<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FP Digital Printing - Sistem Pembukuan</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&display=swap');
        
        body { 
            font-family: 'Poppins', sans-serif; 
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
        }
        
        .sidebar-item:hover { 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
            transform: translateX(4px);
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }
        
        .active-tab { 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
            transform: translateX(4px);
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }
        
        .card-hover:hover { 
            transform: translateY(-8px) scale(1.02); 
            box-shadow: 0 20px 40px rgba(0,0,0,0.15);
            border: 1px solid rgba(102, 126, 234, 0.2);
        }
        
        .gradient-bg { 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
        }
        
        .glass-effect {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .card-gradient {
            background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
            border: 1px solid rgba(102, 126, 234, 0.1);
        }
        
        .status-badge {
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }
        
        .sidebar-gradient {
            background: linear-gradient(180deg, #ffffff 0%, #f8fafc 100%);
            border-right: 1px solid rgba(102, 126, 234, 0.1);
        }
        
        .header-glass {
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.9) 0%, rgba(118, 75, 162, 0.9) 100%);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .input-focus:focus {
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
            transform: translateY(-1px);
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
            transition: all 0.3s ease;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.6);
        }
        
        .table-row:hover {
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.05) 0%, rgba(118, 75, 162, 0.05) 100%);
            transform: translateX(4px);
        }
        
        .stat-card {
            background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
            border: 1px solid rgba(102, 126, 234, 0.1);
            position: relative;
            overflow: hidden;
        }
        
        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        .modal-backdrop {
            background: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(8px);
        }
        
        .modal-content {
            background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
            border: 1px solid rgba(102, 126, 234, 0.2);
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.25);
        }
        
        .icon-gradient {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .animate-fade-in {
            animation: fadeIn 0.5s ease-in-out;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .animate-slide-in {
            animation: slideIn 0.3s ease-out;
        }
        
        @keyframes slideIn {
            from { transform: translateX(-100%); }
            to { transform: translateX(0); }
        }
        
        .price-card-elegant {
            background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
            border: 1px solid rgba(102, 126, 234, 0.1);
            border-radius: 1.5rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
        }
        
        .price-card-elegant:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow: 0 25px 50px rgba(102, 126, 234, 0.15);
            border-color: rgba(102, 126, 234, 0.2);
        }
        
        .price-card-elegant::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.02) 0%, rgba(118, 75, 162, 0.02) 100%);
            border-radius: 1.5rem;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .price-card-elegant:hover::before {
            opacity: 1;
        }
        
        .price-section {
            position: relative;
            padding: 1rem;
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.05) 0%, rgba(147, 51, 234, 0.05) 100%);
            border-radius: 1rem;
            border: 1px solid rgba(59, 130, 246, 0.1);
        }
    </style>
</head>
<body>
    <div class="flex h-screen overflow-hidden">
        <!-- Sidebar -->
        <div class="w-64 sidebar-gradient shadow-xl animate-slide-in">
            <div class="p-6 border-b border-gray-200">
                <div class="flex items-center space-x-3">
                    <div class="w-10 h-10 gradient-bg rounded-xl flex items-center justify-center">
                        <span class="text-white font-bold text-lg">FP</span>
                    </div>
                    <div>
                        <h1 class="text-xl font-bold text-gray-800">FP Digital</h1>
                        <p class="text-sm text-gray-600">Printing System</p>
                    </div>
                </div>
            </div>
            
            <nav class="mt-6 px-4">
                <div class="space-y-2">
                    <button onclick="showTab('dashboard')" class="sidebar-item w-full flex items-center px-4 py-3 text-left text-gray-700 rounded-xl transition-all duration-300 active-tab" id="tab-dashboard">
                        <svg class="w-5 h-5 mr-3" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M3 4a1 1 0 011-1h12a1 1 0 011 1v2a1 1 0 01-1 1H4a1 1 0 01-1-1V4zM3 10a1 1 0 011-1h6a1 1 0 011 1v6a1 1 0 01-1 1H4a1 1 0 01-1-1v-6zM14 9a1 1 0 00-1 1v6a1 1 0 001 1h2a1 1 0 001-1v-6a1 1 0 00-1-1h-2z"></path>
                        </svg>
                        Dashboard
                    </button>
                    

                    
                    <button onclick="showTab('transaksi-harian')" class="sidebar-item w-full flex items-center px-4 py-3 text-left text-gray-700 rounded-xl transition-all duration-300" id="tab-transaksi-harian">
                        <svg class="w-5 h-5 mr-3" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M6 2a1 1 0 00-1 1v1H4a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-1V3a1 1 0 10-2 0v1H7V3a1 1 0 00-1-1zm0 5a1 1 0 000 2h8a1 1 0 100-2H6z" clip-rule="evenodd"></path>
                        </svg>
                        Transaksi Harian
                    </button>
                    
                    <button onclick="showTab('tagihan')" class="sidebar-item w-full flex items-center px-4 py-3 text-left text-gray-700 rounded-xl transition-all duration-300" id="tab-tagihan">
                        <svg class="w-5 h-5 mr-3" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M4 4a2 2 0 012-2h4.586A2 2 0 0112 2.586L15.414 6A2 2 0 0116 7.414V16a2 2 0 01-2 2H6a2 2 0 01-2-2V4zm2 6a1 1 0 011-1h6a1 1 0 110 2H7a1 1 0 01-1-1zm1 3a1 1 0 100 2h6a1 1 0 100-2H7z" clip-rule="evenodd"></path>
                        </svg>
                        Tagihan
                    </button>
                    
                    <button onclick="showTab('surat-jalan')" class="sidebar-item w-full flex items-center px-4 py-3 text-left text-gray-700 rounded-xl transition-all duration-300" id="tab-surat-jalan">
                        <svg class="w-5 h-5 mr-3" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M8 5a1 1 0 100 2h5.586l-1.293 1.293a1 1 0 001.414 1.414l3-3a1 1 0 000-1.414l-3-3a1 1 0 10-1.414 1.414L13.586 5H8zM12 15a1 1 0 100-2H6.414l1.293-1.293a1 1 0 10-1.414-1.414l-3 3a1 1 0 000 1.414l3 3a1 1 0 001.414-1.414L6.414 15H12z"></path>
                        </svg>
                        Surat Jalan
                    </button>
                    
                    <button onclick="showTab('laporan')" class="sidebar-item w-full flex items-center px-4 py-3 text-left text-gray-700 rounded-xl transition-all duration-300" id="tab-laporan">
                        <svg class="w-5 h-5 mr-3" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                            <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a2 2 0 002 2h8a2 2 0 002-2V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                        </svg>
                        Laporan
                    </button>
                    
                    <button onclick="showTab('pelanggan')" class="sidebar-item w-full flex items-center px-4 py-3 text-left text-gray-700 rounded-xl transition-all duration-300" id="tab-pelanggan">
                        <svg class="w-5 h-5 mr-3" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M9 6a3 3 0 11-6 0 3 3 0 016 0zM17 6a3 3 0 11-6 0 3 3 0 016 0zM12.93 17c.046-.327.07-.66.07-1a6.97 6.97 0 00-1.5-4.33A5 5 0 0119 16v1h-6.07zM6 11a5 5 0 015 5v1H1v-1a5 5 0 015-5z"></path>
                        </svg>
                        Pelanggan
                    </button>
                    
                    <button onclick="showTab('harga')" class="sidebar-item w-full flex items-center px-4 py-3 text-left text-gray-700 rounded-xl transition-all duration-300" id="tab-harga">
                        <svg class="w-5 h-5 mr-3" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-13a1 1 0 10-2 0v.092a4.535 4.535 0 00-1.676.662C6.602 6.234 6 7.009 6 8c0 .99.602 1.765 1.324 2.246.48.32 1.054.545 1.676.662v1.941c-.391-.127-.68-.317-.843-.504a1 1 0 10-1.51 1.31c.562.649 1.413 1.076 2.353 1.253V15a1 1 0 102 0v-.092a4.535 4.535 0 001.676-.662C13.398 13.766 14 12.991 14 12c0-.99-.602-1.765-1.324-2.246A4.535 4.535 0 0011 9.092V7.151c.391.127.68.317.843.504a1 1 0 101.511-1.31c-.563-.649-1.413-1.076-2.354-1.253V5z" clip-rule="evenodd"></path>
                        </svg>
                        Daftar Harga
                    </button>
                </div>
            </nav>
        </div>

        <!-- Main Content -->
        <div class="flex-1 flex flex-col overflow-hidden">
            <!-- Header -->
            <header class="header-glass shadow-lg">
                <div class="flex items-center justify-between px-6 py-4">
                    <div>
                        <h2 class="text-2xl font-bold text-white" id="page-title">Dashboard</h2>
                        <p class="text-blue-100" id="page-subtitle">Ringkasan aktivitas bisnis Anda</p>
                    </div>
                    <div class="flex items-center space-x-4">
                        <div class="text-right text-white">
                            <p class="text-sm opacity-90">Selamat datang,</p>
                            <p class="font-semibold">Admin FP Digital</p>
                        </div>
                        <div class="w-10 h-10 bg-white bg-opacity-20 rounded-full flex items-center justify-center">
                            <svg class="w-6 h-6 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </div>
            </header>

            <!-- Content Area -->
            <main class="flex-1 overflow-y-auto p-6">
                <!-- Dashboard Tab -->
                <div id="content-dashboard" class="animate-fade-in">
                    <!-- Stats Cards -->
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                        <div class="stat-card rounded-2xl p-6 card-hover transition-all duration-300">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-sm font-medium text-gray-600">Total Penjualan</p>
                                    <p class="text-3xl font-bold text-gray-900" id="total-sales">Rp 0</p>
                                    <p class="text-sm text-green-600 mt-1">+12% dari bulan lalu</p>
                                </div>
                                <div class="w-12 h-12 gradient-bg rounded-xl flex items-center justify-center">
                                    <svg class="w-6 h-6 text-white" fill="currentColor" viewBox="0 0 20 20">
                                        <path d="M4 4a2 2 0 00-2 2v4a2 2 0 002 2V6h10a2 2 0 00-2-2H4zm2 6a2 2 0 012-2h8a2 2 0 012 2v4a2 2 0 01-2 2H8a2 2 0 01-2-2v-4zm6 4a2 2 0 100-4 2 2 0 000 4z"></path>
                                    </svg>
                                </div>
                            </div>
                        </div>

                        <div class="stat-card rounded-2xl p-6 card-hover transition-all duration-300">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-sm font-medium text-gray-600">Transaksi Hari Ini</p>
                                    <p class="text-3xl font-bold text-gray-900" id="today-transactions">0</p>
                                    <p class="text-sm text-blue-600 mt-1">Aktif</p>
                                </div>
                                <div class="w-12 h-12 gradient-bg rounded-xl flex items-center justify-center">
                                    <svg class="w-6 h-6 text-white" fill="currentColor" viewBox="0 0 20 20">
                                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                                    </svg>
                                </div>
                            </div>
                        </div>

                        <div class="stat-card rounded-2xl p-6 card-hover transition-all duration-300">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-sm font-medium text-gray-600">Total Pelanggan</p>
                                    <p class="text-3xl font-bold text-gray-900" id="total-customers">0</p>
                                    <p class="text-sm text-purple-600 mt-1">Terdaftar</p>
                                </div>
                                <div class="w-12 h-12 gradient-bg rounded-xl flex items-center justify-center">
                                    <svg class="w-6 h-6 text-white" fill="currentColor" viewBox="0 0 20 20">
                                        <path d="M9 6a3 3 0 11-6 0 3 3 0 016 0zM17 6a3 3 0 11-6 0 3 3 0 016 0zM12.93 17c.046-.327.07-.66.07-1a6.97 6.97 0 00-1.5-4.33A5 5 0 0119 16v1h-6.07zM6 11a5 5 0 015 5v1H1v-1a5 5 0 015-5z"></path>
                                    </svg>
                                </div>
                            </div>
                        </div>

                        <div class="stat-card rounded-2xl p-6 card-hover transition-all duration-300">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-sm font-medium text-gray-600">Keuntungan Bulan Ini</p>
                                    <p class="text-3xl font-bold text-gray-900" id="monthly-profit">Rp 0</p>
                                    <p class="text-sm text-green-600 mt-1">+8% dari target</p>
                                </div>
                                <div class="w-12 h-12 gradient-bg rounded-xl flex items-center justify-center">
                                    <svg class="w-6 h-6 text-white" fill="currentColor" viewBox="0 0 20 20">
                                        <path fill-rule="evenodd" d="M12 7a1 1 0 110-2h5a1 1 0 011 1v5a1 1 0 11-2 0V8.414l-4.293 4.293a1 1 0 01-1.414 0L8 10.414l-4.293 4.293a1 1 0 01-1.414-1.414l5-5a1 1 0 011.414 0L11 10.586 14.586 7H12z" clip-rule="evenodd"></path>
                                    </svg>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Invoice Stats Cards -->
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                        <div class="stat-card rounded-2xl p-6 card-hover transition-all duration-300">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-sm font-medium text-gray-600">Tagihan Belum Dibayar</p>
                                    <p class="text-3xl font-bold text-red-600" id="dashboard-unpaid-invoices">0</p>
                                    <p class="text-sm text-red-600 mt-1">Perlu tindak lanjut</p>
                                </div>
                                <div class="w-12 h-12 bg-red-500 rounded-xl flex items-center justify-center">
                                    <svg class="w-6 h-6 text-white" fill="currentColor" viewBox="0 0 20 20">
                                        <path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd"></path>
                                    </svg>
                                </div>
                            </div>
                        </div>

                        <div class="stat-card rounded-2xl p-6 card-hover transition-all duration-300">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-sm font-medium text-gray-600">Total Piutang</p>
                                    <p class="text-3xl font-bold text-orange-600" id="dashboard-total-receivables">Rp 0</p>
                                    <p class="text-sm text-orange-600 mt-1">Belum terbayar</p>
                                </div>
                                <div class="w-12 h-12 bg-orange-500 rounded-xl flex items-center justify-center">
                                    <svg class="w-6 h-6 text-white" fill="currentColor" viewBox="0 0 20 20">
                                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-13a1 1 0 10-2 0v.092a4.535 4.535 0 00-1.676.662C6.602 6.234 6 7.009 6 8c0 .99.602 1.765 1.324 2.246.48.32 1.054.545 1.676.662v1.941c-.391-.127-.68-.317-.843-.504a1 1 0 10-1.51 1.31c.562.649 1.413 1.076 2.353 1.253V15a1 1 0 102 0v-.092a4.535 4.535 0 001.676-.662C13.398 13.766 14 12.991 14 12c0-.99-.602-1.765-1.324-2.246A4.535 4.535 0 0011 9.092V7.151c.391.127.68.317.843.504a1 1 0 101.511-1.31c-.563-.649-1.413-1.076-2.354-1.253V5z" clip-rule="evenodd"></path>
                                    </svg>
                                </div>
                            </div>
                        </div>

                        <div class="stat-card rounded-2xl p-6 card-hover transition-all duration-300">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-sm font-medium text-gray-600">Tagihan Lunas</p>
                                    <p class="text-3xl font-bold text-green-600" id="dashboard-paid-invoices">0</p>
                                    <p class="text-sm text-green-600 mt-1">Terbayar</p>
                                </div>
                                <div class="w-12 h-12 bg-green-500 rounded-xl flex items-center justify-center">
                                    <svg class="w-6 h-6 text-white" fill="currentColor" viewBox="0 0 20 20">
                                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>
                                    </svg>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Dashboard Content Grid -->
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
                        <!-- Recent Transactions -->
                        <div class="card-gradient rounded-2xl p-6 shadow-lg">
                            <div class="flex items-center justify-between mb-6">
                                <h3 class="text-xl font-bold text-gray-900">Transaksi Terbaru</h3>
                                <button onclick="showTab('transaksi-harian')" class="text-blue-600 hover:text-blue-800 font-medium">Lihat Semua</button>
                            </div>
                            <div class="overflow-x-auto">
                                <table class="w-full">
                                    <thead>
                                        <tr class="border-b border-gray-200">
                                            <th class="text-left py-3 px-4 font-semibold text-gray-700">ID</th>
                                            <th class="text-left py-3 px-4 font-semibold text-gray-700">Pelanggan</th>
                                            <th class="text-left py-3 px-4 font-semibold text-gray-700">Total</th>
                                            <th class="text-left py-3 px-4 font-semibold text-gray-700">Status</th>
                                        </tr>
                                    </thead>
                                    <tbody id="recent-transactions">
                                        <tr class="table-row transition-all duration-300">
                                            <td class="py-3 px-4 text-gray-600">#001</td>
                                            <td class="py-3 px-4 text-gray-900 font-medium">Budi Santoso</td>
                                            <td class="py-3 px-4 text-gray-900 font-semibold">Rp 150.000</td>
                                            <td class="py-3 px-4">
                                                <span class="px-3 py-1 bg-green-100 text-green-800 rounded-full text-sm font-medium">Selesai</span>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <!-- Recent Invoices -->
                        <div class="card-gradient rounded-2xl p-6 shadow-lg">
                            <div class="flex items-center justify-between mb-6">
                                <h3 class="text-xl font-bold text-gray-900">Tagihan Terbaru</h3>
                                <div class="flex space-x-2">
                                    <button onclick="openInvoiceModal()" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg text-sm font-medium transition-all duration-300">
                                        + Buat
                                    </button>
                                    <button onclick="showTab('tagihan')" class="text-blue-600 hover:text-blue-800 font-medium">Lihat Semua</button>
                                </div>
                            </div>
                            <div class="overflow-x-auto">
                                <table class="w-full">
                                    <thead>
                                        <tr class="border-b border-gray-200">
                                            <th class="text-left py-3 px-4 font-semibold text-gray-700">No.</th>
                                            <th class="text-left py-3 px-4 font-semibold text-gray-700">Pelanggan</th>
                                            <th class="text-left py-3 px-4 font-semibold text-gray-700">Jumlah</th>
                                            <th class="text-left py-3 px-4 font-semibold text-gray-700">Status</th>
                                            <th class="text-left py-3 px-4 font-semibold text-gray-700">Aksi</th>
                                        </tr>
                                    </thead>
                                    <tbody id="dashboard-recent-invoices">
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <!-- All Invoices Table -->
                    <div class="card-gradient rounded-2xl p-6 shadow-lg">
                        <div class="flex items-center justify-between mb-6">
                            <h3 class="text-xl font-bold text-gray-900">Semua Tagihan</h3>
                            <button onclick="openInvoiceModal()" class="btn-primary text-white px-6 py-3 rounded-xl font-semibold">
                                + Buat Tagihan
                            </button>
                        </div>
                        <div class="overflow-x-auto">
                            <table class="w-full">
                                <thead>
                                    <tr class="border-b border-gray-200">
                                        <th class="text-left py-4 px-4 font-semibold text-gray-700">No. Tagihan</th>
                                        <th class="text-left py-4 px-4 font-semibold text-gray-700">Tanggal</th>
                                        <th class="text-left py-4 px-4 font-semibold text-gray-700">Pelanggan</th>
                                        <th class="text-left py-4 px-4 font-semibold text-gray-700">Jumlah</th>
                                        <th class="text-left py-4 px-4 font-semibold text-gray-700">Jatuh Tempo</th>
                                        <th class="text-left py-4 px-4 font-semibold text-gray-700">Status</th>
                                        <th class="text-left py-4 px-4 font-semibold text-gray-700">Aksi</th>
                                    </tr>
                                </thead>
                                <tbody id="dashboard-invoices-table">
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>



                <!-- Transaksi Harian Tab -->
                <div id="content-transaksi-harian" class="hidden animate-fade-in">
                    <div class="flex justify-between items-center mb-6">
                        <div>
                            <h3 class="text-2xl font-bold text-gray-900">Transaksi Harian</h3>
                            <p class="text-gray-600">Ringkasan transaksi per hari</p>
                        </div>
                        <div class="flex space-x-3">
                            <input type="date" id="daily-date" class="px-4 py-2 border border-gray-300 rounded-xl input-focus" value="">
                            <button onclick="filterDailyTransactions()" class="btn-primary text-white px-6 py-2 rounded-xl font-semibold">
                                Filter
                            </button>
                            <button onclick="openDailyTransactionModal()" class="btn-primary text-white px-8 py-3 rounded-xl font-semibold flex items-center space-x-3 shadow-lg hover:shadow-xl transform hover:scale-105 transition-all duration-300">
                                <div class="w-6 h-6 bg-white bg-opacity-20 rounded-lg flex items-center justify-center">
                                    <svg class="w-4 h-4 text-white" fill="currentColor" viewBox="0 0 20 20">
                                        <path fill-rule="evenodd" d="M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z" clip-rule="evenodd"></path>
                                    </svg>
                                </div>
                                <span>Buat Transaksi</span>
                            </button>
                        </div>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
                        <div class="stat-card rounded-2xl p-6">
                            <h4 class="text-lg font-semibold text-gray-700 mb-2">Total Transaksi Hari Ini</h4>
                            <p class="text-3xl font-bold text-blue-600" id="daily-total-transactions">0</p>
                        </div>
                        <div class="stat-card rounded-2xl p-6">
                            <h4 class="text-lg font-semibold text-gray-700 mb-2">Pendapatan Hari Ini</h4>
                            <p class="text-3xl font-bold text-green-600" id="daily-revenue">Rp 0</p>
                        </div>
                        <div class="stat-card rounded-2xl p-6">
                            <h4 class="text-lg font-semibold text-gray-700 mb-2">Rata-rata per Transaksi</h4>
                            <p class="text-3xl font-bold text-purple-600" id="daily-average">Rp 0</p>
                        </div>
                    </div>

                    <div class="card-gradient rounded-2xl p-6 shadow-lg">
                        <h4 class="text-lg font-bold text-gray-900 mb-4">Detail Transaksi</h4>
                        <div class="overflow-x-auto">
                            <table class="w-full">
                                <thead>
                                    <tr class="border-b border-gray-200">
                                        <th class="text-left py-3 px-4 font-semibold text-gray-700">Waktu</th>
                                        <th class="text-left py-3 px-4 font-semibold text-gray-700">ID</th>
                                        <th class="text-left py-3 px-4 font-semibold text-gray-700">Pelanggan</th>
                                        <th class="text-left py-3 px-4 font-semibold text-gray-700">Layanan</th>
                                        <th class="text-left py-3 px-4 font-semibold text-gray-700">Total</th>
                                        <th class="text-left py-3 px-4 font-semibold text-gray-700">Status</th>
                                    </tr>
                                </thead>
                                <tbody id="daily-transactions-table">
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Tagihan Tab -->
                <div id="content-tagihan" class="hidden animate-fade-in">
                    <div class="flex justify-between items-center mb-6">
                        <div>
                            <h3 class="text-2xl font-bold text-gray-900">Transaksi Tagihan</h3>
                            <p class="text-gray-600">Kelola tagihan dan pembayaran</p>
                        </div>
                        <button onclick="openInvoiceModal()" class="btn-primary text-white px-6 py-3 rounded-xl font-semibold">
                            + Buat Tagihan
                        </button>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
                        <div class="stat-card rounded-2xl p-6">
                            <h4 class="text-lg font-semibold text-gray-700 mb-2">Tagihan Belum Dibayar</h4>
                            <p class="text-3xl font-bold text-red-600" id="unpaid-invoices">0</p>
                        </div>
                        <div class="stat-card rounded-2xl p-6">
                            <h4 class="text-lg font-semibold text-gray-700 mb-2">Total Piutang</h4>
                            <p class="text-3xl font-bold text-orange-600" id="total-receivables">Rp 0</p>
                        </div>
                        <div class="stat-card rounded-2xl p-6">
                            <h4 class="text-lg font-semibold text-gray-700 mb-2">Tagihan Lunas</h4>
                            <p class="text-3xl font-bold text-green-600" id="paid-invoices">0</p>
                        </div>
                    </div>

                    <div class="card-gradient rounded-2xl p-6 shadow-lg">
                        <div class="overflow-x-auto">
                            <table class="w-full">
                                <thead>
                                    <tr class="border-b border-gray-200">
                                        <th class="text-left py-4 px-4 font-semibold text-gray-700">No. Tagihan</th>
                                        <th class="text-left py-4 px-4 font-semibold text-gray-700">Tanggal</th>
                                        <th class="text-left py-4 px-4 font-semibold text-gray-700">Pelanggan</th>
                                        <th class="text-left py-4 px-4 font-semibold text-gray-700">Jumlah</th>
                                        <th class="text-left py-4 px-4 font-semibold text-gray-700">Jatuh Tempo</th>
                                        <th class="text-left py-4 px-4 font-semibold text-gray-700">Status</th>
                                        <th class="text-left py-4 px-4 font-semibold text-gray-700">Aksi</th>
                                    </tr>
                                </thead>
                                <tbody id="invoices-table">
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Surat Jalan Tab -->
                <div id="content-surat-jalan" class="hidden animate-fade-in">
                    <div class="flex justify-between items-center mb-6">
                        <div>
                            <h3 class="text-2xl font-bold text-gray-900">Surat Jalan</h3>
                            <p class="text-gray-600">Kelola pengiriman dan surat jalan</p>
                        </div>
                        <button onclick="openDeliveryModal()" class="btn-primary text-white px-6 py-3 rounded-xl font-semibold">
                            + Buat Surat Jalan
                        </button>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-6">
                        <div class="stat-card rounded-2xl p-6">
                            <h4 class="text-lg font-semibold text-gray-700 mb-2">Menunggu Kirim</h4>
                            <p class="text-3xl font-bold text-yellow-600" id="pending-deliveries">0</p>
                        </div>
                        <div class="stat-card rounded-2xl p-6">
                            <h4 class="text-lg font-semibold text-gray-700 mb-2">Dalam Perjalanan</h4>
                            <p class="text-3xl font-bold text-blue-600" id="in-transit-deliveries">0</p>
                        </div>
                        <div class="stat-card rounded-2xl p-6">
                            <h4 class="text-lg font-semibold text-gray-700 mb-2">Terkirim</h4>
                            <p class="text-3xl font-bold text-green-600" id="delivered-deliveries">0</p>
                        </div>
                        <div class="stat-card rounded-2xl p-6">
                            <h4 class="text-lg font-semibold text-gray-700 mb-2">Total Pengiriman</h4>
                            <p class="text-3xl font-bold text-purple-600" id="total-deliveries">0</p>
                        </div>
                    </div>

                    <div class="card-gradient rounded-2xl p-6 shadow-lg">
                        <div class="overflow-x-auto">
                            <table class="w-full">
                                <thead>
                                    <tr class="border-b border-gray-200">
                                        <th class="text-left py-4 px-4 font-semibold text-gray-700">No. Surat Jalan</th>
                                        <th class="text-left py-4 px-4 font-semibold text-gray-700">Tanggal</th>
                                        <th class="text-left py-4 px-4 font-semibold text-gray-700">Pelanggan</th>
                                        <th class="text-left py-4 px-4 font-semibold text-gray-700">Alamat Tujuan</th>
                
                                        <th class="text-left py-4 px-4 font-semibold text-gray-700">Status</th>
                                        <th class="text-left py-4 px-4 font-semibold text-gray-700">Aksi</th>
                                    </tr>
                                </thead>
                                <tbody id="deliveries-table">
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Laporan Tab -->
                <div id="content-laporan" class="hidden animate-fade-in">
                    <div class="mb-6">
                        <h3 class="text-2xl font-bold text-gray-900">Laporan Keuangan</h3>
                        <p class="text-gray-600">Analisis performa bisnis Anda</p>
                    </div>

                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
                        <div class="card-gradient rounded-2xl p-6 shadow-lg">
                            <h4 class="text-lg font-bold text-gray-900 mb-4">Filter Laporan</h4>
                            <div class="space-y-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Periode</label>
                                    <select id="report-period" class="w-full px-4 py-3 border border-gray-300 rounded-xl input-focus transition-all duration-300">
                                        <option value="today">Hari Ini</option>
                                        <option value="week">Minggu Ini</option>
                                        <option value="month">Bulan Ini</option>
                                        <option value="year">Tahun Ini</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Jenis Laporan</label>
                                    <select id="report-type" class="w-full px-4 py-3 border border-gray-300 rounded-xl input-focus transition-all duration-300">
                                        <option value="financial">Laporan Keuangan</option>
                                        <option value="sales">Laporan Penjualan</option>
                                        <option value="customer">Laporan Pelanggan</option>
                                        <option value="invoice">Laporan Tagihan</option>
                                        <option value="delivery">Laporan Pengiriman</option>
                                    </select>
                                </div>
                                <button onclick="generateReport()" class="w-full btn-primary text-white py-3 rounded-xl font-semibold">
                                    Generate Laporan
                                </button>
                            </div>
                        </div>

                        <div class="card-gradient rounded-2xl p-6 shadow-lg">
                            <h4 class="text-lg font-bold text-gray-900 mb-4">Ringkasan Keuangan</h4>
                            <div class="space-y-4">
                                <div class="flex justify-between items-center p-3 bg-green-50 rounded-xl">
                                    <span class="text-gray-700">Total Pemasukan</span>
                                    <span class="font-bold text-green-600" id="total-income">Rp 0</span>
                                </div>
                                <div class="flex justify-between items-center p-3 bg-red-50 rounded-xl">
                                    <span class="text-gray-700">Total Pengeluaran</span>
                                    <span class="font-bold text-red-600" id="total-expense">Rp 0</span>
                                </div>
                                <div class="flex justify-between items-center p-3 bg-blue-50 rounded-xl">
                                    <span class="text-gray-700">Keuntungan Bersih</span>
                                    <span class="font-bold text-blue-600" id="net-profit">Rp 0</span>
                                </div>
                                <div class="flex justify-between items-center p-3 bg-purple-50 rounded-xl">
                                    <span class="text-gray-700">Piutang Belum Lunas</span>
                                    <span class="font-bold text-purple-600" id="outstanding-receivables">Rp 0</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Detailed Reports -->
                    <div class="card-gradient rounded-2xl p-6 shadow-lg">
                        <h4 class="text-lg font-bold text-gray-900 mb-4">Detail Laporan</h4>
                        <div id="report-content">
                            <p class="text-gray-600 text-center py-8">Pilih periode dan jenis laporan, lalu klik "Generate Laporan" untuk melihat detail.</p>
                        </div>
                    </div>
                </div>

                <!-- Pelanggan Tab -->
                <div id="content-pelanggan" class="hidden animate-fade-in">
                    <div class="flex justify-between items-center mb-6">
                        <div>
                            <h3 class="text-2xl font-bold text-gray-900">Data Pelanggan</h3>
                            <p class="text-gray-600">Kelola informasi pelanggan Anda</p>
                        </div>
                        <button onclick="openCustomerModal()" class="btn-primary text-white px-6 py-3 rounded-xl font-semibold">
                            + Tambah Pelanggan
                        </button>
                    </div>

                    <div class="card-gradient rounded-2xl p-6 shadow-lg">
                        <div class="overflow-x-auto">
                            <table class="w-full">
                                <thead>
                                    <tr class="border-b border-gray-200">
                                        <th class="text-left py-4 px-4 font-semibold text-gray-700">ID</th>
                                        <th class="text-left py-4 px-4 font-semibold text-gray-700">Nama</th>
                                        <th class="text-left py-4 px-4 font-semibold text-gray-700">Email</th>
                                        <th class="text-left py-4 px-4 font-semibold text-gray-700">Telepon</th>
                                        <th class="text-left py-4 px-4 font-semibold text-gray-700">Total Transaksi</th>
                                        <th class="text-left py-4 px-4 font-semibold text-gray-700">Aksi</th>
                                    </tr>
                                </thead>
                                <tbody id="customers-table">
                                    <!-- Customers will be populated here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Harga Tab -->
                <div id="content-harga" class="hidden animate-fade-in">
                    <div class="flex justify-between items-center mb-6">
                        <div>
                            <h3 class="text-2xl font-bold text-gray-900">Daftar Harga Cetakan</h3>
                            <p class="text-gray-600">Kelola harga untuk setiap jenis cetakan</p>
                        </div>
                        <button onclick="openPriceModal()" class="btn-primary text-white px-6 py-3 rounded-xl font-semibold">
                            + Tambah Jenis Cetakan
                        </button>
                    </div>

                    <div id="price-cards-container">
                        <!-- Price table will be populated here -->
                    </div>
                </div>
            </main>
        </div>
    </div>



    <!-- Invoice Modal -->
    <div id="invoice-modal" class="fixed inset-0 modal-backdrop hidden items-center justify-center z-50">
        <div class="modal-content rounded-2xl p-0 max-w-4xl w-full mx-4 max-h-[95vh] overflow-hidden">
            <!-- Modal Header -->
            <div class="header-glass p-6 border-b border-white border-opacity-20">
                <div class="flex justify-between items-center">
                    <div class="flex items-center space-x-3">
                        <div class="w-10 h-10 bg-white bg-opacity-20 rounded-xl flex items-center justify-center">
                            <svg class="w-6 h-6 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M4 4a2 2 0 012-2h4.586A2 2 0 0112 2.586L15.414 6A2 2 0 0116 7.414V16a2 2 0 01-2 2H6a2 2 0 01-2-2V4zm2 6a1 1 0 011-1h6a1 1 0 110 2H7a1 1 0 01-1-1zm1 3a1 1 0 100 2h6a1 1 0 100-2H7z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                        <div>
                            <h3 class="text-xl font-bold text-white">Buat Tagihan Baru</h3>
                            <p class="text-blue-100 text-sm">Sistem tagihan terintegrasi FP Digital</p>
                        </div>
                    </div>
                    <button onclick="closeInvoiceModal()" class="text-white hover:text-blue-200 transition-colors duration-300">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    </button>
                </div>
            </div>

            <!-- Modal Content -->
            <div class="overflow-y-auto max-h-[calc(95vh-120px)]">
                <form id="invoice-form" class="p-6">
                    <!-- Step Indicator -->
                    <div class="mb-8">
                        <div class="flex items-center justify-center space-x-4">
                            <div class="flex items-center">
                                <div class="w-8 h-8 bg-blue-600 text-white rounded-full flex items-center justify-center text-sm font-semibold" id="step-1-indicator">1</div>
                                <span class="ml-2 text-sm font-medium text-blue-600" id="step-1-text">Pilih Pelanggan</span>
                            </div>
                            <div class="w-16 h-0.5 bg-gray-300" id="step-1-2-line"></div>
                            <div class="flex items-center">
                                <div class="w-8 h-8 bg-gray-300 text-gray-500 rounded-full flex items-center justify-center text-sm font-semibold" id="step-2-indicator">2</div>
                                <span class="ml-2 text-sm font-medium text-gray-500" id="step-2-text">Tambah Item</span>
                            </div>
                            <div class="w-16 h-0.5 bg-gray-300" id="step-2-3-line"></div>
                            <div class="flex items-center">
                                <div class="w-8 h-8 bg-gray-300 text-gray-500 rounded-full flex items-center justify-center text-sm font-semibold" id="step-3-indicator">3</div>
                                <span class="ml-2 text-sm font-medium text-gray-500" id="step-3-text">Detail & Konfirmasi</span>
                            </div>
                        </div>
                    </div>

                    <!-- Step 1: Customer Selection -->
                    <div id="invoice-step-1" class="space-y-6">
                        <div class="text-center mb-6">
                            <h4 class="text-2xl font-bold text-gray-900 mb-2">Pilih atau Tambah Pelanggan</h4>
                            <p class="text-gray-600">Mulai dengan memilih pelanggan existing atau tambah pelanggan baru</p>
                        </div>

                        <!-- Customer Selection Options -->
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <!-- Existing Customer Card -->
                            <div class="card-gradient rounded-2xl p-6 border-2 border-transparent hover:border-blue-200 transition-all duration-300 cursor-pointer" onclick="selectCustomerOption('existing')">
                                <div class="text-center">
                                    <div class="w-16 h-16 gradient-bg rounded-2xl flex items-center justify-center mx-auto mb-4">
                                        <svg class="w-8 h-8 text-white" fill="currentColor" viewBox="0 0 20 20">
                                            <path d="M9 6a3 3 0 11-6 0 3 3 0 016 0zM17 6a3 3 0 11-6 0 3 3 0 016 0zM12.93 17c.046-.327.07-.66.07-1a6.97 6.97 0 00-1.5-4.33A5 5 0 0119 16v1h-6.07zM6 11a5 5 0 015 5v1H1v-1a5 5 0 015-5z"></path>
                                        </svg>
                                    </div>
                                    <h5 class="text-lg font-bold text-gray-900 mb-2">Pelanggan Existing</h5>
                                    <p class="text-gray-600 text-sm mb-4">Pilih dari ${customers.length} pelanggan terdaftar</p>
                                    <div class="text-blue-600 font-medium">Pilih Pelanggan </div>
                                </div>
                            </div>

                            <!-- New Customer Card -->
                            <div class="card-gradient rounded-2xl p-6 border-2 border-transparent hover:border-green-200 transition-all duration-300 cursor-pointer" onclick="selectCustomerOption('new')">
                                <div class="text-center">
                                    <div class="w-16 h-16 bg-green-500 rounded-2xl flex items-center justify-center mx-auto mb-4">
                                        <svg class="w-8 h-8 text-white" fill="currentColor" viewBox="0 0 20 20">
                                            <path fill-rule="evenodd" d="M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z" clip-rule="evenodd"></path>
                                        </svg>
                                    </div>
                                    <h5 class="text-lg font-bold text-gray-900 mb-2">Pelanggan Baru</h5>
                                    <p class="text-gray-600 text-sm mb-4">Tambah pelanggan baru ke sistem</p>
                                    <div class="text-green-600 font-medium">Tambah Baru </div>
                                </div>
                            </div>
                        </div>

                        <!-- Existing Customer Selection -->
                        <div id="existing-customer-section" class="hidden space-y-4">
                            <div class="relative">
                                <input type="text" id="smart-customer-input" class="w-full px-4 py-4 border border-gray-300 rounded-xl input-focus transition-all duration-300 text-lg" placeholder=" Cari nama pelanggan..." oninput="handleSmartCustomerInput()">
                            </div>
                            
                            <!-- Customer Grid -->
                            <div id="customers-grid" class="grid grid-cols-1 md:grid-cols-2 gap-4 max-h-64 overflow-y-auto">
                                <!-- Customers will be populated here -->
                            </div>
                        </div>

                        <!-- New Customer Form -->
                        <div id="new-customer-section" class="hidden space-y-4">
                            <div class="card-gradient rounded-xl p-6">
                                <h5 class="text-lg font-bold text-gray-900 mb-4">Informasi Pelanggan Baru</h5>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div class="md:col-span-2">
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Nama Lengkap *</label>
                                        <input type="text" id="new-customer-name" class="w-full px-4 py-3 border border-gray-300 rounded-xl input-focus" placeholder="Masukkan nama lengkap" required>
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Email</label>
                                        <input type="email" id="new-customer-email" class="w-full px-4 py-3 border border-gray-300 rounded-xl input-focus" placeholder="email@contoh.com">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Nomor Telepon</label>
                                        <input type="tel" id="new-customer-phone" class="w-full px-4 py-3 border border-gray-300 rounded-xl input-focus" placeholder="08xxxxxxxxxx">
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Selected Customer Display -->
                        <div id="selected-customer-display" class="hidden">
                            <div class="bg-green-50 border border-green-200 rounded-xl p-4">
                                <div class="flex items-center justify-between">
                                    <div class="flex items-center space-x-3">
                                        <div class="w-10 h-10 bg-green-500 rounded-full flex items-center justify-center">
                                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                                <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                                            </svg>
                                        </div>
                                        <div>
                                            <div class="font-semibold text-green-800">Pelanggan Terpilih</div>
                                            <div id="customer-info" class="text-sm text-green-700"></div>
                                        </div>
                                    </div>
                                    <button type="button" onclick="clearCustomerSelection()" class="text-green-600 hover:text-green-800 font-medium">
                                        Ubah
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- Step 1 Navigation -->
                        <div class="flex justify-end pt-6">
                            <button type="button" id="step-1-next" onclick="goToStep(2)" class="btn-primary text-white px-8 py-3 rounded-xl font-semibold disabled:opacity-50 disabled:cursor-not-allowed" disabled>
                                Lanjut ke Item Tagihan 
                            </button>
                        </div>
                    </div>

                    <!-- Step 2: Items -->
                    <div id="invoice-step-2" class="hidden space-y-6">
                        <div class="text-center mb-6">
                            <h4 class="text-2xl font-bold text-gray-900 mb-2">Tambah Item Tagihan</h4>
                            <p class="text-gray-600">Pilih jenis cetakan dan tentukan jumlahnya</p>
                        </div>

                        <div id="invoice-items" class="space-y-4">
                            <!-- Items will be added here -->
                        </div>
                        
                        <div class="flex justify-between items-center p-4 bg-blue-50 rounded-xl">
                            <button type="button" onclick="addInvoiceItem()" class="flex items-center space-x-2 text-blue-600 hover:text-blue-800 font-medium">
                                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z" clip-rule="evenodd"></path>
                                </svg>
                                <span>Tambah Item Lainnya</span>
                            </button>
                            <div class="text-right">
                                <p class="text-sm text-gray-600">Total Tagihan:</p>
                                <p class="text-2xl font-bold text-gray-900" id="invoice-total">Rp 0</p>
                            </div>
                        </div>

                        <!-- Step 2 Navigation -->
                        <div class="flex justify-between pt-6">
                            <button type="button" onclick="goToStep(1)" class="px-6 py-3 border border-gray-300 text-gray-700 rounded-xl hover:bg-gray-50 transition-all duration-300">
                                 Kembali
                            </button>
                            <button type="button" id="step-2-next" onclick="goToStep(3)" class="btn-primary text-white px-8 py-3 rounded-xl font-semibold disabled:opacity-50 disabled:cursor-not-allowed" disabled>
                                Lanjut ke Konfirmasi 
                            </button>
                        </div>
                    </div>

                    <!-- Step 3: Details & Confirmation -->
                    <div id="invoice-step-3" class="hidden space-y-6">
                        <div class="text-center mb-6">
                            <h4 class="text-2xl font-bold text-gray-900 mb-2">Detail & Konfirmasi</h4>
                            <p class="text-gray-600">Lengkapi informasi tagihan dan konfirmasi</p>
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Tanggal Jatuh Tempo *</label>
                                <input type="date" id="invoice-due-date" class="w-full px-4 py-3 border border-gray-300 rounded-xl input-focus transition-all duration-300" required>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Prioritas</label>
                                <select id="invoice-priority" class="w-full px-4 py-3 border border-gray-300 rounded-xl input-focus transition-all duration-300">
                                    <option value="normal">Normal</option>
                                    <option value="urgent">Mendesak</option>
                                    <option value="low">Rendah</option>
                                </select>
                            </div>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Catatan Tambahan</label>
                            <textarea id="invoice-description" class="w-full px-4 py-3 border border-gray-300 rounded-xl input-focus transition-all duration-300" rows="4" placeholder="Tambahkan catatan khusus untuk tagihan ini..."></textarea>
                        </div>

                        <!-- Invoice Summary -->
                        <div class="card-gradient rounded-xl p-6">
                            <h5 class="text-lg font-bold text-gray-900 mb-4">Ringkasan Tagihan</h5>
                            <div id="invoice-summary" class="space-y-3">
                                <!-- Summary will be populated here -->
                            </div>
                        </div>

                        <!-- Step 3 Navigation -->
                        <div class="flex justify-between pt-6">
                            <button type="button" onclick="goToStep(2)" class="px-6 py-3 border border-gray-300 text-gray-700 rounded-xl hover:bg-gray-50 transition-all duration-300">
                                 Kembali
                            </button>
                            <button type="submit" class="btn-primary text-white px-8 py-3 rounded-xl font-semibold">
                                 Buat Tagihan
                            </button>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Delivery Modal -->
    <div id="delivery-modal" class="fixed inset-0 modal-backdrop hidden items-center justify-center z-50">
        <div class="modal-content rounded-2xl p-0 max-w-2xl w-full mx-4 max-h-[90vh] overflow-hidden">
            <!-- Modal Header -->
            <div class="header-glass p-6 border-b border-white border-opacity-20">
                <div class="flex justify-between items-center">
                    <div class="flex items-center space-x-3">
                        <div class="w-10 h-10 bg-white bg-opacity-20 rounded-xl flex items-center justify-center">
                            <svg class="w-6 h-6 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M8 5a1 1 0 100 2h5.586l-1.293 1.293a1 1 0 001.414 1.414l3-3a1 1 0 000-1.414l-3-3a1 1 0 10-1.414 1.414L13.586 5H8zM12 15a1 1 0 100-2H6.414l1.293-1.293a1 1 0 10-1.414-1.414l-3 3a1 1 0 000 1.414l3 3a1 1 0 001.414-1.414L6.414 15H12z"></path>
                            </svg>
                        </div>
                        <div>
                            <h3 class="text-xl font-bold text-white">Buat Surat Jalan</h3>
                            <p class="text-blue-100 text-sm">Kelola pengiriman barang ke pelanggan</p>
                        </div>
                    </div>
                    <button onclick="closeDeliveryModal()" class="text-white hover:text-blue-200 transition-colors duration-300">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    </button>
                </div>
            </div>

            <!-- Modal Content -->
            <div class="overflow-y-auto max-h-[calc(90vh-120px)]">
                <form id="delivery-form" class="p-6 space-y-6">
                    <!-- Customer Selection -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Pelanggan</label>
                        <div class="relative">
                            <select id="delivery-customer" class="w-full px-4 py-3 border border-gray-300 rounded-xl input-focus transition-all duration-300" required>
                                <option value="">Pilih Pelanggan</option>
                            </select>
                        </div>
                    </div>

                    <!-- Customer Orders Section -->
                    <div id="customer-orders-section" class="hidden">
                        <div class="flex items-center justify-between mb-3">
                            <label class="block text-sm font-medium text-gray-700">Pesanan Pelanggan</label>
                            <button type="button" onclick="loadSelectedOrders()" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg text-sm font-medium transition-all duration-300">
                                 Muat Pesanan Terpilih
                            </button>
                        </div>
                        <div class="bg-gray-50 rounded-xl p-4 max-h-64 overflow-y-auto">
                            <div id="customer-orders-list" class="space-y-3">
                                <!-- Orders will be populated here -->
                            </div>
                        </div>
                        <div class="text-xs text-gray-500 mt-2">
                             Pilih pesanan yang akan dikirim, lalu klik "Muat Pesanan Terpilih" untuk sinkronisasi otomatis
                        </div>
                    </div>

                    <!-- Items Section -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Barang yang Dikirim</label>
                        <textarea id="delivery-items" class="w-full px-4 py-3 border border-gray-300 rounded-xl input-focus transition-all duration-300" rows="6" placeholder="Masukkan daftar barang yang akan dikirim...

Contoh:
1. Banner Promosi Event - 3m  2m (2 pcs)
2. Stiker Logo Perusahaan (100 pcs)
3. Brosur Katalog Produk (500 lembar)

Atau gunakan fitur 'Muat Pesanan Terpilih' untuk sinkronisasi otomatis dengan pesanan pelanggan." required></textarea>
                        <div class="text-xs text-gray-500 mt-1">
                             <strong>Sinkronisasi Otomatis:</strong> Pilih pesanan di atas untuk mengisi otomatis dengan data yang tepat
                        </div>
                    </div>


                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Alamat Tujuan</label>
                        <textarea id="delivery-address" class="w-full px-4 py-3 border border-gray-300 rounded-xl input-focus transition-all duration-300" rows="3" required placeholder="Masukkan alamat lengkap pengiriman..."></textarea>
                    </div>
                    


                    <!-- Delivery Details -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Tanggal Kirim</label>
                            <input type="date" id="delivery-date" class="w-full px-4 py-3 border border-gray-300 rounded-xl input-focus transition-all duration-300" required>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Estimasi Tiba</label>
                            <input type="date" id="delivery-eta" class="w-full px-4 py-3 border border-gray-300 rounded-xl input-focus transition-all duration-300">
                        </div>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Catatan Pengiriman</label>
                        <textarea id="delivery-notes" class="w-full px-4 py-3 border border-gray-300 rounded-xl input-focus transition-all duration-300" rows="3" placeholder="Catatan khusus untuk pengiriman (opsional)..."></textarea>
                    </div>

                    <!-- Delivery Summary Section -->
                    <div id="delivery-summary-section" class="hidden">
                        <div class="card-gradient rounded-xl p-6 border border-blue-200">
                            <div class="flex items-center justify-between mb-4">
                                <h4 class="text-lg font-bold text-gray-900 flex items-center space-x-2">
                                    <svg class="w-5 h-5 text-blue-600" fill="currentColor" viewBox="0 0 20 20">
                                        <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                        <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a2 2 0 002 2h8a2 2 0 002-2V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                                    </svg>
                                    <span>Ringkasan Pengiriman</span>
                                </h4>
                                <div class="flex items-center space-x-2">
                                    <div class="w-3 h-3 bg-green-500 rounded-full animate-pulse"></div>
                                    <span class="text-sm font-medium text-green-600">Siap Dikirim</span>
                                </div>
                            </div>
                            
                            <!-- Summary Grid -->
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                                <div class="bg-blue-50 p-4 rounded-lg border border-blue-200">
                                    <div class="flex items-center space-x-3">
                                        <div class="w-10 h-10 bg-blue-500 rounded-full flex items-center justify-center">
                                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                                <path d="M9 6a3 3 0 11-6 0 3 3 0 016 0zM17 6a3 3 0 11-6 0 3 3 0 016 0zM12.93 17c.046-.327.07-.66.07-1a6.97 6.97 0 00-1.5-4.33A5 5 0 0119 16v1h-6.07zM6 11a5 5 0 015 5v1H1v-1a5 5 0 015-5z"></path>
                                            </svg>
                                        </div>
                                        <div>
                                            <div class="text-sm text-blue-600 font-medium">Pelanggan</div>
                                            <div class="font-bold text-blue-800" id="summary-customer">-</div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="bg-green-50 p-4 rounded-lg border border-green-200">
                                    <div class="flex items-center space-x-3">
                                        <div class="w-10 h-10 bg-green-500 rounded-full flex items-center justify-center">
                                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                                <path fill-rule="evenodd" d="M6 2a1 1 0 00-1 1v1H4a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-1V3a1 1 0 10-2 0v1H7V3a1 1 0 00-1-1zm0 5a1 1 0 000 2h8a1 1 0 100-2H6z" clip-rule="evenodd"></path>
                                            </svg>
                                        </div>
                                        <div>
                                            <div class="text-sm text-green-600 font-medium">Tanggal Kirim</div>
                                            <div class="font-bold text-green-800" id="summary-delivery-date">-</div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="bg-purple-50 p-4 rounded-lg border border-purple-200">
                                    <div class="flex items-center space-x-3">
                                        <div class="w-10 h-10 bg-purple-500 rounded-full flex items-center justify-center">
                                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                                            </svg>
                                        </div>
                                        <div>
                                            <div class="text-sm text-purple-600 font-medium">Estimasi Tiba</div>
                                            <div class="font-bold text-purple-800" id="summary-eta">-</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Address Summary -->
                            <div class="bg-gray-50 p-4 rounded-lg border border-gray-200 mb-4">
                                <div class="flex items-start space-x-3">
                                    <div class="w-8 h-8 bg-gray-500 rounded-full flex items-center justify-center mt-1">
                                        <svg class="w-4 h-4 text-white" fill="currentColor" viewBox="0 0 20 20">
                                            <path fill-rule="evenodd" d="M5.05 4.05a7 7 0 119.9 9.9L10 18.9l-4.95-4.95a7 7 0 010-9.9zM10 11a2 2 0 100-4 2 2 0 000 4z" clip-rule="evenodd"></path>
                                        </svg>
                                    </div>
                                    <div class="flex-1">
                                        <div class="text-sm font-medium text-gray-700 mb-1"> Alamat Tujuan:</div>
                                        <div class="text-gray-900 font-medium" id="summary-address">-</div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Items Summary -->
                            <div class="bg-white p-4 rounded-lg border border-gray-200">
                                <div class="flex items-center justify-between mb-3">
                                    <h5 class="font-semibold text-gray-900 flex items-center space-x-2">
                                        <svg class="w-4 h-4 text-gray-600" fill="currentColor" viewBox="0 0 20 20">
                                            <path d="M3 4a1 1 0 011-1h12a1 1 0 011 1v2a1 1 0 01-1 1H4a1 1 0 01-1-1V4zM3 10a1 1 0 011-1h6a1 1 0 011 1v6a1 1 0 01-1 1H4a1 1 0 01-1-1v-6zM14 9a1 1 0 00-1 1v6a1 1 0 001 1h2a1 1 0 001-1v-6a1 1 0 00-1-1h-2z"></path>
                                        </svg>
                                        <span>Barang yang Dikirim</span>
                                    </h5>
                                    <div class="flex items-center space-x-4">
                                        <div class="text-sm">
                                            <span class="text-gray-500">Total Item:</span>
                                            <span class="font-bold text-blue-600" id="summary-total-items">0</span>
                                        </div>
                                        <div class="text-sm">
                                            <span class="text-gray-500">Jenis:</span>
                                            <span class="font-bold text-green-600" id="summary-item-types">0</span>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="max-h-32 overflow-y-auto">
                                    <div id="summary-items-list" class="text-sm text-gray-700 space-y-1">
                                        <div class="text-center text-gray-400 py-4">Belum ada barang dipilih</div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Action Buttons -->
                            <div class="flex justify-between items-center mt-6 pt-4 border-t border-gray-200">
                                <div class="flex items-center space-x-2 text-sm text-gray-600">
                                    <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                                        <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                                    </svg>
                                    <span>Periksa kembali data sebelum membuat surat jalan</span>
                                </div>
                                <button type="button" onclick="refreshDeliverySummary()" class="text-blue-600 hover:text-blue-800 font-medium text-sm flex items-center space-x-1">
                                    <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                                        <path fill-rule="evenodd" d="M4 2a1 1 0 011 1v2.101a7.002 7.002 0 0111.601 2.566 1 1 0 11-1.885.666A5.002 5.002 0 005.999 7H9a1 1 0 010 2H4a1 1 0 01-1-1V3a1 1 0 011-1zm.008 9.057a1 1 0 011.276.61A5.002 5.002 0 0014.001 13H11a1 1 0 110-2h5a1 1 0 011 1v5a1 1 0 11-2 0v-2.101a7.002 7.002 0 01-11.601-2.566 1 1 0 01.61-1.276z" clip-rule="evenodd"></path>
                                    </svg>
                                    <span>Refresh</span>
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <div class="flex space-x-4 pt-4">
                        <button type="button" onclick="closeDeliveryModal()" class="flex-1 px-4 py-3 border border-gray-300 text-gray-700 rounded-xl hover:bg-gray-50 transition-all duration-300">
                            Batal
                        </button>
                        <button type="submit" class="flex-1 btn-primary text-white py-3 rounded-xl font-semibold">
                             Buat Surat Jalan
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Customer Modal -->
    <div id="customer-modal" class="fixed inset-0 modal-backdrop hidden items-center justify-center z-50">
        <div class="modal-content rounded-2xl p-8 max-w-md w-full mx-4">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-xl font-bold text-gray-900">Tambah Pelanggan Baru</h3>
                <button onclick="closeCustomerModal()" class="text-gray-500 hover:text-gray-700">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>
            
            <form id="customer-form" class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Nama Lengkap</label>
                    <input type="text" id="customer-fullname" class="w-full px-4 py-3 border border-gray-300 rounded-xl input-focus transition-all duration-300" required>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Email</label>
                    <input type="email" id="customer-email" class="w-full px-4 py-3 border border-gray-300 rounded-xl input-focus transition-all duration-300" required>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Nomor Telepon</label>
                    <input type="tel" id="customer-phone" class="w-full px-4 py-3 border border-gray-300 rounded-xl input-focus transition-all duration-300" required>
                </div>
                
                <div class="flex space-x-4 pt-4">
                    <button type="button" onclick="closeCustomerModal()" class="flex-1 px-4 py-3 border border-gray-300 text-gray-700 rounded-xl hover:bg-gray-50 transition-all duration-300">
                        Batal
                    </button>
                    <button type="submit" class="flex-1 btn-primary text-white py-3 rounded-xl font-semibold">
                        Simpan
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Daily Transaction Modal -->
    <div id="daily-transaction-modal" class="fixed inset-0 modal-backdrop hidden items-center justify-center z-50">
        <div class="modal-content rounded-2xl p-0 max-w-2xl w-full mx-4 max-h-[90vh] overflow-hidden">
            <!-- Modal Header -->
            <div class="header-glass p-6 border-b border-white border-opacity-20">
                <div class="flex justify-between items-center">
                    <div class="flex items-center space-x-3">
                        <div class="w-10 h-10 bg-white bg-opacity-20 rounded-xl flex items-center justify-center">
                            <svg class="w-6 h-6 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                        <div>
                            <h3 class="text-xl font-bold text-white">Transaksi Harian Baru</h3>
                            <p class="text-blue-100 text-sm">Catat transaksi dengan harga harian</p>
                        </div>
                    </div>
                    <button onclick="closeDailyTransactionModal()" class="text-white hover:text-blue-200 transition-colors duration-300">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    </button>
                </div>
            </div>

            <!-- Modal Content -->
            <div class="overflow-y-auto max-h-[calc(90vh-120px)]">
                <form id="daily-transaction-form" class="p-6 space-y-6">
                    <!-- Customer Selection -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Pelanggan</label>
                        <div class="relative">
                            <input type="text" id="daily-customer-search" class="w-full px-4 py-3 border border-gray-300 rounded-xl input-focus transition-all duration-300" placeholder=" Cari atau ketik nama pelanggan..." autocomplete="off">
                            <input type="hidden" id="daily-customer" required>
                            
                            <!-- Dropdown Results -->
                            <div id="daily-customer-dropdown" class="absolute top-full left-0 right-0 bg-white border border-gray-300 rounded-xl shadow-lg z-10 max-h-60 overflow-y-auto hidden">
                                <div id="daily-customer-results" class="py-2">
                                    <!-- Results will be populated here -->
                                </div>
                                <div class="border-t border-gray-200 p-3">
                                    <button type="button" id="add-new-customer-btn" class="w-full text-left px-3 py-2 text-blue-600 hover:bg-blue-50 rounded-lg transition-all duration-300 flex items-center space-x-2">
                                        <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                                            <path fill-rule="evenodd" d="M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z" clip-rule="evenodd"></path>
                                        </svg>
                                        <span>Tambah pelanggan baru</span>
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Selected Customer Display -->
                        <div id="daily-selected-customer" class="hidden mt-3 p-3 bg-green-50 border border-green-200 rounded-xl">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center space-x-3">
                                    <div class="w-8 h-8 bg-green-500 rounded-full flex items-center justify-center">
                                        <svg class="w-4 h-4 text-white" fill="currentColor" viewBox="0 0 20 20">
                                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                                        </svg>
                                    </div>
                                    <div>
                                        <div class="font-semibold text-green-800" id="daily-customer-name"></div>
                                        <div class="text-sm text-green-700" id="daily-customer-info"></div>
                                    </div>
                                </div>
                                <button type="button" onclick="clearDailyCustomerSelection()" class="text-green-600 hover:text-green-800 font-medium text-sm">
                                    Ubah
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Items Section -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-4">Item Transaksi</label>
                        <div id="daily-transaction-items" class="space-y-4">
                            <!-- Items will be added here -->
                        </div>
                        
                        <div class="flex justify-between items-center p-4 bg-blue-50 rounded-xl mt-4">
                            <button type="button" onclick="addDailyTransactionItem()" class="flex items-center space-x-2 text-blue-600 hover:text-blue-800 font-medium">
                                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z" clip-rule="evenodd"></path>
                                </svg>
                                <span>Tambah Item Lainnya</span>
                            </button>
                            <div class="text-right">
                                <p class="text-sm text-gray-600">Total Transaksi:</p>
                                <p class="text-2xl font-bold text-gray-900" id="daily-transaction-total">Rp 0</p>
                            </div>
                        </div>
                    </div>

                    <!-- Description -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Keterangan</label>
                        <textarea id="daily-description" class="w-full px-4 py-3 border border-gray-300 rounded-xl input-focus transition-all duration-300" rows="3" placeholder="Keterangan tambahan untuk transaksi ini..."></textarea>
                    </div>
                    
                    <div class="flex space-x-4 pt-4">
                        <button type="button" onclick="closeDailyTransactionModal()" class="flex-1 px-4 py-3 border border-gray-300 text-gray-700 rounded-xl hover:bg-gray-50 transition-all duration-300">
                            Batal
                        </button>
                        <button type="submit" class="flex-1 btn-primary text-white py-3 rounded-xl font-semibold">
                             Simpan Transaksi
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Delivery Details Modal -->
    <div id="delivery-details-modal" class="fixed inset-0 modal-backdrop hidden items-center justify-center z-50">
        <div class="modal-content rounded-2xl p-0 max-w-4xl w-full mx-4 max-h-[95vh] overflow-hidden">
            <!-- Modal Header -->
            <div class="header-glass p-6 border-b border-white border-opacity-20">
                <div class="flex justify-between items-center">
                    <div class="flex items-center space-x-3">
                        <div class="w-10 h-10 bg-white bg-opacity-20 rounded-xl flex items-center justify-center">
                            <svg class="w-6 h-6 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a2 2 0 002 2h8a2 2 0 002-2V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                        <div>
                            <h3 class="text-xl font-bold text-white">Detail Surat Jalan</h3>
                            <p class="text-blue-100 text-sm">Format lengkap surat jalan pengiriman</p>
                        </div>
                    </div>
                    <button onclick="closeDeliveryDetailsModal()" class="text-white hover:text-blue-200 transition-colors duration-300">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    </button>
                </div>
            </div>

            <!-- Modal Content -->
            <div class="overflow-y-auto max-h-[calc(95vh-120px)] bg-gray-50">
                <!-- Simple Professional Delivery Note Format -->
                <div class="p-6 bg-white mx-4 my-4 rounded-lg shadow-lg border border-gray-200" style="font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;">
                    <!-- Simple Header -->
                    <div class="text-center border-b-2 border-blue-600 pb-4 mb-6">
                        <h1 class="text-2xl font-bold text-blue-600 mb-2">FP DIGITAL PRINTING</h1>
                        <p class="text-gray-600 text-sm">Jl. Contoh No. 123, Jakarta  Telp: (021) 1234-5678</p>
                        <p class="text-gray-600 text-sm">Email: info@fpdigital.com</p>
                    </div>
                    
                    <!-- Simple Document Title -->
                    <div class="text-center mb-6">
                        <h2 class="text-xl font-bold text-gray-800 mb-2">SURAT JALAN</h2>
                        <div class="text-lg font-semibold text-blue-600">
                            No: <span id="detail-delivery-number"></span>
                        </div>
                    </div>
                    
                    <!-- Simple Information Grid -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                        <!-- Delivery Information -->
                        <div class="bg-gray-50 p-4 rounded-lg border">
                            <h3 class="font-bold text-gray-800 mb-3">Informasi Pengiriman</h3>
                            <div class="space-y-2 text-sm">
                                <div class="flex justify-between">
                                    <span class="text-gray-600">Tanggal Kirim:</span>
                                    <span id="detail-delivery-date" class="font-semibold"></span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-600">Estimasi Tiba:</span>
                                    <span id="detail-delivery-eta" class="font-semibold"></span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-600">Status:</span>
                                    <span id="detail-delivery-status" class="px-2 py-1 rounded text-xs font-medium"></span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-600">Dibuat:</span>
                                    <span id="detail-created-date" class="font-semibold"></span>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Customer Information -->
                        <div class="bg-gray-50 p-4 rounded-lg border">
                            <h3 class="font-bold text-gray-800 mb-3">Informasi Penerima</h3>
                            <div class="space-y-2">
                                <div class="flex items-center space-x-3 mb-3">
                                    <div class="w-10 h-10 bg-blue-600 rounded-full flex items-center justify-center">
                                        <span class="text-white font-bold" id="customer-initial"></span>
                                    </div>
                                    <div>
                                        <div class="font-bold text-gray-900" id="detail-customer-name"></div>
                                        <div class="text-xs text-gray-500">Pelanggan</div>
                                    </div>
                                </div>
                                <div>
                                    <div class="text-sm font-semibold text-gray-600 mb-1">Alamat Pengiriman:</div>
                                    <div class="text-sm text-gray-800" id="detail-delivery-address"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Simple Items Section -->
                    <div class="bg-white border rounded-lg mb-6">
                        <div class="bg-blue-600 text-white p-3 rounded-t-lg">
                            <h3 class="font-bold">DAFTAR BARANG YANG DIKIRIM</h3>
                        </div>
                        <div class="p-4">
                            <div id="detail-delivery-items-formatted">
                                <!-- Formatted items will be inserted here -->
                            </div>
                        </div>
                    </div>
                    
                    <!-- Simple Notes Section -->
                    <div id="notes-section" class="bg-yellow-50 border border-yellow-200 rounded-lg p-4 mb-6">
                        <h3 class="font-bold text-gray-800 mb-2">Catatan Pengiriman</h3>
                        <div id="detail-delivery-notes" class="text-gray-700 text-sm"></div>
                    </div>
                    
                    <!-- Simple Signature Section -->
                    <div class="mt-8 mb-6">
                        <h3 class="text-center font-bold text-gray-800 mb-6">TANDA TANGAN</h3>
                        
                        <div class="grid grid-cols-3 gap-6 text-center">
                            <!-- Sender -->
                            <div class="border border-gray-300 rounded-lg p-4">
                                <div class="font-bold text-gray-800 mb-12">PENGIRIM</div>
                                <div class="border-t border-gray-400 pt-2">
                                    <div class="text-xs text-gray-600">Tanda Tangan & Nama</div>
                                    <div class="text-sm font-medium mt-1">FP Digital Printing</div>
                                </div>
                            </div>
                            
                            <!-- Courier -->
                            <div class="border border-gray-300 rounded-lg p-4">
                                <div class="font-bold text-gray-800 mb-12">KURIR</div>
                                <div class="border-t border-gray-400 pt-2">
                                    <div class="text-xs text-gray-600">Tanda Tangan & Nama</div>
                                    <div class="text-sm font-medium mt-1">Petugas Pengiriman</div>
                                </div>
                            </div>
                            
                            <!-- Recipient -->
                            <div class="border border-gray-300 rounded-lg p-4">
                                <div class="font-bold text-gray-800 mb-12">PENERIMA</div>
                                <div class="border-t border-gray-400 pt-2">
                                    <div class="text-xs text-gray-600">Tanda Tangan & Nama</div>
                                    <div class="text-sm font-medium mt-1">Konfirmasi Penerimaan</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Simple Footer -->
                    <div class="mt-6 pt-4 border-t border-gray-300">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-xs text-gray-600">
                            <div>
                                <div class="font-bold mb-2">Syarat & Ketentuan:</div>
                                <ul class="space-y-1">
                                    <li> Barang yang sudah diterima tidak dapat dikembalikan</li>
                                    <li> Laporkan kerusakan dalam 24 jam</li>
                                    <li> Dokumen ini adalah bukti sah pengiriman</li>
                                </ul>
                            </div>
                            <div class="text-right">
                                <div class="font-bold mb-2">Dokumen Digital</div>
                                <div>Dicetak: <span id="print-date" class="font-mono"></span></div>
                                <div class="text-blue-600 font-semibold mt-2">FP Digital Printing System</div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Action Buttons -->
                <div class="p-6 bg-gray-50 border-t border-gray-200">
                    <div class="flex justify-between items-center">
                        <button onclick="closeDeliveryDetailsModal()" class="px-6 py-3 border border-gray-300 text-gray-700 rounded-xl hover:bg-gray-50 transition-all duration-300">
                            Tutup
                        </button>
                        <button onclick="printDeliveryDetails()" class="btn-primary text-white px-8 py-3 rounded-xl font-semibold flex items-center space-x-2">
                            <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M5 4v3H4a2 2 0 00-2 2v3a2 2 0 002 2h1v2a2 2 0 002 2h6a2 2 0 002-2v-2h1a2 2 0 002-2V9a2 2 0 00-2-2h-1V4a2 2 0 00-2-2H7a2 2 0 00-2 2zm8 0H7v3h6V4zm0 8H7v4h6v-4z" clip-rule="evenodd"></path>
                            </svg>
                            <span> Cetak Surat Jalan</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Price Modal -->
    <div id="price-modal" class="fixed inset-0 modal-backdrop hidden items-center justify-center z-50">
        <div class="modal-content rounded-2xl p-8 max-w-md w-full mx-4">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-xl font-bold text-gray-900" id="price-modal-title">Tambah Jenis Cetakan</h3>
                <button onclick="closePriceModal()" class="text-gray-500 hover:text-gray-700">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>
            
            <form id="price-form" class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Nama Jenis Cetakan</label>
                    <input type="text" id="price-name" class="w-full px-4 py-3 border border-gray-300 rounded-xl input-focus transition-all duration-300" required>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Jenis Satuan</label>
                    <select id="price-unit" class="w-full px-4 py-3 border border-gray-300 rounded-xl input-focus transition-all duration-300" required>
                        <option value="">Pilih Satuan</option>
                        <option value="Per Meter">Per Meter</option>
                        <option value="Per Pcs">Per Pcs</option>
                        <option value="Per Lembar">Per Lembar</option>
                    </select>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Harga Harian (Rp)</label>
                    <input type="number" id="price-daily" class="w-full px-4 py-3 border border-gray-300 rounded-xl input-focus transition-all duration-300" min="0" required>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Harga Tagihan (Rp)</label>
                    <input type="number" id="price-billing" class="w-full px-4 py-3 border border-gray-300 rounded-xl input-focus transition-all duration-300" min="0" required>
                </div>
                
                <div class="flex space-x-4 pt-4">
                    <button type="button" onclick="closePriceModal()" class="flex-1 px-4 py-3 border border-gray-300 text-gray-700 rounded-xl hover:bg-gray-50 transition-all duration-300">
                        Batal
                    </button>
                    <button type="submit" class="flex-1 btn-primary text-white py-3 rounded-xl font-semibold">
                        Simpan
                    </button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // Data Storage - Unified System with Local Storage
        
        // Data persistence functions
        function saveDataToStorage() {
            try {
                localStorage.setItem('fp_digital_print_prices', JSON.stringify(printPrices));
                localStorage.setItem('fp_digital_customers', JSON.stringify(customers));
                localStorage.setItem('fp_digital_transactions', JSON.stringify(transactions));
                localStorage.setItem('fp_digital_deliveries', JSON.stringify(deliveries));
                console.log('Data berhasil disimpan ke localStorage');
            } catch (error) {
                console.error('Error menyimpan data:', error);
                alert('Gagal menyimpan data. Pastikan browser mendukung localStorage.');
            }
        }

        function loadDataFromStorage() {
            try {
                const savedPrintPrices = localStorage.getItem('fp_digital_print_prices');
                const savedCustomers = localStorage.getItem('fp_digital_customers');
                const savedTransactions = localStorage.getItem('fp_digital_transactions');
                const savedDeliveries = localStorage.getItem('fp_digital_deliveries');

                if (savedPrintPrices) {
                    printPrices = JSON.parse(savedPrintPrices);
                }
                if (savedCustomers) {
                    customers = JSON.parse(savedCustomers);
                }
                if (savedTransactions) {
                    transactions = JSON.parse(savedTransactions);
                }
                if (savedDeliveries) {
                    deliveries = JSON.parse(savedDeliveries);
                }
                
                console.log('Data berhasil dimuat dari localStorage');
            } catch (error) {
                console.error('Error memuat data:', error);
                // Jika error, gunakan data default
                initializeDefaultData();
            }
        }

        function initializeDefaultData() {
            printPrices = {
                'Banner/Spanduk': { 
                    dailyPrice: 75000, 
                    billingPrice: 75000, 
                    unit: 'Per Meter' 
                },
                'Stiker': { 
                    dailyPrice: 25000, 
                    billingPrice: 25000, 
                    unit: 'Per Meter' 
                },
                'Albatros': { 
                    dailyPrice: 45000, 
                    billingPrice: 45000, 
                    unit: 'Per Meter' 
                },
                'Oneway': { 
                    dailyPrice: 35000, 
                    billingPrice: 35000, 
                    unit: 'Per Meter' 
                },
                'Brosur A4 (HVS)': { 
                    dailyPrice: 1500, 
                    billingPrice: 1500, 
                    unit: 'Per Pcs' 
                },
                'Brosur A4 (Ap120gr)': { 
                    dailyPrice: 2500, 
                    billingPrice: 2500, 
                    unit: 'Per Pcs' 
                },
                'Poster A3': { 
                    dailyPrice: 15000, 
                    billingPrice: 15000, 
                    unit: 'Per Lembar' 
                },
                'Stempel': { 
                    dailyPrice: 50000, 
                    billingPrice: 50000, 
                    unit: 'Per Pcs' 
                },
                'Id Card': { 
                    dailyPrice: 8000, 
                    billingPrice: 8000, 
                    unit: 'Per Pcs' 
                },
                'Kartu Nama': { 
                    dailyPrice: 3000, 
                    billingPrice: 3000, 
                    unit: 'Per Pcs' 
                }
            };

            customers = [
                {
                    id: 1,
                    name: 'Budi Santoso',
                    email: 'budi@email.com',
                    phone: '081234567890',
                    address: 'Jl. Merdeka No. 123, Jakarta Pusat',
                    totalTransactions: 3
                },
                {
                    id: 2,
                    name: 'Siti Rahayu',
                    email: 'siti@email.com',
                    phone: '081234567891',
                    address: 'Jl. Sudirman No. 456, Jakarta Selatan',
                    totalTransactions: 2
                },
                {
                    id: 3,
                    name: 'Ahmad Wijaya',
                    email: 'ahmad@email.com',
                    phone: '081234567892',
                    address: 'Jl. Thamrin No. 789, Jakarta Pusat',
                    totalTransactions: 1
                }
            ];

            // Unified transaction/invoice system - each entry can be both transaction and invoice
            transactions = [
                {
                    id: 1,
                    invoiceNumber: 'INV-001',
                    date: '2024-01-15',
                    time: '10:30',
                    customer: 'Budi Santoso',
                    items: [
                        {
                            productName: 'Banner Promosi Grand Opening',
                            service: 'Banner/Spanduk',
                            quantity: 2,
                            unitPrice: 75000,
                            subtotal: 150000
                        }
                    ],
                    total: 150000,
                    dueDate: '2024-01-30',
                    status: 'Lunas',
                    transactionStatus: 'Selesai',
                    description: 'Cetak Banner 2x3m',
                    type: 'billing', // 'daily' or 'billing'
                    paymentDate: '2024-01-20'
                },
                {
                    id: 2,
                    invoiceNumber: 'INV-002',
                    date: '2024-01-16',
                    time: '14:15',
                    customer: 'Siti Rahayu',
                    items: [
                        {
                            productName: 'Stiker Logo Perusahaan',
                            service: 'Stiker',
                            quantity: 5,
                            unitPrice: 25000,
                            subtotal: 125000
                        },
                        {
                            productName: 'Brosur Katalog Produk',
                            service: 'Brosur A4 (HVS)',
                            quantity: 100,
                            unitPrice: 1500,
                            subtotal: 150000
                        }
                    ],
                    total: 275000,
                    dueDate: '2024-02-01',
                    status: 'Belum Dibayar',
                    transactionStatus: 'Selesai',
                    description: 'Stiker promosi dan brosur',
                    type: 'billing',
                    paymentDate: null
                },
                {
                    id: 3,
                    invoiceNumber: 'TXN-001',
                    date: '2024-01-17',
                    time: '09:45',
                    customer: 'Ahmad Wijaya',
                    items: [
                        {
                            productName: 'Kartu Nama Executive',
                            service: 'Kartu Nama',
                            quantity: 200,
                            unitPrice: 3000,
                            subtotal: 600000
                        }
                    ],
                    total: 600000,
                    dueDate: null,
                    status: 'Lunas',
                    transactionStatus: 'Selesai',
                    description: 'Cetak kartu nama',
                    type: 'daily',
                    paymentDate: '2024-01-17'
                },
                {
                    id: 4,
                    invoiceNumber: 'INV-003',
                    date: '2024-01-18',
                    time: '11:20',
                    customer: 'Budi Santoso',
                    items: [
                        {
                            productName: 'Poster Event Seminar',
                            service: 'Poster A3',
                            size: 1,
                            quantity: 10,
                            totalMeters: 10,
                            unitPrice: 15000,
                            subtotal: 150000
                        }
                    ],
                    total: 150000,
                    dueDate: '2024-02-05',
                    status: 'Belum Dibayar',
                    transactionStatus: 'Proses',
                    description: 'Poster promosi event',
                    type: 'billing',
                    paymentDate: null
                },
                {
                    id: 5,
                    invoiceNumber: 'TXN-002',
                    date: '2024-01-19',
                    time: '16:30',
                    customer: 'Siti Rahayu',
                    items: [
                        {
                            productName: 'ID Card Karyawan Baru',
                            service: 'Id Card',
                            size: 1,
                            quantity: 50,
                            totalMeters: 50,
                            unitPrice: 8000,
                            subtotal: 400000
                        }
                    ],
                    total: 400000,
                    dueDate: null,
                    status: 'Lunas',
                    transactionStatus: 'Selesai',
                    description: 'ID Card karyawan',
                    type: 'daily',
                    paymentDate: '2024-01-19'
                }
            ];

            deliveries = [
                {
                    id: 1,
                    deliveryNumber: 'SJ-001',
                    date: '2024-01-15',
                    customer: 'Budi Santoso',
                    address: 'Jl. Merdeka No. 123, Jakarta',
                    items: 'Banner 2x3m (2 pcs)',
                    status: 'Terkirim',
                    notes: 'Pengiriman sesuai jadwal'
                },
                {
                    id: 2,
                    deliveryNumber: 'SJ-002',
                    date: '2024-01-16',
                    customer: 'Siti Rahayu',
                    address: 'Jl. Sudirman No. 456, Jakarta',
                    items: 'Stiker (5m), Brosur A4 (100 pcs)',
                    status: 'Dalam Perjalanan',
                    notes: 'Estimasi tiba sore hari'
                }
            ];
        }

        // Initialize data variables
        let printPrices = {};
        let customers = [];
        let transactions = [];
        let deliveries = [];

        // Invoices are now filtered from transactions
        let invoices = [];

        // Tab Management
        function showTab(tabName) {
            // Hide all content
            const contents = ['dashboard', 'transaksi-harian', 'tagihan', 'surat-jalan', 'laporan', 'pelanggan', 'harga'];
            contents.forEach(content => {
                document.getElementById(`content-${content}`).classList.add('hidden');
                document.getElementById(`tab-${content}`).classList.remove('active-tab');
            });

            // Show selected content
            document.getElementById(`content-${tabName}`).classList.remove('hidden');
            document.getElementById(`tab-${tabName}`).classList.add('active-tab');

            // Update header
            const titles = {
                dashboard: { title: 'Dashboard', subtitle: 'Ringkasan aktivitas bisnis Anda' },
                'transaksi-harian': { title: 'Transaksi Harian', subtitle: 'Ringkasan transaksi per hari' },
                tagihan: { title: 'Tagihan', subtitle: 'Kelola tagihan dan pembayaran' },
                'surat-jalan': { title: 'Surat Jalan', subtitle: 'Kelola pengiriman dan surat jalan' },
                laporan: { title: 'Laporan', subtitle: 'Analisis performa bisnis Anda' },
                pelanggan: { title: 'Pelanggan', subtitle: 'Kelola informasi pelanggan' },
                harga: { title: 'Daftar Harga', subtitle: 'Kelola harga untuk setiap jenis cetakan' }
            };

            document.getElementById('page-title').textContent = titles[tabName].title;
            document.getElementById('page-subtitle').textContent = titles[tabName].subtitle;

            // Refresh data when switching tabs
            if (tabName === 'transaksi-harian') {
                document.getElementById('daily-date').value = new Date().toISOString().split('T')[0];
                filterDailyTransactions();
            } else if (tabName === 'tagihan') {
                renderInvoices();
                updateInvoiceStats();
            } else if (tabName === 'surat-jalan') {
                renderDeliveries();
                updateDeliveryStats();
            } else if (tabName === 'pelanggan') {
                renderCustomers();
            } else if (tabName === 'dashboard') {
                updateDashboardStats();
            } else if (tabName === 'laporan') {
                updateReportStats();
            } else if (tabName === 'harga') {
                renderPriceCards();
            }
        }



        // Daily Transaction Modal Management
        function openDailyTransactionModal() {
            // Clear customer selection
            clearDailyCustomerSelection();
            
            // Setup customer search functionality
            setupDailyCustomerSearch();
            
            // Clear and initialize items
            const container = document.getElementById('daily-transaction-items');
            container.innerHTML = '';
            addDailyTransactionItem();
            
            // Reset total
            document.getElementById('daily-transaction-total').textContent = 'Rp 0';
            
            document.getElementById('daily-transaction-modal').classList.remove('hidden');
            document.getElementById('daily-transaction-modal').classList.add('flex');
        }

        function closeDailyTransactionModal() {
            document.getElementById('daily-transaction-modal').classList.add('hidden');
            document.getElementById('daily-transaction-modal').classList.remove('flex');
            document.getElementById('daily-transaction-form').reset();
        }

        function addDailyTransactionItem() {
            const container = document.getElementById('daily-transaction-items');
            const itemCount = container.children.length;
            const newItem = document.createElement('div');
            newItem.className = 'daily-transaction-item card-gradient rounded-xl p-4 border border-gray-200 relative';
            
            newItem.innerHTML = `
                ${itemCount > 0 ? `
                    <button type="button" onclick="removeDailyTransactionItem(this)" class="absolute top-2 right-2 w-8 h-8 bg-red-100 hover:bg-red-200 text-red-600 rounded-full flex items-center justify-center transition-all duration-300">
                        <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                        </svg>
                    </button>
                ` : ''}
                
                <div class="space-y-4">
                    <!-- Product Name Field for Daily Transaction -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Nama Barang/Pesanan</label>
                        <input type="text" class="daily-item-product-name w-full px-3 py-3 border border-gray-300 rounded-xl input-focus" placeholder="Contoh: Banner Promo Hari Raya, Stiker Diskon, dll.">
                        <div class="text-xs text-gray-500 mt-1"> Opsional - untuk memudahkan identifikasi pesanan</div>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-6 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Jenis Cetakan</label>
                            <select class="daily-item-type w-full px-3 py-3 border border-gray-300 rounded-xl input-focus" required>
                                <option value="">Pilih Jenis</option>
                                ${Object.keys(printPrices).map(type => `<option value="${type}">${type}</option>`).join('')}
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Panjang (m)</label>
                            <input type="number" class="daily-item-length w-full px-3 py-3 border border-gray-300 rounded-xl input-focus" min="0.1" step="0.1" value="1" required>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Lebar (m)</label>
                            <input type="number" class="daily-item-width w-full px-3 py-3 border border-gray-300 rounded-xl input-focus" min="0.1" step="0.1" value="1" required>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Jumlah</label>
                            <input type="number" class="daily-item-quantity w-full px-3 py-3 border border-gray-300 rounded-xl input-focus" min="1" value="1" required>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Harga/m</label>
                            <div class="relative">
                                <span class="absolute left-3 top-3 text-gray-500">Rp</span>
                                <input type="number" class="daily-item-price w-full pl-8 pr-3 py-3 border border-gray-300 rounded-xl bg-gray-50" readonly>
                            </div>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Subtotal</label>
                            <div class="relative">
                                <span class="absolute left-3 top-3 text-gray-500">Rp</span>
                                <input type="number" class="daily-item-subtotal w-full pl-8 pr-3 py-3 border border-gray-300 rounded-xl bg-gray-50 font-semibold text-green-600" readonly>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="mt-3 text-xs text-gray-500" id="daily-item-unit-${itemCount}">
                    <!-- Unit info will be displayed here -->
                    <div class="bg-green-50 p-2 rounded-lg">
                        <div class="font-medium text-green-800 mb-1"> Kalkulasi Otomatis:</div>
                        <div class="text-green-700">Panjang  Lebar  Jumlah  Harga/m = Total</div>
                    </div>
                </div>
            `;
            
            container.appendChild(newItem);
            setupDailyTransactionItemListeners(newItem);
        }

        function setupDailyTransactionItemListeners(item) {
            const typeSelect = item.querySelector('.daily-item-type');
            const lengthInput = item.querySelector('.daily-item-length');
            const widthInput = item.querySelector('.daily-item-width');
            const quantityInput = item.querySelector('.daily-item-quantity');
            const priceInput = item.querySelector('.daily-item-price');
            const subtotalInput = item.querySelector('.daily-item-subtotal');

            typeSelect.addEventListener('change', function() {
                if (this.value) {
                    const priceData = printPrices[this.value];
                    priceInput.value = priceData.dailyPrice; // Use daily price
                    
                    // Update unit info
                    const unitInfo = item.querySelector('[id^="daily-item-unit-"]');
                    if (unitInfo) {
                        unitInfo.textContent = `Satuan: ${priceData.unit}  Harga Harian: Rp ${priceData.dailyPrice.toLocaleString('id-ID')}`;
                    }
                    
                    calculateDailyItemSubtotal(item);
                } else {
                    priceInput.value = '';
                    subtotalInput.value = '';
                    
                    // Clear unit info
                    const unitInfo = item.querySelector('[id^="daily-item-unit-"]');
                    if (unitInfo) {
                        unitInfo.textContent = '';
                    }
                }
                calculateDailyTransactionTotal();
            });

            lengthInput.addEventListener('input', function() {
                calculateDailyItemSubtotal(item);
                calculateDailyTransactionTotal();
            });

            widthInput.addEventListener('input', function() {
                calculateDailyItemSubtotal(item);
                calculateDailyTransactionTotal();
            });

            quantityInput.addEventListener('input', function() {
                calculateDailyItemSubtotal(item);
                calculateDailyTransactionTotal();
            });
        }

        function calculateDailyItemSubtotal(item) {
            const length = parseFloat(item.querySelector('.daily-item-length').value) || 0;
            const width = parseFloat(item.querySelector('.daily-item-width').value) || 0;
            const quantity = parseInt(item.querySelector('.daily-item-quantity').value) || 0;
            const pricePerUnit = parseInt(item.querySelector('.daily-item-price').value) || 0;
            
            // Calculate total area in square meters
            const totalArea = length * width * quantity;
            const subtotal = totalArea * pricePerUnit;
            
            item.querySelector('.daily-item-subtotal').value = subtotal;
        }

        function calculateDailyTransactionTotal() {
            const items = document.querySelectorAll('.daily-transaction-item');
            let total = 0;
            
            items.forEach(item => {
                const subtotal = parseInt(item.querySelector('.daily-item-subtotal').value) || 0;
                total += subtotal;
            });

            document.getElementById('daily-transaction-total').textContent = `Rp ${total.toLocaleString('id-ID')}`;
        }

        function removeDailyTransactionItem(button) {
            const item = button.closest('.daily-transaction-item');
            item.remove();
            calculateDailyTransactionTotal();
        }

        function setupDailyCustomerSearch() {
            const searchInput = document.getElementById('daily-customer-search');
            const dropdown = document.getElementById('daily-customer-dropdown');
            const resultsContainer = document.getElementById('daily-customer-results');
            const addNewBtn = document.getElementById('add-new-customer-btn');

            // Clear previous event listeners
            searchInput.removeEventListener('input', handleDailyCustomerSearch);
            searchInput.removeEventListener('focus', handleDailyCustomerFocus);
            searchInput.removeEventListener('blur', handleDailyCustomerBlur);
            addNewBtn.removeEventListener('click', handleAddNewCustomer);

            // Add event listeners
            searchInput.addEventListener('input', handleDailyCustomerSearch);
            searchInput.addEventListener('focus', handleDailyCustomerFocus);
            searchInput.addEventListener('blur', handleDailyCustomerBlur);
            addNewBtn.addEventListener('click', handleAddNewCustomer);

            function handleDailyCustomerSearch() {
                const query = searchInput.value.toLowerCase().trim();
                
                if (query.length === 0) {
                    populateDailyCustomerResults(customers);
                } else {
                    const filtered = customers.filter(customer => 
                        customer.name.toLowerCase().includes(query) ||
                        customer.email.toLowerCase().includes(query) ||
                        customer.phone.includes(query)
                    );
                    populateDailyCustomerResults(filtered);
                }
                
                dropdown.classList.remove('hidden');
            }

            function handleDailyCustomerFocus() {
                populateDailyCustomerResults(customers);
                dropdown.classList.remove('hidden');
            }

            function handleDailyCustomerBlur(e) {
                // Delay hiding to allow clicks on dropdown items
                setTimeout(() => {
                    if (!dropdown.contains(document.activeElement)) {
                        dropdown.classList.add('hidden');
                    }
                }, 150);
            }

            function handleAddNewCustomer() {
                const customerName = searchInput.value.trim();
                if (customerName) {
                    // Create new customer with minimal info
                    const newCustomer = {
                        id: customers.length + 1,
                        name: customerName,
                        email: 'Tidak ada email',
                        phone: 'Tidak ada telepon',
                        totalTransactions: 0
                    };
                    
                    customers.push(newCustomer);
                    saveDataToStorage();
                    
                    // Select the new customer
                    selectDailyCustomer(newCustomer);
                    dropdown.classList.add('hidden');
                }
            }
        }

        function populateDailyCustomerResults(customerList) {
            const resultsContainer = document.getElementById('daily-customer-results');
            resultsContainer.innerHTML = '';

            if (customerList.length === 0) {
                resultsContainer.innerHTML = '<div class="px-4 py-3 text-gray-500 text-sm">Tidak ada pelanggan ditemukan</div>';
                return;
            }

            customerList.forEach(customer => {
                const customerItem = document.createElement('div');
                customerItem.className = 'px-4 py-3 hover:bg-gray-50 cursor-pointer transition-all duration-300';
                customerItem.innerHTML = `
                    <div class="flex items-center space-x-3">
                        <div class="w-8 h-8 gradient-bg rounded-full flex items-center justify-center">
                            <span class="text-white font-semibold text-xs">${customer.name.charAt(0).toUpperCase()}</span>
                        </div>
                        <div class="flex-1">
                            <div class="font-medium text-gray-900">${customer.name}</div>
                            <div class="text-xs text-gray-500">${customer.email}  ${customer.phone}</div>
                            <div class="text-xs text-blue-600">${customer.totalTransactions} transaksi</div>
                        </div>
                    </div>
                `;
                
                customerItem.addEventListener('click', () => {
                    selectDailyCustomer(customer);
                    document.getElementById('daily-customer-dropdown').classList.add('hidden');
                });
                
                resultsContainer.appendChild(customerItem);
            });
        }

        function selectDailyCustomer(customer) {
            // Set hidden input value
            document.getElementById('daily-customer').value = customer.name;
            
            // Update search input
            document.getElementById('daily-customer-search').value = customer.name;
            
            // Show selected customer display
            document.getElementById('daily-customer-name').textContent = customer.name;
            document.getElementById('daily-customer-info').textContent = `${customer.email}  ${customer.phone}  ${customer.totalTransactions} transaksi`;
            document.getElementById('daily-selected-customer').classList.remove('hidden');
            
            // Hide search input
            document.getElementById('daily-customer-search').style.display = 'none';
        }

        function clearDailyCustomerSelection() {
            // Clear values
            document.getElementById('daily-customer').value = '';
            document.getElementById('daily-customer-search').value = '';
            
            // Hide selected customer display
            document.getElementById('daily-selected-customer').classList.add('hidden');
            
            // Show search input
            document.getElementById('daily-customer-search').style.display = 'block';
            
            // Hide dropdown
            document.getElementById('daily-customer-dropdown').classList.add('hidden');
        }

        function addDailyTransaction() {
            const customer = document.getElementById('daily-customer').value;
            const description = document.getElementById('daily-description').value;
            const items = document.querySelectorAll('.daily-transaction-item');
            
            if (!customer) {
                alert('Silakan pilih pelanggan');
                return;
            }
            
            let transactionItems = [];
            let totalAmount = 0;
            
            items.forEach(item => {
                const type = item.querySelector('.daily-item-type').value;
                const length = parseFloat(item.querySelector('.daily-item-length').value) || 0;
                const width = parseFloat(item.querySelector('.daily-item-width').value) || 0;
                const quantity = parseInt(item.querySelector('.daily-item-quantity').value) || 0;
                const price = parseInt(item.querySelector('.daily-item-price').value) || 0;
                const subtotal = parseInt(item.querySelector('.daily-item-subtotal').value) || 0;
                
                if (type && length > 0 && width > 0 && quantity > 0 && price > 0) {
                    const productName = item.querySelector('.daily-item-product-name')?.value.trim() || type;
                    const totalArea = length * width * quantity;
                    
                    transactionItems.push({
                        productName: productName,
                        service: type,
                        length: length,
                        width: width,
                        quantity: quantity,
                        totalArea: totalArea,
                        unitPrice: price,
                        subtotal: subtotal
                    });
                    totalAmount += subtotal;
                }
            });

            if (transactionItems.length === 0) {
                alert('Silakan tambahkan minimal satu item transaksi');
                return;
            }

            // Generate transaction number
            const dailyCount = transactions.filter(t => t.type === 'daily').length;
            const transactionNumber = `TXN-${String(dailyCount + 1).padStart(3, '0')}`;

            const newTransaction = {
                id: transactions.length + 1,
                invoiceNumber: transactionNumber,
                date: new Date().toISOString().split('T')[0],
                time: new Date().toLocaleTimeString('id-ID', { hour: '2-digit', minute: '2-digit' }),
                customer: customer,
                items: transactionItems,
                total: totalAmount,
                dueDate: null,
                status: 'Lunas',
                transactionStatus: 'Selesai',
                description: description || 'Transaksi harian',
                type: 'daily',
                paymentDate: new Date().toISOString().split('T')[0]
            };

            transactions.push(newTransaction);
            
            // Update customer transaction count
            const customerObj = customers.find(c => c.name === customer);
            if (customerObj) {
                customerObj.totalTransactions += 1;
            }
            
            saveDataToStorage();
            
            // Refresh displays
            filterDailyTransactions();
            updateDashboardStats();
            
            closeDailyTransactionModal();
            
            // Show success message
            alert(` Transaksi ${transactionNumber} berhasil disimpan!\n\nPelanggan: ${customer}\nTotal: Rp ${totalAmount.toLocaleString('id-ID')}`);
        }

        // Daily Transactions Management
        function filterDailyTransactions() {
            const selectedDate = document.getElementById('daily-date').value;
            // Filter only daily transactions for the selected date
            const dailyTransactions = transactions.filter(t => t.date === selectedDate && t.type === 'daily');
            
            // Update stats
            const totalTransactions = dailyTransactions.length;
            const totalRevenue = dailyTransactions.reduce((sum, t) => sum + t.total, 0);
            const averageTransaction = totalTransactions > 0 ? totalRevenue / totalTransactions : 0;

            document.getElementById('daily-total-transactions').textContent = totalTransactions;
            document.getElementById('daily-revenue').textContent = `Rp ${totalRevenue.toLocaleString('id-ID')}`;
            document.getElementById('daily-average').textContent = `Rp ${Math.round(averageTransaction).toLocaleString('id-ID')}`;

            // Render table
            const tbody = document.getElementById('daily-transactions-table');
            tbody.innerHTML = '';

            if (dailyTransactions.length === 0) {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td colspan="6" class="py-8 px-4 text-center text-gray-500">
                        Tidak ada transaksi harian pada tanggal ${selectedDate}
                    </td>
                `;
                tbody.appendChild(row);
                return;
            }

            dailyTransactions.forEach(transaction => {
                const row = document.createElement('tr');
                row.className = 'table-row transition-all duration-300';
                
                const statusClass = transaction.transactionStatus === 'Selesai' ? 'bg-green-100 text-green-800' : 
                                   transaction.transactionStatus === 'Proses' ? 'bg-yellow-100 text-yellow-800' : 
                                   'bg-red-100 text-red-800';

                // Get main service for display with product name
                let mainService = 'Layanan tidak tersedia';
                if (transaction.items && transaction.items.length > 0) {
                    const firstItem = transaction.items[0];
                    const displayName = firstItem.productName || firstItem.service;
                    mainService = displayName + (transaction.items.length > 1 ? ` (+${transaction.items.length - 1} lainnya)` : '');
                }

                row.innerHTML = `
                    <td class="py-3 px-4 text-gray-600">${transaction.time}</td>
                    <td class="py-3 px-4 text-gray-600">${transaction.invoiceNumber}</td>
                    <td class="py-3 px-4 text-gray-900 font-medium">${transaction.customer}</td>
                    <td class="py-3 px-4 text-gray-600">${mainService}</td>
                    <td class="py-3 px-4 text-gray-900 font-semibold">Rp ${transaction.total.toLocaleString('id-ID')}</td>
                    <td class="py-3 px-4">
                        <span class="px-3 py-1 ${statusClass} rounded-full text-sm font-medium">${transaction.transactionStatus}</span>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        // Price Management
        function renderPriceCards() {
            const container = document.getElementById('price-cards-container');
            container.innerHTML = '';

            // Create elegant card grid
            const cardGrid = document.createElement('div');
            cardGrid.className = 'grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6';
            
            Object.entries(printPrices).forEach(([type, priceData]) => {
                const card = document.createElement('div');
                card.className = 'price-card-elegant group relative overflow-hidden';
                
                // Get icon based on print type
                const icon = getPrintTypeIcon(type);
                
                card.innerHTML = `
                    <div class="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-blue-500 to-purple-600"></div>
                    <div class="p-6">
                        <div class="flex items-start justify-between mb-4">
                            <div class="flex items-center space-x-3">
                                <div class="w-12 h-12 gradient-bg rounded-xl flex items-center justify-center group-hover:scale-110 transition-transform duration-300">
                                    ${icon}
                                </div>
                                <div>
                                    <h3 class="text-lg font-bold text-gray-900 group-hover:text-blue-600 transition-colors duration-300">${type}</h3>
                                    <p class="text-sm text-gray-500 font-medium">${priceData.unit}</p>
                                </div>
                            </div>
                            <div class="flex space-x-2 opacity-0 group-hover:opacity-100 transition-opacity duration-300">
                                <button onclick="editPrice('${type}')" class="w-8 h-8 bg-blue-100 hover:bg-blue-200 text-blue-600 rounded-lg flex items-center justify-center transition-all duration-300 hover:scale-110">
                                    <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                                        <path d="M13.586 3.586a2 2 0 112.828 2.828l-.793.793-2.828-2.828.793-.793zM11.379 5.793L3 14.172V17h2.828l8.38-8.379-2.83-2.828z"></path>
                                    </svg>
                                </button>
                                <button onclick="deletePrice('${type}')" class="w-8 h-8 bg-red-100 hover:bg-red-200 text-red-600 rounded-lg flex items-center justify-center transition-all duration-300 hover:scale-110">
                                    <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                                        <path fill-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z" clip-rule="evenodd"></path>
                                    </svg>
                                </button>
                            </div>
                        </div>
                        
                        <div class="space-y-4">
                            <div class="price-section">
                                <div class="flex items-center justify-between mb-2">
                                    <span class="text-sm font-medium text-gray-600">Harga Harian</span>
                                    <div class="w-2 h-2 bg-blue-500 rounded-full"></div>
                                </div>
                                <div class="text-2xl font-bold text-blue-600 mb-1">
                                    Rp ${priceData.dailyPrice.toLocaleString('id-ID')}
                                </div>
                                <div class="text-xs text-gray-500">Per transaksi harian</div>
                            </div>
                            
                            <div class="border-t border-gray-100 pt-4">
                                <div class="flex items-center justify-between mb-2">
                                    <span class="text-sm font-medium text-gray-600">Harga Tagihan</span>
                                    <div class="w-2 h-2 bg-green-500 rounded-full"></div>
                                </div>
                                <div class="text-2xl font-bold text-green-600 mb-1">
                                    Rp ${priceData.billingPrice.toLocaleString('id-ID')}
                                </div>
                                <div class="text-xs text-gray-500">Per tagihan resmi</div>
                            </div>
                        </div>
                        
                        <div class="mt-6 pt-4 border-t border-gray-100">
                            <div class="flex items-center justify-between text-xs text-gray-500">
                                <span>Satuan: ${priceData.unit}</span>
                                <span class="flex items-center space-x-1">
                                    <div class="w-1 h-1 bg-gray-400 rounded-full"></div>
                                    <div class="w-1 h-1 bg-gray-400 rounded-full"></div>
                                    <div class="w-1 h-1 bg-gray-400 rounded-full"></div>
                                </span>
                            </div>
                        </div>
                    </div>
                `;
                
                cardGrid.appendChild(card);
            });
            
            container.appendChild(cardGrid);
        }

        function getPrintTypeIcon(type) {
            const icons = {
                'Banner/Spanduk': '<svg class="w-6 h-6 text-white" fill="currentColor" viewBox="0 0 20 20"><path d="M4 3a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V5a2 2 0 00-2-2H4zm12 12H4l4-8 3 6 2-4 3 6z"></path></svg>',
                'Stiker': '<svg class="w-6 h-6 text-white" fill="currentColor" viewBox="0 0 20 20"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"></path></svg>',
                'Albatros': '<svg class="w-6 h-6 text-white" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M3 4a1 1 0 011-1h12a1 1 0 011 1v2a1 1 0 01-1 1H4a1 1 0 01-1-1V4zm0 4a1 1 0 011-1h12a1 1 0 011 1v2a1 1 0 01-1 1H4a1 1 0 01-1-1V8zm0 4a1 1 0 011-1h12a1 1 0 011 1v2a1 1 0 01-1 1H4a1 1 0 01-1-1v-2z" clip-rule="evenodd"></path></svg>',
                'Oneway': '<svg class="w-6 h-6 text-white" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-8.293l-3-3a1 1 0 00-1.414 1.414L10.586 9H7a1 1 0 100 2h3.586l-1.293 1.293a1 1 0 101.414 1.414l3-3a1 1 0 000-1.414z" clip-rule="evenodd"></path></svg>',
                'Brosur A4 (HVS)': '<svg class="w-6 h-6 text-white" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M4 4a2 2 0 012-2h4.586A2 2 0 0112 2.586L15.414 6A2 2 0 0116 7.414V16a2 2 0 01-2 2H6a2 2 0 01-2-2V4z" clip-rule="evenodd"></path></svg>',
                'Brosur A4 (Ap120gr)': '<svg class="w-6 h-6 text-white" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M4 4a2 2 0 012-2h4.586A2 2 0 0112 2.586L15.414 6A2 2 0 0116 7.414V16a2 2 0 01-2 2H6a2 2 0 01-2-2V4zm2 6a1 1 0 011-1h6a1 1 0 110 2H7a1 1 0 01-1-1zm1 3a1 1 0 100 2h6a1 1 0 100-2H7z" clip-rule="evenodd"></path></svg>',
                'Poster A3': '<svg class="w-6 h-6 text-white" fill="currentColor" viewBox="0 0 20 20"><path d="M4 3a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V5a2 2 0 00-2-2H4zm12 12H4l4-8 3 6 2-4 3 6z"></path></svg>',
                'Stempel': '<svg class="w-6 h-6 text-white" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 2a4 4 0 00-4 4v1H5a1 1 0 00-.994.89l-1 9A1 1 0 004 18h12a1 1 0 00.994-1.11l-1-9A1 1 0 0015 7h-1V6a4 4 0 00-4-4zm2 5V6a2 2 0 10-4 0v1h4zm-6 3a1 1 0 112 0 1 1 0 01-2 0zm7-1a1 1 0 100 2 1 1 0 000-2z" clip-rule="evenodd"></path></svg>',
                'Id Card': '<svg class="w-6 h-6 text-white" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 2a4 4 0 00-4 4v1H5a1 1 0 00-.994.89l-1 9A1 1 0 004 18h12a1 1 0 00.994-1.11l-1-9A1 1 0 0015 7h-1V6a4 4 0 00-4-4zm2 5V6a2 2 0 10-4 0v1h4zm-6 3a1 1 0 112 0 1 1 0 01-2 0zm7-1a1 1 0 100 2 1 1 0 000-2z" clip-rule="evenodd"></path></svg>',
                'Kartu Nama': '<svg class="w-6 h-6 text-white" fill="currentColor" viewBox="0 0 20 20"><path d="M4 4a2 2 0 00-2 2v8a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2H4zm2 6a1 1 0 011-1h6a1 1 0 110 2H7a1 1 0 01-1-1zm1 3a1 1 0 100 2h6a1 1 0 100-2H7z"></path></svg>'
            };
            
            return icons[type] || '<svg class="w-6 h-6 text-white" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M4 2a2 2 0 00-2 2v12a2 2 0 002 2h12a2 2 0 002-2V4a2 2 0 00-2-2H4zm3 2h6v4H7V4zm8 8v2h-2v-2h2zM9 8h2v2H9V8zm2 4h2v2h-2v-2zM7 12h2v2H7v-2z" clip-rule="evenodd"></path></svg>';
        }

        function openPriceModal(editType = null) {
            const modal = document.getElementById('price-modal');
            const title = document.getElementById('price-modal-title');
            const nameInput = document.getElementById('price-name');
            const unitSelect = document.getElementById('price-unit');
            const dailyInput = document.getElementById('price-daily');
            const billingInput = document.getElementById('price-billing');

            if (editType) {
                title.textContent = 'Edit Harga Cetakan';
                nameInput.value = editType;
                nameInput.readOnly = true;
                unitSelect.value = printPrices[editType].unit;
                dailyInput.value = printPrices[editType].dailyPrice;
                billingInput.value = printPrices[editType].billingPrice;
            } else {
                title.textContent = 'Tambah Jenis Cetakan';
                nameInput.readOnly = false;
                document.getElementById('price-form').reset();
            }
            
            modal.classList.remove('hidden');
            modal.classList.add('flex');
        }

        function closePriceModal() {
            document.getElementById('price-modal').classList.add('hidden');
            document.getElementById('price-modal').classList.remove('flex');
            document.getElementById('price-form').reset();
            document.getElementById('price-name').readOnly = false;
        }

        function editPrice(type) {
            openPriceModal(type);
        }

        function deletePrice(type) {
            if (confirm(`Apakah Anda yakin ingin menghapus jenis cetakan "${type}"?`)) {
                delete printPrices[type];
                saveDataToStorage(); // Save data after deleting price
                renderPriceCards();
            }
        }

        function addOrUpdatePrice(name, unit, dailyPrice, billingPrice) {
            const isNewPrice = !printPrices[name];
            
            printPrices[name] = {
                unit: unit,
                dailyPrice: parseInt(dailyPrice),
                billingPrice: parseInt(billingPrice)
            };
            
            saveDataToStorage(); // Save data after updating prices
            renderPriceCards();
            closePriceModal();
            
            // Show success message
            const action = isNewPrice ? 'ditambahkan' : 'diperbarui';
            alert(` Jenis cetakan "${name}" berhasil ${action}!\n\nHarga Harian: Rp ${parseInt(dailyPrice).toLocaleString('id-ID')}\nHarga Tagihan: Rp ${parseInt(billingPrice).toLocaleString('id-ID')}\nSatuan: ${unit}`);
        }

        // Invoice Management
        function openInvoiceModal() {
            // Reset modal to step 1
            currentStep = 1;
            selectedCustomer = null;
            customerOption = null;
            
            // Reset all form elements
            document.getElementById('invoice-form').reset();
            clearCustomerSelection();
            
            // Clear invoice items container
            const itemsContainer = document.getElementById('invoice-items');
            itemsContainer.innerHTML = '';
            
            // Reset total display
            document.getElementById('invoice-total').textContent = 'Rp 0';
            
            // Show step 1
            goToStep(1);
            
            // Set default due date (30 days from now)
            const dueDate = new Date();
            dueDate.setDate(dueDate.getDate() + 30);
            document.getElementById('invoice-due-date').value = dueDate.toISOString().split('T')[0];
            
            document.getElementById('invoice-modal').classList.remove('hidden');
            document.getElementById('invoice-modal').classList.add('flex');
        }

        function closeInvoiceModal() {
            document.getElementById('invoice-modal').classList.add('hidden');
            document.getElementById('invoice-modal').classList.remove('flex');
            
            // Reset everything
            currentStep = 1;
            selectedCustomer = null;
            customerOption = null;
            document.getElementById('invoice-form').reset();
            clearCustomerSelection();
            
            // Clear invoice items
            const itemsContainer = document.getElementById('invoice-items');
            itemsContainer.innerHTML = '';
            
            // Reset total display
            document.getElementById('invoice-total').textContent = 'Rp 0';
        }

        function populateInvoiceItems() {
            const container = document.getElementById('invoice-items');
            const firstItem = container.querySelector('.invoice-item');
            const typeSelect = firstItem.querySelector('.item-type');
            
            // Clear and populate print types
            typeSelect.innerHTML = '<option value="">Pilih Jenis</option>';
            Object.keys(printPrices).forEach(type => {
                const option = document.createElement('option');
                option.value = type;
                option.textContent = type;
                typeSelect.appendChild(option);
            });

            // Add event listeners
            setupInvoiceItemListeners(firstItem);
        }

        function setupInvoiceItemListeners(item) {
            const typeSelect = item.querySelector('.item-type');
            const lengthInput = item.querySelector('.item-length');
            const widthInput = item.querySelector('.item-width');
            const quantityInput = item.querySelector('.item-quantity');
            const priceInput = item.querySelector('.item-price');
            const subtotalInput = item.querySelector('.item-subtotal');

            typeSelect.addEventListener('change', function() {
                if (this.value) {
                    const priceData = printPrices[this.value];
                    priceInput.value = priceData.billingPrice;
                    
                    // Update unit info
                    const unitInfo = item.querySelector('[id^="item-unit-"]');
                    if (unitInfo) {
                        unitInfo.textContent = `Satuan: ${priceData.unit}  Harga: Rp ${priceData.billingPrice.toLocaleString('id-ID')}`;
                    }
                    
                    calculateItemSubtotal(item);
                } else {
                    priceInput.value = '';
                    subtotalInput.value = '';
                    
                    // Clear unit info
                    const unitInfo = item.querySelector('[id^="item-unit-"]');
                    if (unitInfo) {
                        unitInfo.textContent = '';
                    }
                }
                calculateInvoiceTotal();
                validateStep2();
            });

            lengthInput.addEventListener('input', function() {
                calculateItemSubtotal(item);
                calculateInvoiceTotal();
                validateStep2();
            });

            widthInput.addEventListener('input', function() {
                calculateItemSubtotal(item);
                calculateInvoiceTotal();
                validateStep2();
            });

            quantityInput.addEventListener('input', function() {
                calculateItemSubtotal(item);
                calculateInvoiceTotal();
                validateStep2();
            });
        }

        function calculateItemSubtotal(item) {
            const length = parseFloat(item.querySelector('.item-length').value) || 0;
            const width = parseFloat(item.querySelector('.item-width').value) || 0;
            const quantity = parseInt(item.querySelector('.item-quantity').value) || 0;
            const pricePerUnit = parseInt(item.querySelector('.item-price').value) || 0;
            
            // Calculate total area in square meters
            const totalArea = length * width * quantity;
            const subtotal = totalArea * pricePerUnit;
            
            item.querySelector('.item-subtotal').value = subtotal;
        }

        function calculateInvoiceTotal() {
            const items = document.querySelectorAll('.invoice-item');
            let total = 0;
            
            items.forEach(item => {
                const subtotal = parseInt(item.querySelector('.item-subtotal').value) || 0;
                total += subtotal;
            });

            document.getElementById('invoice-total').textContent = `Rp ${total.toLocaleString('id-ID')}`;
        }

        function addInvoiceItem() {
            const container = document.getElementById('invoice-items');
            const itemCount = container.children.length;
            const newItem = document.createElement('div');
            newItem.className = 'invoice-item card-gradient rounded-xl p-4 border border-gray-200 relative';
            
            newItem.innerHTML = `
                ${itemCount > 0 ? `
                    <button type="button" onclick="removeInvoiceItem(this)" class="absolute top-2 right-2 w-8 h-8 bg-red-100 hover:bg-red-200 text-red-600 rounded-full flex items-center justify-center transition-all duration-300">
                        <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                        </svg>
                    </button>
                ` : ''}
                
                <div class="space-y-4">
                    <!-- Product Name Field -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Nama Barang/Pesanan *</label>
                        <input type="text" class="item-product-name w-full px-3 py-3 border border-gray-300 rounded-xl input-focus" placeholder="Contoh: Banner Promosi Event, Stiker Logo Perusahaan, dll." required>
                        <div class="text-xs text-gray-500 mt-1"> Berikan nama yang spesifik untuk memudahkan identifikasi pesanan</div>
                    </div>
                    
                    <!-- Main Item Details -->
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-6 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Jenis Cetakan</label>
                            <select class="item-type w-full px-3 py-3 border border-gray-300 rounded-xl input-focus" required>
                                <option value="">Pilih Jenis</option>
                                ${Object.keys(printPrices).map(type => `<option value="${type}">${type}</option>`).join('')}
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Panjang (m)</label>
                            <input type="number" class="item-length w-full px-3 py-3 border border-gray-300 rounded-xl input-focus" min="0.1" step="0.1" value="1" required>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Lebar (m)</label>
                            <input type="number" class="item-width w-full px-3 py-3 border border-gray-300 rounded-xl input-focus" min="0.1" step="0.1" value="1" required>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Jumlah</label>
                            <input type="number" class="item-quantity w-full px-3 py-3 border border-gray-300 rounded-xl input-focus" min="1" value="1" required>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Harga/m</label>
                            <div class="relative">
                                <span class="absolute left-3 top-3 text-gray-500">Rp</span>
                                <input type="number" class="item-price w-full pl-8 pr-3 py-3 border border-gray-300 rounded-xl bg-gray-50" readonly>
                            </div>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Subtotal</label>
                            <div class="relative">
                                <span class="absolute left-3 top-3 text-gray-500">Rp</span>
                                <input type="number" class="item-subtotal w-full pl-8 pr-3 py-3 border border-gray-300 rounded-xl bg-gray-50 font-semibold text-blue-600" readonly>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="mt-3 text-xs text-gray-500" id="item-unit-${itemCount}">
                    <!-- Unit info will be displayed here -->
                    <div class="bg-blue-50 p-2 rounded-lg">
                        <div class="font-medium text-blue-800 mb-1"> Kalkulasi Otomatis:</div>
                        <div class="text-blue-700">Panjang  Lebar  Jumlah  Harga/m = Total</div>
                    </div>
                </div>
            `;
            
            container.appendChild(newItem);
            setupInvoiceItemListeners(newItem);
        }

        function removeInvoiceItem(button) {
            const item = button.closest('.invoice-item');
            item.remove();
            calculateInvoiceTotal();
            validateStep2();
        }

        function resetInvoiceItems() {
            const container = document.getElementById('invoice-items');
            const items = container.querySelectorAll('.invoice-item');
            
            // Remove all items except the first one
            for (let i = 1; i < items.length; i++) {
                items[i].remove();
            }
            
            // Reset the first item
            const firstItem = items[0];
            firstItem.querySelector('.item-type').value = '';
            firstItem.querySelector('.item-quantity').value = '1';
            firstItem.querySelector('.item-price').value = '';
            firstItem.querySelector('.item-subtotal').value = '';
            
            calculateInvoiceTotal();
        }

        function addInvoice() {
            const dueDate = document.getElementById('invoice-due-date').value;
            const description = document.getElementById('invoice-description').value;
            const priority = document.getElementById('invoice-priority').value;
            const items = document.querySelectorAll('.invoice-item');
            
            let customerName = '';
            
            // Determine customer name and handle customer creation
            if (selectedCustomer) {
                // Existing customer was selected
                customerName = selectedCustomer.name;
            } else if (customerOption === 'new') {
                // New customer
                customerName = document.getElementById('new-customer-name').value.trim();
                const email = document.getElementById('new-customer-email').value.trim();
                const phone = document.getElementById('new-customer-phone').value.trim();
                
                if (!customerName) {
                    alert('Silakan masukkan nama pelanggan');
                    goToStep(1);
                    return;
                }
                
                // Add new customer with complete data
                const existingCustomer = customers.find(c => c.name.toLowerCase() === customerName.toLowerCase());
                if (!existingCustomer) {
                    const newCustomer = {
                        id: customers.length + 1,
                        name: customerName,
                        email: email || 'Tidak ada email',
                        phone: phone || 'Tidak ada telepon',
                        totalTransactions: 0
                    };
                    customers.push(newCustomer);
                }
            }
            
            if (!customerName) {
                alert('Silakan pilih atau tambah pelanggan terlebih dahulu');
                goToStep(1);
                return;
            }
            
            let invoiceItems = [];
            let totalAmount = 0;
            
            items.forEach(item => {
                const type = item.querySelector('.item-type').value;
                const length = parseFloat(item.querySelector('.item-length').value) || 0;
                const width = parseFloat(item.querySelector('.item-width').value) || 0;
                const quantity = parseInt(item.querySelector('.item-quantity').value) || 0;
                const price = parseInt(item.querySelector('.item-price').value) || 0;
                const subtotal = parseInt(item.querySelector('.item-subtotal').value) || 0;
                
                if (type && length > 0 && width > 0 && quantity > 0 && price > 0) {
                    const productName = item.querySelector('.item-product-name').value.trim();
                    const totalArea = length * width * quantity;
                    
                    invoiceItems.push({
                        productName: productName || type,
                        service: type,
                        length: length,
                        width: width,
                        quantity: quantity,
                        totalArea: totalArea,
                        unitPrice: price,
                        subtotal: subtotal
                    });
                    totalAmount += subtotal;
                }
            });

            if (invoiceItems.length === 0) {
                alert('Silakan tambahkan minimal satu item tagihan');
                goToStep(2);
                return;
            }

            if (!dueDate) {
                alert('Silakan tentukan tanggal jatuh tempo');
                goToStep(3);
                return;
            }

            // Generate invoice number
            const billingCount = transactions.filter(t => t.type === 'billing').length;
            const invoiceNumber = `INV-${String(billingCount + 1).padStart(3, '0')}`;

            const newTransaction = {
                id: transactions.length + 1,
                invoiceNumber: invoiceNumber,
                date: new Date().toISOString().split('T')[0],
                time: new Date().toLocaleTimeString('id-ID', { hour: '2-digit', minute: '2-digit' }),
                customer: customerName,
                items: invoiceItems,
                total: totalAmount,
                dueDate: dueDate,
                status: 'Belum Dibayar',
                transactionStatus: 'Selesai',
                description: description || 'Tagihan cetak digital',
                priority: priority || 'normal',
                type: 'billing',
                paymentDate: null
            };

            transactions.push(newTransaction);
            
            // Update customer transaction count
            const customer = customers.find(c => c.name.toLowerCase() === customerName.toLowerCase());
            if (customer) {
                customer.totalTransactions += 1;
            }
            
            saveDataToStorage(); // Save data after adding invoice
            
            // Refresh all relevant displays
            renderInvoices();
            updateInvoiceStats();
            updateDashboardStats();
            
            // Switch to tagihan tab to show the new invoice
            showTab('tagihan');
            
            closeInvoiceModal();
            
            // Show success message
            alert(` Tagihan ${invoiceNumber} berhasil dibuat untuk ${customerName}!\n\nTotal: Rp ${totalAmount.toLocaleString('id-ID')}\nJatuh Tempo: ${dueDate}`);
        }

        function renderInvoices() {
            const tbody = document.getElementById('invoices-table');
            tbody.innerHTML = '';

            // Filter only billing type transactions for invoice view
            const billingTransactions = transactions.filter(t => t.type === 'billing');

            billingTransactions.forEach(invoice => {
                const row = document.createElement('tr');
                row.className = 'table-row transition-all duration-300';
                
                const statusClass = invoice.status === 'Lunas' ? 'bg-green-100 text-green-800' : 
                                   invoice.status === 'Belum Dibayar' ? 'bg-red-100 text-red-800' : 
                                   'bg-yellow-100 text-yellow-800';

                row.innerHTML = `
                    <td class="py-3 px-4 text-gray-600">${invoice.invoiceNumber}</td>
                    <td class="py-3 px-4 text-gray-600">${invoice.date}</td>
                    <td class="py-3 px-4 text-gray-900 font-medium">${invoice.customer}</td>
                    <td class="py-3 px-4 text-gray-900 font-semibold">Rp ${invoice.total.toLocaleString('id-ID')}</td>
                    <td class="py-3 px-4 text-gray-600">${invoice.dueDate}</td>
                    <td class="py-3 px-4">
                        <span class="px-3 py-1 ${statusClass} rounded-full text-sm font-medium">${invoice.status}</span>
                    </td>
                    <td class="py-3 px-4">
                        <button onclick="updateInvoiceStatus(${invoice.id})" class="text-blue-600 hover:text-blue-800 font-medium mr-3">
                            ${invoice.status === 'Lunas' ? 'Belum Bayar' : 'Bayar'}
                        </button>
                        <button onclick="printInvoice(${invoice.id})" class="text-green-600 hover:text-green-800 font-medium">
                            Print
                        </button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        function updateInvoiceStatus(id) {
            const transaction = transactions.find(t => t.id === id);
            if (transaction) {
                transaction.status = transaction.status === 'Lunas' ? 'Belum Dibayar' : 'Lunas';
                transaction.paymentDate = transaction.status === 'Lunas' ? new Date().toISOString().split('T')[0] : null;
                
                saveDataToStorage(); // Save data after updating status
                renderInvoices();
                updateInvoiceStats();
                updateDashboardStats();
                updateReportStats();
            }
        }

        function updateInvoiceStats() {
            const billingTransactions = transactions.filter(t => t.type === 'billing');
            const unpaidInvoices = billingTransactions.filter(i => i.status === 'Belum Dibayar').length;
            const paidInvoices = billingTransactions.filter(i => i.status === 'Lunas').length;
            const totalReceivables = billingTransactions.filter(i => i.status === 'Belum Dibayar').reduce((sum, i) => sum + i.total, 0);

            document.getElementById('unpaid-invoices').textContent = unpaidInvoices;
            document.getElementById('paid-invoices').textContent = paidInvoices;
            document.getElementById('total-receivables').textContent = `Rp ${totalReceivables.toLocaleString('id-ID')}`;
        }

        function printInvoice(id) {
            const transaction = transactions.find(t => t.id === id);
            if (transaction) {
                alert(`Mencetak tagihan ${transaction.invoiceNumber} untuk ${transaction.customer}`);
            }
        }

        // Delivery Management
        function openDeliveryModal() {
            populateCustomerDropdown('delivery-customer');
            
            // Set default delivery date to today
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('delivery-date').value = today;
            
            // Set default ETA to tomorrow
            const tomorrow = new Date();
            tomorrow.setDate(tomorrow.getDate() + 1);
            document.getElementById('delivery-eta').value = tomorrow.toISOString().split('T')[0];
            
            // Setup event listeners for real-time summary updates
            setupDeliverySummaryListeners();
            
            // Setup customer orders loading
            setupCustomerOrdersListener();
            
            // Initial summary update
            updateDeliverySummary();
            
            document.getElementById('delivery-modal').classList.remove('hidden');
            document.getElementById('delivery-modal').classList.add('flex');
        }

        function setupCustomerOrdersListener() {
            const customerSelect = document.getElementById('delivery-customer');
            customerSelect.addEventListener('change', loadCustomerOrders);
        }

        function setupDeliverySummaryListeners() {
            // Remove existing listeners to prevent duplicates
            const customerSelect = document.getElementById('delivery-customer');
            const addressTextarea = document.getElementById('delivery-address');
            const deliveryDateInput = document.getElementById('delivery-date');
            const etaInput = document.getElementById('delivery-eta');
            const deliveryItemsTextarea = document.getElementById('delivery-items');
            
            // Add event listeners for real-time updates
            customerSelect.addEventListener('change', updateDeliverySummary);
            addressTextarea.addEventListener('input', updateDeliverySummary);
            deliveryDateInput.addEventListener('change', updateDeliverySummary);
            etaInput.addEventListener('change', updateDeliverySummary);
            deliveryItemsTextarea.addEventListener('input', updateItemsSummary);
        }

        function closeDeliveryModal() {
            document.getElementById('delivery-modal').classList.add('hidden');
            document.getElementById('delivery-modal').classList.remove('flex');
            document.getElementById('delivery-form').reset();
            
            // Hide and reset summary section
            document.getElementById('delivery-summary-section').classList.add('hidden');
            resetItemsSummary();
        }

        function loadCustomerOrders() {
            const selectedCustomer = document.getElementById('delivery-customer').value;
            const ordersSection = document.getElementById('customer-orders-section');
            const ordersList = document.getElementById('customer-orders-list');
            const addressField = document.getElementById('delivery-address');
            
            if (!selectedCustomer) {
                ordersSection.classList.add('hidden');
                addressField.value = '';
                return;
            }
            
            // Auto-fill customer address if available
            const customer = customers.find(c => c.name === selectedCustomer);
            if (customer && customer.address) {
                addressField.value = customer.address;
            } else {
                // Set default address format
                addressField.value = `Alamat ${selectedCustomer}\nJakarta`;
            }
            
            // Find customer's transactions/orders
            const customerOrders = transactions.filter(t => t.customer === selectedCustomer);
            
            if (customerOrders.length === 0) {
                ordersSection.classList.add('hidden');
                return;
            }
            
            // Show orders section
            ordersSection.classList.remove('hidden');
            
            // Populate orders list
            ordersList.innerHTML = '';
            
            customerOrders.forEach(order => {
                const orderCard = document.createElement('div');
                orderCard.className = 'border border-gray-200 rounded-xl p-4 hover:bg-gray-50 transition-all duration-300';
                
                const statusClass = order.status === 'Lunas' ? 'bg-green-100 text-green-800' : 
                                   order.status === 'Belum Dibayar' ? 'bg-red-100 text-red-800' : 
                                   'bg-yellow-100 text-yellow-800';
                
                const transactionStatusClass = order.transactionStatus === 'Selesai' ? 'bg-green-100 text-green-800' : 
                                              order.transactionStatus === 'Proses' ? 'bg-yellow-100 text-yellow-800' : 
                                              'bg-red-100 text-red-800';
                
                // Format items for display with enhanced information including dimensions
                let itemsDisplay = 'Item tidak tersedia';
                let detailedItems = [];
                
                if (order.items && order.items.length > 0) {
                    detailedItems = order.items.map(item => {
                        const unit = printPrices[item.service]?.unit || 'unit';
                        let displayText = '';
                        let enhancedItem = {
                            name: item.service,
                            quantity: item.quantity,
                            unit: unit
                        };
                        
                        // Check if item has dimensional information
                        if (item.length && item.width) {
                            const dimensions = `${item.length}m  ${item.width}m`;
                            const productName = item.productName || item.service;
                            displayText = `${productName} - ${dimensions} (${item.quantity} pcs)`;
                            
                            // Add enhanced data for better sync
                            enhancedItem.dimensions = dimensions;
                            enhancedItem.productName = productName;
                            enhancedItem.totalArea = item.totalArea;
                            enhancedItem.displayText = displayText;
                        } else {
                            displayText = `${item.productName || item.service} (${item.quantity} ${unit})`;
                            enhancedItem.productName = item.productName;
                            enhancedItem.displayText = displayText;
                        }
                        
                        return enhancedItem;
                    });
                    itemsDisplay = detailedItems.map(item => item.displayText).join(', ');
                }
                
                orderCard.innerHTML = `
                    <div class="flex items-start justify-between mb-3">
                        <div class="flex-1">
                            <div class="flex items-center space-x-3 mb-2">
                                <h4 class="font-semibold text-gray-900">${order.invoiceNumber}</h4>
                                <span class="px-2 py-1 ${statusClass} rounded-full text-xs font-medium">${order.status}</span>
                                <span class="px-2 py-1 ${transactionStatusClass} rounded-full text-xs font-medium">${order.transactionStatus}</span>
                            </div>
                            <div class="text-sm text-gray-600 mb-2">
                                <div> ${order.date} ${order.time ? `  ${order.time}` : ''}</div>
                                <div> Rp ${order.total.toLocaleString('id-ID')}</div>
                                ${order.dueDate ? `<div> Jatuh Tempo: ${order.dueDate}</div>` : ''}
                            </div>
                            <div class="text-sm text-gray-700">
                                <strong>Items:</strong> ${itemsDisplay}
                            </div>
                            ${order.description ? `<div class="text-xs text-gray-500 mt-1">${order.description}</div>` : ''}
                        </div>
                        <div class="ml-4">
                            <input type="checkbox" class="order-checkbox w-4 h-4 text-blue-600 rounded" 
                                   data-order-id="${order.id}" 
                                   data-order-number="${order.invoiceNumber}"
                                   data-items='${JSON.stringify(detailedItems)}'>
                        </div>
                    </div>
                `;
                
                ordersList.appendChild(orderCard);
            });
            
            // Add "no orders" message if empty
            if (customerOrders.length === 0) {
                ordersList.innerHTML = '<div class="text-center text-gray-500 py-4">Tidak ada pesanan untuk pelanggan ini</div>';
            }
        }

        function loadSelectedOrders() {
            const checkboxes = document.querySelectorAll('.order-checkbox:checked');
            const deliveryItemsTextarea = document.getElementById('delivery-items');
            
            if (checkboxes.length === 0) {
                alert('Silakan pilih minimal satu pesanan');
                return;
            }
            
            let allItems = [];
            let structuredItems = [];
            const selectedOrders = [];
            
            checkboxes.forEach(checkbox => {
                const orderNumber = checkbox.getAttribute('data-order-number');
                const itemsData = JSON.parse(checkbox.getAttribute('data-items'));
                
                selectedOrders.push(orderNumber);
                
                // Get the actual transaction to extract complete information
                const transaction = transactions.find(t => t.invoiceNumber === orderNumber);
                
                if (transaction && transaction.items) {
                    // Process each item from the transaction directly for perfect sync
                    transaction.items.forEach(transactionItem => {
                        // Use the exact product name from the transaction
                        const exactProductName = transactionItem.productName || transactionItem.service;
                        
                        let enhancedItem = {
                            service: transactionItem.service,
                            productName: exactProductName,
                            quantity: transactionItem.quantity,
                            orderNumber: orderNumber,
                            originalTransactionItem: transactionItem
                        };
                        
                        // Handle dimensional items (Banner, Stiker, etc.)
                        if (transactionItem.length && transactionItem.width) {
                            const dimensions = `${transactionItem.length}m  ${transactionItem.width}m`;
                            enhancedItem.dimensions = dimensions;
                            enhancedItem.length = transactionItem.length;
                            enhancedItem.width = transactionItem.width;
                            enhancedItem.totalArea = transactionItem.totalArea || (transactionItem.length * transactionItem.width * transactionItem.quantity);
                            enhancedItem.unit = 'pcs';
                            enhancedItem.displayText = `${exactProductName} - ${dimensions} (${transactionItem.quantity} pcs)`;
                            
                            // Add to display list with exact name
                            allItems.push(`${exactProductName} - ${dimensions} (${transactionItem.quantity} pcs)`);
                        } 
                        // Handle non-dimensional items (Kartu Nama, ID Card, etc.)
                        else {
                            const priceData = printPrices[transactionItem.service];
                            const unit = priceData ? priceData.unit.replace('Per ', '').toLowerCase() : 'pcs';
                            enhancedItem.unit = unit;
                            enhancedItem.displayText = `${exactProductName} (${transactionItem.quantity} ${unit})`;
                            
                            // Add to display list with exact name
                            allItems.push(`${exactProductName} (${transactionItem.quantity} ${unit})`);
                        }
                        
                        structuredItems.push(enhancedItem);
                    });
                } else {
                    // Fallback to itemsData if transaction not found
                    itemsData.forEach(item => {
                        const exactProductName = item.productName || item.name;
                        
                        let enhancedItem = {
                            service: item.name,
                            productName: exactProductName,
                            quantity: item.quantity,
                            unit: item.unit,
                            displayText: item.displayText || `${exactProductName} (${item.quantity} ${item.unit})`,
                            orderNumber: orderNumber
                        };
                        
                        if (item.dimensions) {
                            enhancedItem.dimensions = item.dimensions;
                        }
                        
                        structuredItems.push(enhancedItem);
                        allItems.push(enhancedItem.displayText);
                    });
                }
            });
            
            // Format items for delivery with enhanced structure and perfect sync
            const ordersText = selectedOrders.join(', ');
            const itemsFormatted = allItems.map((item, index) => `${index + 1}. ${item}`).join('\n');
            
            // Create comprehensive delivery note format with exact product names
            deliveryItemsTextarea.value = ` PESANAN TERKAIT: ${ordersText}

 DAFTAR BARANG YANG DIKIRIM:
${itemsFormatted}

 RINGKASAN:
 Total Item: ${allItems.length} produk
 Dari Pesanan: ${selectedOrders.length} invoice
 Status: Siap Kirim 

 Data tersinkronisasi dengan sistem pesanan - Nama produk sesuai pesanan asli`;
            
            // Store enhanced structured items data for perfect delivery note formatting
            deliveryItemsTextarea.setAttribute('data-structured-items', JSON.stringify(structuredItems));
            deliveryItemsTextarea.setAttribute('data-order-numbers', JSON.stringify(selectedOrders));
            deliveryItemsTextarea.setAttribute('data-sync-status', 'synced');
            
            // Update delivery summary
            updateDeliverySummary();
            
            // Show enhanced success message
            const uniqueProducts = [...new Set(structuredItems.map(item => item.service))];
            alert(` SINKRONISASI SEMPURNA!\n\n Pesanan: ${ordersText}\n ${allItems.length} item dari ${uniqueProducts.length} jenis produk\n Nama produk tersinkronisasi 100% dengan pesanan asli\n\n Semua nama barang, dimensi, dan jumlah sesuai dengan data pesanan yang dipilih.`);
            
            // Uncheck all checkboxes
            checkboxes.forEach(checkbox => {
                checkbox.checked = false;
            });
        }

        function updateDeliverySummary() {
            const summarySection = document.getElementById('delivery-summary-section');
            const customer = document.getElementById('delivery-customer').value;
            const address = document.getElementById('delivery-address').value;
            const deliveryDate = document.getElementById('delivery-date').value;
            const eta = document.getElementById('delivery-eta').value;
            const deliveryItemsTextarea = document.getElementById('delivery-items');
            
            // Show summary section if we have basic data
            if (customer || address || deliveryDate) {
                summarySection.classList.remove('hidden');
                
                // Update basic info
                document.getElementById('summary-customer').textContent = customer || '-';
                document.getElementById('summary-delivery-date').textContent = deliveryDate ? new Date(deliveryDate).toLocaleDateString('id-ID') : '-';
                document.getElementById('summary-eta').textContent = eta ? new Date(eta).toLocaleDateString('id-ID') : '-';
                document.getElementById('summary-address').textContent = address || '-';
                
                // Update items summary
                updateItemsSummary();
            } else {
                summarySection.classList.add('hidden');
            }
        }

        function updateItemsSummary() {
            const deliveryItemsTextarea = document.getElementById('delivery-items');
            const summaryItemsList = document.getElementById('summary-items-list');
            const summaryTotalItems = document.getElementById('summary-total-items');
            const summaryItemTypes = document.getElementById('summary-item-types');
            
            try {
                const structuredItemsData = deliveryItemsTextarea.getAttribute('data-structured-items');
                
                if (structuredItemsData) {
                    const structuredItems = JSON.parse(structuredItemsData);
                    
                    if (structuredItems.length > 0) {
                        // Calculate totals
                        const totalItems = structuredItems.reduce((sum, item) => sum + item.quantity, 0);
                        const uniqueServices = [...new Set(structuredItems.map(item => item.service))];
                        
                        // Update counters
                        summaryTotalItems.textContent = totalItems;
                        summaryItemTypes.textContent = uniqueServices.length;
                        
                        // Create items list
                        let itemsHTML = '';
                        structuredItems.forEach((item, index) => {
                            const icon = getServiceIcon(item.service);
                            const displayName = item.productName || item.service;
                            
                            itemsHTML += `
                                <div class="flex items-center justify-between py-2 px-3 bg-gray-50 rounded-lg">
                                    <div class="flex items-center space-x-3">
                                        <div class="w-8 h-8 gradient-bg rounded-lg flex items-center justify-center">
                                            ${icon}
                                        </div>
                                        <div>
                                            <div class="font-medium text-gray-900">${displayName}</div>
                                            <div class="text-xs text-gray-500">
                                                ${item.dimensions ? `${item.dimensions}  ` : ''}${item.service}
                                                ${item.orderNumber ? `  ${item.orderNumber}` : ''}
                                            </div>
                                        </div>
                                    </div>
                                    <div class="text-right">
                                        <div class="font-bold text-blue-600">${item.quantity}</div>
                                        <div class="text-xs text-gray-500">${item.unit}</div>
                                    </div>
                                </div>
                            `;
                        });
                        
                        summaryItemsList.innerHTML = itemsHTML;
                    } else {
                        resetItemsSummary();
                    }
                } else {
                    // Parse from text format if no structured data
                    const itemsText = deliveryItemsTextarea.value.trim();
                    
                    if (itemsText && itemsText !== '') {
                        // Try to extract items from text
                        const lines = itemsText.split('\n');
                        let itemCount = 0;
                        let itemsHTML = '';
                        
                        lines.forEach(line => {
                            line = line.trim();
                            if (line && line.match(/^\d+\./)) {
                                itemCount++;
                                const cleanLine = line.replace(/^\d+\.\s*/, '');
                                itemsHTML += `
                                    <div class="flex items-center justify-between py-2 px-3 bg-gray-50 rounded-lg">
                                        <div class="flex items-center space-x-3">
                                            <div class="w-8 h-8 bg-gray-500 rounded-lg flex items-center justify-center">
                                                <svg class="w-4 h-4 text-white" fill="currentColor" viewBox="0 0 20 20">
                                                    <path d="M3 4a1 1 0 011-1h12a1 1 0 011 1v2a1 1 0 01-1 1H4a1 1 0 01-1-1V4zM3 10a1 1 0 011-1h6a1 1 0 011 1v6a1 1 0 01-1 1H4a1 1 0 01-1-1v-6zM14 9a1 1 0 00-1 1v6a1 1 0 001 1h2a1 1 0 001-1v-6a1 1 0 00-1-1h-2z"></path>
                                                </svg>
                                            </div>
                                            <div>
                                                <div class="font-medium text-gray-900">${cleanLine}</div>
                                                <div class="text-xs text-gray-500">Item manual</div>
                                            </div>
                                        </div>
                                        <div class="text-right">
                                            <div class="font-bold text-gray-600">1</div>
                                            <div class="text-xs text-gray-500">item</div>
                                        </div>
                                    </div>
                                `;
                            }
                        });
                        
                        if (itemCount > 0) {
                            summaryTotalItems.textContent = itemCount;
                            summaryItemTypes.textContent = itemCount;
                            summaryItemsList.innerHTML = itemsHTML;
                        } else {
                            resetItemsSummary();
                        }
                    } else {
                        resetItemsSummary();
                    }
                }
            } catch (error) {
                console.error('Error updating items summary:', error);
                resetItemsSummary();
            }
        }

        function resetItemsSummary() {
            document.getElementById('summary-total-items').textContent = '0';
            document.getElementById('summary-item-types').textContent = '0';
            document.getElementById('summary-items-list').innerHTML = '<div class="text-center text-gray-400 py-4">Belum ada barang dipilih</div>';
        }

        function refreshDeliverySummary() {
            updateDeliverySummary();
            
            // Show refresh animation
            const refreshBtn = event.target.closest('button');
            const originalHTML = refreshBtn.innerHTML;
            refreshBtn.innerHTML = `
                <svg class="w-4 h-4 animate-spin" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M4 2a1 1 0 011 1v2.101a7.002 7.002 0 0111.601 2.566 1 1 0 11-1.885.666A5.002 5.002 0 005.999 7H9a1 1 0 010 2H4a1 1 0 01-1-1V3a1 1 0 011-1zm.008 9.057a1 1 0 011.276.61A5.002 5.002 0 0014.001 13H11a1 1 0 110-2h5a1 1 0 011 1v5a1 1 0 11-2 0v-2.101a7.002 7.002 0 01-11.601-2.566 1 1 0 01.61-1.276z" clip-rule="evenodd"></path>
                </svg>
                <span>Memperbarui...</span>
            `;
            
            setTimeout(() => {
                refreshBtn.innerHTML = originalHTML;
            }, 1000);
        }

        function addDelivery(customer, address, items, notes, deliveryDate, eta) {
            // Get structured items data if available
            const deliveryItemsTextarea = document.getElementById('delivery-items');
            let structuredItems = null;
            let orderNumbers = null;
            
            try {
                const structuredItemsData = deliveryItemsTextarea.getAttribute('data-structured-items');
                const orderNumbersData = deliveryItemsTextarea.getAttribute('data-order-numbers');
                
                if (structuredItemsData) {
                    structuredItems = JSON.parse(structuredItemsData);
                }
                if (orderNumbersData) {
                    orderNumbers = JSON.parse(orderNumbersData);
                }
            } catch (error) {
                console.log('No structured data available, using text format');
            }

            const newDelivery = {
                id: deliveries.length + 1,
                deliveryNumber: `SJ-${String(deliveries.length + 1).padStart(3, '0')}`,
                date: deliveryDate || new Date().toISOString().split('T')[0],
                customer: customer,
                address: address,
                items: items,
                status: 'Menunggu Kirim',
                notes: notes,
                eta: eta,
                createdAt: new Date().toISOString().split('T')[0],
                createdTime: new Date().toLocaleTimeString('id-ID', { hour: '2-digit', minute: '2-digit' }),
                // Enhanced data for better formatting
                structuredItems: structuredItems,
                relatedOrders: orderNumbers,
                syncedFromInvoices: structuredItems ? true : false
            };

            deliveries.push(newDelivery);
            saveDataToStorage(); // Save data after adding delivery
            renderDeliveries();
            updateDeliveryStats();
            closeDeliveryModal();
            
            // Show enhanced success message
            let successMessage = ` Surat Jalan ${newDelivery.deliveryNumber} berhasil dibuat!\n\nPelanggan: ${customer}\nTanggal Kirim: ${deliveryDate}`;
            
            if (eta) {
                successMessage += `\nEstimasi Tiba: ${eta}`;
            }
            
            if (orderNumbers && orderNumbers.length > 0) {
                successMessage += `\n\n Terhubung dengan pesanan: ${orderNumbers.join(', ')}`;
                successMessage += `\n Total ${structuredItems ? structuredItems.length : 0} jenis produk`;
            }
            
            alert(successMessage);
        }

        function renderDeliveries() {
            const tbody = document.getElementById('deliveries-table');
            tbody.innerHTML = '';

            deliveries.forEach(delivery => {
                const row = document.createElement('tr');
                row.className = 'table-row transition-all duration-300';
                
                const statusClass = delivery.status === 'Terkirim' ? 'bg-green-100 text-green-800' : 
                                   delivery.status === 'Dalam Perjalanan' ? 'bg-blue-100 text-blue-800' : 
                                   'bg-yellow-100 text-yellow-800';

                // Truncate long text for display
                const addressDisplay = delivery.address.length > 40 ? delivery.address.substring(0, 40) + '...' : delivery.address;
                
                // Enhanced items display
                let itemsDisplay = '';
                if (delivery.syncedFromInvoices && delivery.structuredItems) {
                    const totalItems = delivery.structuredItems.reduce((sum, item) => sum + item.quantity, 0);
                    const itemTypes = delivery.structuredItems.length;
                    itemsDisplay = ` ${totalItems} item (${itemTypes} jenis)`;
                    if (delivery.relatedOrders) {
                        itemsDisplay += `   ${delivery.relatedOrders.join(', ')}`;
                    }
                } else {
                    itemsDisplay = delivery.items.length > 30 ? delivery.items.substring(0, 30) + '...' : delivery.items;
                }

                // Add sync indicator
                const syncIndicator = delivery.syncedFromInvoices ? 
                    '<span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-800 ml-2"> Sync</span>' : '';

                row.innerHTML = `
                    <td class="py-3 px-4 text-gray-600">
                        <div class="flex items-center">
                            ${delivery.deliveryNumber}
                            ${syncIndicator}
                        </div>
                    </td>
                    <td class="py-3 px-4 text-gray-600">${delivery.date}</td>
                    <td class="py-3 px-4 text-gray-900 font-medium">${delivery.customer}</td>
                    <td class="py-3 px-4 text-gray-600" title="${delivery.address}">${addressDisplay}</td>

                    <td class="py-3 px-4">
                        <span class="px-3 py-1 ${statusClass} rounded-full text-sm font-medium">${delivery.status}</span>
                    </td>
                    <td class="py-3 px-4">
                        <div class="flex space-x-2">
                            <button onclick="updateDeliveryStatus(${delivery.id})" class="text-blue-600 hover:text-blue-800 font-medium text-sm px-2 py-1 rounded hover:bg-blue-50 transition-all duration-300">
                                Update
                            </button>
                            <button onclick="viewDeliveryDetails(${delivery.id})" class="text-purple-600 hover:text-purple-800 font-medium text-sm px-2 py-1 rounded hover:bg-purple-50 transition-all duration-300">
                                Detail
                            </button>
                            <button onclick="printDeliveryNote(${delivery.id})" class="text-green-600 hover:text-green-800 font-medium text-sm px-2 py-1 rounded hover:bg-green-50 transition-all duration-300">
                                Print
                            </button>
                        </div>
                    </td>
                `;
                tbody.appendChild(row);
            });

            if (deliveries.length === 0) {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td colspan="6" class="py-12 px-4 text-center text-gray-500">
                        <div class="flex flex-col items-center">
                            <svg class="w-16 h-16 text-gray-300 mb-4" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M8 5a1 1 0 100 2h5.586l-1.293 1.293a1 1 0 001.414 1.414l3-3a1 1 0 000-1.414l-3-3a1 1 0 10-1.414 1.414L13.586 5H8zM12 15a1 1 0 100-2H6.414l1.293-1.293a1 1 0 10-1.414-1.414l-3 3a1 1 0 000 1.414l3 3a1 1 0 001.414-1.414L6.414 15H12z"></path>
                            </svg>
                            <p class="text-lg font-medium text-gray-600 mb-2">Belum ada surat jalan</p>
                            <p class="text-sm text-gray-500">Klik "Buat Surat Jalan" untuk membuat surat jalan pertama</p>
                        </div>
                    </td>
                `;
                tbody.appendChild(row);
            }
        }

        function viewDeliveryDetails(id) {
            const delivery = deliveries.find(d => d.id === id);
            if (delivery) {
                openDeliveryDetailsModal(delivery);
            }
        }

        function openDeliveryDetailsModal(delivery) {
            const modal = document.getElementById('delivery-details-modal');
            
            // Populate modal content
            document.getElementById('detail-delivery-number').textContent = delivery.deliveryNumber;
            document.getElementById('detail-customer-name').textContent = delivery.customer;
            document.getElementById('detail-delivery-date').textContent = delivery.date;
            document.getElementById('detail-delivery-eta').textContent = delivery.eta || 'Tidak ditentukan';
            document.getElementById('detail-delivery-address').textContent = delivery.address;
            document.getElementById('detail-delivery-notes').textContent = delivery.notes || 'Tidak ada catatan khusus';
            document.getElementById('detail-delivery-status').textContent = delivery.status;
            document.getElementById('detail-created-date').textContent = `${delivery.createdAt || delivery.date} ${delivery.createdTime || ''}`;
            
            // Set customer initial
            const customerInitial = delivery.customer.charAt(0).toUpperCase();
            document.getElementById('customer-initial').textContent = customerInitial;
            
            // Set status badge color
            const statusBadge = document.getElementById('detail-delivery-status');
            statusBadge.className = 'px-3 py-1 rounded-full text-sm font-medium ';
            if (delivery.status === 'Terkirim') {
                statusBadge.className += 'bg-green-100 text-green-800';
            } else if (delivery.status === 'Dalam Perjalanan') {
                statusBadge.className += 'bg-blue-100 text-blue-800';
            } else {
                statusBadge.className += 'bg-yellow-100 text-yellow-800';
            }
            
            // Format and display items with simple structure
            formatSimpleDeliveryItems(delivery);
            
            // Update print date
            document.getElementById('print-date').textContent = `${new Date().toLocaleDateString('id-ID')} ${new Date().toLocaleTimeString('id-ID')}`;
            
            // Hide notes section if no notes
            const notesSection = document.getElementById('notes-section');
            if (delivery.notes === 'Tidak ada catatan khusus' || !delivery.notes) {
                notesSection.style.display = 'none';
            } else {
                notesSection.style.display = 'block';
            }
            
            modal.classList.remove('hidden');
            modal.classList.add('flex');
        }

        function formatSimpleDeliveryItems(delivery) {
            const formattedContainer = document.getElementById('detail-delivery-items-formatted');
            
            // Try to parse structured items from delivery with enhanced sync detection
            let itemsData = [];
            
            // Priority 1: Check if delivery has structured items (from perfect invoice sync)
            if (delivery.structuredItems && Array.isArray(delivery.structuredItems)) {
                itemsData = delivery.structuredItems.map(item => ({
                    service: item.service || item.name,
                    productName: item.productName || item.service || item.name,
                    quantity: item.quantity || 1,
                    unit: item.unit || 'pcs',
                    dimensions: item.dimensions || null,
                    length: item.length || null,
                    width: item.width || null,
                    totalArea: item.totalArea || null,
                    displayText: item.displayText || `${item.productName || item.service} (${item.quantity} ${item.unit})`,
                    orderNumber: item.orderNumber || null,
                    syncedFromInvoice: true
                }));
            } else {
                // Priority 2: Parse from enhanced text format (new sync format)
                const itemsText = delivery.items;
                
                // Check for new enhanced sync format
                if (itemsText.includes(' PESANAN TERKAIT:') && itemsText.includes(' DAFTAR BARANG YANG DIKIRIM:')) {
                    const lines = itemsText.split('\n');
                    let inItemsList = false;
                    
                    lines.forEach(line => {
                        line = line.trim();
                        if (line === ' DAFTAR BARANG YANG DIKIRIM:') {
                            inItemsList = true;
                        } else if (inItemsList && line && !line.startsWith('') && !line.startsWith('')) {
                            // Remove numbering if present
                            const cleanLine = line.replace(/^\d+\.\s*/, '');
                            if (cleanLine) {
                                let parsedItem = {
                                    service: cleanLine,
                                    productName: cleanLine,
                                    quantity: 1,
                                    unit: 'item',
                                    displayText: cleanLine,
                                    dimensions: null,
                                    syncedFromInvoice: true
                                };
                                
                                // Enhanced parsing for dimensions (e.g., "Banner Promosi Event - 3m  2m (2 pcs)")
                                const dimensionMatch = cleanLine.match(/^(.+?)\s*-\s*(\d+(?:\.\d+)?m\s*\s*\d+(?:\.\d+)?m)\s*\((\d+)\s*(.+?)\)$/);
                                if (dimensionMatch) {
                                    parsedItem.productName = dimensionMatch[1].trim();
                                    // Keep the original service type for icon matching
                                    parsedItem.service = getServiceTypeFromProductName(parsedItem.productName);
                                    parsedItem.dimensions = dimensionMatch[2].trim();
                                    parsedItem.quantity = parseInt(dimensionMatch[3]);
                                    parsedItem.unit = dimensionMatch[4].trim();
                                    
                                    // Extract length and width for better display
                                    const dimParts = parsedItem.dimensions.match(/(\d+(?:\.\d+)?)m\s*\s*(\d+(?:\.\d+)?)m/);
                                    if (dimParts) {
                                        parsedItem.length = parseFloat(dimParts[1]);
                                        parsedItem.width = parseFloat(dimParts[2]);
                                        parsedItem.totalArea = parsedItem.length * parsedItem.width * parsedItem.quantity;
                                    }
                                } else {
                                    // Try standard format (e.g., "Kartu Nama Executive (200 pcs)")
                                    const standardMatch = cleanLine.match(/^(.+?)\s*\((\d+)\s*(.+?)\)$/);
                                    if (standardMatch) {
                                        parsedItem.productName = standardMatch[1].trim();
                                        // Keep the original service type for icon matching
                                        parsedItem.service = getServiceTypeFromProductName(parsedItem.productName);
                                        parsedItem.quantity = parseInt(standardMatch[2]);
                                        parsedItem.unit = standardMatch[3].trim();
                                    }
                                }
                                
                                itemsData.push(parsedItem);
                            }
                        }
                    });
                } 
                // Legacy format support
                else if (itemsText.includes('PESANAN:') && itemsText.includes('DAFTAR BARANG:')) {
                    const lines = itemsText.split('\n');
                    let inItemsList = false;
                    
                    lines.forEach(line => {
                        line = line.trim();
                        if (line === 'DAFTAR BARANG:') {
                            inItemsList = true;
                        } else if (inItemsList && line && !line.startsWith('TOTAL:')) {
                            const cleanLine = line.replace(/^\d+\.\s*/, '');
                            if (cleanLine) {
                                let parsedItem = {
                                    service: cleanLine,
                                    productName: cleanLine,
                                    quantity: 1,
                                    unit: 'item',
                                    displayText: cleanLine,
                                    dimensions: null,
                                    syncedFromInvoice: false
                                };
                                
                                const dimensionMatch = cleanLine.match(/^(.+?)\s*-\s*(\d+(?:\.\d+)?m\s*\s*\d+(?:\.\d+)?m)\s*\((\d+)\s*(.+?)\)$/);
                                if (dimensionMatch) {
                                    parsedItem.productName = dimensionMatch[1].trim();
                                    parsedItem.service = parsedItem.productName;
                                    parsedItem.dimensions = dimensionMatch[2].trim();
                                    parsedItem.quantity = parseInt(dimensionMatch[3]);
                                    parsedItem.unit = dimensionMatch[4].trim();
                                } else {
                                    const standardMatch = cleanLine.match(/^(.+?)\s*\((\d+)\s*(.+?)\)$/);
                                    if (standardMatch) {
                                        parsedItem.productName = standardMatch[1].trim();
                                        parsedItem.service = parsedItem.productName;
                                        parsedItem.quantity = parseInt(standardMatch[2]);
                                        parsedItem.unit = standardMatch[3].trim();
                                    }
                                }
                                
                                itemsData.push(parsedItem);
                            }
                        }
                    });
                } else {
                    // Simple text format - split by lines or commas
                    const items = itemsText.split(/[,\n]/).filter(item => item.trim());
                    items.forEach(item => {
                        const cleanItem = item.trim();
                        if (cleanItem) {
                            let parsedItem = {
                                service: cleanItem,
                                productName: cleanItem,
                                quantity: 1,
                                unit: 'item',
                                displayText: cleanItem,
                                dimensions: null,
                                syncedFromInvoice: false
                            };
                            
                            const dimensionMatch = cleanItem.match(/^(.+?)\s*-\s*(\d+(?:\.\d+)?m\s*\s*\d+(?:\.\d+)?m)\s*\((\d+)\s*(.+?)\)$/);
                            if (dimensionMatch) {
                                parsedItem.productName = dimensionMatch[1].trim();
                                parsedItem.service = parsedItem.productName;
                                parsedItem.dimensions = dimensionMatch[2].trim();
                                parsedItem.quantity = parseInt(dimensionMatch[3]);
                                parsedItem.unit = dimensionMatch[4].trim();
                            } else {
                                const standardMatch = cleanItem.match(/^(.+?)\s*\((\d+)\s*(.+?)\)$/);
                                if (standardMatch) {
                                    parsedItem.productName = standardMatch[1].trim();
                                    parsedItem.service = parsedItem.productName;
                                    parsedItem.quantity = parseInt(standardMatch[2]);
                                    parsedItem.unit = standardMatch[3].trim();
                                }
                            }
                            
                            itemsData.push(parsedItem);
                        }
                    });
                }
            }
            
            // Generate enhanced formatted HTML with perfect sync indicators
            if (itemsData.length === 0) {
                formattedContainer.innerHTML = `
                    <div class="text-center text-gray-500 py-6">
                        <p class="text-lg font-medium">Tidak ada detail barang</p>
                        <p class="text-sm">Informasi barang tidak tersedia</p>
                    </div>
                `;
                return;
            }
            
            let formattedHTML = '';
            let totalItems = 0;
            let totalArea = 0;
            const hasSyncedItems = itemsData.some(item => item.syncedFromInvoice);
            
            // Add sync status indicator
            if (hasSyncedItems) {
                formattedHTML += `
                    <div class="mb-4 p-3 bg-blue-50 border border-blue-200 rounded-lg">
                        <div class="flex items-center space-x-2">
                            <div class="w-4 h-4 bg-blue-500 rounded-full flex items-center justify-center">
                                <svg class="w-2 h-2 text-white" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                                </svg>
                            </div>
                            <span class="text-sm font-medium text-blue-800"> Data Tersinkronisasi dengan Pesanan</span>
                        </div>
                    </div>
                `;
            }
            
            // Enhanced table format with perfect sync data
            formattedHTML += `
                <table class="w-full border-collapse">
                    <thead>
                        <tr class="border-b-2 border-gray-300">
                            <th class="text-left py-2 px-3 font-semibold">No</th>
                            <th class="text-left py-2 px-3 font-semibold">Nama Barang</th>
                            <th class="text-center py-2 px-3 font-semibold">Dimensi</th>
                            <th class="text-center py-2 px-3 font-semibold">Jumlah</th>
                            <th class="text-center py-2 px-3 font-semibold">Satuan</th>
                        </tr>
                    </thead>
                    <tbody>
            `;
            
            itemsData.forEach((item, index) => {
                totalItems += item.quantity;
                if (item.totalArea) {
                    totalArea += item.totalArea;
                }
                
                // Display product name with sync indicator
                const displayName = item.productName || item.service;
                const dimensions = item.dimensions || '-';
                const syncIndicator = item.syncedFromInvoice ? 
                    '<span class="inline-block w-2 h-2 bg-green-500 rounded-full ml-1" title="Tersinkronisasi dengan pesanan"></span>' : '';
                
                formattedHTML += `
                    <tr class="border-b border-gray-200 ${item.syncedFromInvoice ? 'bg-green-50' : ''}">
                        <td class="py-3 px-3 text-center">${index + 1}</td>
                        <td class="py-3 px-3 font-medium">
                            ${displayName}${syncIndicator}
                            ${item.totalArea ? `<div class="text-xs text-gray-500">Area: ${item.totalArea.toFixed(2)} m</div>` : ''}
                        </td>
                        <td class="py-3 px-3 text-center text-sm">${dimensions}</td>
                        <td class="py-3 px-3 text-center font-semibold">${item.quantity}</td>
                        <td class="py-3 px-3 text-center">${item.unit}</td>
                    </tr>
                `;
            });
            
            formattedHTML += `
                    </tbody>
                    <tfoot>
                        <tr class="border-t-2 border-gray-300 bg-gray-50">
                            <td colspan="3" class="py-3 px-3 font-bold text-right">
                                TOTAL:
                                ${totalArea > 0 ? `<div class="text-xs font-normal text-gray-600">Total Area: ${totalArea.toFixed(2)} m</div>` : ''}
                            </td>
                            <td class="py-3 px-3 text-center font-bold text-blue-600">${totalItems}</td>
                            <td class="py-3 px-3 text-center font-bold">${itemsData.length} jenis</td>
                        </tr>
                    </tfoot>
                </table>
            `;
            
            // Add sync summary if applicable
            if (hasSyncedItems) {
                const syncedCount = itemsData.filter(item => item.syncedFromInvoice).length;
                formattedHTML += `
                    <div class="mt-4 p-3 bg-green-50 border border-green-200 rounded-lg">
                        <div class="text-sm text-green-800">
                            <strong> Sinkronisasi Sempurna:</strong> ${syncedCount} dari ${itemsData.length} item tersinkronisasi dengan data pesanan asli
                        </div>
                    </div>
                `;
            }
            
            formattedContainer.innerHTML = formattedHTML;
        }

        function getServiceTypeFromProductName(productName) {
            const productLower = productName.toLowerCase();
            
            // Mapping product names to service types
            const serviceMapping = {
                'banner': 'Banner/Spanduk',
                'spanduk': 'Banner/Spanduk',
                'stiker': 'Stiker',
                'sticker': 'Stiker',
                'albatros': 'Albatros',
                'oneway': 'Oneway',
                'one way': 'Oneway',
                'brosur': 'Brosur A4 (HVS)',
                'flyer': 'Brosur A4 (HVS)',
                'leaflet': 'Brosur A4 (HVS)',
                'poster': 'Poster A3',
                'stempel': 'Stempel',
                'cap': 'Stempel',
                'id card': 'Id Card',
                'kartu identitas': 'Id Card',
                'kartu nama': 'Kartu Nama',
                'name card': 'Kartu Nama',
                'business card': 'Kartu Nama'
            };
            
            // Find matching service type
            for (const [keyword, serviceType] of Object.entries(serviceMapping)) {
                if (productLower.includes(keyword)) {
                    return serviceType;
                }
            }
            
            // Default fallback - return the product name itself
            return productName;
        }

        function getServiceIcon(serviceName) {
            const icons = {
                'Banner/Spanduk': '<svg class="w-6 h-6 text-white" fill="currentColor" viewBox="0 0 20 20"><path d="M4 3a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V5a2 2 0 00-2-2H4zm12 12H4l4-8 3 6 2-4 3 6z"></path></svg>',
                'Stiker': '<svg class="w-6 h-6 text-white" fill="currentColor" viewBox="0 0 20 20"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"></path></svg>',
                'Albatros': '<svg class="w-6 h-6 text-white" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M3 4a1 1 0 011-1h12a1 1 0 011 1v2a1 1 0 01-1 1H4a1 1 0 01-1-1V4zm0 4a1 1 0 011-1h12a1 1 0 011 1v2a1 1 0 01-1 1H4a1 1 0 01-1-1V8zm0 4a1 1 0 011-1h12a1 1 0 011 1v2a1 1 0 01-1 1H4a1 1 0 01-1-1v-2z" clip-rule="evenodd"></path></svg>',
                'Oneway': '<svg class="w-6 h-6 text-white" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-8.293l-3-3a1 1 0 00-1.414 1.414L10.586 9H7a1 1 0 100 2h3.586l-1.293 1.293a1 1 0 101.414 1.414l3-3a1 1 0 000-1.414z" clip-rule="evenodd"></path></svg>',
                'Brosur': '<svg class="w-6 h-6 text-white" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M4 4a2 2 0 012-2h4.586A2 2 0 0112 2.586L15.414 6A2 2 0 0116 7.414V16a2 2 0 01-2 2H6a2 2 0 01-2-2V4z" clip-rule="evenodd"></path></svg>',
                'Poster': '<svg class="w-6 h-6 text-white" fill="currentColor" viewBox="0 0 20 20"><path d="M4 3a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V5a2 2 0 00-2-2H4zm12 12H4l4-8 3 6 2-4 3 6z"></path></svg>',
                'Stempel': '<svg class="w-6 h-6 text-white" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 2a4 4 0 00-4 4v1H5a1 1 0 00-.994.89l-1 9A1 1 0 004 18h12a1 1 0 00.994-1.11l-1-9A1 1 0 0015 7h-1V6a4 4 0 00-4-4zm2 5V6a2 2 0 10-4 0v1h4zm-6 3a1 1 0 112 0 1 1 0 01-2 0zm7-1a1 1 0 100 2 1 1 0 000-2z" clip-rule="evenodd"></path></svg>',
                'Id Card': '<svg class="w-6 h-6 text-white" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 2a4 4 0 00-4 4v1H5a1 1 0 00-.994.89l-1 9A1 1 0 004 18h12a1 1 0 00.994-1.11l-1-9A1 1 0 0015 7h-1V6a4 4 0 00-4-4zm2 5V6a2 2 0 10-4 0v1h4zm-6 3a1 1 0 112 0 1 1 0 01-2 0zm7-1a1 1 0 100 2 1 1 0 000-2z" clip-rule="evenodd"></path></svg>',
                'Kartu Nama': '<svg class="w-6 h-6 text-white" fill="currentColor" viewBox="0 0 20 20"><path d="M4 4a2 2 0 00-2 2v8a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2H4zm2 6a1 1 0 011-1h6a1 1 0 110 2H7a1 1 0 01-1-1zm1 3a1 1 0 100 2h6a1 1 0 100-2H7z"></path></svg>'
            };
            
            // Find matching icon by checking if service name contains key
            for (const [key, icon] of Object.entries(icons)) {
                if (serviceName.toLowerCase().includes(key.toLowerCase()) || 
                    key.toLowerCase().includes(serviceName.toLowerCase())) {
                    return icon;
                }
            }
            
            // Default icon
            return '<svg class="w-6 h-6 text-white" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M4 2a2 2 0 00-2 2v12a2 2 0 002 2h12a2 2 0 002-2V4a2 2 0 00-2-2H4zm3 2h6v4H7V4zm8 8v2h-2v-2h2zM9 8h2v2H9V8zm2 4h2v2h-2v-2zM7 12h2v2H7v-2z" clip-rule="evenodd"></path></svg>';
        }

        function closeDeliveryDetailsModal() {
            document.getElementById('delivery-details-modal').classList.add('hidden');
            document.getElementById('delivery-details-modal').classList.remove('flex');
        }

        function printDeliveryDetails() {
            const deliveryNumber = document.getElementById('detail-delivery-number').textContent;
            const customerName = document.getElementById('detail-customer-name').textContent;
            const deliveryDate = document.getElementById('detail-delivery-date').textContent;
            const eta = document.getElementById('detail-delivery-eta').textContent;
            const address = document.getElementById('detail-delivery-address').textContent;
            const items = document.getElementById('detail-delivery-items').textContent;
            const notes = document.getElementById('detail-delivery-notes').textContent;
            const status = document.getElementById('detail-delivery-status').textContent;
            const createdDate = document.getElementById('detail-created-date').textContent;
            
            // Create print content
            const printContent = `
                <div style="font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px;">
                    <div style="text-align: center; border-bottom: 3px solid #667eea; padding-bottom: 20px; margin-bottom: 30px;">
                        <h1 style="color: #667eea; margin: 0; font-size: 28px; font-weight: bold;">FP DIGITAL PRINTING</h1>
                        <p style="margin: 5px 0; color: #666; font-size: 14px;">Jl. Contoh No. 123, Jakarta  Telp: (021) 1234-5678</p>
                        <p style="margin: 0; color: #666; font-size: 14px;">Email: info@fpdigital.com  Website: www.fpdigital.com</p>
                    </div>
                    
                    <div style="text-align: center; margin-bottom: 30px;">
                        <h2 style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 15px; margin: 0; border-radius: 10px; font-size: 24px;">SURAT JALAN</h2>
                        <div style="margin-top: 15px; font-size: 18px; font-weight: bold; color: #333;">No: ${deliveryNumber}</div>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px; margin-bottom: 30px;">
                        <div style="background: #f8fafc; padding: 20px; border-radius: 10px; border-left: 4px solid #667eea;">
                            <h3 style="color: #667eea; margin: 0 0 15px 0; font-size: 16px; font-weight: bold;">INFORMASI PENGIRIMAN</h3>
                            <table style="width: 100%; font-size: 14px;">
                                <tr><td style="padding: 5px 0; font-weight: bold; color: #555;">Tanggal Kirim:</td><td style="padding: 5px 0;">${deliveryDate}</td></tr>
                                <tr><td style="padding: 5px 0; font-weight: bold; color: #555;">Estimasi Tiba:</td><td style="padding: 5px 0;">${eta}</td></tr>
                                <tr><td style="padding: 5px 0; font-weight: bold; color: #555;">Status:</td><td style="padding: 5px 0;"><span style="background: #e3f2fd; color: #1976d2; padding: 3px 8px; border-radius: 5px; font-size: 12px;">${status}</span></td></tr>
                                <tr><td style="padding: 5px 0; font-weight: bold; color: #555;">Dibuat:</td><td style="padding: 5px 0;">${createdDate}</td></tr>
                            </table>
                        </div>
                        
                        <div style="background: #f8fafc; padding: 20px; border-radius: 10px; border-left: 4px solid #764ba2;">
                            <h3 style="color: #764ba2; margin: 0 0 15px 0; font-size: 16px; font-weight: bold;">PENERIMA</h3>
                            <div style="font-size: 14px;">
                                <div style="font-weight: bold; font-size: 16px; color: #333; margin-bottom: 10px;">${customerName}</div>
                                <div style="color: #666; line-height: 1.5;">${address}</div>
                            </div>
                        </div>
                    </div>
                    
                    <div style="background: #f8fafc; padding: 20px; border-radius: 10px; margin-bottom: 30px; border: 1px solid #e2e8f0;">
                        <h3 style="color: #333; margin: 0 0 15px 0; font-size: 16px; font-weight: bold; border-bottom: 2px solid #667eea; padding-bottom: 10px;">DAFTAR BARANG/ITEMS</h3>
                        <div style="background: white; padding: 15px; border-radius: 8px; border: 1px solid #e2e8f0;">
                            <pre style="font-family: Arial, sans-serif; font-size: 14px; line-height: 1.6; margin: 0; white-space: pre-wrap; color: #333;">${items}</pre>
                        </div>
                    </div>
                    
                    ${notes !== 'Tidak ada catatan khusus' ? `
                    <div style="background: #fff3cd; padding: 20px; border-radius: 10px; margin-bottom: 30px; border-left: 4px solid #ffc107;">
                        <h3 style="color: #856404; margin: 0 0 10px 0; font-size: 16px; font-weight: bold;">CATATAN KHUSUS</h3>
                        <div style="color: #856404; font-size: 14px; line-height: 1.5;">${notes}</div>
                    </div>
                    ` : ''}
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 20px; margin-top: 50px; text-align: center;">
                        <div style="border-top: 1px solid #ccc; padding-top: 10px;">
                            <div style="font-weight: bold; margin-bottom: 40px; color: #333;">Pengirim</div>
                            <div style="border-top: 1px solid #999; padding-top: 5px; font-size: 12px; color: #666;">Tanda Tangan & Nama</div>
                        </div>
                        <div style="border-top: 1px solid #ccc; padding-top: 10px;">
                            <div style="font-weight: bold; margin-bottom: 40px; color: #333;">Kurir</div>
                            <div style="border-top: 1px solid #999; padding-top: 5px; font-size: 12px; color: #666;">Tanda Tangan & Nama</div>
                        </div>
                        <div style="border-top: 1px solid #ccc; padding-top: 10px;">
                            <div style="font-weight: bold; margin-bottom: 40px; color: #333;">Penerima</div>
                            <div style="border-top: 1px solid #999; padding-top: 5px; font-size: 12px; color: #666;">Tanda Tangan & Nama</div>
                        </div>
                    </div>
                    
                    <div style="margin-top: 40px; text-align: center; font-size: 12px; color: #666; border-top: 1px solid #e2e8f0; padding-top: 20px;">
                        <p style="margin: 0;">Dokumen ini dicetak secara otomatis oleh sistem FP Digital Printing</p>
                        <p style="margin: 5px 0 0 0;">Tanggal Cetak: ${new Date().toLocaleDateString('id-ID')} ${new Date().toLocaleTimeString('id-ID')}</p>
                    </div>
                </div>
            `;
            
            // Open print window
            const printWindow = window.open('', '_blank');
            printWindow.document.write(`
                <!DOCTYPE html>
                <html>
                <head>
                    <title>Surat Jalan ${deliveryNumber}</title>
                    <style>
                        @media print {
                            body { margin: 0; }
                            @page { margin: 1cm; }
                        }
                    </style>
                </head>
                <body>
                    ${printContent}
                </body>
                </html>
            `);
            printWindow.document.close();
            printWindow.print();
        }

        function updateDeliveryStatus(id) {
            const delivery = deliveries.find(d => d.id === id);
            if (delivery) {
                const statuses = ['Menunggu Kirim', 'Dalam Perjalanan', 'Terkirim'];
                const currentIndex = statuses.indexOf(delivery.status);
                const nextIndex = (currentIndex + 1) % statuses.length;
                delivery.status = statuses[nextIndex];
                
                saveDataToStorage(); // Save data after updating delivery status
                renderDeliveries();
                updateDeliveryStats();
            }
        }

        function updateDeliveryStats() {
            const pendingDeliveries = deliveries.filter(d => d.status === 'Menunggu Kirim').length;
            const inTransitDeliveries = deliveries.filter(d => d.status === 'Dalam Perjalanan').length;
            const deliveredDeliveries = deliveries.filter(d => d.status === 'Terkirim').length;
            const totalDeliveries = deliveries.length;

            document.getElementById('pending-deliveries').textContent = pendingDeliveries;
            document.getElementById('in-transit-deliveries').textContent = inTransitDeliveries;
            document.getElementById('delivered-deliveries').textContent = deliveredDeliveries;
            document.getElementById('total-deliveries').textContent = totalDeliveries;
        }

        function printDeliveryNote(id) {
            const delivery = deliveries.find(d => d.id === id);
            if (delivery) {
                alert(`Mencetak surat jalan ${delivery.deliveryNumber} untuk ${delivery.customer}`);
            }
        }

        // Helper Functions
        function populateCustomerDropdown(selectId) {
            const select = document.getElementById(selectId);
            select.innerHTML = '<option value="">Pilih Pelanggan</option>';
            
            customers.forEach(customer => {
                const option = document.createElement('option');
                option.value = customer.name;
                option.textContent = customer.name;
                select.appendChild(option);
            });
        }

        // Invoice Step Management
        let currentStep = 1;
        let selectedCustomer = null;
        let customerOption = null; // 'existing' or 'new'

        function goToStep(step) {
            // Hide all steps
            for (let i = 1; i <= 3; i++) {
                document.getElementById(`invoice-step-${i}`).classList.add('hidden');
                document.getElementById(`step-${i}-indicator`).classList.remove('bg-blue-600', 'text-white');
                document.getElementById(`step-${i}-indicator`).classList.add('bg-gray-300', 'text-gray-500');
                document.getElementById(`step-${i}-text`).classList.remove('text-blue-600');
                document.getElementById(`step-${i}-text`).classList.add('text-gray-500');
            }

            // Update step lines
            for (let i = 1; i < 3; i++) {
                const line = document.getElementById(`step-${i}-${i+1}-line`);
                if (step > i) {
                    line.classList.remove('bg-gray-300');
                    line.classList.add('bg-blue-600');
                } else {
                    line.classList.remove('bg-blue-600');
                    line.classList.add('bg-gray-300');
                }
            }

            // Show current step
            document.getElementById(`invoice-step-${step}`).classList.remove('hidden');
            document.getElementById(`step-${step}-indicator`).classList.remove('bg-gray-300', 'text-gray-500');
            document.getElementById(`step-${step}-indicator`).classList.add('bg-blue-600', 'text-white');
            document.getElementById(`step-${step}-text`).classList.remove('text-gray-500');
            document.getElementById(`step-${step}-text`).classList.add('text-blue-600');

            currentStep = step;

            // Special handling for each step
            if (step === 1) {
                // Reset customer selection when going back to step 1
                if (currentStep > 1) {
                    clearCustomerSelection();
                }
            } else if (step === 2) {
                initializeInvoiceItems();
            } else if (step === 3) {
                updateInvoiceSummary();
            }
        }

        function selectCustomerOption(option) {
            customerOption = option;
            
            // Hide both sections first
            document.getElementById('existing-customer-section').classList.add('hidden');
            document.getElementById('new-customer-section').classList.add('hidden');
            
            if (option === 'existing') {
                document.getElementById('existing-customer-section').classList.remove('hidden');
                populateCustomersGrid();
                // Disable next button until customer is selected
                document.getElementById('step-1-next').disabled = true;
            } else if (option === 'new') {
                document.getElementById('new-customer-section').classList.remove('hidden');
                // Enable next button for new customer but validate on step transition
                validateNewCustomerForm();
            }
        }

        function validateNewCustomerForm() {
            const nameInput = document.getElementById('new-customer-name');
            const nextButton = document.getElementById('step-1-next');
            
            // Add event listener to name input for real-time validation
            nameInput.addEventListener('input', function() {
                const hasName = this.value.trim().length > 0;
                nextButton.disabled = !hasName;
            });
            
            // Initial validation
            const hasName = nameInput.value.trim().length > 0;
            nextButton.disabled = !hasName;
        }

        function populateCustomersGrid() {
            const grid = document.getElementById('customers-grid');
            grid.innerHTML = '';
            
            customers.forEach(customer => {
                const customerCard = document.createElement('div');
                customerCard.className = 'card-gradient rounded-xl p-4 border-2 border-transparent hover:border-blue-200 cursor-pointer transition-all duration-300';
                customerCard.onclick = () => selectExistingCustomer(customer);
                
                customerCard.innerHTML = `
                    <div class="flex items-center space-x-3">
                        <div class="w-10 h-10 gradient-bg rounded-full flex items-center justify-center">
                            <span class="text-white font-semibold text-sm">${customer.name.charAt(0).toUpperCase()}</span>
                        </div>
                        <div class="flex-1">
                            <div class="font-semibold text-gray-900">${customer.name}</div>
                            <div class="text-sm text-gray-600">${customer.email}</div>
                            <div class="text-xs text-blue-600">${customer.totalTransactions} transaksi</div>
                        </div>
                    </div>
                `;
                
                grid.appendChild(customerCard);
            });
        }

        function handleSmartCustomerInput() {
            const input = document.getElementById('smart-customer-input');
            const inputValue = input.value.toLowerCase().trim();
            
            if (inputValue.length === 0) {
                populateCustomersGrid();
                return;
            }
            
            const filteredCustomers = customers.filter(customer => 
                customer.name.toLowerCase().includes(inputValue)
            );
            
            const grid = document.getElementById('customers-grid');
            grid.innerHTML = '';
            
            if (filteredCustomers.length === 0) {
                grid.innerHTML = '<div class="col-span-2 text-center text-gray-500 py-8">Tidak ada pelanggan ditemukan</div>';
                return;
            }
            
            filteredCustomers.forEach(customer => {
                const customerCard = document.createElement('div');
                customerCard.className = 'card-gradient rounded-xl p-4 border-2 border-transparent hover:border-blue-200 cursor-pointer transition-all duration-300';
                customerCard.onclick = () => selectExistingCustomer(customer);
                
                customerCard.innerHTML = `
                    <div class="flex items-center space-x-3">
                        <div class="w-10 h-10 gradient-bg rounded-full flex items-center justify-center">
                            <span class="text-white font-semibold text-sm">${customer.name.charAt(0).toUpperCase()}</span>
                        </div>
                        <div class="flex-1">
                            <div class="font-semibold text-gray-900">${customer.name}</div>
                            <div class="text-sm text-gray-600">${customer.email}</div>
                            <div class="text-xs text-blue-600">${customer.totalTransactions} transaksi</div>
                        </div>
                    </div>
                `;
                
                grid.appendChild(customerCard);
            });
        }

        function populateCustomersList(customerList) {
            const customersList = document.getElementById('existing-customers-list');
            customersList.innerHTML = '';
            
            if (customerList.length === 0) {
                customersList.innerHTML = '<div class="px-3 py-2 text-gray-500 text-sm">Tidak ada pelanggan ditemukan</div>';
                return;
            }
            
            customerList.forEach(customer => {
                const customerItem = document.createElement('div');
                customerItem.className = 'px-3 py-2 hover:bg-gray-50 cursor-pointer rounded-lg';
                customerItem.innerHTML = `
                    <div class="font-medium text-gray-900">${customer.name}</div>
                    <div class="text-xs text-gray-500">${customer.email}  ${customer.phone}</div>
                    <div class="text-xs text-blue-600">${customer.totalTransactions} transaksi</div>
                `;
                customerItem.onclick = () => selectExistingCustomer(customer);
                customersList.appendChild(customerItem);
            });
        }

        function selectExistingCustomer(customer) {
            selectedCustomer = customer;
            const customerInfo = document.getElementById('customer-info');
            const selectedDisplay = document.getElementById('selected-customer-display');
            
            // Show selected customer info
            customerInfo.innerHTML = `
                <div class="font-medium">${customer.name}</div>
                <div class="text-xs text-green-600">${customer.email}  ${customer.phone}</div>
                <div class="text-xs text-green-600">${customer.totalTransactions} transaksi sebelumnya</div>
            `;
            selectedDisplay.classList.remove('hidden');
            
            // Enable next button
            document.getElementById('step-1-next').disabled = false;
        }

        function clearCustomerSelection() {
            selectedCustomer = null;
            customerOption = null;
            
            // Hide all sections
            document.getElementById('existing-customer-section').classList.add('hidden');
            document.getElementById('new-customer-section').classList.add('hidden');
            document.getElementById('selected-customer-display').classList.add('hidden');
            
            // Clear inputs
            document.getElementById('smart-customer-input').value = '';
            document.getElementById('new-customer-name').value = '';
            document.getElementById('new-customer-email').value = '';
            document.getElementById('new-customer-phone').value = '';
            
            // Disable next button
            document.getElementById('step-1-next').disabled = true;
        }

        function initializeInvoiceItems() {
            const container = document.getElementById('invoice-items');
            container.innerHTML = '';
            
            // Add first item
            addInvoiceItem();
            
            // Check if we can proceed to next step
            validateStep2();
        }

        function validateStep2() {
            const items = document.querySelectorAll('.invoice-item');
            let hasValidItem = false;
            
            items.forEach(item => {
                const type = item.querySelector('.item-type').value;
                const quantity = parseInt(item.querySelector('.item-quantity').value);
                
                if (type && quantity > 0) {
                    hasValidItem = true;
                }
            });
            
            document.getElementById('step-2-next').disabled = !hasValidItem;
        }

        function updateInvoiceSummary() {
            const summaryContainer = document.getElementById('invoice-summary');
            const items = document.querySelectorAll('.invoice-item');
            let totalAmount = 0;
            let summaryHTML = '';
            
            // Customer info
            let customerName = '';
            if (selectedCustomer) {
                customerName = selectedCustomer.name;
            } else if (customerOption === 'new') {
                customerName = document.getElementById('new-customer-name').value;
            }
            
            summaryHTML += `
                <div class="flex justify-between items-center py-2 border-b border-gray-200">
                    <span class="font-medium text-gray-700">Pelanggan:</span>
                    <span class="font-semibold text-gray-900">${customerName}</span>
                </div>
            `;
            
            // Items summary
            summaryHTML += '<div class="space-y-2 py-3">';
            items.forEach((item, index) => {
                const type = item.querySelector('.item-type').value;
                const length = parseFloat(item.querySelector('.item-length').value);
                const width = parseFloat(item.querySelector('.item-width').value);
                const quantity = parseInt(item.querySelector('.item-quantity').value);
                const price = parseInt(item.querySelector('.item-price').value);
                const subtotal = parseInt(item.querySelector('.item-subtotal').value);
                
                if (type && length && width && quantity && price) {
                    totalAmount += subtotal;
                    const productName = item.querySelector('.item-product-name').value.trim();
                    const displayName = productName || type;
                    const totalArea = length * width * quantity;
                    
                    summaryHTML += `
                        <div class="flex justify-between items-start text-sm mb-2">
                            <div class="flex-1 pr-4">
                                <div class="font-medium text-gray-900">${displayName}</div>
                                <div class="text-xs text-gray-500">${type}  ${length}m  ${width}m  ${quantity} pcs = ${totalArea.toFixed(2)} m</div>
                                <div class="text-xs text-blue-600">Rp ${price.toLocaleString('id-ID')}/m</div>
                            </div>
                            <span class="font-semibold text-gray-900">Rp ${subtotal.toLocaleString('id-ID')}</span>
                        </div>
                    `;
                }
            });
            summaryHTML += '</div>';
            
            // Total
            summaryHTML += `
                <div class="flex justify-between items-center py-3 border-t border-gray-200">
                    <span class="text-lg font-bold text-gray-900">Total Tagihan:</span>
                    <span class="text-xl font-bold text-blue-600">Rp ${totalAmount.toLocaleString('id-ID')}</span>
                </div>
            `;
            
            summaryContainer.innerHTML = summaryHTML;
        }



        // Customer Management
        function openCustomerModal() {
            document.getElementById('customer-modal').classList.remove('hidden');
            document.getElementById('customer-modal').classList.add('flex');
        }

        function closeCustomerModal() {
            document.getElementById('customer-modal').classList.add('hidden');
            document.getElementById('customer-modal').classList.remove('flex');
            document.getElementById('customer-form').reset();
        }

        function addCustomer(name, email, phone) {
            const newCustomer = {
                id: customers.length + 1,
                name: name,
                email: email,
                phone: phone,
                totalTransactions: 0
            };

            customers.push(newCustomer);
            saveDataToStorage(); // Save data after adding customer
            renderCustomers();
            closeCustomerModal();
        }

        function renderCustomers() {
            const tbody = document.getElementById('customers-table');
            tbody.innerHTML = '';

            customers.forEach(customer => {
                const row = document.createElement('tr');
                row.className = 'table-row transition-all duration-300';
                
                row.innerHTML = `
                    <td class="py-3 px-4 text-gray-600">#${String(customer.id).padStart(3, '0')}</td>
                    <td class="py-3 px-4 text-gray-900 font-medium">${customer.name}</td>
                    <td class="py-3 px-4 text-gray-600">${customer.email}</td>
                    <td class="py-3 px-4 text-gray-600">${customer.phone}</td>
                    <td class="py-3 px-4 text-gray-900 font-semibold">${customer.totalTransactions}</td>
                    <td class="py-3 px-4">
                        <button onclick="editCustomer(${customer.id})" class="text-blue-600 hover:text-blue-800 font-medium mr-3">
                            Edit
                        </button>
                        <button onclick="deleteCustomer(${customer.id})" class="text-red-600 hover:text-red-800 font-medium">
                            Hapus
                        </button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        function deleteCustomer(id) {
            if (confirm('Apakah Anda yakin ingin menghapus pelanggan ini?')) {
                customers = customers.filter(c => c.id !== id);
                saveDataToStorage(); // Save data after deleting customer
                renderCustomers();
                updateDashboardStats();
            }
        }

        // Dashboard Stats
        function updateDashboardStats() {
            const totalSales = transactions.reduce((sum, t) => sum + t.total, 0);
            const todayDate = new Date().toISOString().split('T')[0];
            const todayTransactions = transactions.filter(t => t.date === todayDate && t.type === 'daily').length;
            const totalCustomers = customers.length;
            const monthlyProfit = totalSales * 0.3; // Assuming 30% profit margin

            document.getElementById('total-sales').textContent = `Rp ${totalSales.toLocaleString('id-ID')}`;
            document.getElementById('today-transactions').textContent = todayTransactions;
            document.getElementById('total-customers').textContent = totalCustomers;
            document.getElementById('monthly-profit').textContent = `Rp ${monthlyProfit.toLocaleString('id-ID')}`;

            // Update invoice stats on dashboard
            const billingTransactions = transactions.filter(t => t.type === 'billing');
            const unpaidInvoices = billingTransactions.filter(i => i.status === 'Belum Dibayar').length;
            const paidInvoices = billingTransactions.filter(i => i.status === 'Lunas').length;
            const totalReceivables = billingTransactions.filter(i => i.status === 'Belum Dibayar').reduce((sum, i) => sum + i.total, 0);

            document.getElementById('dashboard-unpaid-invoices').textContent = unpaidInvoices;
            document.getElementById('dashboard-paid-invoices').textContent = paidInvoices;
            document.getElementById('dashboard-total-receivables').textContent = `Rp ${totalReceivables.toLocaleString('id-ID')}`;

            // Update report stats
            document.getElementById('total-income').textContent = `Rp ${totalSales.toLocaleString('id-ID')}`;
            document.getElementById('total-expense').textContent = `Rp ${(totalSales * 0.7).toLocaleString('id-ID')}`;
            document.getElementById('net-profit').textContent = `Rp ${monthlyProfit.toLocaleString('id-ID')}`;

            // Update recent transactions (show all types)
            const recentTransactionsTable = document.getElementById('recent-transactions');
            recentTransactionsTable.innerHTML = '';
            
            const recentTransactions = transactions.slice(-5).reverse();
            recentTransactions.forEach(transaction => {
                const row = document.createElement('tr');
                row.className = 'table-row transition-all duration-300';
                
                const statusClass = transaction.transactionStatus === 'Selesai' ? 'bg-green-100 text-green-800' : 
                                   transaction.transactionStatus === 'Proses' ? 'bg-yellow-100 text-yellow-800' : 
                                   'bg-red-100 text-red-800';

                row.innerHTML = `
                    <td class="py-3 px-4 text-gray-600">${transaction.invoiceNumber}</td>
                    <td class="py-3 px-4 text-gray-900 font-medium">${transaction.customer}</td>
                    <td class="py-3 px-4 text-gray-900 font-semibold">Rp ${transaction.total.toLocaleString('id-ID')}</td>
                    <td class="py-3 px-4">
                        <span class="px-3 py-1 ${statusClass} rounded-full text-sm font-medium">${transaction.transactionStatus}</span>
                    </td>
                `;
                recentTransactionsTable.appendChild(row);
            });

            // Update recent invoices on dashboard (only billing transactions)
            const recentInvoicesTable = document.getElementById('dashboard-recent-invoices');
            recentInvoicesTable.innerHTML = '';
            
            const recentInvoices = billingTransactions.slice(-5).reverse();
            recentInvoices.forEach(invoice => {
                const row = document.createElement('tr');
                row.className = 'table-row transition-all duration-300';
                
                const statusClass = invoice.status === 'Lunas' ? 'bg-green-100 text-green-800' : 
                                   invoice.status === 'Belum Dibayar' ? 'bg-red-100 text-red-800' : 
                                   'bg-yellow-100 text-yellow-800';

                row.innerHTML = `
                    <td class="py-3 px-4 text-gray-600">${invoice.invoiceNumber}</td>
                    <td class="py-3 px-4 text-gray-900 font-medium">${invoice.customer}</td>
                    <td class="py-3 px-4 text-gray-900 font-semibold">Rp ${invoice.total.toLocaleString('id-ID')}</td>
                    <td class="py-3 px-4">
                        <span class="px-3 py-1 ${statusClass} rounded-full text-sm font-medium">${invoice.status}</span>
                    </td>
                    <td class="py-3 px-4">
                        <button onclick="updateInvoiceStatus(${invoice.id})" class="text-blue-600 hover:text-blue-800 font-medium text-sm">
                            ${invoice.status === 'Lunas' ? 'Belum Bayar' : 'Bayar'}
                        </button>
                    </td>
                `;
                recentInvoicesTable.appendChild(row);
            });

            // Update all invoices table on dashboard (only billing transactions)
            const allInvoicesTable = document.getElementById('dashboard-invoices-table');
            allInvoicesTable.innerHTML = '';

            billingTransactions.forEach(invoice => {
                const row = document.createElement('tr');
                row.className = 'table-row transition-all duration-300';
                
                const statusClass = invoice.status === 'Lunas' ? 'bg-green-100 text-green-800' : 
                                   invoice.status === 'Belum Dibayar' ? 'bg-red-100 text-red-800' : 
                                   'bg-yellow-100 text-yellow-800';

                row.innerHTML = `
                    <td class="py-3 px-4 text-gray-600">${invoice.invoiceNumber}</td>
                    <td class="py-3 px-4 text-gray-600">${invoice.date}</td>
                    <td class="py-3 px-4 text-gray-900 font-medium">${invoice.customer}</td>
                    <td class="py-3 px-4 text-gray-900 font-semibold">Rp ${invoice.total.toLocaleString('id-ID')}</td>
                    <td class="py-3 px-4 text-gray-600">${invoice.dueDate}</td>
                    <td class="py-3 px-4">
                        <span class="px-3 py-1 ${statusClass} rounded-full text-sm font-medium">${invoice.status}</span>
                    </td>
                    <td class="py-3 px-4">
                        <button onclick="updateInvoiceStatus(${invoice.id})" class="text-blue-600 hover:text-blue-800 font-medium mr-3">
                            ${invoice.status === 'Lunas' ? 'Belum Bayar' : 'Bayar'}
                        </button>
                        <button onclick="printInvoice(${invoice.id})" class="text-green-600 hover:text-green-800 font-medium">
                            Print
                        </button>
                    </td>
                `;
                allInvoicesTable.appendChild(row);
            });
        }

        // Report Generation
        function generateReport() {
            const period = document.getElementById('report-period').value;
            const type = document.getElementById('report-type').value;
            const reportContent = document.getElementById('report-content');

            let filteredData = [];
            let reportHTML = '';

            switch (type) {
                case 'financial':
                    reportHTML = generateFinancialReport(period);
                    break;
                case 'sales':
                    reportHTML = generateSalesReport(period);
                    break;
                case 'customer':
                    reportHTML = generateCustomerReport(period);
                    break;
                case 'invoice':
                    reportHTML = generateInvoiceReport(period);
                    break;
                case 'delivery':
                    reportHTML = generateDeliveryReport(period);
                    break;
            }

            reportContent.innerHTML = reportHTML;
        }

        function generateFinancialReport(period) {
            const filteredTransactions = filterByPeriod(transactions, period);
            const totalIncome = filteredTransactions.reduce((sum, t) => sum + t.total, 0);
            const totalExpense = totalIncome * 0.7; // Assuming 70% expense
            const netProfit = totalIncome - totalExpense;

            return `
                <div class="space-y-4">
                    <h5 class="text-lg font-bold text-gray-900">Laporan Keuangan - ${getPeriodLabel(period)}</h5>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div class="p-4 bg-green-50 rounded-xl">
                            <p class="text-sm text-gray-600">Total Pemasukan</p>
                            <p class="text-xl font-bold text-green-600">Rp ${totalIncome.toLocaleString('id-ID')}</p>
                        </div>
                        <div class="p-4 bg-red-50 rounded-xl">
                            <p class="text-sm text-gray-600">Total Pengeluaran</p>
                            <p class="text-xl font-bold text-red-600">Rp ${totalExpense.toLocaleString('id-ID')}</p>
                        </div>
                        <div class="p-4 bg-blue-50 rounded-xl">
                            <p class="text-sm text-gray-600">Keuntungan Bersih</p>
                            <p class="text-xl font-bold text-blue-600">Rp ${netProfit.toLocaleString('id-ID')}</p>
                        </div>
                    </div>
                    <div class="mt-6">
                        <h6 class="font-semibold text-gray-900 mb-3">Detail Transaksi</h6>
                        <div class="overflow-x-auto">
                            <table class="w-full text-sm">
                                <thead>
                                    <tr class="border-b">
                                        <th class="text-left py-2">Tanggal</th>
                                        <th class="text-left py-2">Pelanggan</th>
                                        <th class="text-left py-2">Layanan</th>
                                        <th class="text-left py-2">Total</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${filteredTransactions.map(t => `
                                        <tr class="border-b">
                                            <td class="py-2">${t.date}</td>
                                            <td class="py-2">${t.customer}</td>
                                            <td class="py-2">${t.service}</td>
                                            <td class="py-2">Rp ${t.total.toLocaleString('id-ID')}</td>
                                        </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            `;
        }

        function generateSalesReport(period) {
            const filteredTransactions = filterByPeriod(transactions, period);
            const serviceStats = {};
            
            filteredTransactions.forEach(t => {
                if (!serviceStats[t.service]) {
                    serviceStats[t.service] = { count: 0, total: 0 };
                }
                serviceStats[t.service].count += t.quantity;
                serviceStats[t.service].total += t.total;
            });

            return `
                <div class="space-y-4">
                    <h5 class="text-lg font-bold text-gray-900">Laporan Penjualan - ${getPeriodLabel(period)}</h5>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        ${Object.entries(serviceStats).map(([service, stats]) => `
                            <div class="p-4 bg-gray-50 rounded-xl">
                                <p class="font-semibold text-gray-900">${service}</p>
                                <p class="text-sm text-gray-600">Jumlah: ${stats.count} unit</p>
                                <p class="text-lg font-bold text-blue-600">Rp ${stats.total.toLocaleString('id-ID')}</p>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
        }

        function generateCustomerReport(period) {
            const customerStats = customers.map(customer => {
                const customerTransactions = transactions.filter(t => t.customer === customer.name);
                const totalSpent = customerTransactions.reduce((sum, t) => sum + t.total, 0);
                return { ...customer, totalSpent };
            }).sort((a, b) => b.totalSpent - a.totalSpent);

            return `
                <div class="space-y-4">
                    <h5 class="text-lg font-bold text-gray-900">Laporan Pelanggan - ${getPeriodLabel(period)}</h5>
                    <div class="overflow-x-auto">
                        <table class="w-full text-sm">
                            <thead>
                                <tr class="border-b">
                                    <th class="text-left py-2">Nama</th>
                                    <th class="text-left py-2">Email</th>
                                    <th class="text-left py-2">Total Transaksi</th>
                                    <th class="text-left py-2">Total Belanja</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${customerStats.map(c => `
                                    <tr class="border-b">
                                        <td class="py-2">${c.name}</td>
                                        <td class="py-2">${c.email}</td>
                                        <td class="py-2">${c.totalTransactions}</td>
                                        <td class="py-2">Rp ${c.totalSpent.toLocaleString('id-ID')}</td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                </div>
            `;
        }

        function generateInvoiceReport(period) {
            const filteredInvoices = filterByPeriod(invoices, period);
            const paidInvoices = filteredInvoices.filter(i => i.status === 'Lunas');
            const unpaidInvoices = filteredInvoices.filter(i => i.status === 'Belum Dibayar');

            return `
                <div class="space-y-4">
                    <h5 class="text-lg font-bold text-gray-900">Laporan Tagihan - ${getPeriodLabel(period)}</h5>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div class="p-4 bg-green-50 rounded-xl">
                            <p class="text-sm text-gray-600">Tagihan Lunas</p>
                            <p class="text-xl font-bold text-green-600">${paidInvoices.length} tagihan</p>
                            <p class="text-sm text-gray-600">Rp ${paidInvoices.reduce((sum, i) => sum + i.amount, 0).toLocaleString('id-ID')}</p>
                        </div>
                        <div class="p-4 bg-red-50 rounded-xl">
                            <p class="text-sm text-gray-600">Tagihan Belum Dibayar</p>
                            <p class="text-xl font-bold text-red-600">${unpaidInvoices.length} tagihan</p>
                            <p class="text-sm text-gray-600">Rp ${unpaidInvoices.reduce((sum, i) => sum + i.amount, 0).toLocaleString('id-ID')}</p>
                        </div>
                    </div>
                </div>
            `;
        }

        function generateDeliveryReport(period) {
            const filteredDeliveries = filterByPeriod(deliveries, period);
            const statusStats = {};
            
            filteredDeliveries.forEach(d => {
                statusStats[d.status] = (statusStats[d.status] || 0) + 1;
            });

            return `
                <div class="space-y-4">
                    <h5 class="text-lg font-bold text-gray-900">Laporan Pengiriman - ${getPeriodLabel(period)}</h5>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        ${Object.entries(statusStats).map(([status, count]) => `
                            <div class="p-4 bg-gray-50 rounded-xl">
                                <p class="font-semibold text-gray-900">${status}</p>
                                <p class="text-xl font-bold text-blue-600">${count} pengiriman</p>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
        }

        function filterByPeriod(data, period) {
            const today = new Date();
            const todayStr = today.toISOString().split('T')[0];
            
            switch (period) {
                case 'today':
                    return data.filter(item => item.date === todayStr);
                case 'week':
                    const weekAgo = new Date(today.getTime() - 7 * 24 * 60 * 60 * 1000);
                    return data.filter(item => new Date(item.date) >= weekAgo);
                case 'month':
                    const monthAgo = new Date(today.getFullYear(), today.getMonth() - 1, today.getDate());
                    return data.filter(item => new Date(item.date) >= monthAgo);
                case 'year':
                    const yearAgo = new Date(today.getFullYear() - 1, today.getMonth(), today.getDate());
                    return data.filter(item => new Date(item.date) >= yearAgo);
                default:
                    return data;
            }
        }

        function getPeriodLabel(period) {
            switch (period) {
                case 'today': return 'Hari Ini';
                case 'week': return 'Minggu Ini';
                case 'month': return 'Bulan Ini';
                case 'year': return 'Tahun Ini';
                default: return 'Semua Periode';
            }
        }

        function updateReportStats() {
            const totalIncome = transactions.reduce((sum, t) => sum + t.total, 0);
            const totalExpense = totalIncome * 0.7;
            const netProfit = totalIncome - totalExpense;
            const outstandingReceivables = invoices.filter(i => i.status === 'Belum Dibayar').reduce((sum, i) => sum + i.amount, 0);

            document.getElementById('total-income').textContent = `Rp ${totalIncome.toLocaleString('id-ID')}`;
            document.getElementById('total-expense').textContent = `Rp ${totalExpense.toLocaleString('id-ID')}`;
            document.getElementById('net-profit').textContent = `Rp ${netProfit.toLocaleString('id-ID')}`;
            document.getElementById('outstanding-receivables').textContent = `Rp ${outstandingReceivables.toLocaleString('id-ID')}`;
        }

        // Form Handlers
        document.getElementById('customer-form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const name = document.getElementById('customer-fullname').value;
            const email = document.getElementById('customer-email').value;
            const phone = document.getElementById('customer-phone').value;

            addCustomer(name, email, phone);
        });

        document.getElementById('invoice-form').addEventListener('submit', function(e) {
            e.preventDefault();
            addInvoice();
        });

        document.getElementById('delivery-form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const customer = document.getElementById('delivery-customer').value;
            const address = document.getElementById('delivery-address').value;
            const items = document.getElementById('delivery-items').value.trim();
            const notes = document.getElementById('delivery-notes').value;
            const deliveryDate = document.getElementById('delivery-date').value;
            const eta = document.getElementById('delivery-eta').value;

            if (!customer || !address || !deliveryDate || !items) {
                alert('Silakan lengkapi semua field yang wajib diisi (Pelanggan, Alamat, Tanggal Kirim, dan Barang)');
                return;
            }

            addDelivery(customer, address, items, notes, deliveryDate, eta);
        });

        document.getElementById('price-form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const name = document.getElementById('price-name').value.trim();
            const unit = document.getElementById('price-unit').value;
            const dailyPrice = document.getElementById('price-daily').value;
            const billingPrice = document.getElementById('price-billing').value;

            // Validation
            if (!name) {
                alert('Silakan masukkan nama jenis cetakan');
                return;
            }
            
            if (!unit) {
                alert('Silakan pilih jenis satuan');
                return;
            }
            
            if (!dailyPrice || dailyPrice <= 0) {
                alert('Silakan masukkan harga harian yang valid');
                return;
            }
            
            if (!billingPrice || billingPrice <= 0) {
                alert('Silakan masukkan harga tagihan yang valid');
                return;
            }

            // Check if name already exists (only for new entries)
            const nameInput = document.getElementById('price-name');
            if (!nameInput.readOnly && printPrices[name]) {
                alert('Jenis cetakan dengan nama ini sudah ada. Silakan gunakan nama yang berbeda.');
                return;
            }

            addOrUpdatePrice(name, unit, dailyPrice, billingPrice);
        });

        document.getElementById('daily-transaction-form').addEventListener('submit', function(e) {
            e.preventDefault();
            addDailyTransaction();
        });

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            // Load data from localStorage first
            loadDataFromStorage();
            
            // Update invoices array after loading transactions
            invoices = transactions.filter(t => t.type === 'billing');
            
            // Then render all components
            updateDashboardStats();
            renderCustomers();
            renderInvoices();
            renderDeliveries();
            updateInvoiceStats();
            updateDeliveryStats();
            updateReportStats();
            renderPriceCards();
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'97626562c12e4b1b',t:'MTc1NjM2OTI5Ni4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
