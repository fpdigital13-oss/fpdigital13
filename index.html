<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FP Digital Printing - Sistem Pembukuan</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&display=swap');
        
        body { 
            font-family: 'Poppins', sans-serif; 
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
        }
        
        .sidebar-item:hover { 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
            transform: translateX(4px);
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }
        
        .active-tab { 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
            transform: translateX(4px);
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }
        
        .card-hover:hover { 
            transform: translateY(-8px) scale(1.02); 
            box-shadow: 0 20px 40px rgba(0,0,0,0.15);
            border: 1px solid rgba(102, 126, 234, 0.2);
        }
        
        .gradient-bg { 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
        }
        
        .glass-effect {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .card-gradient {
            background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
            border: 1px solid rgba(102, 126, 234, 0.1);
        }
        
        .status-badge {
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }
        
        .sidebar-gradient {
            background: linear-gradient(180deg, #ffffff 0%, #f8fafc 100%);
            border-right: 1px solid rgba(102, 126, 234, 0.1);
        }
        
        .header-glass {
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.9) 0%, rgba(118, 75, 162, 0.9) 100%);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .input-focus:focus {
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
            transform: translateY(-1px);
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
            transition: all 0.3s ease;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.6);
        }
        
        .table-row:hover {
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.05) 0%, rgba(118, 75, 162, 0.05) 100%);
            transform: translateX(4px);
        }
        
        .stat-card {
            background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
            border: 1px solid rgba(102, 126, 234, 0.1);
            position: relative;
            overflow: hidden;
        }
        
        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        .modal-backdrop {
            background: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(8px);
        }
        
        .modal-content {
            background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
            border: 1px solid rgba(102, 126, 234, 0.2);
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.25);
        }
        
        .icon-gradient {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .animate-fade-in {
            animation: fadeIn 0.5s ease-in-out;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .animate-slide-in {
            animation: slideIn 0.3s ease-out;
        }
        
        @keyframes slideIn {
            from { transform: translateX(-100%); }
            to { transform: translateX(0); }
        }
        
        .price-card-elegant {
            background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
            border: 1px solid rgba(102, 126, 234, 0.1);
            border-radius: 1.5rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
        }
        
        .price-card-elegant:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow: 0 25px 50px rgba(102, 126, 234, 0.15);
            border-color: rgba(102, 126, 234, 0.2);
        }
        
        .price-card-elegant::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.02) 0%, rgba(118, 75, 162, 0.02) 100%);
            border-radius: 1.5rem;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .price-card-elegant:hover::before {
            opacity: 1;
        }
        
        .price-section {
            position: relative;
            padding: 1rem;
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.05) 0%, rgba(147, 51, 234, 0.05) 100%);
            border-radius: 1rem;
            border: 1px solid rgba(59, 130, 246, 0.1);
        }
    </style>
</head>
<body>
    <!-- Login Page -->
    <div id="login-page" class="min-h-screen flex items-center justify-center py-12 px-4 sm:px-6 lg:px-8">
        <div class="max-w-md w-full space-y-8">
            <!-- Logo and Title -->
            <div class="text-center">
                <div class="mx-auto w-20 h-20 gradient-bg rounded-2xl flex items-center justify-center mb-6 shadow-lg">
                    <span class="text-white font-bold text-2xl">FP</span>
                </div>
                <h2 class="text-3xl font-bold text-gray-900 mb-2">Selamat Datang</h2>
                <p class="text-gray-600">Masuk ke sistem FP Digital Printing</p>
            </div>

            <!-- Login Form -->
            <div class="modal-content rounded-2xl p-8 shadow-xl">
                <form id="login-form" class="space-y-6">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Username</label>
                        <div class="relative">
                            <input type="text" id="login-username" class="w-full px-4 py-3 pl-12 border border-gray-300 rounded-xl input-focus transition-all duration-300" placeholder="Masukkan username" required>
                            <svg class="w-5 h-5 text-gray-400 absolute left-4 top-3.5" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Password</label>
                        <div class="relative">
                            <input type="password" id="login-password" class="w-full px-4 py-3 pl-12 pr-12 border border-gray-300 rounded-xl input-focus transition-all duration-300" placeholder="Masukkan password" required>
                            <svg class="w-5 h-5 text-gray-400 absolute left-4 top-3.5" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M5 9V7a5 5 0 0110 0v2a2 2 0 012 2v5a2 2 0 01-2 2H5a2 2 0 01-2-2v-5a2 2 0 012-2zm8-2v2H7V7a3 3 0 016 0z" clip-rule="evenodd"></path>
                            </svg>
                            <button type="button" onclick="togglePassword()" class="absolute right-4 top-3.5 text-gray-400 hover:text-gray-600">
                                <svg id="eye-icon" class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                                    <path d="M10 12a2 2 0 100-4 2 2 0 000 4z"></path>
                                    <path fill-rule="evenodd" d="M.458 10C1.732 5.943 5.522 3 10 3s8.268 2.943 9.542 7c-1.274 4.057-5.064 7-9.542 7S1.732 14.057.458 10zM14 10a4 4 0 11-8 0 4 4 0 018 0z" clip-rule="evenodd"></path>
                                </svg>
                            </button>
                        </div>
                    </div>

                    <div class="flex items-center justify-between">
                        <div class="flex items-center">
                            <input type="checkbox" id="remember-me" class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded">
                            <label for="remember-me" class="ml-2 block text-sm text-gray-700">Ingat saya</label>
                        </div>
                        <button type="button" class="text-sm text-blue-600 hover:text-blue-800 font-medium">
                            Lupa password?
                        </button>
                    </div>

                    <button type="submit" class="w-full btn-primary text-white py-3 rounded-xl font-semibold text-lg">
                        Masuk
                    </button>
                </form>


            </div>

            <!-- Footer -->
            <div class="text-center text-sm text-gray-500">
                <p>&copy; 2024 FP Digital Printing. All rights reserved.</p>
            </div>
        </div>
    </div>

    <!-- Main Application (Hidden initially) -->
    <div id="main-app" class="hidden">
        <!-- Mobile Menu Button -->
        <button id="mobile-menu-btn" class="lg:hidden fixed top-4 left-4 z-50 w-12 h-12 bg-white rounded-xl shadow-lg flex items-center justify-center">
            <svg class="w-6 h-6 text-gray-700" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
            </svg>
        </button>

        <!-- Mobile Overlay -->
        <div id="mobile-overlay" class="lg:hidden fixed inset-0 bg-black bg-opacity-50 z-40 hidden"></div>

        <div class="flex h-screen overflow-hidden">
            <!-- Sidebar -->
            <div id="sidebar" class="w-64 sidebar-gradient shadow-xl animate-slide-in fixed lg:relative inset-y-0 left-0 z-50 transform -translate-x-full lg:translate-x-0 transition-transform duration-300 ease-in-out">
            <div class="p-6 border-b border-gray-200">
                <div class="flex items-center space-x-3">
                    <div class="w-10 h-10 gradient-bg rounded-xl flex items-center justify-center">
                        <span class="text-white font-bold text-lg">FP</span>
                    </div>
                    <div>
                        <h1 class="text-xl font-bold text-gray-800">FP Digital</h1>
                        <p class="text-sm text-gray-600">Printing System</p>
                    </div>
                </div>
            </div>
            
            <nav class="mt-6 px-4">
                <div class="space-y-2">
                    <button onclick="showTab('dashboard')" class="sidebar-item w-full flex items-center px-4 py-3 text-left text-gray-700 rounded-xl transition-all duration-300 active-tab" id="tab-dashboard">
                        <svg class="w-5 h-5 mr-3" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M3 4a1 1 0 011-1h12a1 1 0 011 1v2a1 1 0 01-1 1H4a1 1 0 01-1-1V4zM3 10a1 1 0 011-1h6a1 1 0 011 1v6a1 1 0 01-1 1H4a1 1 0 01-1-1v-6zM14 9a1 1 0 00-1 1v6a1 1 0 001 1h2a1 1 0 001-1v-6a1 1 0 00-1-1h-2z"></path>
                        </svg>
                        Dashboard
                    </button>
                    
                    <button onclick="showTab('transaksi-harian')" class="sidebar-item w-full flex items-center px-4 py-3 text-left text-gray-700 rounded-xl transition-all duration-300" id="tab-transaksi-harian">
                        <svg class="w-5 h-5 mr-3" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M6 2a1 1 0 00-1 1v1H4a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-1V3a1 1 0 10-2 0v1H7V3a1 1 0 00-1-1zm0 5a1 1 0 000 2h8a1 1 0 100-2H6z" clip-rule="evenodd"></path>
                        </svg>
                        Transaksi Harian
                    </button>
                    
                    <button onclick="showTab('tagihan')" class="sidebar-item w-full flex items-center px-4 py-3 text-left text-gray-700 rounded-xl transition-all duration-300" id="tab-tagihan">
                        <svg class="w-5 h-5 mr-3" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M4 4a2 2 0 012-2h4.586A2 2 0 0112 2.586L15.414 6A2 2 0 0116 7.414V16a2 2 0 01-2 2H6a2 2 0 01-2-2V4zm2 6a1 1 0 011-1h6a1 1 0 110 2H7a1 1 0 01-1-1zm1 3a1 1 0 100 2h6a1 1 0 100-2H7z" clip-rule="evenodd"></path>
                        </svg>
                        Tagihan
                    </button>
                    
                    <button onclick="showTab('surat-jalan')" class="sidebar-item w-full flex items-center px-4 py-3 text-left text-gray-700 rounded-xl transition-all duration-300" id="tab-surat-jalan">
                        <svg class="w-5 h-5 mr-3" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M8 5a1 1 0 100 2h5.586l-1.293 1.293a1 1 0 001.414 1.414l3-3a1 1 0 000-1.414l-3-3a1 1 0 10-1.414 1.414L13.586 5H8zM12 15a1 1 0 100-2H6.414l1.293-1.293a1 1 0 10-1.414-1.414l-3 3a1 1 0 000 1.414l3 3a1 1 0 001.414-1.414L6.414 15H12z"></path>
                        </svg>
                        Surat Jalan
                    </button>
                    
                    <button onclick="showTab('laporan')" class="sidebar-item w-full flex items-center px-4 py-3 text-left text-gray-700 rounded-xl transition-all duration-300" id="tab-laporan">
                        <svg class="w-5 h-5 mr-3" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                            <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a2 2 0 002 2h8a2 2 0 002-2V3a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                        </svg>
                        Laporan
                    </button>
                    
                    <button onclick="showTab('pelanggan')" class="sidebar-item w-full flex items-center px-4 py-3 text-left text-gray-700 rounded-xl transition-all duration-300" id="tab-pelanggan">
                        <svg class="w-5 h-5 mr-3" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M9 6a3 3 0 11-6 0 3 3 0 016 0zM17 6a3 3 0 11-6 0 3 3 0 016 0zM12.93 17c.046-.327.07-.66.07-1a6.97 6.97 0 00-1.5-4.33A5 5 0 0119 16v1h-6.07zM6 11a5 5 0 015 5v1H1v-1a5 5 0 015-5z"></path>
                        </svg>
                        Pelanggan
                    </button>
                    
                    <button onclick="showTab('harga')" class="sidebar-item w-full flex items-center px-4 py-3 text-left text-gray-700 rounded-xl transition-all duration-300" id="tab-harga">
                        <svg class="w-5 h-5 mr-3" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-13a1 1 0 10-2 0v.092a4.535 4.535 0 00-1.676.662C6.602 6.234 6 7.009 6 8c0 .99.602 1.765 1.324 2.246.48.32 1.054.545 1.676.662v1.941c-.391-.127-.68-.317-.843-.504a1 1 0 10-1.51 1.31c.562.649 1.413 1.076 2.353 1.253V15a1 1 0 102 0v-.092a4.535 4.535 0 001.676-.662C13.398 13.766 14 12.991 14 12c0-.99-.602-1.765-1.324-2.246A4.535 4.535 0 0011 9.092V7.151c.391.127.68.317.843.504a1 1 0 101.511-1.31c-.563-.649-1.413-1.076-2.354-1.253V5z" clip-rule="evenodd"></path>
                        </svg>
                        Daftar Harga
                    </button>
                    
                    <button onclick="showTab('pengaturan')" class="sidebar-item w-full flex items-center px-4 py-3 text-left text-gray-700 rounded-xl transition-all duration-300" id="tab-pengaturan">
                        <svg class="w-5 h-5 mr-3" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M11.49 3.17c-.38-1.56-2.6-1.56-2.98 0a1.532 1.532 0 01-2.286.948c-1.372-.836-2.942.734-2.106 2.106.54.886.061 2.042-.947 2.287-1.561.379-1.561 2.6 0 2.978a1.532 1.532 0 01.947 2.287c-.836 1.372.734 2.942 2.106 2.106a1.532 1.532 0 012.287.947c.379 1.561 2.6 1.561 2.978 0a1.533 1.533 0 012.287-.947c1.372.836 2.942-.734 2.106-2.106a1.533 1.533 0 01.947-2.287c1.561-.379 1.561-2.6 0-2.978a1.532 1.532 0 01-.947-2.287c.836-1.372-.734-2.942-2.106-2.106a1.532 1.532 0 01-2.287-.947zM10 13a3 3 0 100-6 3 3 0 000 6z" clip-rule="evenodd"></path>
                        </svg>
                        Pengaturan
                    </button>
                </div>
            </nav>
        </div>

        <!-- Main Content -->
        <div class="flex-1 flex flex-col overflow-hidden lg:ml-0">
            <!-- Header -->
            <header class="header-glass shadow-lg">
                <div class="flex items-center justify-between px-4 lg:px-6 py-4 ml-12 lg:ml-0">
                    <div class="flex-1 min-w-0">
                        <h2 class="text-lg lg:text-2xl font-bold text-white truncate" id="page-title">Dashboard</h2>
                        <p class="text-blue-100 text-sm lg:text-base hidden sm:block" id="page-subtitle">Ringkasan aktivitas bisnis Anda</p>
                    </div>
                    <div class="flex items-center space-x-2 lg:space-x-4">
                        <div class="text-right text-white hidden md:block">
                            <p class="text-sm opacity-90">Selamat datang,</p>
                            <p class="font-semibold" id="user-display-name">Admin FP Digital</p>
                        </div>
                        <div class="flex items-center space-x-2 lg:space-x-3">
                            <button onclick="logout()" class="w-8 h-8 lg:w-10 lg:h-10 bg-white bg-opacity-20 rounded-full flex items-center justify-center hover:bg-opacity-30 transition-all duration-300" title="Keluar">
                                <svg class="w-4 h-4 lg:w-5 lg:h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M3 3a1 1 0 00-1 1v12a1 1 0 102 0V4a1 1 0 00-1-1zm10.293 9.293a1 1 0 001.414 1.414l3-3a1 1 0 000-1.414l-3-3a1 1 0 10-1.414 1.414L14.586 9H7a1 1 0 100 2h7.586l-1.293 1.293z" clip-rule="evenodd"></path>
                                </svg>
                            </button>
                            <div class="w-8 h-8 lg:w-10 lg:h-10 bg-white bg-opacity-20 rounded-full flex items-center justify-center">
                                <svg class="w-5 h-5 lg:w-6 lg:h-6 text-white" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd"></path>
                                </svg>
                            </div>
                        </div>
                    </div>
                </div>
            </header>

            <!-- Content Area -->
            <main class="flex-1 overflow-y-auto p-4 lg:p-6">
                <!-- Dashboard Tab -->
                <div id="content-dashboard" class="animate-fade-in">
                    <!-- Stats Cards -->
                    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 lg:gap-6 mb-6 lg:mb-8">
                        <div class="stat-card rounded-xl lg:rounded-2xl p-4 lg:p-6 card-hover transition-all duration-300">
                            <div class="flex items-center justify-between">
                                <div class="flex-1 min-w-0">
                                    <p class="text-xs lg:text-sm font-medium text-gray-600">Total Penjualan</p>
                                    <p class="text-xl lg:text-3xl font-bold text-gray-900 truncate" id="total-sales">Rp 0</p>
                                    <p class="text-xs lg:text-sm text-green-600 mt-1">+12% dari bulan lalu</p>
                                </div>
                                <div class="w-10 h-10 lg:w-12 lg:h-12 gradient-bg rounded-lg lg:rounded-xl flex items-center justify-center flex-shrink-0 ml-2">
                                    <svg class="w-5 h-5 lg:w-6 lg:h-6 text-white" fill="currentColor" viewBox="0 0 20 20">
                                        <path d="M4 4a2 2 0 00-2 2v4a2 2 0 002 2V6h10a2 2 0 00-2-2H4zm2 6a2 2 0 012-2h8a2 2 0 012 2v4a2 2 0 01-2 2H8a2 2 0 01-2-2v-4zm6 4a2 2 0 100-4 2 2 0 000 4z"></path>
                                    </svg>
                                </div>
                            </div>
                        </div>

                        <div class="stat-card rounded-xl lg:rounded-2xl p-4 lg:p-6 card-hover transition-all duration-300">
                            <div class="flex items-center justify-between">
                                <div class="flex-1 min-w-0">
                                    <p class="text-xs lg:text-sm font-medium text-gray-600">Transaksi Hari Ini</p>
                                    <p class="text-xl lg:text-3xl font-bold text-gray-900 truncate" id="today-transactions">0</p>
                                    <p class="text-xs lg:text-sm text-blue-600 mt-1">Aktif</p>
                                </div>
                                <div class="w-10 h-10 lg:w-12 lg:h-12 gradient-bg rounded-lg lg:rounded-xl flex items-center justify-center flex-shrink-0 ml-2">
                                    <svg class="w-5 h-5 lg:w-6 lg:h-6 text-white" fill="currentColor" viewBox="0 0 20 20">
                                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                                    </svg>
                                </div>
                            </div>
                        </div>

                        <div class="stat-card rounded-xl lg:rounded-2xl p-4 lg:p-6 card-hover transition-all duration-300">
                            <div class="flex items-center justify-between">
                                <div class="flex-1 min-w-0">
                                    <p class="text-xs lg:text-sm font-medium text-gray-600">Total Pelanggan</p>
                                    <p class="text-xl lg:text-3xl font-bold text-gray-900 truncate" id="total-customers">0</p>
                                    <p class="text-xs lg:text-sm text-purple-600 mt-1">Terdaftar</p>
                                </div>
                                <div class="w-10 h-10 lg:w-12 lg:h-12 gradient-bg rounded-lg lg:rounded-xl flex items-center justify-center flex-shrink-0 ml-2">
                                    <svg class="w-5 h-5 lg:w-6 lg:h-6 text-white" fill="currentColor" viewBox="0 0 20 20">
                                        <path d="M9 6a3 3 0 11-6 0 3 3 0 016 0zM17 6a3 3 0 11-6 0 3 3 0 016 0zM12.93 17c.046-.327.07-.66.07-1a6.97 6.97 0 00-1.5-4.33A5 5 0 0119 16v1h-6.07zM6 11a5 5 0 015 5v1H1v-1a5 5 0 015-5z"></path>
                                    </svg>
                                </div>
                            </div>
                        </div>

                        <div class="stat-card rounded-xl lg:rounded-2xl p-4 lg:p-6 card-hover transition-all duration-300">
                            <div class="flex items-center justify-between">
                                <div class="flex-1 min-w-0">
                                    <p class="text-xs lg:text-sm font-medium text-gray-600">Keuntungan Bulan Ini</p>
                                    <p class="text-xl lg:text-3xl font-bold text-gray-900 truncate" id="monthly-profit">Rp 0</p>
                                    <p class="text-xs lg:text-sm text-green-600 mt-1">+8% dari target</p>
                                </div>
                                <div class="w-10 h-10 lg:w-12 lg:h-12 gradient-bg rounded-lg lg:rounded-xl flex items-center justify-center flex-shrink-0 ml-2">
                                    <svg class="w-5 h-5 lg:w-6 lg:h-6 text-white" fill="currentColor" viewBox="0 0 20 20">
                                        <path fill-rule="evenodd" d="M12 7a1 1 0 110-2h5a1 1 0 011 1v5a1 1 0 11-2 0V8.414l-4.293 4.293a1 1 0 01-1.414 0L8 10.414l-4.293 4.293a1 1 0 01-1.414-1.414l5-5a1 1 0 011.414 0L11 10.586 14.586 7H12z" clip-rule="evenodd"></path>
                                    </svg>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Recent Transactions -->
                    <div class="card-gradient rounded-xl lg:rounded-2xl p-4 lg:p-6 shadow-lg">
                        <div class="flex items-center justify-between mb-4 lg:mb-6">
                            <h3 class="text-lg lg:text-xl font-bold text-gray-900">Transaksi Terbaru</h3>
                            <button onclick="showTab('transaksi-harian')" class="text-blue-600 hover:text-blue-800 font-medium text-sm lg:text-base">Lihat Semua</button>
                        </div>
                        <div class="overflow-x-auto -mx-4 lg:mx-0">
                            <table class="w-full min-w-full">
                                <thead>
                                    <tr class="border-b border-gray-200">
                                        <th class="text-left py-2 lg:py-3 px-2 lg:px-4 font-semibold text-gray-700 text-xs lg:text-sm">ID</th>
                                        <th class="text-left py-2 lg:py-3 px-2 lg:px-4 font-semibold text-gray-700 text-xs lg:text-sm">Pelanggan</th>
                                        <th class="text-left py-2 lg:py-3 px-2 lg:px-4 font-semibold text-gray-700 text-xs lg:text-sm">Total</th>
                                        <th class="text-left py-2 lg:py-3 px-2 lg:px-4 font-semibold text-gray-700 text-xs lg:text-sm">Status</th>
                                    </tr>
                                </thead>
                                <tbody id="recent-transactions">
                                    <tr class="table-row transition-all duration-300">
                                        <td class="py-2 lg:py-3 px-2 lg:px-4 text-gray-600 text-xs lg:text-sm">#001</td>
                                        <td class="py-2 lg:py-3 px-2 lg:px-4 text-gray-900 font-medium text-xs lg:text-sm">Budi Santoso</td>
                                        <td class="py-2 lg:py-3 px-2 lg:px-4 text-gray-900 font-semibold text-xs lg:text-sm">Rp 150.000</td>
                                        <td class="py-2 lg:py-3 px-2 lg:px-4">
                                            <span class="px-2 lg:px-3 py-1 bg-green-100 text-green-800 rounded-full text-xs lg:text-sm font-medium">Selesai</span>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Transaksi Harian Tab -->
                <div id="content-transaksi-harian" class="hidden animate-fade-in">
                    <div class="flex justify-between items-center mb-6">
                        <div>
                            <h3 class="text-2xl font-bold text-gray-900">Transaksi Harian</h3>
                            <p class="text-gray-600">Ringkasan transaksi per hari</p>
                        </div>
                        <div class="flex space-x-3">
                            <input type="date" id="daily-date" class="px-4 py-2 border border-gray-300 rounded-xl input-focus" value="">
                            <button onclick="filterDailyTransactions()" class="btn-primary text-white px-6 py-2 rounded-xl font-semibold">
                                Filter
                            </button>
                            <button onclick="openDailyTransactionModal()" class="btn-primary text-white px-8 py-3 rounded-xl font-semibold flex items-center space-x-3 shadow-lg hover:shadow-xl transform hover:scale-105 transition-all duration-300">
                                <div class="w-6 h-6 bg-white bg-opacity-20 rounded-lg flex items-center justify-center">
                                    <svg class="w-4 h-4 text-white" fill="currentColor" viewBox="0 0 20 20">
                                        <path fill-rule="evenodd" d="M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z" clip-rule="evenodd"></path>
                                    </svg>
                                </div>
                                <span>Buat Transaksi</span>
                            </button>
                        </div>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
                        <div class="stat-card rounded-2xl p-6">
                            <h4 class="text-lg font-semibold text-gray-700 mb-2">Total Transaksi Hari Ini</h4>
                            <p class="text-3xl font-bold text-blue-600" id="daily-total-transactions">0</p>
                        </div>
                        <div class="stat-card rounded-2xl p-6">
                            <h4 class="text-lg font-semibold text-gray-700 mb-2">Pendapatan Hari Ini</h4>
                            <p class="text-3xl font-bold text-green-600" id="daily-revenue">Rp 0</p>
                        </div>
                        <div class="stat-card rounded-2xl p-6">
                            <h4 class="text-lg font-semibold text-gray-700 mb-2">Rata-rata per Transaksi</h4>
                            <p class="text-3xl font-bold text-purple-600" id="daily-average">Rp 0</p>
                        </div>
                    </div>

                    <div class="card-gradient rounded-2xl p-6 shadow-lg">
                        <h4 class="text-lg font-bold text-gray-900 mb-4">Detail Transaksi</h4>
                        <div class="overflow-x-auto">
                            <table class="w-full">
                                <thead>
                                    <tr class="border-b border-gray-200">
                                        <th class="text-left py-3 px-4 font-semibold text-gray-700">Waktu</th>
                                        <th class="text-left py-3 px-4 font-semibold text-gray-700">ID</th>
                                        <th class="text-left py-3 px-4 font-semibold text-gray-700">Pelanggan</th>
                                        <th class="text-left py-3 px-4 font-semibold text-gray-700">Layanan</th>
                                        <th class="text-left py-3 px-4 font-semibold text-gray-700">Total</th>
                                        <th class="text-left py-3 px-4 font-semibold text-gray-700">Status</th>
                                        <th class="text-left py-3 px-4 font-semibold text-gray-700">Aksi</th>
                                    </tr>
                                </thead>
                                <tbody id="daily-transactions-table">
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Tagihan Tab -->
                <div id="content-tagihan" class="hidden animate-fade-in">
                    <div class="flex justify-between items-center mb-6">
                        <div>
                            <h3 class="text-2xl font-bold text-gray-900">Transaksi Tagihan</h3>
                            <p class="text-gray-600">Kelola tagihan dan pembayaran</p>
                        </div>
                        <button onclick="openInvoiceModal()" class="btn-primary text-white px-6 py-3 rounded-xl font-semibold">
                            + Buat Tagihan
                        </button>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
                        <div class="stat-card rounded-2xl p-6">
                            <h4 class="text-lg font-semibold text-gray-700 mb-2">Tagihan Belum Dibayar</h4>
                            <p class="text-3xl font-bold text-red-600" id="unpaid-invoices">0</p>
                        </div>
                        <div class="stat-card rounded-2xl p-6">
                            <h4 class="text-lg font-semibold text-gray-700 mb-2">Total Piutang</h4>
                            <p class="text-3xl font-bold text-orange-600" id="total-receivables">Rp 0</p>
                        </div>
                        <div class="stat-card rounded-2xl p-6">
                            <h4 class="text-lg font-semibold text-gray-700 mb-2">Tagihan Lunas</h4>
                            <p class="text-3xl font-bold text-green-600" id="paid-invoices">0</p>
                        </div>
                    </div>

                    <div class="card-gradient rounded-2xl p-6 shadow-lg">
                        <div class="overflow-x-auto">
                            <table class="w-full">
                                <thead>
                                    <tr class="border-b border-gray-200">
                                        <th class="text-left py-4 px-4 font-semibold text-gray-700">No. Tagihan</th>
                                        <th class="text-left py-4 px-4 font-semibold text-gray-700">Tanggal</th>
                                        <th class="text-left py-4 px-4 font-semibold text-gray-700">Pelanggan</th>
                                        <th class="text-left py-4 px-4 font-semibold text-gray-700">Jumlah</th>
                                        <th class="text-left py-4 px-4 font-semibold text-gray-700">Jatuh Tempo</th>
                                        <th class="text-left py-4 px-4 font-semibold text-gray-700">Status</th>
                                        <th class="text-left py-4 px-4 font-semibold text-gray-700">Aksi</th>
                                    </tr>
                                </thead>
                                <tbody id="invoices-table">
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Surat Jalan Tab -->
                <div id="content-surat-jalan" class="hidden animate-fade-in">
                    <div class="flex justify-between items-center mb-6">
                        <div>
                            <h3 class="text-2xl font-bold text-gray-900">Surat Jalan</h3>
                            <p class="text-gray-600">Kelola pengiriman dan surat jalan</p>
                        </div>
                        <button onclick="openDeliveryModal()" class="btn-primary text-white px-6 py-3 rounded-xl font-semibold">
                            + Buat Surat Jalan
                        </button>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-6">
                        <div class="stat-card rounded-2xl p-6">
                            <h4 class="text-lg font-semibold text-gray-700 mb-2">Menunggu Kirim</h4>
                            <p class="text-3xl font-bold text-yellow-600" id="pending-deliveries">0</p>
                        </div>
                        <div class="stat-card rounded-2xl p-6">
                            <h4 class="text-lg font-semibold text-gray-700 mb-2">Dalam Perjalanan</h4>
                            <p class="text-3xl font-bold text-blue-600" id="in-transit-deliveries">0</p>
                        </div>
                        <div class="stat-card rounded-2xl p-6">
                            <h4 class="text-lg font-semibold text-gray-700 mb-2">Terkirim</h4>
                            <p class="text-3xl font-bold text-green-600" id="delivered-deliveries">0</p>
                        </div>
                        <div class="stat-card rounded-2xl p-6">
                            <h4 class="text-lg font-semibold text-gray-700 mb-2">Total Pengiriman</h4>
                            <p class="text-3xl font-bold text-purple-600" id="total-deliveries">0</p>
                        </div>
                    </div>

                    <div class="card-gradient rounded-2xl p-6 shadow-lg">
                        <div class="overflow-x-auto">
                            <table class="w-full">
                                <thead>
                                    <tr class="border-b border-gray-200">
                                        <th class="text-left py-4 px-4 font-semibold text-gray-700">No. Surat Jalan</th>
                                        <th class="text-left py-4 px-4 font-semibold text-gray-700">Tanggal</th>
                                        <th class="text-left py-4 px-4 font-semibold text-gray-700">Pelanggan</th>
                                        <th class="text-left py-4 px-4 font-semibold text-gray-700">Alamat Tujuan</th>
                                        <th class="text-left py-4 px-4 font-semibold text-gray-700">Status</th>
                                        <th class="text-left py-4 px-4 font-semibold text-gray-700">Aksi</th>
                                    </tr>
                                </thead>
                                <tbody id="deliveries-table">
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Laporan Tab -->
                <div id="content-laporan" class="hidden animate-fade-in">
                    <div class="mb-6">
                        <h3 class="text-2xl font-bold text-gray-900">Laporan Keuangan</h3>
                        <p class="text-gray-600">Analisis performa bisnis Anda</p>
                    </div>

                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
                        <div class="card-gradient rounded-2xl p-6 shadow-lg">
                            <h4 class="text-lg font-bold text-gray-900 mb-4">Filter Laporan</h4>
                            <div class="space-y-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Periode</label>
                                    <select id="report-period" class="w-full px-4 py-3 border border-gray-300 rounded-xl input-focus transition-all duration-300">
                                        <option value="today">Hari Ini</option>
                                        <option value="week">Minggu Ini</option>
                                        <option value="month">Bulan Ini</option>
                                        <option value="year">Tahun Ini</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Jenis Laporan</label>
                                    <select id="report-type" class="w-full px-4 py-3 border border-gray-300 rounded-xl input-focus transition-all duration-300">
                                        <option value="financial">Laporan Keuangan</option>
                                        <option value="sales">Laporan Penjualan</option>
                                        <option value="customer">Laporan Pelanggan</option>
                                        <option value="invoice">Laporan Tagihan</option>
                                        <option value="delivery">Laporan Pengiriman</option>
                                    </select>
                                </div>
                                <button onclick="generateReport()" class="w-full btn-primary text-white py-3 rounded-xl font-semibold">
                                    Generate Laporan
                                </button>
                            </div>
                        </div>

                        <div class="card-gradient rounded-2xl p-6 shadow-lg">
                            <h4 class="text-lg font-bold text-gray-900 mb-4">Ringkasan Keuangan</h4>
                            <div class="space-y-4">
                                <div class="flex justify-between items-center p-3 bg-green-50 rounded-xl">
                                    <span class="text-gray-700">Total Pemasukan</span>
                                    <span class="font-bold text-green-600" id="total-income">Rp 0</span>
                                </div>
                                <div class="flex justify-between items-center p-3 bg-red-50 rounded-xl">
                                    <span class="text-gray-700">Total Pengeluaran</span>
                                    <span class="font-bold text-red-600" id="total-expense">Rp 0</span>
                                </div>
                                <div class="flex justify-between items-center p-3 bg-blue-50 rounded-xl">
                                    <span class="text-gray-700">Keuntungan Bersih</span>
                                    <span class="font-bold text-blue-600" id="net-profit">Rp 0</span>
                                </div>
                                <div class="flex justify-between items-center p-3 bg-purple-50 rounded-xl">
                                    <span class="text-gray-700">Piutang Belum Lunas</span>
                                    <span class="font-bold text-purple-600" id="outstanding-receivables">Rp 0</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Detailed Reports -->
                    <div class="card-gradient rounded-2xl p-6 shadow-lg">
                        <h4 class="text-lg font-bold text-gray-900 mb-4">Detail Laporan</h4>
                        <div id="report-content">
                            <p class="text-gray-600 text-center py-8">Pilih periode dan jenis laporan, lalu klik "Generate Laporan" untuk melihat detail.</p>
                        </div>
                    </div>
                </div>

                <!-- Pelanggan Tab -->
                <div id="content-pelanggan" class="hidden animate-fade-in">
                    <div class="flex justify-between items-center mb-6">
                        <div>
                            <h3 class="text-2xl font-bold text-gray-900">Data Pelanggan</h3>
                            <p class="text-gray-600">Kelola informasi pelanggan Anda</p>
                        </div>
                        <div class="flex space-x-3">
                            <button onclick="exportCustomers()" class="bg-green-600 hover:bg-green-700 text-white px-4 py-3 rounded-xl font-semibold transition-all duration-300">
                                📊 Export
                            </button>
                            <button onclick="openCustomerModal()" class="btn-primary text-white px-6 py-3 rounded-xl font-semibold">
                                + Tambah Pelanggan
                            </button>
                        </div>
                    </div>

                    <!-- Customer Stats Cards -->
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-6">
                        <div class="stat-card rounded-2xl p-6">
                            <h4 class="text-lg font-semibold text-gray-700 mb-2">Total Pelanggan</h4>
                            <p class="text-3xl font-bold text-blue-600" id="total-customers-count">0</p>
                        </div>
                        <div class="stat-card rounded-2xl p-6">
                            <h4 class="text-lg font-semibold text-gray-700 mb-2">Pelanggan Aktif</h4>
                            <p class="text-3xl font-bold text-green-600" id="active-customers-count">0</p>
                        </div>
                        <div class="stat-card rounded-2xl p-6">
                            <h4 class="text-lg font-semibold text-gray-700 mb-2">Pelanggan VIP</h4>
                            <p class="text-3xl font-bold text-purple-600" id="vip-customers-count">0</p>
                        </div>
                        <div class="stat-card rounded-2xl p-6">
                            <h4 class="text-lg font-semibold text-gray-700 mb-2">Rata-rata Belanja</h4>
                            <p class="text-3xl font-bold text-orange-600" id="avg-customer-spending">Rp 0</p>
                        </div>
                    </div>

                    <!-- Search and Filter Controls -->
                    <div class="card-gradient rounded-2xl p-6 shadow-lg mb-6">
                        <div class="flex flex-col md:flex-row gap-4 items-center">
                            <div class="flex-1">
                                <div class="relative">
                                    <input type="text" id="customer-search" class="w-full px-4 py-3 pl-10 border border-gray-300 rounded-xl input-focus" placeholder="🔍 Cari nama, email, atau telepon pelanggan..." oninput="filterCustomers()">
                                    <svg class="w-5 h-5 text-gray-400 absolute left-3 top-3.5" fill="currentColor" viewBox="0 0 20 20">
                                        <path fill-rule="evenodd" d="M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z" clip-rule="evenodd"></path>
                                    </svg>
                                </div>
                            </div>
                            <div class="flex space-x-3">
                                <select id="customer-filter" class="px-4 py-3 border border-gray-300 rounded-xl input-focus" onchange="filterCustomers()">
                                    <option value="all">Semua Pelanggan</option>
                                    <option value="active">Pelanggan Aktif (>2 transaksi)</option>
                                    <option value="vip">Pelanggan VIP (>5 transaksi)</option>
                                    <option value="new">Pelanggan Baru (≤2 transaksi)</option>
                                </select>
                                <select id="customer-sort" class="px-4 py-3 border border-gray-300 rounded-xl input-focus" onchange="filterCustomers()">
                                    <option value="name">Urutkan: Nama A-Z</option>
                                    <option value="name-desc">Urutkan: Nama Z-A</option>
                                    <option value="transactions">Urutkan: Transaksi Terbanyak</option>
                                    <option value="spending">Urutkan: Belanja Terbesar</option>
                                    <option value="recent">Urutkan: Terbaru</option>
                                </select>
                                <button onclick="clearCustomerFilters()" class="px-4 py-3 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-xl transition-all duration-300">
                                    🔄 Reset
                                </button>
                            </div>
                        </div>
                    </div>

                    <div class="card-gradient rounded-2xl p-6 shadow-lg">
                        <div class="flex justify-between items-center mb-4">
                            <h4 class="text-lg font-bold text-gray-900">Daftar Pelanggan</h4>
                            <div class="text-sm text-gray-600">
                                Menampilkan <span id="customers-showing">0</span> dari <span id="customers-total">0</span> pelanggan
                            </div>
                        </div>
                        <div class="overflow-x-auto">
                            <table class="w-full">
                                <thead>
                                    <tr class="border-b border-gray-200">
                                        <th class="text-left py-4 px-4 font-semibold text-gray-700">ID</th>
                                        <th class="text-left py-4 px-4 font-semibold text-gray-700">Nama</th>
                                        <th class="text-left py-4 px-4 font-semibold text-gray-700">Kontak</th>
                                        <th class="text-left py-4 px-4 font-semibold text-gray-700">Telepon</th>
                                        <th class="text-left py-4 px-4 font-semibold text-gray-700">Transaksi</th>
                                        <th class="text-left py-4 px-4 font-semibold text-gray-700">Aksi</th>
                                    </tr>
                                </thead>
                                <tbody id="customers-table">
                                    <!-- Customers will be populated here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Harga Tab -->
                <div id="content-harga" class="hidden animate-fade-in">
                    <div class="flex justify-between items-center mb-6">
                        <div>
                            <h3 class="text-2xl font-bold text-gray-900">Daftar Harga Cetakan</h3>
                            <p class="text-gray-600">Kelola harga untuk setiap jenis cetakan</p>
                        </div>
                        <button onclick="openPriceModal()" class="btn-primary text-white px-6 py-3 rounded-xl font-semibold">
                            + Tambah Jenis Cetakan
                        </button>
                    </div>

                    <div id="price-cards-container">
                        <!-- Price table will be populated here -->
                    </div>
                </div>

                <!-- Pengaturan Tab -->
                <div id="content-pengaturan" class="hidden animate-fade-in">
                    <div class="flex justify-between items-center mb-6">
                        <div>
                            <h3 class="text-2xl font-bold text-gray-900">Pengaturan Perusahaan</h3>
                            <p class="text-gray-600">Kelola informasi dan logo perusahaan</p>
                        </div>
                        <div class="flex space-x-3">
                            <button onclick="exportAllData()" class="bg-green-600 hover:bg-green-700 text-white px-4 py-3 rounded-xl font-semibold transition-all duration-300">
                                💾 Backup Data
                            </button>
                            <button onclick="document.getElementById('import-file').click()" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-3 rounded-xl font-semibold transition-all duration-300">
                                📂 Import Data
                            </button>
                            <button onclick="resetAllData()" class="bg-red-600 hover:bg-red-700 text-white px-4 py-3 rounded-xl font-semibold transition-all duration-300">
                                🗑️ Reset Semua
                            </button>
                            <button onclick="resetCompanySettings()" class="bg-gray-600 hover:bg-gray-700 text-white px-4 py-3 rounded-xl font-semibold transition-all duration-300">
                                🔄 Reset Default
                            </button>
                        </div>
                    </div>
                    
                    <!-- Hidden file input for import -->
                    <input type="file" id="import-file" accept=".json" style="display: none;" onchange="handleImportFile(this)">

                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <!-- Company Info Form -->
                        <div class="card-gradient rounded-2xl p-6 shadow-lg">
                            <h4 class="text-lg font-bold text-gray-900 mb-6">📝 Informasi Perusahaan</h4>
                            
                            <form id="company-settings-form" class="space-y-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Nama Perusahaan</label>
                                    <input type="text" id="company-name" class="w-full px-4 py-3 border border-gray-300 rounded-xl input-focus transition-all duration-300" required>
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Tagline/Slogan</label>
                                    <input type="text" id="company-tagline" class="w-full px-4 py-3 border border-gray-300 rounded-xl input-focus transition-all duration-300" placeholder="Contoh: Professional Printing Services">
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Alamat Lengkap</label>
                                    <textarea id="company-address" rows="4" class="w-full px-4 py-3 border border-gray-300 rounded-xl input-focus transition-all duration-300 resize-none" placeholder="Alamat lengkap, telepon, email, dll." required></textarea>
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Logo Perusahaan</label>
                                    <div class="space-y-3">
                                        <input type="file" id="company-logo-file" accept="image/*" class="w-full px-4 py-3 border border-gray-300 rounded-xl input-focus transition-all duration-300" onchange="handleLogoUpload(this)">
                                        <div class="text-xs text-gray-500">
                                            💡 Upload gambar logo (JPG, PNG, SVG) atau gunakan logo default
                                        </div>
                                        <div class="flex space-x-2">
                                            <button type="button" onclick="useDefaultLogo()" class="px-3 py-2 bg-blue-100 text-blue-700 rounded-lg hover:bg-blue-200 transition-colors text-sm">
                                                🎨 Logo Default
                                            </button>
                                            <button type="button" onclick="clearLogo()" class="px-3 py-2 bg-red-100 text-red-700 rounded-lg hover:bg-red-200 transition-colors text-sm">
                                                🗑️ Hapus Logo
                                            </button>
                                        </div>
                                    </div>
                                </div>
                                
                                <button type="submit" class="w-full btn-primary text-white py-3 rounded-xl font-semibold">
                                    💾 Simpan Pengaturan
                                </button>
                            </form>
                        </div>

                        <!-- Preview Section -->
                        <div class="card-gradient rounded-2xl p-6 shadow-lg">
                            <h4 class="text-lg font-bold text-gray-900 mb-6">👁️ Preview</h4>
                            
                            <!-- Logo Preview -->
                            <div class="mb-6">
                                <h5 class="text-sm font-medium text-gray-700 mb-3">Logo Preview:</h5>
                                <div class="flex items-center justify-center p-6 bg-gray-50 rounded-xl border-2 border-dashed border-gray-300">
                                    <div id="logo-preview" class="text-center">
                                        <img id="logo-preview-img" src="" alt="Logo Preview" class="max-w-24 max-h-24 mx-auto mb-2 hidden">
                                        <div id="logo-preview-placeholder" class="w-24 h-24 gradient-bg rounded-xl flex items-center justify-center mx-auto mb-2">
                                            <span class="text-white font-bold text-2xl">FP</span>
                                        </div>
                                        <div class="text-xs text-gray-500">Logo Perusahaan</div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Header Preview -->
                            <div class="mb-6">
                                <h5 class="text-sm font-medium text-gray-700 mb-3">Header Dokumen Preview:</h5>
                                <div class="bg-white border border-gray-200 rounded-xl p-4">
                                    <div class="text-center">
                                        <div class="flex items-center justify-center mb-3">
                                            <img id="header-logo-preview" src="" alt="Logo" class="max-w-12 max-h-12 mr-3 hidden">
                                            <div id="header-logo-placeholder" class="w-12 h-12 gradient-bg rounded-lg flex items-center justify-center mr-3">
                                                <span class="text-white font-bold text-sm">FP</span>
                                            </div>
                                            <div>
                                                <div id="header-company-name" class="text-lg font-bold text-gray-900">FP DIGITAL PRINTING</div>
                                                <div id="header-company-tagline" class="text-xs text-gray-600">Professional Printing Services</div>
                                            </div>
                                        </div>
                                        <div id="header-company-address" class="text-xs text-gray-500 whitespace-pre-line">Royal Sentraland BTP, Blok RD/15
Telepon: 0877 8811 2438
Email: fpdigital13@gmail.com</div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Usage Info -->
                            <div class="bg-blue-50 border border-blue-200 rounded-xl p-4">
                                <h5 class="text-sm font-medium text-blue-800 mb-2">ℹ️ Informasi Penggunaan:</h5>
                                <div class="text-xs text-blue-700 space-y-1">
                                    <p>• Logo dan informasi ini akan muncul di semua dokumen cetak</p>
                                    <p>• Termasuk: Surat Jalan, Tagihan, dan Laporan</p>
                                    <p>• Perubahan akan langsung diterapkan ke semua dokumen baru</p>
                                    <p>• Ukuran logo optimal: 100x100 pixel atau rasio 1:1</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>
    </div>

    <!-- Customer Modal -->
    <div id="customer-modal" class="fixed inset-0 modal-backdrop hidden items-center justify-center z-50">
        <div class="modal-content rounded-2xl p-8 max-w-md w-full mx-4">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-xl font-bold text-gray-900">Tambah Pelanggan Baru</h3>
                <button onclick="closeCustomerModal()" class="text-gray-500 hover:text-gray-700">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>
            
            <form id="customer-form" class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Nama Lengkap</label>
                    <input type="text" id="customer-fullname" class="w-full px-4 py-3 border border-gray-300 rounded-xl input-focus transition-all duration-300" required>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Email</label>
                    <input type="email" id="customer-email" class="w-full px-4 py-3 border border-gray-300 rounded-xl input-focus transition-all duration-300" required>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Nomor Telepon</label>
                    <input type="tel" id="customer-phone" class="w-full px-4 py-3 border border-gray-300 rounded-xl input-focus transition-all duration-300" required>
                </div>
                
                <div class="flex space-x-4 pt-4">
                    <button type="button" onclick="closeCustomerModal()" class="flex-1 px-4 py-3 border border-gray-300 text-gray-700 rounded-xl hover:bg-gray-50 transition-all duration-300">
                        Batal
                    </button>
                    <button type="submit" class="flex-1 btn-primary text-white py-3 rounded-xl font-semibold">
                        Simpan
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Invoice Modal -->
    <div id="invoice-modal" class="fixed inset-0 modal-backdrop hidden items-center justify-center z-50">
        <div class="modal-content rounded-2xl p-0 max-w-4xl w-full mx-4 max-h-[90vh] overflow-hidden shadow-xl">
            <!-- Simple Header -->
            <div class="bg-white px-6 py-4 border-b border-gray-200">
                <div class="flex justify-between items-center">
                    <h3 class="text-xl font-semibold text-gray-900">Buat Tagihan Baru</h3>
                    <button onclick="closeInvoiceModal()" class="text-gray-400 hover:text-gray-600 transition-colors">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    </button>
                </div>
            </div>

            <!-- Content -->
            <div class="max-h-[calc(90vh-140px)] overflow-y-auto">
                <form id="invoice-form" class="p-6 space-y-6">
                    <!-- Basic Info -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Nomor Tagihan</label>
                            <input type="text" id="invoice-number" class="w-full px-3 py-2 border border-gray-300 rounded-lg bg-gray-50 font-mono text-sm" readonly>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Tanggal</label>
                            <input type="date" id="invoice-date" class="w-full px-3 py-2 border border-gray-300 rounded-lg input-focus" required>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Pelanggan</label>
                            <select id="invoice-customer" class="w-full px-3 py-2 border border-gray-300 rounded-lg input-focus" required>
                                <option value="">Pilih Pelanggan</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Jatuh Tempo</label>
                            <input type="date" id="invoice-due-date" class="w-full px-3 py-2 border border-gray-300 rounded-lg input-focus" required>
                        </div>
                    </div>

                    <!-- Items Section -->
                    <div class="border border-gray-200 rounded-lg p-4">
                        <div class="flex justify-between items-center mb-4">
                            <h4 class="font-medium text-gray-900">Item Tagihan</h4>
                            <button type="button" onclick="addInvoiceItem()" class="btn-primary text-white px-4 py-2 rounded-lg text-sm font-medium">
                                + Tambah Item
                            </button>
                        </div>
                        
                        <div id="invoice-items-container" class="space-y-3">
                            <!-- Invoice items will be added here -->
                        </div>
                        
                        <!-- Totals -->
                        <div class="mt-6 pt-4 border-t border-gray-200">
                            <div class="flex justify-end">
                                <div class="w-80 space-y-2">
                                    <div class="flex justify-between text-sm">
                                        <span class="text-gray-600">Subtotal:</span>
                                        <span class="font-medium" id="invoice-subtotal">Rp 0</span>
                                    </div>
                                    <div class="flex justify-between text-sm">
                                        <span class="text-gray-600">PPN (11%):</span>
                                        <span class="font-medium" id="invoice-tax">Rp 0</span>
                                    </div>
                                    <div class="flex justify-between text-lg font-semibold pt-2 border-t border-gray-200">
                                        <span>Total:</span>
                                        <span class="text-blue-600" id="invoice-total">Rp 0</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Notes -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Catatan (Opsional)</label>
                        <textarea id="invoice-notes" rows="3" class="w-full px-3 py-2 border border-gray-300 rounded-lg input-focus resize-none" placeholder="Tambahkan catatan atau syarat pembayaran..."></textarea>
                    </div>
                </form>
            </div>

            <!-- Footer -->
            <div class="px-6 py-4 bg-gray-50 border-t border-gray-200 flex justify-end space-x-3">
                <button type="button" onclick="closeInvoiceModal()" class="px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-100 transition-colors">
                    Batal
                </button>
                <button type="submit" form="invoice-form" class="btn-primary text-white px-6 py-2 rounded-lg font-medium">
                    Buat Tagihan
                </button>
            </div>
        </div>
    </div>

    <!-- Daily Transaction Modal -->
    <div id="daily-transaction-modal" class="fixed inset-0 modal-backdrop hidden items-center justify-center z-50">
        <div class="modal-content rounded-2xl p-0 max-w-2xl w-full mx-4 max-h-[90vh] overflow-hidden shadow-xl">
            <!-- Header -->
            <div class="bg-white px-6 py-4 border-b border-gray-200">
                <div class="flex justify-between items-center">
                    <h3 class="text-xl font-semibold text-gray-900">Buat Transaksi Harian</h3>
                    <button onclick="closeDailyTransactionModal()" class="text-gray-400 hover:text-gray-600 transition-colors">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    </button>
                </div>
            </div>

            <!-- Content -->
            <div class="max-h-[calc(90vh-140px)] overflow-y-auto">
                <form id="daily-transaction-form" class="p-6 space-y-6">
                    <!-- Basic Info -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">ID Transaksi</label>
                            <input type="text" id="transaction-id" class="w-full px-3 py-2 border border-gray-300 rounded-lg bg-gray-50 font-mono text-sm" readonly>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Tanggal & Waktu</label>
                            <input type="datetime-local" id="transaction-datetime" class="w-full px-3 py-2 border border-gray-300 rounded-lg input-focus" required>
                        </div>
                        <div class="md:col-span-2">
                            <label class="block text-sm font-medium text-gray-700 mb-2">Pelanggan</label>
                            <div class="flex space-x-2">
                                <select id="transaction-customer" class="flex-1 px-3 py-2 border border-gray-300 rounded-lg input-focus" required>
                                    <option value="">Pilih Pelanggan</option>
                                </select>
                                <button type="button" onclick="openQuickCustomerAdd()" class="px-4 py-2 bg-blue-100 text-blue-700 rounded-lg hover:bg-blue-200 transition-colors text-sm font-medium">
                                    + Baru
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Service Selection -->
                    <div class="border border-gray-200 rounded-lg p-4">
                        <h4 class="font-medium text-gray-900 mb-4">Detail Layanan</h4>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Jenis Cetakan</label>
                                <select id="transaction-service" class="w-full px-3 py-2 border border-gray-300 rounded-lg input-focus" onchange="updateTransactionPrice()" required>
                                    <option value="">Pilih Jenis Cetakan</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Jumlah</label>
                                <input type="number" id="transaction-quantity" class="w-full px-3 py-2 border border-gray-300 rounded-lg input-focus" min="1" value="1" onchange="calculateTransactionTotal()" required>
                            </div>
                        </div>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Harga Satuan</label>
                                <input type="number" id="transaction-price" class="w-full px-3 py-2 border border-gray-300 rounded-lg input-focus" min="0" onchange="calculateTransactionTotal()" required>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Total Harga</label>
                                <input type="number" id="transaction-total" class="w-full px-3 py-2 border border-gray-300 rounded-lg bg-gray-100 font-semibold text-blue-600" readonly>
                            </div>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Deskripsi (Opsional)</label>
                            <textarea id="transaction-description" rows="2" class="w-full px-3 py-2 border border-gray-300 rounded-lg input-focus resize-none" placeholder="Contoh: Banner promosi ukuran 2x3m, warna biru"></textarea>
                        </div>
                    </div>

                    <!-- Payment Status -->
                    <div class="border border-gray-200 rounded-lg p-4">
                        <h4 class="font-medium text-gray-900 mb-3">Status Pembayaran</h4>
                        <div class="flex space-x-4">
                            <label class="flex items-center">
                                <input type="radio" name="payment-status" value="Lunas" class="mr-2" checked>
                                <span class="text-sm text-gray-700">💰 Lunas</span>
                            </label>
                            <label class="flex items-center">
                                <input type="radio" name="payment-status" value="Belum Lunas" class="mr-2">
                                <span class="text-sm text-gray-700">⏳ Belum Lunas</span>
                            </label>
                        </div>
                    </div>
                </form>
            </div>

            <!-- Footer -->
            <div class="px-6 py-4 bg-gray-50 border-t border-gray-200 flex justify-end space-x-3">
                <button type="button" onclick="closeDailyTransactionModal()" class="px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-100 transition-colors">
                    Batal
                </button>
                <button type="submit" form="daily-transaction-form" class="btn-primary text-white px-6 py-2 rounded-lg font-medium">
                    Buat Transaksi
                </button>
            </div>
        </div>
    </div>

    <!-- Quick Customer Add Modal -->
    <div id="quick-customer-modal" class="fixed inset-0 modal-backdrop hidden items-center justify-center z-50">
        <div class="modal-content rounded-2xl p-6 max-w-md w-full mx-4">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-lg font-bold text-gray-900">Tambah Pelanggan Cepat</h3>
                <button onclick="closeQuickCustomerModal()" class="text-gray-500 hover:text-gray-700">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>
            
            <form id="quick-customer-form" class="space-y-3">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Nama Lengkap</label>
                    <input type="text" id="quick-customer-name" class="w-full px-3 py-2 border border-gray-300 rounded-lg input-focus" required>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Nomor Telepon</label>
                    <input type="tel" id="quick-customer-phone" class="w-full px-3 py-2 border border-gray-300 rounded-lg input-focus" required>
                </div>
                
                <div class="flex space-x-3 pt-3">
                    <button type="button" onclick="closeQuickCustomerModal()" class="flex-1 px-3 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors text-sm">
                        Batal
                    </button>
                    <button type="submit" class="flex-1 btn-primary text-white py-2 rounded-lg font-medium text-sm">
                        Tambah
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Delivery Modal -->
    <div id="delivery-modal" class="fixed inset-0 modal-backdrop hidden items-center justify-center z-50">
        <div class="modal-content rounded-2xl p-0 max-w-2xl w-full mx-4 max-h-[90vh] overflow-hidden shadow-xl">
            <!-- Header -->
            <div class="bg-white px-6 py-4 border-b border-gray-200">
                <div class="flex justify-between items-center">
                    <h3 class="text-xl font-semibold text-gray-900">Buat Surat Jalan</h3>
                    <button onclick="closeDeliveryModal()" class="text-gray-400 hover:text-gray-600 transition-colors">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    </button>
                </div>
            </div>

            <!-- Content -->
            <div class="max-h-[calc(90vh-140px)] overflow-y-auto">
                <form id="delivery-form" class="p-6 space-y-6">
                    <!-- Basic Info -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">No. Surat Jalan</label>
                            <input type="text" id="delivery-number" class="w-full px-3 py-2 border border-gray-300 rounded-lg bg-gray-50 font-mono text-sm" readonly>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Tanggal Kirim</label>
                            <input type="date" id="delivery-date" class="w-full px-3 py-2 border border-gray-300 rounded-lg input-focus" required>
                        </div>
                        <div class="md:col-span-2">
                            <label class="block text-sm font-medium text-gray-700 mb-2">Berdasarkan Tagihan (Opsional)</label>
                            <select id="delivery-invoice" class="w-full px-3 py-2 border border-gray-300 rounded-lg input-focus" onchange="loadInvoiceData()">
                                <option value="">Pilih Tagihan (atau isi manual)</option>
                            </select>
                        </div>
                        <div class="md:col-span-2">
                            <label class="block text-sm font-medium text-gray-700 mb-2">Pelanggan</label>
                            <select id="delivery-customer" class="w-full px-3 py-2 border border-gray-300 rounded-lg input-focus" onchange="updateDeliveryAddress()" required>
                                <option value="">Pilih Pelanggan</option>
                            </select>
                        </div>
                    </div>

                    <!-- Delivery Address -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Alamat Tujuan</label>
                        <textarea id="delivery-address" rows="3" class="w-full px-3 py-2 border border-gray-300 rounded-lg input-focus resize-none" placeholder="Masukkan alamat lengkap pengiriman..." required></textarea>
                    </div>

                    <!-- Items -->
                    <div class="border border-gray-200 rounded-lg p-4">
                        <div class="flex justify-between items-center mb-4">
                            <h4 class="font-medium text-gray-900">Barang yang Dikirim</h4>
                            <div id="invoice-reference" class="text-sm text-blue-600 hidden">
                                📋 Dari Tagihan: <span id="selected-invoice-number"></span>
                            </div>
                        </div>
                        <textarea id="delivery-items" rows="4" class="w-full px-3 py-2 border border-gray-300 rounded-lg input-focus resize-none" placeholder="Contoh:&#10;- Banner 2x3m (2 pcs)&#10;- Stiker A4 (100 pcs)&#10;- Brosur A4 (500 pcs)" required></textarea>
                        <div class="mt-2 text-xs text-gray-500">
                            💡 Tip: Pilih tagihan di atas untuk otomatis mengisi item dari pesanan
                        </div>
                    </div>

                    <!-- Notes -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Catatan Pengiriman (Opsional)</label>
                        <textarea id="delivery-notes" rows="2" class="w-full px-3 py-2 border border-gray-300 rounded-lg input-focus resize-none" placeholder="Catatan khusus untuk pengiriman..."></textarea>
                    </div>
                </form>
            </div>

            <!-- Footer -->
            <div class="px-6 py-4 bg-gray-50 border-t border-gray-200 flex justify-end space-x-3">
                <button type="button" onclick="closeDeliveryModal()" class="px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-100 transition-colors">
                    Batal
                </button>
                <button type="submit" form="delivery-form" class="btn-primary text-white px-6 py-2 rounded-lg font-medium">
                    Buat Surat Jalan
                </button>
            </div>
        </div>
    </div>

    <!-- Price Modal -->
    <div id="price-modal" class="fixed inset-0 modal-backdrop hidden items-center justify-center z-50">
        <div class="modal-content rounded-2xl p-8 max-w-md w-full mx-4">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-xl font-bold text-gray-900" id="price-modal-title">Tambah Jenis Cetakan</h3>
                <button onclick="closePriceModal()" class="text-gray-500 hover:text-gray-700">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>
            
            <form id="price-form" class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Nama Jenis Cetakan</label>
                    <input type="text" id="price-name" class="w-full px-4 py-3 border border-gray-300 rounded-xl input-focus transition-all duration-300" required>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Jenis Satuan</label>
                    <select id="price-unit" class="w-full px-4 py-3 border border-gray-300 rounded-xl input-focus transition-all duration-300" required>
                        <option value="">Pilih Satuan</option>
                        <option value="Per Meter">Per Meter</option>
                        <option value="Per Pcs">Per Pcs</option>
                        <option value="Per Lembar">Per Lembar</option>
                    </select>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Harga Harian (Rp)</label>
                    <input type="number" id="price-daily" class="w-full px-4 py-3 border border-gray-300 rounded-xl input-focus transition-all duration-300" min="0" required>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Harga Tagihan (Rp)</label>
                    <input type="number" id="price-billing" class="w-full px-4 py-3 border border-gray-300 rounded-xl input-focus transition-all duration-300" min="0" required>
                </div>
                
                <div class="flex space-x-4 pt-4">
                    <button type="button" onclick="closePriceModal()" class="flex-1 px-4 py-3 border border-gray-300 text-gray-700 rounded-xl hover:bg-gray-50 transition-all duration-300">
                        Batal
                    </button>
                    <button type="submit" class="flex-1 btn-primary text-white py-3 rounded-xl font-semibold">
                        Simpan
                    </button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // Data Storage with Persistence
        let printPrices = {};
        let customers = [];
        let transactions = [];
        let deliveries = [];
        let invoices = [];
        let invoiceCounter = 1;
        let transactionCounter = 1;
        let deliveryCounter = 1;

        // Default data for first-time users
        const defaultData = {
            printPrices: {
                'Banner/Spanduk': { unit: 'Per Meter', dailyPrice: 75000, billingPrice: 80000 },
                'Stiker': { unit: 'Per Meter', dailyPrice: 25000, billingPrice: 30000 },
                'Albatros': { unit: 'Per Meter', dailyPrice: 45000, billingPrice: 50000 },
                'Oneway': { unit: 'Per Meter', dailyPrice: 35000, billingPrice: 40000 },
                'Brosur A4 (HVS)': { unit: 'Per Lembar', dailyPrice: 500, billingPrice: 750 },
                'Brosur A4 (Ap120gr)': { unit: 'Per Lembar', dailyPrice: 750, billingPrice: 1000 },
                'Poster A3': { unit: 'Per Lembar', dailyPrice: 15000, billingPrice: 18000 },
                'Stempel': { unit: 'Per Pcs', dailyPrice: 35000, billingPrice: 40000 },
                'Id Card': { unit: 'Per Pcs', dailyPrice: 8000, billingPrice: 10000 },
                'Kartu Nama': { unit: 'Per Pcs', dailyPrice: 500, billingPrice: 750 }
            },
            customers: [
                {
                    id: 1,
                    name: 'Budi Santoso',
                    email: 'budi@email.com',
                    phone: '081234567890',
                    address: 'Royal Sentraland BTP, Blok RD/15',
                    totalTransactions: 3
                },
                {
                    id: 2,
                    name: 'Siti Rahayu',
                    email: 'siti@email.com',
                    phone: '081234567891',
                    address: 'Royal Sentraland BTP, Blok RC/20',
                    totalTransactions: 2
                },
                {
                    id: 3,
                    name: 'Ahmad Wijaya',
                    email: 'ahmad@email.com',
                    phone: '081234567892',
                    address: 'Royal Sentraland BTP, Blok RA/10',
                    totalTransactions: 1
                }
            ],
            transactions: [
                {
                    id: 1,
                    invoiceNumber: 'TXN-001',
                    date: '2024-01-15',
                    time: '10:30',
                    customer: 'Budi Santoso',
                    service: 'Banner/Spanduk',
                    quantity: 2,
                    total: 150000,
                    status: 'Selesai',
                    description: 'Cetak Banner 2x3m',
                    type: 'daily'
                },
                {
                    id: 2,
                    invoiceNumber: 'TXN-002',
                    date: '2024-01-16',
                    time: '14:15',
                    customer: 'Siti Rahayu',
                    service: 'Stiker',
                    quantity: 5,
                    total: 125000,
                    status: 'Selesai',
                    description: 'Stiker promosi',
                    type: 'daily'
                }
            ],
            deliveries: [
                {
                    id: 1,
                    deliveryNumber: 'SJ-001',
                    date: '2024-01-15',
                    customer: 'Budi Santoso',
                    address: 'Royal Sentraland BTP, Blok RD/15',
                    items: 'Banner 2x3m (2 pcs)',
                    status: 'Terkirim',
                    notes: 'Pengiriman sesuai jadwal',
                    invoiceRef: 'INV-001'
                }
            ],
            invoices: [
                {
                    id: 1,
                    invoiceNumber: 'INV-001',
                    date: '2024-01-15',
                    dueDate: '2024-01-30',
                    customer: 'Budi Santoso',
                    items: [
                        {
                            description: 'Banner/Spanduk',
                            quantity: 2,
                            unit: 'Per Meter',
                            price: 75000,
                            total: 150000
                        }
                    ],
                    subtotal: 150000,
                    tax: 16500,
                    total: 166500,
                    status: 'Belum Dibayar',
                    notes: 'Banner promosi untuk acara'
                }
            ],
            counters: {
                invoiceCounter: 2,
                transactionCounter: 3,
                deliveryCounter: 2
            }
        };

        // Data Persistence Functions
        function saveAllData() {
            try {
                const dataToSave = {
                    printPrices: printPrices,
                    customers: customers,
                    transactions: transactions,
                    deliveries: deliveries,
                    invoices: invoices,
                    counters: {
                        invoiceCounter: invoiceCounter,
                        transactionCounter: transactionCounter,
                        deliveryCounter: deliveryCounter
                    },
                    lastSaved: new Date().toISOString()
                };
                
                localStorage.setItem('fpDigitalPrintingData', JSON.stringify(dataToSave));
                console.log('✅ Data berhasil disimpan:', new Date().toLocaleString('id-ID'));
            } catch (error) {
                console.error('❌ Error menyimpan data:', error);
                alert('⚠️ Gagal menyimpan data ke penyimpanan lokal. Pastikan browser mendukung localStorage.');
            }
        }

        function loadAllData() {
            try {
                const savedData = localStorage.getItem('fpDigitalPrintingData');
                
                if (savedData) {
                    const parsedData = JSON.parse(savedData);
                    
                    // Load all data arrays
                    printPrices = parsedData.printPrices || defaultData.printPrices;
                    customers = parsedData.customers || defaultData.customers;
                    transactions = parsedData.transactions || defaultData.transactions;
                    deliveries = parsedData.deliveries || defaultData.deliveries;
                    invoices = parsedData.invoices || defaultData.invoices;
                    
                    // Load counters
                    if (parsedData.counters) {
                        invoiceCounter = parsedData.counters.invoiceCounter || 1;
                        transactionCounter = parsedData.counters.transactionCounter || 1;
                        deliveryCounter = parsedData.counters.deliveryCounter || 1;
                    }
                    
                    console.log('✅ Data berhasil dimuat dari penyimpanan:', parsedData.lastSaved || 'Unknown');
                    return true;
                } else {
                    // First time user - load default data
                    printPrices = {...defaultData.printPrices};
                    customers = [...defaultData.customers];
                    transactions = [...defaultData.transactions];
                    deliveries = [...defaultData.deliveries];
                    invoices = [...defaultData.invoices];
                    invoiceCounter = defaultData.counters.invoiceCounter;
                    transactionCounter = defaultData.counters.transactionCounter;
                    deliveryCounter = defaultData.counters.deliveryCounter;
                    
                    // Save default data
                    saveAllData();
                    console.log('✅ Data default dimuat untuk pengguna baru');
                    return false;
                }
            } catch (error) {
                console.error('❌ Error memuat data:', error);
                // Fallback to default data
                printPrices = {...defaultData.printPrices};
                customers = [...defaultData.customers];
                transactions = [...defaultData.transactions];
                deliveries = [...defaultData.deliveries];
                invoices = [...defaultData.invoices];
                invoiceCounter = defaultData.counters.invoiceCounter;
                transactionCounter = defaultData.counters.transactionCounter;
                deliveryCounter = defaultData.counters.deliveryCounter;
                
                alert('⚠️ Terjadi kesalahan saat memuat data. Menggunakan data default.');
                return false;
            }
        }

        function exportAllData() {
            try {
                const exportData = {
                    printPrices: printPrices,
                    customers: customers,
                    transactions: transactions,
                    deliveries: deliveries,
                    invoices: invoices,
                    counters: {
                        invoiceCounter: invoiceCounter,
                        transactionCounter: transactionCounter,
                        deliveryCounter: deliveryCounter
                    },
                    exportDate: new Date().toISOString(),
                    version: '1.0'
                };
                
                const dataStr = JSON.stringify(exportData, null, 2);
                const dataBlob = new Blob([dataStr], { type: 'application/json' });
                
                const link = document.createElement('a');
                link.href = URL.createObjectURL(dataBlob);
                link.download = `fp-digital-backup-${new Date().toISOString().split('T')[0]}.json`;
                link.click();
                
                alert(`✅ Backup data berhasil diunduh!\n\nFile: fp-digital-backup-${new Date().toISOString().split('T')[0]}.json\n\nSimpan file ini di tempat yang aman untuk restore data di kemudian hari.`);
            } catch (error) {
                console.error('❌ Error export data:', error);
                alert('❌ Gagal mengekspor data. Silakan coba lagi.');
            }
        }

        function importAllData(file) {
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const importedData = JSON.parse(e.target.result);
                    
                    // Validate imported data structure
                    if (!importedData.printPrices || !importedData.customers || !importedData.transactions) {
                        throw new Error('Format file backup tidak valid');
                    }
                    
                    // Confirm import
                    const confirmMessage = `🔄 IMPORT DATA BACKUP\n\nFile: ${file.name}\nTanggal Export: ${importedData.exportDate ? new Date(importedData.exportDate).toLocaleString('id-ID') : 'Unknown'}\nVersi: ${importedData.version || 'Unknown'}\n\nData yang akan diimport:\n• ${Object.keys(importedData.printPrices || {}).length} jenis cetakan\n• ${(importedData.customers || []).length} pelanggan\n• ${(importedData.transactions || []).length} transaksi\n• ${(importedData.invoices || []).length} tagihan\n• ${(importedData.deliveries || []).length} surat jalan\n\n⚠️ PERINGATAN: Data saat ini akan diganti dengan data backup!\n\nApakah Anda yakin ingin melanjutkan?`;
                    
                    if (confirm(confirmMessage)) {
                        // Import all data
                        printPrices = importedData.printPrices || {};
                        customers = importedData.customers || [];
                        transactions = importedData.transactions || [];
                        deliveries = importedData.deliveries || [];
                        invoices = importedData.invoices || [];
                        
                        // Import counters
                        if (importedData.counters) {
                            invoiceCounter = importedData.counters.invoiceCounter || 1;
                            transactionCounter = importedData.counters.transactionCounter || 1;
                            deliveryCounter = importedData.counters.deliveryCounter || 1;
                        }
                        
                        // Save imported data
                        saveAllData();
                        
                        // Refresh all displays
                        updateDashboardStats();
                        renderCustomers();
                        updateCustomerStats();
                        renderPriceCards();
                        renderInvoices();
                        updateInvoiceStats();
                        updateDailyTransactionStats();
                        renderDailyTransactions();
                        renderDeliveries();
                        updateDeliveryStats();
                        
                        alert(`✅ Data berhasil diimport!\n\nSemua data telah diganti dengan data dari backup.\nSilakan periksa semua tab untuk memastikan data sudah benar.`);
                    }
                } catch (error) {
                    console.error('❌ Error import data:', error);
                    alert(`❌ Gagal mengimport data!\n\nError: ${error.message}\n\nPastikan file backup valid dan tidak rusak.`);
                }
            };
            reader.readAsText(file);
        }

        function resetAllData() {
            if (confirm('🔄 RESET SEMUA DATA\n\n⚠️ PERINGATAN KERAS!\nSemua data akan dihapus dan dikembalikan ke pengaturan awal:\n\n• Semua pelanggan akan dihapus\n• Semua transaksi akan dihapus\n• Semua tagihan akan dihapus\n• Semua surat jalan akan dihapus\n• Harga cetakan dikembalikan ke default\n• Pengaturan perusahaan direset\n\nData yang dihapus TIDAK DAPAT dikembalikan!\n\nApakah Anda BENAR-BENAR yakin?')) {
                if (confirm('⚠️ KONFIRMASI TERAKHIR!\n\nIni adalah peringatan terakhir!\nSemua data akan HILANG PERMANEN!\n\nKetik "RESET" di kotak dialog berikutnya untuk melanjutkan.')) {
                    const confirmation = prompt('Ketik "RESET" (huruf besar) untuk mengkonfirmasi penghapusan semua data:');
                    
                    if (confirmation === 'RESET') {
                        // Only clear business data, keep login session if active
                        localStorage.removeItem('fpDigitalPrintingData');
                        localStorage.removeItem('companySettings');
                        
                        // Reset to default data
                        printPrices = {...defaultData.printPrices};
                        customers = [...defaultData.customers];
                        transactions = [...defaultData.transactions];
                        deliveries = [...defaultData.deliveries];
                        invoices = [...defaultData.invoices];
                        invoiceCounter = defaultData.counters.invoiceCounter;
                        transactionCounter = defaultData.counters.transactionCounter;
                        deliveryCounter = defaultData.counters.deliveryCounter;
                        
                        // Reset company settings
                        companySettings = {
                            name: 'FP DIGITAL PRINTING',
                            tagline: 'Professional Printing Services',
                            address: 'Royal Sentraland BTP, Blok RD/15\nTelepon: (021) 1234-5678\nEmail: info@fpdigitalprinting.com',
                            logo: 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgdmlld0JveD0iMCAwIDEwMCAxMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi0vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIxMDAiIGhlaWdodD0iMTAwIiByeD0iMjAiIGZpbGw9InVybCgjZ3JhZGllbnQwX2xpbmVhcl8xXzEpIi8+CjxkZWZzPgo8bGluZWFyR3JhZGllbnQgaWQ9ImdyYWRpZW50MF9saW5lYXJfMV8xIiB4MT0iMCIgeTE9IjAiIHgyPSIxMDAiIHkyPSIxMDAiIGdyYWRpZW50VW5pdHM9InVzZXJTcGFjZU9uVXNlIj4KPHN0b3Agc3RvcC1jb2xvcj0iIzY2N0VFQSIvPgo8c3RvcCBvZmZzZXQ9IjEiIHN0b3AtY29sb3I9IiM3NjRCQTIiLz4KPC9saW5lYXJHcmFkaWVudD4KPC9kZWZzPgo8dGV4dCB4PSI1MCIgeT0iNjAiIGZvbnQtZmFtaWx5PSJBcmlhbCwgc2Fucy1zZXJpZiIgZm9udC1zaXplPSI0MCIgZm9udC13ZWlnaHQ9ImJvbGQiIGZpbGw9IndoaXRlIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIj5GUDwvdGV4dD4KPC9zdmc+'
                        };
                        
                        // Save default data
                        saveAllData();
                        localStorage.setItem('companySettings', JSON.stringify(companySettings));
                        
                        // Refresh all displays
                        updateDashboardStats();
                        renderCustomers();
                        updateCustomerStats();
                        renderPriceCards();
                        renderInvoices();
                        updateInvoiceStats();
                        updateDailyTransactionStats();
                        renderDailyTransactions();
                        renderDeliveries();
                        updateDeliveryStats();
                        loadCompanySettings();
                        updateSidebarLogo();
                        updateLoginPageLogo();
                        
                        alert('✅ RESET BERHASIL!\n\nSemua data telah dikembalikan ke pengaturan awal.\nSistem siap digunakan dengan data default.\nSession login tetap aktif.');
                    } else {
                        alert('❌ Reset dibatalkan.\n\nKonfirmasi tidak sesuai. Data Anda tetap aman.');
                    }
                }
            }
        }

        // Company Settings
        let companySettings = {
            name: 'FP DIGITAL PRINTING',
            tagline: 'Professional Printing Services',
            address: 'Royal Sentraland BTP, Blok RD/15\nTelepon: 0877 8811 2438\nEmail: fpdigital13@gmail.com',
            logo: 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgdmlld0JveD0iMCAwIDEwMCAxMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIxMDAiIGhlaWdodD0iMTAwIiByeD0iMjAiIGZpbGw9InVybCgjZ3JhZGllbnQwX2xpbmVhcl8xXzEpIi8+CjxkZWZzPgo8bGluZWFyR3JhZGllbnQgaWQ9ImdyYWRpZW50MF9saW5lYXJfMV8xIiB4MT0iMCIgeTE9IjAiIHgyPSIxMDAiIHkyPSIxMDAiIGdyYWRpZW50VW5pdHM9InVzZXJTcGFjZU9uVXNlIj4KPHN0b3Agc3RvcC1jb2xvcj0iIzY2N0VFQSIvPgo8c3RvcCBvZmZzZXQ9IjEiIHN0b3AtY29sb3I9IiM3NjRCQTIiLz4KPC9saW5lYXJHcmFkaWVudD4KPC9kZWZzPgo8dGV4dCB4PSI1MCIgeT0iNjAiIGZvbnQtZmFtaWx5PSJBcmlhbCwgc2Fucy1zZXJpZiIgZm9udC1zaXplPSI0MCIgZm9udC13ZWlnaHQ9ImJvbGQiIGZpbGw9IndoaXRlIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIj5GUDwvdGV4dD4KPC9zdmc+'
        };

        // Tab Management
        function showTab(tabName) {
            // Hide all content
            const contents = ['dashboard', 'transaksi-harian', 'tagihan', 'surat-jalan', 'laporan', 'pelanggan', 'harga', 'pengaturan'];
            contents.forEach(content => {
                document.getElementById(`content-${content}`).classList.add('hidden');
                document.getElementById(`tab-${content}`).classList.remove('active-tab');
            });

            // Show selected content
            document.getElementById(`content-${tabName}`).classList.remove('hidden');
            document.getElementById(`tab-${tabName}`).classList.add('active-tab');

            // Update header
            const titles = {
                dashboard: { title: 'Dashboard', subtitle: 'Ringkasan aktivitas bisnis Anda' },
                'transaksi-harian': { title: 'Transaksi Harian', subtitle: 'Ringkasan transaksi per hari' },
                tagihan: { title: 'Tagihan', subtitle: 'Kelola tagihan dan pembayaran' },
                'surat-jalan': { title: 'Surat Jalan', subtitle: 'Kelola pengiriman dan surat jalan' },
                laporan: { title: 'Laporan', subtitle: 'Analisis performa bisnis Anda' },
                pelanggan: { title: 'Pelanggan', subtitle: 'Kelola informasi pelanggan' },
                harga: { title: 'Daftar Harga', subtitle: 'Kelola harga untuk setiap jenis cetakan' },
                pengaturan: { title: 'Pengaturan', subtitle: 'Kelola informasi dan logo perusahaan' }
            };

            document.getElementById('page-title').textContent = titles[tabName].title;
            document.getElementById('page-subtitle').textContent = titles[tabName].subtitle;

            // Refresh data when switching tabs
            if (tabName === 'pelanggan') {
                renderCustomers();
                updateCustomerStats();
                filterCustomers();
            } else if (tabName === 'dashboard') {
                updateDashboardStats();
            } else if (tabName === 'harga') {
                renderPriceCards();
            } else if (tabName === 'pengaturan') {
                loadCompanySettings();
            } else if (tabName === 'tagihan') {
                renderInvoices();
                updateInvoiceStats();
                updateDailyTransactionStats();
                renderDailyTransactions();
                renderDeliveries();
                updateDeliveryStats();
            } else if (tabName === 'transaksi-harian') {
                updateDailyTransactionStats();
                renderDailyTransactions();
                // Set today's date as default
                const today = new Date().toISOString().split('T')[0];
                document.getElementById('daily-date').value = today;
            } else if (tabName === 'surat-jalan') {
                renderDeliveries();
                updateDeliveryStats();
            }
        }

        // Customer Management
        function openCustomerModal(editId = null) {
            const modal = document.getElementById('customer-modal');
            const title = modal.querySelector('h3');
            const form = document.getElementById('customer-form');
            
            if (editId) {
                const customer = customers.find(c => c.id === editId);
                if (customer) {
                    title.textContent = 'Edit Pelanggan';
                    document.getElementById('customer-fullname').value = customer.name;
                    document.getElementById('customer-email').value = customer.email;
                    document.getElementById('customer-phone').value = customer.phone;
                    form.setAttribute('data-edit-id', editId);
                }
            } else {
                title.textContent = 'Tambah Pelanggan Baru';
                form.reset();
                form.removeAttribute('data-edit-id');
            }
            
            modal.classList.remove('hidden');
            modal.classList.add('flex');
        }

        function closeCustomerModal() {
            document.getElementById('customer-modal').classList.add('hidden');
            document.getElementById('customer-modal').classList.remove('flex');
            document.getElementById('customer-form').reset();
            document.getElementById('customer-form').removeAttribute('data-edit-id');
        }

        function addCustomer(name, email, phone) {
            const form = document.getElementById('customer-form');
            const editId = form.getAttribute('data-edit-id');
            
            if (editId) {
                // Edit existing customer
                const customer = customers.find(c => c.id === parseInt(editId));
                if (customer) {
                    customer.name = name;
                    customer.email = email;
                    customer.phone = phone;
                    
                    alert(`✅ Data pelanggan berhasil diperbarui!\n\nNama: ${name}\nEmail: ${email}\nTelepon: ${phone}`);
                }
            } else {
                // Add new customer
                const newCustomer = {
                    id: customers.length + 1,
                    name: name,
                    email: email,
                    phone: phone,
                    address: `Alamat ${name}`,
                    totalTransactions: 0
                };

                customers.push(newCustomer);
                alert(`✅ Pelanggan baru berhasil ditambahkan!\n\nNama: ${name}\nEmail: ${email}\nTelepon: ${phone}`);
            }

            saveAllData(); // Auto-save
            renderCustomers();
            updateDashboardStats();
            closeCustomerModal();
        }

        function renderCustomers() {
            const tbody = document.getElementById('customers-table');
            tbody.innerHTML = '';

            if (customers.length === 0) {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td colspan="6" class="py-12 px-4 text-center text-gray-500">
                        <div class="flex flex-col items-center">
                            <svg class="w-16 h-16 text-gray-300 mb-4" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 6a3 3 0 11-6 0 3 3 0 016 0zM17 6a3 3 0 11-6 0 3 3 0 016 0zM12.93 17c.046-.327.07-.66.07-1a6.97 6.97 0 00-1.5-4.33A5 5 0 0119 16v1h-6.07zM6 11a5 5 0 015 5v1H1v-1a5 5 0 015-5z"></path>
                            </svg>
                            <p class="text-lg font-medium text-gray-600 mb-2">Belum ada pelanggan</p>
                            <p class="text-sm text-gray-500">Klik "Tambah Pelanggan" untuk menambah pelanggan pertama</p>
                        </div>
                    </td>
                `;
                tbody.appendChild(row);
                return;
            }

            customers.forEach(customer => {
                const row = document.createElement('tr');
                row.className = 'table-row transition-all duration-300';
                
                // Calculate customer stats
                const customerTransactions = transactions.filter(t => t.customer === customer.name);
                const totalSpent = customerTransactions.reduce((sum, t) => sum + t.total, 0);
                const lastTransaction = customerTransactions.length > 0 ? 
                    customerTransactions[customerTransactions.length - 1].date : 'Belum ada';
                
                // Determine customer status
                let statusBadge = '';
                let statusClass = '';
                if (customer.totalTransactions > 5) {
                    statusBadge = 'VIP';
                    statusClass = 'bg-purple-100 text-purple-800';
                } else if (customer.totalTransactions > 2) {
                    statusBadge = 'Aktif';
                    statusClass = 'bg-green-100 text-green-800';
                } else {
                    statusBadge = 'Baru';
                    statusClass = 'bg-blue-100 text-blue-800';
                }
                
                row.innerHTML = `
                    <td class="py-3 px-4">
                        <div class="flex items-center space-x-3">
                            <div class="w-8 h-8 gradient-bg rounded-full flex items-center justify-center">
                                <span class="text-white font-semibold text-xs">${customer.name.charAt(0).toUpperCase()}</span>
                            </div>
                            <span class="text-gray-600 font-mono">#${String(customer.id).padStart(3, '0')}</span>
                        </div>
                    </td>
                    <td class="py-3 px-4">
                        <div>
                            <div class="text-gray-900 font-medium">${customer.name}</div>
                            <div class="flex items-center space-x-2 mt-1">
                                <span class="px-2 py-1 ${statusClass} rounded-full text-xs font-medium">${statusBadge}</span>
                            </div>
                        </div>
                    </td>
                    <td class="py-3 px-4">
                        <div class="text-gray-600">${customer.email}</div>
                        <div class="text-xs text-gray-500">📧 Email kontak</div>
                    </td>
                    <td class="py-3 px-4">
                        <div class="text-gray-600">${customer.phone}</div>
                        <div class="text-xs text-gray-500">Terakhir: ${lastTransaction}</div>
                    </td>
                    <td class="py-3 px-4">
                        <div class="text-center">
                            <div class="text-gray-900 font-semibold">${customer.totalTransactions}</div>
                            <div class="text-xs text-blue-600">Rp ${totalSpent.toLocaleString('id-ID')}</div>
                        </div>
                    </td>
                    <td class="py-3 px-4">
                        <div class="flex space-x-2">
                            <button onclick="viewCustomerDetails(${customer.id})" class="text-purple-600 hover:text-purple-800 font-medium text-sm px-2 py-1 rounded hover:bg-purple-50 transition-all duration-300" title="Lihat Detail">
                                👁️
                            </button>
                            <button onclick="editCustomer(${customer.id})" class="text-blue-600 hover:text-blue-800 font-medium text-sm px-2 py-1 rounded hover:bg-blue-50 transition-all duration-300" title="Edit">
                                ✏️
                            </button>
                            <button onclick="deleteCustomer(${customer.id})" class="text-red-600 hover:text-red-800 font-medium text-sm px-2 py-1 rounded hover:bg-red-50 transition-all duration-300" title="Hapus">
                                🗑️
                            </button>
                        </div>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        function editCustomer(id) {
            openCustomerModal(id);
        }

        function viewCustomerDetails(id) {
            const customer = customers.find(c => c.id === id);
            if (!customer) return;
            
            const customerTransactions = transactions.filter(t => t.customer === customer.name);
            const totalSpent = customerTransactions.reduce((sum, t) => sum + t.total, 0);
            const avgTransaction = customerTransactions.length > 0 ? totalSpent / customerTransactions.length : 0;
            
            alert(`📊 DETAIL PELANGGAN\n\n👤 ${customer.name}\n📧 ${customer.email}\n📱 ${customer.phone}\n\n💰 STATISTIK:\n• Total Transaksi: ${customer.totalTransactions}\n• Total Belanja: Rp ${totalSpent.toLocaleString('id-ID')}\n• Rata-rata: Rp ${Math.round(avgTransaction).toLocaleString('id-ID')}\n\n📈 STATUS: ${customer.totalTransactions > 5 ? 'Pelanggan VIP' : customer.totalTransactions > 2 ? 'Pelanggan Setia' : 'Pelanggan Baru'}`);
        }

        function deleteCustomer(id) {
            const customer = customers.find(c => c.id === id);
            if (!customer) return;
            
            const customerTransactions = transactions.filter(t => t.customer === customer.name);
            
            let confirmMessage = `Apakah Anda yakin ingin menghapus pelanggan "${customer.name}"?`;
            
            if (customerTransactions.length > 0) {
                confirmMessage += `\n\n⚠️ PERINGATAN: Pelanggan ini memiliki ${customerTransactions.length} transaksi.\nData transaksi akan tetap ada, tetapi referensi pelanggan akan hilang.`;
            }
            
            if (confirm(confirmMessage)) {
                customers = customers.filter(c => c.id !== id);
                saveAllData(); // Auto-save
                renderCustomers();
                updateDashboardStats();
                updateCustomerStats();
                
                alert(`✅ Pelanggan "${customer.name}" berhasil dihapus dari sistem.`);
            }
        }

        // Customer Filter and Search Functions
        function filterCustomers() {
            const searchTerm = document.getElementById('customer-search').value.toLowerCase().trim();
            const filterType = document.getElementById('customer-filter').value;
            const sortType = document.getElementById('customer-sort').value;
            
            let filteredCustomers = [...customers];
            
            // Apply search filter
            if (searchTerm) {
                filteredCustomers = filteredCustomers.filter(customer => 
                    customer.name.toLowerCase().includes(searchTerm) ||
                    customer.email.toLowerCase().includes(searchTerm) ||
                    customer.phone.includes(searchTerm)
                );
            }
            
            // Apply category filter
            if (filterType !== 'all') {
                filteredCustomers = filteredCustomers.filter(customer => {
                    switch (filterType) {
                        case 'active':
                            return customer.totalTransactions > 2;
                        case 'vip':
                            return customer.totalTransactions > 5;
                        case 'new':
                            return customer.totalTransactions <= 2;
                        default:
                            return true;
                    }
                });
            }
            
            // Apply sorting
            filteredCustomers.sort((a, b) => {
                switch (sortType) {
                    case 'name':
                        return a.name.localeCompare(b.name);
                    case 'name-desc':
                        return b.name.localeCompare(a.name);
                    case 'transactions':
                        return b.totalTransactions - a.totalTransactions;
                    case 'spending':
                        const aSpending = transactions.filter(t => t.customer === a.name).reduce((sum, t) => sum + t.total, 0);
                        const bSpending = transactions.filter(t => t.customer === b.name).reduce((sum, t) => sum + t.total, 0);
                        return bSpending - aSpending;
                    case 'recent':
                        return b.id - a.id;
                    default:
                        return 0;
                }
            });
            
            renderFilteredCustomers(filteredCustomers);
            updateCustomerCounts(filteredCustomers);
        }

        function renderFilteredCustomers(filteredCustomers) {
            const tbody = document.getElementById('customers-table');
            tbody.innerHTML = '';

            if (filteredCustomers.length === 0) {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td colspan="6" class="py-12 px-4 text-center text-gray-500">
                        <div class="flex flex-col items-center">
                            <svg class="w-16 h-16 text-gray-300 mb-4" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z" clip-rule="evenodd"></path>
                            </svg>
                            <p class="text-lg font-medium text-gray-600 mb-2">Tidak ada pelanggan ditemukan</p>
                            <p class="text-sm text-gray-500">Coba ubah kriteria pencarian atau filter</p>
                        </div>
                    </td>
                `;
                tbody.appendChild(row);
                return;
            }

            filteredCustomers.forEach(customer => {
                const row = document.createElement('tr');
                row.className = 'table-row transition-all duration-300';
                
                const customerTransactions = transactions.filter(t => t.customer === customer.name);
                const totalSpent = customerTransactions.reduce((sum, t) => sum + t.total, 0);
                const lastTransaction = customerTransactions.length > 0 ? 
                    customerTransactions[customerTransactions.length - 1].date : 'Belum ada';
                
                let statusBadge = '';
                let statusClass = '';
                if (customer.totalTransactions > 5) {
                    statusBadge = 'VIP';
                    statusClass = 'bg-purple-100 text-purple-800';
                } else if (customer.totalTransactions > 2) {
                    statusBadge = 'Aktif';
                    statusClass = 'bg-green-100 text-green-800';
                } else {
                    statusBadge = 'Baru';
                    statusClass = 'bg-blue-100 text-blue-800';
                }
                
                row.innerHTML = `
                    <td class="py-3 px-4">
                        <div class="flex items-center space-x-3">
                            <div class="w-8 h-8 gradient-bg rounded-full flex items-center justify-center">
                                <span class="text-white font-semibold text-xs">${customer.name.charAt(0).toUpperCase()}</span>
                            </div>
                            <span class="text-gray-600 font-mono">#${String(customer.id).padStart(3, '0')}</span>
                        </div>
                    </td>
                    <td class="py-3 px-4">
                        <div>
                            <div class="text-gray-900 font-medium">${customer.name}</div>
                            <div class="flex items-center space-x-2 mt-1">
                                <span class="px-2 py-1 ${statusClass} rounded-full text-xs font-medium">${statusBadge}</span>
                            </div>
                        </div>
                    </td>
                    <td class="py-3 px-4">
                        <div class="text-gray-600">${customer.email}</div>
                        <div class="text-xs text-gray-500">📧 Email kontak</div>
                    </td>
                    <td class="py-3 px-4">
                        <div class="text-gray-600">${customer.phone}</div>
                        <div class="text-xs text-gray-500">Terakhir: ${lastTransaction}</div>
                    </td>
                    <td class="py-3 px-4">
                        <div class="text-center">
                            <div class="text-gray-900 font-semibold">${customer.totalTransactions}</div>
                            <div class="text-xs text-blue-600">Rp ${totalSpent.toLocaleString('id-ID')}</div>
                        </div>
                    </td>
                    <td class="py-3 px-4">
                        <div class="flex space-x-2">
                            <button onclick="viewCustomerDetails(${customer.id})" class="text-purple-600 hover:text-purple-800 font-medium text-sm px-2 py-1 rounded hover:bg-purple-50 transition-all duration-300" title="Lihat Detail">
                                👁️
                            </button>
                            <button onclick="editCustomer(${customer.id})" class="text-blue-600 hover:text-blue-800 font-medium text-sm px-2 py-1 rounded hover:bg-blue-50 transition-all duration-300" title="Edit">
                                ✏️
                            </button>
                            <button onclick="deleteCustomer(${customer.id})" class="text-red-600 hover:text-red-800 font-medium text-sm px-2 py-1 rounded hover:bg-red-50 transition-all duration-300" title="Hapus">
                                🗑️
                            </button>
                        </div>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        function updateCustomerCounts(filteredCustomers) {
            document.getElementById('customers-showing').textContent = filteredCustomers.length;
            document.getElementById('customers-total').textContent = customers.length;
        }

        function clearCustomerFilters() {
            document.getElementById('customer-search').value = '';
            document.getElementById('customer-filter').value = 'all';
            document.getElementById('customer-sort').value = 'name';
            filterCustomers();
        }

        function updateCustomerStats() {
            const totalCustomers = customers.length;
            const activeCustomers = customers.filter(c => c.totalTransactions > 2).length;
            const vipCustomers = customers.filter(c => c.totalTransactions > 5).length;
            
            let totalSpending = 0;
            let customersWithTransactions = 0;
            
            customers.forEach(customer => {
                const customerTransactions = transactions.filter(t => t.customer === customer.name);
                const customerSpending = customerTransactions.reduce((sum, t) => sum + t.total, 0);
                if (customerSpending > 0) {
                    totalSpending += customerSpending;
                    customersWithTransactions++;
                }
            });
            
            const avgSpending = customersWithTransactions > 0 ? totalSpending / customersWithTransactions : 0;
            
            document.getElementById('total-customers-count').textContent = totalCustomers;
            document.getElementById('active-customers-count').textContent = activeCustomers;
            document.getElementById('vip-customers-count').textContent = vipCustomers;
            document.getElementById('avg-customer-spending').textContent = `Rp ${Math.round(avgSpending).toLocaleString('id-ID')}`;
        }

        function exportCustomers() {
            if (customers.length === 0) {
                alert('Tidak ada data pelanggan untuk diekspor');
                return;
            }
            
            const exportData = customers.map(customer => {
                const customerTransactions = transactions.filter(t => t.customer === customer.name);
                const totalSpent = customerTransactions.reduce((sum, t) => sum + t.total, 0);
                const lastTransaction = customerTransactions.length > 0 ? 
                    customerTransactions[customerTransactions.length - 1].date : 'Belum ada';
                
                let status = 'Baru';
                if (customer.totalTransactions > 5) status = 'VIP';
                else if (customer.totalTransactions > 2) status = 'Aktif';
                
                return {
                    'ID': `#${String(customer.id).padStart(3, '0')}`,
                    'Nama': customer.name,
                    'Email': customer.email,
                    'Telepon': customer.phone,
                    'Total Transaksi': customer.totalTransactions,
                    'Total Belanja': `Rp ${totalSpent.toLocaleString('id-ID')}`,
                    'Transaksi Terakhir': lastTransaction,
                    'Status': status
                };
            });
            
            const headers = Object.keys(exportData[0]);
            const csvContent = [
                headers.join(','),
                ...exportData.map(row => 
                    headers.map(header => `"${row[header]}"`).join(',')
                )
            ].join('\n');
            
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', `data-pelanggan-${new Date().toISOString().split('T')[0]}.csv`);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            alert(`✅ Data ${customers.length} pelanggan berhasil diekspor!\n\nFile: data-pelanggan-${new Date().toISOString().split('T')[0]}.csv\nFormat: CSV (Excel Compatible)`);
        }

        // Price Management
        function renderPriceCards() {
            const container = document.getElementById('price-cards-container');
            container.innerHTML = '';

            const cardGrid = document.createElement('div');
            cardGrid.className = 'grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6';
            
            Object.entries(printPrices).forEach(([type, priceData]) => {
                const card = document.createElement('div');
                card.className = 'price-card-elegant group relative overflow-hidden';
                
                const icon = getPrintTypeIcon(type);
                
                card.innerHTML = `
                    <div class="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-blue-500 to-purple-600"></div>
                    <div class="p-6">
                        <div class="flex items-start justify-between mb-4">
                            <div class="flex items-center space-x-3">
                                <div class="w-12 h-12 gradient-bg rounded-xl flex items-center justify-center group-hover:scale-110 transition-transform duration-300">
                                    ${icon}
                                </div>
                                <div>
                                    <h3 class="text-lg font-bold text-gray-900 group-hover:text-blue-600 transition-colors duration-300">${type}</h3>
                                    <p class="text-sm text-gray-500 font-medium">${priceData.unit}</p>
                                </div>
                            </div>
                            <div class="flex space-x-2 opacity-0 group-hover:opacity-100 transition-opacity duration-300">
                                <button onclick="editPrice('${type}')" class="w-8 h-8 bg-blue-100 hover:bg-blue-200 text-blue-600 rounded-lg flex items-center justify-center transition-all duration-300 hover:scale-110">
                                    <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                                        <path d="M13.586 3.586a2 2 0 112.828 2.828l-.793.793-2.828-2.828.793-.793zM11.379 5.793L3 14.172V17h2.828l8.38-8.379-2.83-2.828z"></path>
                                    </svg>
                                </button>
                                <button onclick="deletePrice('${type}')" class="w-8 h-8 bg-red-100 hover:bg-red-200 text-red-600 rounded-lg flex items-center justify-center transition-all duration-300 hover:scale-110">
                                    <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                                        <path fill-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z" clip-rule="evenodd"></path>
                                    </svg>
                                </button>
                            </div>
                        </div>
                        
                        <div class="space-y-4">
                            <div class="price-section">
                                <div class="flex items-center justify-between mb-2">
                                    <span class="text-sm font-medium text-gray-600">Harga Harian</span>
                                    <div class="w-2 h-2 bg-blue-500 rounded-full"></div>
                                </div>
                                <div class="text-2xl font-bold text-blue-600 mb-1">
                                    Rp ${priceData.dailyPrice.toLocaleString('id-ID')}
                                </div>
                                <div class="text-xs text-gray-500">Per transaksi harian</div>
                            </div>
                            
                            <div class="border-t border-gray-100 pt-4">
                                <div class="flex items-center justify-between mb-2">
                                    <span class="text-sm font-medium text-gray-600">Harga Tagihan</span>
                                    <div class="w-2 h-2 bg-green-500 rounded-full"></div>
                                </div>
                                <div class="text-2xl font-bold text-green-600 mb-1">
                                    Rp ${priceData.billingPrice.toLocaleString('id-ID')}
                                </div>
                                <div class="text-xs text-gray-500">Per tagihan resmi</div>
                            </div>
                        </div>
                        
                        <div class="mt-6 pt-4 border-t border-gray-100">
                            <div class="flex items-center justify-between text-xs text-gray-500">
                                <span>Satuan: ${priceData.unit}</span>
                                <span class="flex items-center space-x-1">
                                    <div class="w-1 h-1 bg-gray-400 rounded-full"></div>
                                    <div class="w-1 h-1 bg-gray-400 rounded-full"></div>
                                    <div class="w-1 h-1 bg-gray-400 rounded-full"></div>
                                </span>
                            </div>
                        </div>
                    </div>
                `;
                
                cardGrid.appendChild(card);
            });
            
            container.appendChild(cardGrid);
        }

        function getPrintTypeIcon(type) {
            const icons = {
                'Banner/Spanduk': '<svg class="w-6 h-6 text-white" fill="currentColor" viewBox="0 0 20 20"><path d="M4 3a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V5a2 2 0 00-2-2H4zm12 12H4l4-8 3 6 2-4 3 6z"></path></svg>',
                'Stiker': '<svg class="w-6 h-6 text-white" fill="currentColor" viewBox="0 0 20 20"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"></path></svg>',
                'Albatros': '<svg class="w-6 h-6 text-white" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M3 4a1 1 0 011-1h12a1 1 0 011 1v2a1 1 0 01-1 1H4a1 1 0 01-1-1V4zm0 4a1 1 0 011-1h12a1 1 0 011 1v2a1 1 0 01-1 1H4a1 1 0 01-1-1V8zm0 4a1 1 0 011-1h12a1 1 0 011 1v2a1 1 0 01-1 1H4a1 1 0 01-1-1v-2z" clip-rule="evenodd"></path></svg>',
                'Oneway': '<svg class="w-6 h-6 text-white" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-8.293l-3-3a1 1 0 00-1.414 1.414L10.586 9H7a1 1 0 100 2h3.586l-1.293 1.293a1 1 0 101.414 1.414l3-3a1 1 0 000-1.414z" clip-rule="evenodd"></path></svg>',
                'Brosur A4 (HVS)': '<svg class="w-6 h-6 text-white" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M4 4a2 2 0 012-2h4.586A2 2 0 0112 2.586L15.414 6A2 2 0 0116 7.414V16a2 2 0 01-2 2H6a2 2 0 01-2-2V4z" clip-rule="evenodd"></path></svg>',
                'Brosur A4 (Ap120gr)': '<svg class="w-6 h-6 text-white" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M4 4a2 2 0 012-2h4.586A2 2 0 0112 2.586L15.414 6A2 2 0 0116 7.414V16a2 2 0 01-2 2H6a2 2 0 01-2-2V4zm2 6a1 1 0 011-1h6a1 1 0 110 2H7a1 1 0 01-1-1zm1 3a1 1 0 100 2h6a1 1 0 100-2H7z" clip-rule="evenodd"></path></svg>',
                'Poster A3': '<svg class="w-6 h-6 text-white" fill="currentColor" viewBox="0 0 20 20"><path d="M4 3a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V5a2 2 0 00-2-2H4zm12 12H4l4-8 3 6 2-4 3 6z"></path></svg>',
                'Stempel': '<svg class="w-6 h-6 text-white" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 2a4 4 0 00-4 4v1H5a1 1 0 00-.994.89l-1 9A1 1 0 004 18h12a1 1 0 00.994-1.11l-1-9A1 1 0 0015 7h-1V6a4 4 0 00-4-4zm2 5V6a2 2 0 10-4 0v1h4zm-6 3a1 1 0 112 0 1 1 0 01-2 0zm7-1a1 1 0 100 2 1 1 0 000-2z" clip-rule="evenodd"></path></svg>',
                'Id Card': '<svg class="w-6 h-6 text-white" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 2a4 4 0 00-4 4v1H5a1 1 0 00-.994.89l-1 9A1 1 0 004 18h12a1 1 0 00.994-1.11l-1-9A1 1 0 0015 7h-1V6a4 4 0 00-4-4zm2 5V6a2 2 0 10-4 0v1h4zm-6 3a1 1 0 112 0 1 1 0 01-2 0zm7-1a1 1 0 100 2 1 1 0 000-2z" clip-rule="evenodd"></path></svg>',
                'Kartu Nama': '<svg class="w-6 h-6 text-white" fill="currentColor" viewBox="0 0 20 20"><path d="M4 4a2 2 0 00-2 2v8a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2H4zm2 6a1 1 0 011-1h6a1 1 0 110 2H7a1 1 0 01-1-1zm1 3a1 1 0 100 2h6a1 1 0 100-2H7z"></path></svg>'
            };
            
            return icons[type] || '<svg class="w-6 h-6 text-white" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M4 2a2 2 0 00-2 2v12a2 2 0 002 2h12a2 2 0 002-2V4a2 2 0 00-2-2H4zm3 2h6v4H7V4zm8 8v2h-2v-2h2zM9 8h2v2H9V8zm2 4h2v2h-2v-2zM7 12h2v2H7v-2z" clip-rule="evenodd"></path></svg>';
        }

        function openPriceModal(editType = null) {
            const modal = document.getElementById('price-modal');
            const title = document.getElementById('price-modal-title');
            const nameInput = document.getElementById('price-name');
            const unitSelect = document.getElementById('price-unit');
            const dailyInput = document.getElementById('price-daily');
            const billingInput = document.getElementById('price-billing');

            if (editType) {
                title.textContent = 'Edit Harga Cetakan';
                nameInput.value = editType;
                nameInput.readOnly = true;
                unitSelect.value = printPrices[editType].unit;
                dailyInput.value = printPrices[editType].dailyPrice;
                billingInput.value = printPrices[editType].billingPrice;
            } else {
                title.textContent = 'Tambah Jenis Cetakan';
                nameInput.readOnly = false;
                document.getElementById('price-form').reset();
            }
            
            modal.classList.remove('hidden');
            modal.classList.add('flex');
        }

        function closePriceModal() {
            document.getElementById('price-modal').classList.add('hidden');
            document.getElementById('price-modal').classList.remove('flex');
            document.getElementById('price-form').reset();
            document.getElementById('price-name').readOnly = false;
        }

        function editPrice(type) {
            openPriceModal(type);
        }

        function deletePrice(type) {
            if (confirm(`Apakah Anda yakin ingin menghapus jenis cetakan "${type}"?`)) {
                delete printPrices[type];
                saveAllData(); // Auto-save
                renderPriceCards();
            }
        }

        function addOrUpdatePrice(name, unit, dailyPrice, billingPrice) {
            const isNewPrice = !printPrices[name];
            
            printPrices[name] = {
                unit: unit,
                dailyPrice: parseInt(dailyPrice),
                billingPrice: parseInt(billingPrice)
            };
            
            saveAllData(); // Auto-save
            renderPriceCards();
            closePriceModal();
            
            const action = isNewPrice ? 'ditambahkan' : 'diperbarui';
            alert(`✅ Jenis cetakan "${name}" berhasil ${action}!\n\nHarga Harian: Rp ${parseInt(dailyPrice).toLocaleString('id-ID')}\nHarga Tagihan: Rp ${parseInt(billingPrice).toLocaleString('id-ID')}\nSatuan: ${unit}`);
        }

        function editPrice(type) {
            if (!printPrices[type]) {
                alert('❌ Jenis cetakan tidak ditemukan!');
                return;
            }
            
            const priceData = printPrices[type];
            
            if (confirm(`🔄 EDIT HARGA CETAKAN\n\nJenis: ${type}\nSatuan: ${priceData.unit}\nHarga Harian: Rp ${priceData.dailyPrice.toLocaleString('id-ID')}\nHarga Tagihan: Rp ${priceData.billingPrice.toLocaleString('id-ID')}\n\nApakah Anda ingin mengedit harga cetakan ini?`)) {
                openPriceModal(type);
            }
        }

        function deletePrice(type) {
            if (!printPrices[type]) {
                alert('❌ Jenis cetakan tidak ditemukan!');
                return;
            }
            
            const priceData = printPrices[type];
            
            // Check if this print type is used in any transactions or invoices
            const usedInTransactions = transactions.some(t => t.service === type);
            const usedInInvoices = invoices.some(inv => inv.items.some(item => item.description === type));
            
            let warningMessage = `🗑️ HAPUS JENIS CETAKAN\n\nJenis: ${type}\nSatuan: ${priceData.unit}\nHarga Harian: Rp ${priceData.dailyPrice.toLocaleString('id-ID')}\nHarga Tagihan: Rp ${priceData.billingPrice.toLocaleString('id-ID')}`;
            
            if (usedInTransactions || usedInInvoices) {
                warningMessage += `\n\n⚠️ PERINGATAN PENTING!\nJenis cetakan ini sudah digunakan dalam:`;
                if (usedInTransactions) warningMessage += `\n• Transaksi harian`;
                if (usedInInvoices) warningMessage += `\n• Tagihan`;
                warningMessage += `\n\nData transaksi/tagihan yang sudah ada tidak akan terpengaruh, tetapi Anda tidak bisa membuat transaksi baru dengan jenis cetakan ini.`;
            }
            
            warningMessage += `\n\n❓ Apakah Anda yakin ingin menghapus jenis cetakan "${type}"?`;
            
            if (confirm(warningMessage)) {
                // Remove from printPrices
                delete printPrices[type];
                
                // Save changes
                saveAllData();
                
                // Refresh displays
                renderPriceCards();
                
                // Update dropdowns in forms
                populateTransactionServiceDropdown();
                
                alert(`✅ Jenis cetakan "${type}" berhasil dihapus!\n\n${usedInTransactions || usedInInvoices ? '📝 Catatan: Data transaksi dan tagihan yang sudah ada tetap tersimpan.' : '🗑️ Jenis cetakan telah dihapus sepenuhnya dari sistem.'}`);
            }
        }

        // Dashboard Stats
        function updateDashboardStats() {
            const totalSales = transactions.reduce((sum, t) => sum + t.total, 0);
            const todayDate = new Date().toISOString().split('T')[0];
            const todayTransactions = transactions.filter(t => t.date === todayDate).length;
            const totalCustomers = customers.length;
            const monthlyProfit = totalSales * 0.3;

            document.getElementById('total-sales').textContent = `Rp ${totalSales.toLocaleString('id-ID')}`;
            document.getElementById('today-transactions').textContent = todayTransactions;
            document.getElementById('total-customers').textContent = totalCustomers;
            document.getElementById('monthly-profit').textContent = `Rp ${monthlyProfit.toLocaleString('id-ID')}`;

            const recentTransactionsTable = document.getElementById('recent-transactions');
            recentTransactionsTable.innerHTML = '';
            
            const recentTransactions = transactions.slice(-5).reverse();
            recentTransactions.forEach(transaction => {
                const row = document.createElement('tr');
                row.className = 'table-row transition-all duration-300';
                
                const statusClass = transaction.status === 'Selesai' ? 'bg-green-100 text-green-800' : 
                                   transaction.status === 'Proses' ? 'bg-yellow-100 text-yellow-800' : 
                                   'bg-red-100 text-red-800';

                row.innerHTML = `
                    <td class="py-3 px-4 text-gray-600">${transaction.invoiceNumber}</td>
                    <td class="py-3 px-4 text-gray-900 font-medium">${transaction.customer}</td>
                    <td class="py-3 px-4 text-gray-900 font-semibold">Rp ${transaction.total.toLocaleString('id-ID')}</td>
                    <td class="py-3 px-4">
                        <span class="px-3 py-1 ${statusClass} rounded-full text-sm font-medium">${transaction.status}</span>
                    </td>
                `;
                recentTransactionsTable.appendChild(row);
            });
        }

        // Form Handlers
        document.getElementById('customer-form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const name = document.getElementById('customer-fullname').value;
            const email = document.getElementById('customer-email').value;
            const phone = document.getElementById('customer-phone').value;

            addCustomer(name, email, phone);
        });

        document.getElementById('price-form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const name = document.getElementById('price-name').value.trim();
            const unit = document.getElementById('price-unit').value;
            const dailyPrice = document.getElementById('price-daily').value;
            const billingPrice = document.getElementById('price-billing').value;

            if (!name) {
                alert('Silakan masukkan nama jenis cetakan');
                return;
            }
            
            if (!unit) {
                alert('Silakan pilih jenis satuan');
                return;
            }
            
            if (!dailyPrice || dailyPrice <= 0) {
                alert('Silakan masukkan harga harian yang valid');
                return;
            }
            
            if (!billingPrice || billingPrice <= 0) {
                alert('Silakan masukkan harga tagihan yang valid');
                return;
            }

            const nameInput = document.getElementById('price-name');
            if (!nameInput.readOnly && printPrices[name]) {
                alert('Jenis cetakan dengan nama ini sudah ada. Silakan gunakan nama yang berbeda.');
                return;
            }

            addOrUpdatePrice(name, unit, dailyPrice, billingPrice);
        });

        // Form Handlers
        document.getElementById('invoice-form').addEventListener('submit', function(e) {
            e.preventDefault();
            createInvoice();
        });

        document.getElementById('daily-transaction-form').addEventListener('submit', function(e) {
            e.preventDefault();
            createDailyTransaction();
        });

        document.getElementById('quick-customer-form').addEventListener('submit', function(e) {
            e.preventDefault();
            addQuickCustomer();
        });

        document.getElementById('delivery-form').addEventListener('submit', function(e) {
            e.preventDefault();
            createDelivery();
        });

        document.getElementById('company-settings-form').addEventListener('submit', function(e) {
            e.preventDefault();
            saveCompanySettings();
        });

        // Login Management
        function togglePassword() {
            const passwordInput = document.getElementById('login-password');
            const eyeIcon = document.getElementById('eye-icon');
            
            if (passwordInput.type === 'password') {
                passwordInput.type = 'text';
                eyeIcon.innerHTML = `
                    <path d="M3.707 2.293a1 1 0 00-1.414 1.414l14 14a1 1 0 001.414-1.414l-1.473-1.473A10.014 10.014 0 0019.542 10C18.268 5.943 14.478 3 10 3a9.958 9.958 0 00-4.512 1.074l-1.78-1.781zm4.261 4.26l1.514 1.515a2.003 2.003 0 012.45 2.45l1.514 1.514a4 4 0 00-5.478-5.478z"></path>
                    <path d="M12.454 16.697L9.75 13.992a4 4 0 01-3.742-3.741L2.335 6.578A9.98 9.98 0 00.458 10c1.274 4.057 5.065 7 9.542 7 .847 0 1.669-.105 2.454-.303z"></path>
                `;
            } else {
                passwordInput.type = 'password';
                eyeIcon.innerHTML = `
                    <path d="M10 12a2 2 0 100-4 2 2 0 000 4z"></path>
                    <path fill-rule="evenodd" d="M.458 10C1.732 5.943 5.522 3 10 3s8.268 2.943 9.542 7c-1.274 4.057-5.064 7-9.542 7S1.732 14.057.458 10zM14 10a4 4 0 11-8 0 4 4 0 018 0z" clip-rule="evenodd"></path>
                `;
            }
        }

        function getUserRole(username) {
            const userRoles = {
                'admin': 'admin',
                'user': 'user',
                'demo': 'user'
            };
            return userRoles[username] || 'user';
        }

        function setupUserInterface(userRole) {
            const adminOnlyTabs = ['laporan', 'pelanggan', 'harga', 'pengaturan'];
            
            if (userRole === 'user') {
                // Hide admin-only tabs for regular users
                adminOnlyTabs.forEach(tabName => {
                    const tabButton = document.getElementById(`tab-${tabName}`);
                    if (tabButton) {
                        tabButton.style.display = 'none';
                    }
                });
                
                // Update welcome message for user role
                const welcomeText = document.querySelector('header .text-right p:first-child');
                if (welcomeText) {
                    welcomeText.textContent = 'Selamat datang, User';
                }
            } else {
                // Show all tabs for admin
                adminOnlyTabs.forEach(tabName => {
                    const tabButton = document.getElementById(`tab-${tabName}`);
                    if (tabButton) {
                        tabButton.style.display = 'flex';
                    }
                });
            }
        }

        // Company Settings Functions
        function loadCompanySettings() {
            document.getElementById('company-name').value = companySettings.name;
            document.getElementById('company-tagline').value = companySettings.tagline;
            document.getElementById('company-address').value = companySettings.address;
            
            updateCompanyPreview();
        }

        function updateCompanyPreview() {
            // Update preview elements
            document.getElementById('header-company-name').textContent = companySettings.name;
            document.getElementById('header-company-tagline').textContent = companySettings.tagline;
            document.getElementById('header-company-address').textContent = companySettings.address;
            
            // Update logo preview
            if (companySettings.logo && companySettings.logo !== 'default') {
                // Show custom logo
                document.getElementById('logo-preview-img').src = companySettings.logo;
                document.getElementById('logo-preview-img').classList.remove('hidden');
                document.getElementById('logo-preview-placeholder').classList.add('hidden');
                
                document.getElementById('header-logo-preview').src = companySettings.logo;
                document.getElementById('header-logo-preview').classList.remove('hidden');
                document.getElementById('header-logo-placeholder').classList.add('hidden');
            } else {
                // Show default logo placeholder
                document.getElementById('logo-preview-img').classList.add('hidden');
                document.getElementById('logo-preview-placeholder').classList.remove('hidden');
                
                document.getElementById('header-logo-preview').classList.add('hidden');
                document.getElementById('header-logo-placeholder').classList.remove('hidden');
            }
        }

        function handleLogoUpload(input) {
            const file = input.files[0];
            if (!file) return;
            
            // Validate file type
            const validTypes = ['image/jpeg', 'image/jpg', 'image/png', 'image/svg+xml'];
            if (!validTypes.includes(file.type)) {
                alert('❌ Format file tidak didukung!\n\nGunakan format: JPG, PNG, atau SVG');
                input.value = '';
                return;
            }
            
            // Validate file size (max 2MB)
            if (file.size > 2 * 1024 * 1024) {
                alert('❌ Ukuran file terlalu besar!\n\nMaksimal 2MB');
                input.value = '';
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function(e) {
                companySettings.logo = e.target.result;
                updateCompanyPreview();
                
                alert(`✅ Logo berhasil diupload!\n\nFile: ${file.name}\nUkuran: ${(file.size / 1024).toFixed(1)} KB\n\nLogo akan diterapkan setelah menyimpan pengaturan.`);
            };
            reader.readAsDataURL(file);
        }

        function useDefaultLogo() {
            companySettings.logo = companySettings.logo || 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgdmlld0JveD0iMCAwIDEwMCAxMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIxMDAiIGhlaWdodD0iMTAwIiByeD0iMjAiIGZpbGw9InVybCgjZ3JhZGllbnQwX2xpbmVhcl8xXzEpIi8+CjxkZWZzPgo8bGluZWFyR3JhZGllbnQgaWQ9ImdyYWRpZW50MF9saW5lYXJfMV8xIiB4MT0iMCIgeTE9IjAiIHgyPSIxMDAiIHkyPSIxMDAiIGdyYWRpZW50VW5pdHM9InVzZXJTcGFjZU9uVXNlIj4KPHN0b3Agc3RvcC1jb2xvcj0iIzY2N0VFQSIvPgo8c3RvcCBvZmZzZXQ9IjEiIHN0b3AtY29sb3I9IiM3NjRCQTIiLz4KPC9saW5lYXJHcmFkaWVudD4KPC9kZWZzPgo8dGV4dCB4PSI1MCIgeT0iNjAiIGZvbnQtZmFtaWx5PSJBcmlhbCwgc2Fucy1zZXJpZiIgZm9udC1zaXplPSI0MCIgZm9udC13ZWlnaHQ9ImJvbGQiIGZpbGw9IndoaXRlIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIj5GUDwvdGV4dD4KPC9zdmc+';
            updateCompanyPreview();
            
            // Clear file input
            document.getElementById('company-logo-file').value = '';
            
            alert('🎨 Logo default berhasil diterapkan!\n\nLogo gradient biru dengan teks "FP" akan digunakan.');
        }

        function clearLogo() {
            if (confirm('🗑️ Hapus Logo?\n\nApakah Anda yakin ingin menghapus logo perusahaan?\n\nLogo akan dikembalikan ke placeholder default.')) {
                companySettings.logo = null;
                updateCompanyPreview();
                
                // Clear file input
                document.getElementById('company-logo-file').value = '';
                
                alert('✅ Logo berhasil dihapus!\n\nPlaceholder default akan digunakan.');
            }
        }

        function saveCompanySettings() {
            const name = document.getElementById('company-name').value.trim();
            const tagline = document.getElementById('company-tagline').value.trim();
            const address = document.getElementById('company-address').value.trim();
            
            if (!name || !address) {
                alert('❌ Silakan lengkapi nama perusahaan dan alamat!');
                return;
            }
            
            // Update company settings
            companySettings.name = name;
            companySettings.tagline = tagline;
            companySettings.address = address;
            
            // Save to localStorage
            localStorage.setItem('companySettings', JSON.stringify(companySettings));
            
            // Save all data including company settings
            saveAllData();
            
            updateCompanyPreview();
            updateSidebarLogo();
            updateLoginPageLogo();
            
            alert(`✅ Pengaturan perusahaan berhasil disimpan!\n\n🏢 ${name}\n🎯 ${tagline}\n📍 ${address.split('\n')[0]}\n\n💾 Logo dan semua pengaturan telah disimpan permanen.\nPerubahan akan diterapkan ke semua dokumen dan halaman login.`);
        }

        function resetCompanySettings() {
            if (confirm('🔄 Reset ke Pengaturan Default?\n\nSemua perubahan akan dikembalikan ke pengaturan awal:\n\n• Nama: FP DIGITAL PRINTING\n• Tagline: Professional Printing Services\n• Alamat: Default\n• Logo: Default\n\nApakah Anda yakin?')) {
                companySettings = {
                    name: 'FP DIGITAL PRINTING',
                    tagline: 'Professional Printing Services',
                    address: 'Royal Sentraland BTP, Blok RD/15\nTelepon: 0877 8811 2438\nEmail: fpdigital13@gmail.com',
                    logo: 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgdmlld0JveD0iMCAwIDEwMCAxMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIxMDAiIGhlaWdodD0iMTAwIiByeD0iMjAiIGZpbGw9InVybCgjZ3JhZGllbnQwX2xpbmVhcl8xXzEpIi8+CjxkZWZzPgo8bGluZWFyR3JhZGllbnQgaWQ9ImdyYWRpZW50MF9saW5lYXJfMV8xIiB4MT0iMCIgeTE9IjAiIHgyPSIxMDAiIHkyPSIxMDAiIGdyYWRpZW50VW5pdHM9InVzZXJTcGFjZU9uVXNlIj4KPHN0b3Agc3RvcC1jb2xvcj0iIzY2N0VFQSIvPgo8c3RvcCBvZmZzZXQ9IjEiIHN0b3AtY29sb3I9IiM3NjRCQTIiLz4KPC9saW5lYXJHcmFkaWVudD4KPC9kZWZzPgo8dGV4dCB4PSI1MCIgeT0iNjAiIGZvbnQtZmFtaWx5PSJBcmlhbCwgc2Fucy1zZXJpZiIgZm9udC1zaXplPSI0MCIgZm9udC13ZWlnaHQ9ImJvbGQiIGZpbGw9IndoaXRlIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIj5GUDwvdGV4dD4KPC9zdmc+'
                };
                
                // Save to localStorage
                localStorage.setItem('companySettings', JSON.stringify(companySettings));
                
                // Clear file input
                document.getElementById('company-logo-file').value = '';
                
                loadCompanySettings();
                updateSidebarLogo();
                updateLoginPageLogo();
                
                alert('✅ Pengaturan berhasil direset ke default!\n\nSemua perubahan telah dikembalikan ke pengaturan awal dan disinkronkan ke seluruh sistem.');
            }
        }

        function updateSidebarLogo() {
            // Update sidebar logo and company name
            const sidebarLogo = document.querySelector('.sidebar-gradient .w-10.h-10');
            const sidebarName = document.querySelector('.sidebar-gradient h1');
            const sidebarTagline = document.querySelector('.sidebar-gradient p');
            
            if (sidebarName) sidebarName.textContent = companySettings.name.split(' ')[0] + ' ' + (companySettings.name.split(' ')[1] || '');
            if (sidebarTagline) sidebarTagline.textContent = 'Printing System';
            
            // Update logo in sidebar if custom logo exists
            if (companySettings.logo && companySettings.logo !== 'default' && sidebarLogo) {
                // For now, keep the gradient background with initials
                // Could be enhanced to show actual logo in future
                const initials = companySettings.name.split(' ').map(word => word.charAt(0)).join('').substring(0, 2);
                sidebarLogo.querySelector('span').textContent = initials;
            }
        }

        function updateLoginPageLogo() {
            // Update login page logo and company name
            const loginLogo = document.querySelector('#login-page .w-20.h-20');
            const loginTitle = document.querySelector('#login-page h2');
            const loginSubtitle = document.querySelector('#login-page p');
            
            if (loginTitle) loginTitle.textContent = 'Selamat Datang';
            if (loginSubtitle) loginSubtitle.textContent = `Masuk ke sistem ${companySettings.name}`;
            
            if (loginLogo) {
                if (companySettings.logo && companySettings.logo !== 'default') {
                    // Replace with custom logo
                    loginLogo.innerHTML = `<img src="${companySettings.logo}" alt="Logo" class="w-full h-full object-contain rounded-2xl">`;
                } else {
                    // Use default gradient logo with initials
                    const initials = companySettings.name.split(' ').map(word => word.charAt(0)).join('').substring(0, 2);
                    loginLogo.innerHTML = `<span class="text-white font-bold text-2xl">${initials}</span>`;
                }
            }
        }

        function login(username, password) {
            // Demo credentials with roles
            const validCredentials = {
                'admin': { password: 'admin123', role: 'admin' },
                'user': { password: 'user123', role: 'user' },
                'demo': { password: 'demo123', role: 'user' }
            };

            if (validCredentials[username] && validCredentials[username].password === password) {
                const userRole = validCredentials[username].role;
                
                // Store login state
                localStorage.setItem('isLoggedIn', 'true');
                localStorage.setItem('currentUser', username);
                localStorage.setItem('userRole', userRole);
                
                // Hide login page and show main app
                document.getElementById('login-page').classList.add('hidden');
                document.getElementById('main-app').classList.remove('hidden');
                
                // Setup interface based on user role
                setupUserInterface(userRole);
                
                // Update welcome message
                const welcomeText = document.getElementById('user-display-name');
                if (welcomeText) {
                    const roleText = userRole === 'admin' ? 'Admin' : 'User';
                    welcomeText.textContent = `${roleText} - FP Digital`;
                }
                
                // Initialize app based on role
                updateDashboardStats();
                if (userRole === 'admin') {
                    renderCustomers();
                    updateCustomerStats();
                    renderPriceCards();
                }
                renderInvoices();
                updateInvoiceStats();
                updateDailyTransactionStats();
                renderDailyTransactions();
                renderDeliveries();
                updateDeliveryStats();
                
                return true;
            }
            
            return false;
        }

        function logout() {
            const currentUser = localStorage.getItem('currentUser') || 'User';
            const userRole = localStorage.getItem('userRole') || 'user';
            const roleText = userRole === 'admin' ? 'Administrator' : 'User';
            
            if (confirm(`🚪 KONFIRMASI LOGOUT\n\n👤 User: ${currentUser}\n🎭 Role: ${roleText}\n\n❓ Apakah Anda yakin ingin keluar dari sistem?\n\nSemua data akan disimpan dan Anda akan kembali ke halaman login.`)) {
                // Save all current data before logout
                saveAllData();
                
                // Only clear login-related data, keep business data
                localStorage.removeItem('isLoggedIn');
                localStorage.removeItem('currentUser');
                localStorage.removeItem('userRole');
                
                // Show login page and hide main app
                document.getElementById('main-app').classList.add('hidden');
                document.getElementById('login-page').classList.remove('hidden');
                
                // Update login page logo
                updateLoginPageLogo();
                
                // Reset all tabs to visible (for next login)
                const allTabs = ['dashboard', 'transaksi-harian', 'tagihan', 'surat-jalan', 'laporan', 'pelanggan', 'harga'];
                allTabs.forEach(tabName => {
                    const tabButton = document.getElementById(`tab-${tabName}`);
                    if (tabButton) {
                        tabButton.style.display = 'flex';
                        tabButton.classList.remove('active-tab');
                    }
                });
                
                // Reset to dashboard tab as active
                document.getElementById('tab-dashboard').classList.add('active-tab');
                
                // Reset all content visibility
                const contents = ['dashboard', 'transaksi-harian', 'tagihan', 'surat-jalan', 'laporan', 'pelanggan', 'harga', 'pengaturan'];
                contents.forEach(content => {
                    const contentEl = document.getElementById(`content-${content}`);
                    if (contentEl) {
                        contentEl.classList.add('hidden');
                    }
                });
                document.getElementById('content-dashboard').classList.remove('hidden');
                
                // Reset header titles
                document.getElementById('page-title').textContent = 'Dashboard';
                document.getElementById('page-subtitle').textContent = 'Ringkasan aktivitas bisnis Anda';
                
                // Reset login form completely
                const loginForm = document.getElementById('login-form');
                if (loginForm) {
                    loginForm.reset();
                }
                
                // Reset user display name
                document.getElementById('user-display-name').textContent = 'Admin FP Digital';
                
                // Close any open modals
                const modals = ['customer-modal', 'invoice-modal', 'price-modal', 'daily-transaction-modal', 'quick-customer-modal', 'delivery-modal'];
                modals.forEach(modalId => {
                    const modal = document.getElementById(modalId);
                    if (modal) {
                        modal.classList.add('hidden');
                        modal.classList.remove('flex');
                    }
                });
                
                // Show success message
                alert(`✅ LOGOUT BERHASIL!\n\n👤 ${currentUser} (${roleText}) telah keluar dari sistem dengan aman.\n\n💾 Semua data telah disimpan otomatis.\n🔑 Silakan login kembali untuk mengakses sistem.\n\n📱 Terima kasih telah menggunakan FP Digital Printing!`);
            }
        }

        function checkLoginState() {
            const isLoggedIn = localStorage.getItem('isLoggedIn');
            const currentUser = localStorage.getItem('currentUser');
            const userRole = localStorage.getItem('userRole');
            
            if (isLoggedIn === 'true' && currentUser && userRole) {
                // User is logged in, show main app
                document.getElementById('login-page').classList.add('hidden');
                document.getElementById('main-app').classList.remove('hidden');
                
                // Setup interface based on stored user role
                setupUserInterface(userRole);
                
                // Update welcome message
                const welcomeText = document.getElementById('user-display-name');
                if (welcomeText) {
                    const roleText = userRole === 'admin' ? 'Admin' : 'User';
                    welcomeText.textContent = `${roleText} - FP Digital`;
                }
                
                return true;
            } else {
                // User is not logged in, show login page
                document.getElementById('login-page').classList.remove('hidden');
                document.getElementById('main-app').classList.add('hidden');
                return false;
            }
        }

        // Login form handler
        document.getElementById('login-form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const username = document.getElementById('login-username').value.trim();
            const password = document.getElementById('login-password').value;
            
            if (!username || !password) {
                alert('❌ Silakan masukkan username dan password');
                return;
            }
            
            if (login(username, password)) {
                const userRole = localStorage.getItem('userRole');
                const roleText = userRole === 'admin' ? 'Administrator' : 'User';
                const accessText = userRole === 'admin' ? 'Akses penuh ke semua fitur sistem' : 'Akses ke Dashboard, Transaksi Harian, Tagihan, dan Surat Jalan';
                
                alert(`✅ Selamat datang, ${username}!\n\nRole: ${roleText}\n${accessText}\n\nAnda berhasil masuk ke sistem FP Digital Printing.`);
            } else {
                alert('❌ Username atau password salah!\n\nSilakan periksa kembali kredensial Anda.');
                
                // Clear password field
                document.getElementById('login-password').value = '';
                document.getElementById('login-password').focus();
            }
        });

        // Mobile Menu Functions
        function toggleMobileMenu() {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('mobile-overlay');
            const menuBtn = document.getElementById('mobile-menu-btn');
            
            if (sidebar.classList.contains('-translate-x-full')) {
                // Show sidebar
                sidebar.classList.remove('-translate-x-full');
                overlay.classList.remove('hidden');
                menuBtn.innerHTML = `
                    <svg class="w-6 h-6 text-gray-700" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                `;
            } else {
                // Hide sidebar
                sidebar.classList.add('-translate-x-full');
                overlay.classList.add('hidden');
                menuBtn.innerHTML = `
                    <svg class="w-6 h-6 text-gray-700" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
                    </svg>
                `;
            }
        }

        function closeMobileMenu() {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('mobile-overlay');
            const menuBtn = document.getElementById('mobile-menu-btn');
            
            sidebar.classList.add('-translate-x-full');
            overlay.classList.add('hidden');
            menuBtn.innerHTML = `
                <svg class="w-6 h-6 text-gray-700" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
                </svg>
            `;
        }

        function handleImportFile(input) {
            const file = input.files[0];
            if (file) {
                importAllData(file);
                input.value = ''; // Clear the input
            }
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            // Load all data first
            loadAllData();
            
            // Mobile menu event listeners
            document.getElementById('mobile-menu-btn').addEventListener('click', toggleMobileMenu);
            document.getElementById('mobile-overlay').addEventListener('click', closeMobileMenu);
            
            // Close mobile menu when clicking sidebar items
            document.querySelectorAll('.sidebar-item').forEach(item => {
                item.addEventListener('click', () => {
                    setTimeout(closeMobileMenu, 100);
                });
            });
            
            // Load company settings from localStorage
            const savedSettings = localStorage.getItem('companySettings');
            if (savedSettings) {
                companySettings = JSON.parse(savedSettings);
            }
            
            // Check login state first
            if (checkLoginState()) {
                // User is logged in, initialize app based on role
                const userRole = localStorage.getItem('userRole');
                updateDashboardStats();
                updateSidebarLogo();
                if (userRole === 'admin') {
                    renderCustomers();
                    updateCustomerStats();
                    renderPriceCards();
                }
                renderInvoices();
                updateInvoiceStats();
                updateDailyTransactionStats();
                renderDailyTransactions();
                renderDeliveries();
                updateDeliveryStats();
            } else {
                // User is not logged in, update login page logo
                updateLoginPageLogo();
            }
        });

        // Invoice Management
        function openInvoiceModal() {
            const modal = document.getElementById('invoice-modal');
            
            // Generate invoice number
            const invoiceNumber = `INV-${String(invoiceCounter).padStart(3, '0')}`;
            document.getElementById('invoice-number').value = invoiceNumber;
            
            // Set default dates
            const today = new Date().toISOString().split('T')[0];
            const dueDate = new Date();
            dueDate.setDate(dueDate.getDate() + 30);
            
            document.getElementById('invoice-date').value = today;
            document.getElementById('invoice-due-date').value = dueDate.toISOString().split('T')[0];
            
            // Populate customer dropdown
            populateCustomerDropdown();
            
            // Clear items and add first item
            document.getElementById('invoice-items-container').innerHTML = '';
            addInvoiceItem();
            
            modal.classList.remove('hidden');
            modal.classList.add('flex');
        }

        function closeInvoiceModal() {
            document.getElementById('invoice-modal').classList.add('hidden');
            document.getElementById('invoice-modal').classList.remove('flex');
            document.getElementById('invoice-form').reset();
        }

        function populateCustomerDropdown() {
            const select = document.getElementById('invoice-customer');
            select.innerHTML = '<option value="">Pilih Pelanggan</option>';
            
            customers.forEach(customer => {
                const option = document.createElement('option');
                option.value = customer.name;
                option.textContent = `${customer.name} - ${customer.email}`;
                select.appendChild(option);
            });
        }

        function addInvoiceItem() {
            const container = document.getElementById('invoice-items-container');
            const itemIndex = container.children.length;
            
            const itemDiv = document.createElement('div');
            itemDiv.className = 'invoice-item bg-gray-50 border border-gray-200 rounded-lg p-4';
            itemDiv.innerHTML = `
                <div class="flex justify-between items-center mb-3">
                    <span class="text-sm font-medium text-gray-700">Item ${itemIndex + 1}</span>
                    ${itemIndex > 0 ? `
                        <button type="button" onclick="removeInvoiceItem(this)" class="text-red-500 hover:text-red-700 text-sm">
                            Hapus
                        </button>
                    ` : ''}
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-3 mb-3">
                    <div>
                        <label class="block text-xs font-medium text-gray-600 mb-1">Jenis Cetakan</label>
                        <select class="item-description w-full px-3 py-2 border border-gray-300 rounded-lg text-sm input-focus" onchange="updateItemPrice(this)" required>
                            <option value="">Pilih Jenis Cetakan</option>
                            ${Object.keys(printPrices).map(type => 
                                `<option value="${type}" data-price="${printPrices[type].billingPrice}" data-unit="${printPrices[type].unit}">${type}</option>`
                            ).join('')}
                        </select>
                    </div>
                    
                    <div>
                        <label class="block text-xs font-medium text-gray-600 mb-1">Deskripsi</label>
                        <input type="text" class="item-detail w-full px-3 py-2 border border-gray-300 rounded-lg text-sm input-focus" placeholder="Contoh: Ukuran 2x3m">
                    </div>
                </div>
                
                <div class="grid grid-cols-3 gap-3">
                    <div>
                        <label class="block text-xs font-medium text-gray-600 mb-1">Jumlah</label>
                        <input type="number" class="item-quantity w-full px-3 py-2 border border-gray-300 rounded-lg text-sm input-focus" min="1" value="1" onchange="calculateItemTotal(this)" required>
                    </div>
                    
                    <div>
                        <label class="block text-xs font-medium text-gray-600 mb-1">Harga Satuan</label>
                        <input type="number" class="item-price w-full px-3 py-2 border border-gray-300 rounded-lg text-sm input-focus" min="0" onchange="calculateItemTotal(this)" required>
                    </div>
                    
                    <div>
                        <label class="block text-xs font-medium text-gray-600 mb-1">Total</label>
                        <input type="number" class="item-total w-full px-3 py-2 border border-gray-300 rounded-lg text-sm bg-gray-100" readonly>
                    </div>
                </div>
            `;
            
            container.appendChild(itemDiv);
        }

        function removeInvoiceItem(button) {
            button.closest('.invoice-item').remove();
            calculateInvoiceTotal();
            
            // Update item numbers
            const items = document.querySelectorAll('.invoice-item h5');
            items.forEach((item, index) => {
                item.textContent = `Item ${index + 1}`;
            });
        }

        function updateItemPrice(select) {
            const selectedOption = select.options[select.selectedIndex];
            const priceInput = select.closest('.invoice-item').querySelector('.item-price');
            
            if (selectedOption.value) {
                priceInput.value = selectedOption.dataset.price;
                calculateItemTotal(priceInput);
            } else {
                priceInput.value = '';
            }
        }

        function calculateItemTotal(input) {
            const itemDiv = input.closest('.invoice-item');
            const quantity = parseFloat(itemDiv.querySelector('.item-quantity').value) || 0;
            const price = parseFloat(itemDiv.querySelector('.item-price').value) || 0;
            const totalInput = itemDiv.querySelector('.item-total');
            
            const total = quantity * price;
            totalInput.value = total;
            
            calculateInvoiceTotal();
        }

        function calculateInvoiceTotal() {
            const itemTotals = document.querySelectorAll('.item-total');
            let subtotal = 0;
            
            itemTotals.forEach(input => {
                subtotal += parseFloat(input.value) || 0;
            });
            
            const tax = subtotal * 0.11; // PPN 11%
            const total = subtotal + tax;
            
            document.getElementById('invoice-subtotal').textContent = `Rp ${subtotal.toLocaleString('id-ID')}`;
            document.getElementById('invoice-tax').textContent = `Rp ${Math.round(tax).toLocaleString('id-ID')}`;
            document.getElementById('invoice-total').textContent = `Rp ${Math.round(total).toLocaleString('id-ID')}`;
        }

        function createInvoice() {
            const form = document.getElementById('invoice-form');
            const editId = form.getAttribute('data-edit-id');
            
            const invoiceNumber = document.getElementById('invoice-number').value;
            const date = document.getElementById('invoice-date').value;
            const dueDate = document.getElementById('invoice-due-date').value;
            const customer = document.getElementById('invoice-customer').value;
            const notes = document.getElementById('invoice-notes').value;
            
            if (!customer) {
                alert('Silakan pilih pelanggan');
                return;
            }
            
            // Collect items
            const items = [];
            const itemDivs = document.querySelectorAll('.invoice-item');
            
            for (let itemDiv of itemDivs) {
                const description = itemDiv.querySelector('.item-description').value;
                const quantity = parseFloat(itemDiv.querySelector('.item-quantity').value);
                const price = parseFloat(itemDiv.querySelector('.item-price').value);
                const total = parseFloat(itemDiv.querySelector('.item-total').value);
                const detail = itemDiv.querySelector('.item-detail').value;
                
                if (!description || !quantity || !price) {
                    alert('Silakan lengkapi semua item tagihan');
                    return;
                }
                
                const selectedOption = itemDiv.querySelector('.item-description').options[itemDiv.querySelector('.item-description').selectedIndex];
                const unit = selectedOption.dataset.unit;
                
                items.push({
                    description: description,
                    detail: detail,
                    quantity: quantity,
                    unit: unit,
                    price: price,
                    total: total
                });
            }
            
            if (items.length === 0) {
                alert('Silakan tambahkan minimal satu item');
                return;
            }
            
            // Calculate totals
            const subtotal = items.reduce((sum, item) => sum + item.total, 0);
            const tax = subtotal * 0.11;
            const total = subtotal + tax;
            
            if (editId) {
                // Edit existing invoice
                const invoice = invoices.find(inv => inv.id === parseInt(editId));
                if (invoice) {
                    const oldCustomer = invoice.customer;
                    
                    invoice.date = date;
                    invoice.dueDate = dueDate;
                    invoice.customer = customer;
                    invoice.items = items;
                    invoice.subtotal = subtotal;
                    invoice.tax = Math.round(tax);
                    invoice.total = Math.round(total);
                    invoice.notes = notes;
                    
                    // Update customer transaction counts if customer changed
                    if (oldCustomer !== customer) {
                        const oldCustomerObj = customers.find(c => c.name === oldCustomer);
                        const newCustomerObj = customers.find(c => c.name === customer);
                        
                        if (oldCustomerObj && oldCustomerObj.totalTransactions > 0) {
                            oldCustomerObj.totalTransactions--;
                        }
                        if (newCustomerObj) {
                            newCustomerObj.totalTransactions++;
                        }
                    }
                    
                    alert(`✅ Tagihan berhasil diperbarui!\n\nNo. Tagihan: ${invoiceNumber}\nPelanggan: ${customer}\nTotal: Rp ${Math.round(total).toLocaleString('id-ID')}\nJatuh Tempo: ${dueDate}`);
                }
                
                form.removeAttribute('data-edit-id');
            } else {
                // Create new invoice
                const newInvoice = {
                    id: invoiceCounter,
                    invoiceNumber: invoiceNumber,
                    date: date,
                    dueDate: dueDate,
                    customer: customer,
                    items: items,
                    subtotal: subtotal,
                    tax: Math.round(tax),
                    total: Math.round(total),
                    status: 'Belum Dibayar',
                    notes: notes
                };
                
                invoices.push(newInvoice);
                invoiceCounter++;
                
                // Update customer transaction count
                const customerObj = customers.find(c => c.name === customer);
                if (customerObj) {
                    customerObj.totalTransactions++;
                }
                
                alert(`✅ Tagihan berhasil dibuat!\n\nNo. Tagihan: ${invoiceNumber}\nPelanggan: ${customer}\nTotal: Rp ${Math.round(total).toLocaleString('id-ID')}\nJatuh Tempo: ${dueDate}`);
            }
            
            saveAllData(); // Auto-save
            renderInvoices();
            updateInvoiceStats();
            updateDashboardStats();
            closeInvoiceModal();
        }

        // Delivery Management
        function openDeliveryModal() {
            const modal = document.getElementById('delivery-modal');
            
            // Generate delivery number
            const deliveryNumber = `SJ-${String(deliveryCounter).padStart(3, '0')}`;
            document.getElementById('delivery-number').value = deliveryNumber;
            
            // Set today's date
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('delivery-date').value = today;
            
            // Populate dropdowns
            populateDeliveryCustomerDropdown();
            populateDeliveryInvoiceDropdown();
            
            // Reset form
            document.getElementById('delivery-form').reset();
            document.getElementById('delivery-number').value = deliveryNumber;
            document.getElementById('delivery-date').value = today;
            document.getElementById('invoice-reference').classList.add('hidden');
            
            modal.classList.remove('hidden');
            modal.classList.add('flex');
        }

        function closeDeliveryModal() {
            document.getElementById('delivery-modal').classList.add('hidden');
            document.getElementById('delivery-modal').classList.remove('flex');
            document.getElementById('delivery-form').reset();
        }

        function populateDeliveryCustomerDropdown() {
            const select = document.getElementById('delivery-customer');
            select.innerHTML = '<option value="">Pilih Pelanggan</option>';
            
            customers.forEach(customer => {
                const option = document.createElement('option');
                option.value = customer.name;
                option.textContent = `${customer.name} - ${customer.phone}`;
                option.dataset.address = customer.address;
                select.appendChild(option);
            });
        }

        function populateDeliveryInvoiceDropdown() {
            const select = document.getElementById('delivery-invoice');
            select.innerHTML = '<option value="">Pilih Tagihan (atau isi manual)</option>';
            
            // Only show unpaid invoices for delivery
            const availableInvoices = invoices.filter(inv => inv.status === 'Belum Dibayar');
            
            availableInvoices.forEach(invoice => {
                const option = document.createElement('option');
                option.value = invoice.id;
                option.textContent = `${invoice.invoiceNumber} - ${invoice.customer} (Rp ${invoice.total.toLocaleString('id-ID')})`;
                select.appendChild(option);
            });
        }

        function updateDeliveryAddress() {
            const select = document.getElementById('delivery-customer');
            const addressTextarea = document.getElementById('delivery-address');
            const selectedOption = select.options[select.selectedIndex];
            
            if (selectedOption.value && selectedOption.dataset.address) {
                addressTextarea.value = selectedOption.dataset.address;
            } else {
                addressTextarea.value = '';
            }
        }

        function loadInvoiceData() {
            const invoiceSelect = document.getElementById('delivery-invoice');
            const selectedInvoiceId = invoiceSelect.value;
            
            if (!selectedInvoiceId) {
                // Clear form if no invoice selected
                document.getElementById('delivery-customer').value = '';
                document.getElementById('delivery-address').value = '';
                document.getElementById('delivery-items').value = '';
                document.getElementById('invoice-reference').classList.add('hidden');
                return;
            }
            
            const selectedInvoice = invoices.find(inv => inv.id === parseInt(selectedInvoiceId));
            if (!selectedInvoice) return;
            
            // Auto-fill customer data
            document.getElementById('delivery-customer').value = selectedInvoice.customer;
            
            // Auto-fill address from customer data
            const customer = customers.find(c => c.name === selectedInvoice.customer);
            if (customer) {
                document.getElementById('delivery-address').value = customer.address;
            }
            
            // Auto-fill items from invoice
            const itemsList = selectedInvoice.items.map(item => {
                let itemText = `- ${item.description}`;
                if (item.detail) {
                    itemText += ` (${item.detail})`;
                }
                itemText += ` - ${item.quantity} ${item.unit}`;
                return itemText;
            }).join('\n');
            
            document.getElementById('delivery-items').value = itemsList;
            
            // Show invoice reference
            document.getElementById('selected-invoice-number').textContent = selectedInvoice.invoiceNumber;
            document.getElementById('invoice-reference').classList.remove('hidden');
            
            alert(`✅ Data tagihan berhasil dimuat!\n\n📋 ${selectedInvoice.invoiceNumber}\n👤 ${selectedInvoice.customer}\n📦 ${selectedInvoice.items.length} item pesanan\n\nSemua field telah diisi otomatis berdasarkan data tagihan.`);
        }

        function createDelivery() {
            const form = document.getElementById('delivery-form');
            const editId = form.getAttribute('data-edit-id');
            
            const deliveryNumber = document.getElementById('delivery-number').value;
            const date = document.getElementById('delivery-date').value;
            const customer = document.getElementById('delivery-customer').value;
            const address = document.getElementById('delivery-address').value.trim();
            const items = document.getElementById('delivery-items').value.trim();
            const notes = document.getElementById('delivery-notes').value.trim();
            const invoiceId = document.getElementById('delivery-invoice').value;
            
            if (!customer || !address || !items) {
                alert('Silakan lengkapi semua field yang diperlukan');
                return;
            }
            
            // Get invoice reference if selected
            let invoiceRef = null;
            if (invoiceId) {
                const selectedInvoice = invoices.find(inv => inv.id === parseInt(invoiceId));
                if (selectedInvoice) {
                    invoiceRef = selectedInvoice.invoiceNumber;
                }
            }
            
            if (editId) {
                // Edit existing delivery
                const delivery = deliveries.find(d => d.id === parseInt(editId));
                if (delivery) {
                    delivery.date = date;
                    delivery.customer = customer;
                    delivery.address = address;
                    delivery.items = items;
                    delivery.notes = notes;
                    delivery.invoiceRef = invoiceRef;
                    
                    alert(`✅ Surat jalan berhasil diperbarui!\n\nNo. Surat Jalan: ${deliveryNumber}\nPelanggan: ${customer}\nTanggal Kirim: ${date}\nStatus: ${delivery.status}${invoiceRef ? `\nReferensi: ${invoiceRef}` : ''}`);
                }
                
                form.removeAttribute('data-edit-id');
            } else {
                // Create new delivery
                const newDelivery = {
                    id: deliveryCounter,
                    deliveryNumber: deliveryNumber,
                    date: date,
                    customer: customer,
                    address: address,
                    items: items,
                    status: 'Menunggu Kirim',
                    notes: notes,
                    invoiceRef: invoiceRef
                };
                
                deliveries.push(newDelivery);
                deliveryCounter++;
                
                alert(`✅ Surat jalan berhasil dibuat!\n\nNo. Surat Jalan: ${deliveryNumber}\nPelanggan: ${customer}\nTanggal Kirim: ${date}\nStatus: Menunggu Kirim${invoiceRef ? `\nReferensi: ${invoiceRef}` : ''}`);
            }
            
            // Update displays
            saveAllData(); // Auto-save
            renderDeliveries();
            updateDeliveryStats();
            closeDeliveryModal();
        }

        function renderDeliveries() {
            const tbody = document.getElementById('deliveries-table');
            tbody.innerHTML = '';

            if (deliveries.length === 0) {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td colspan="6" class="py-12 px-4 text-center text-gray-500">
                        <div class="flex flex-col items-center">
                            <svg class="w-16 h-16 text-gray-300 mb-4" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M8 16.5a1.5 1.5 0 11-3 0 1.5 1.5 0 013 0zM15 16.5a1.5 1.5 0 11-3 0 1.5 1.5 0 013 0z"></path>
                                <path d="M3 4a1 1 0 00-1 1v10a1 1 0 001 1h1.05a2.5 2.5 0 014.9 0H10a1 1 0 001-1V5a1 1 0 00-1-1H3zM14 7a1 1 0 00-1 1v6.05A2.5 2.5 0 0115.95 16H17a1 1 0 001-1V8a1 1 0 00-1-1h-3z"></path>
                            </svg>
                            <p class="text-lg font-medium text-gray-600 mb-2">Belum ada surat jalan</p>
                            <p class="text-sm text-gray-500">Klik "Buat Surat Jalan" untuk membuat surat jalan pertama</p>
                        </div>
                    </td>
                `;
                tbody.appendChild(row);
                return;
            }

            deliveries.forEach(delivery => {
                const row = document.createElement('tr');
                row.className = 'table-row transition-all duration-300';
                
                const statusClass = delivery.status === 'Terkirim' ? 'bg-green-100 text-green-800' : 
                                   delivery.status === 'Dalam Perjalanan' ? 'bg-blue-100 text-blue-800' : 
                                   'bg-yellow-100 text-yellow-800';
                
                row.innerHTML = `
                    <td class="py-4 px-4">
                        <div class="font-mono text-blue-600 font-semibold">${delivery.deliveryNumber}</div>
                    </td>
                    <td class="py-4 px-4 text-gray-600">${delivery.date}</td>
                    <td class="py-4 px-4">
                        <div class="text-gray-900 font-medium">${delivery.customer}</div>
                        ${delivery.invoiceRef ? `<div class="text-xs text-blue-600">📋 ${delivery.invoiceRef}</div>` : ''}
                    </td>
                    <td class="py-4 px-4">
                        <div class="text-gray-600 text-sm max-w-xs truncate">${delivery.address}</div>
                    </td>
                    <td class="py-4 px-4">
                        <span class="px-3 py-1 ${statusClass} rounded-full text-sm font-medium">${delivery.status}</span>
                    </td>
                    <td class="py-4 px-4">
                        <div class="flex space-x-2">
                            <button onclick="viewDelivery(${delivery.id})" class="text-purple-600 hover:text-purple-800 font-medium text-sm px-2 py-1 rounded hover:bg-purple-50 transition-all duration-300" title="Lihat & Print">
                                👁️
                            </button>
                            <button onclick="editDelivery(${delivery.id})" class="text-orange-600 hover:text-orange-800 font-medium text-sm px-2 py-1 rounded hover:bg-orange-50 transition-all duration-300" title="Edit">
                                ✏️
                            </button>
                            <button onclick="updateDeliveryStatus(${delivery.id})" class="text-blue-600 hover:text-blue-800 font-medium text-sm px-2 py-1 rounded hover:bg-blue-50 transition-all duration-300" title="Update Status">
                                🚚
                            </button>
                            <button onclick="deleteDelivery(${delivery.id})" class="text-red-600 hover:text-red-800 font-medium text-sm px-2 py-1 rounded hover:bg-red-50 transition-all duration-300" title="Hapus">
                                🗑️
                            </button>
                        </div>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        function updateDeliveryStats() {
            const pendingDeliveries = deliveries.filter(d => d.status === 'Menunggu Kirim').length;
            const inTransitDeliveries = deliveries.filter(d => d.status === 'Dalam Perjalanan').length;
            const deliveredDeliveries = deliveries.filter(d => d.status === 'Terkirim').length;
            const totalDeliveries = deliveries.length;
            
            document.getElementById('pending-deliveries').textContent = pendingDeliveries;
            document.getElementById('in-transit-deliveries').textContent = inTransitDeliveries;
            document.getElementById('delivered-deliveries').textContent = deliveredDeliveries;
            document.getElementById('total-deliveries').textContent = totalDeliveries;
        }

        function viewDelivery(id) {
            const delivery = deliveries.find(d => d.id === id);
            if (!delivery) return;
            
            const detailText = `🚚 DETAIL SURAT JALAN\n\n📋 ${delivery.deliveryNumber}\n📅 ${delivery.date}\n👤 ${delivery.customer}${delivery.invoiceRef ? `\n🔗 Referensi: ${delivery.invoiceRef}` : ''}\n\n📍 ALAMAT TUJUAN:\n${delivery.address}\n\n📦 BARANG YANG DIKIRIM:\n${delivery.items}\n\n📊 Status: ${delivery.status}${delivery.notes ? `\n\n📝 Catatan: ${delivery.notes}` : ''}`;
            
            if (confirm(`${detailText}\n\n🖨️ Apakah Anda ingin mencetak surat jalan ini?`)) {
                printDelivery(delivery);
            } else {
                alert(detailText);
            }
        }

        function printDelivery(delivery) {
            const printWindow = window.open('', '_blank');
            
            // Parse items into structured format for table
            const itemsArray = delivery.items.split('\n').filter(item => item.trim()).map(item => {
                const cleanItem = item.replace(/^[-•]\s*/, '').trim();
                const parts = cleanItem.split(' - ');
                const description = parts[0] || cleanItem;
                const quantity = parts[1] || '1 pcs';
                return { description, quantity };
            });
            
            const printContent = `
                <!DOCTYPE html>
                <html>
                <head>
                    <title>Surat Jalan - ${delivery.deliveryNumber}</title>
                    <meta charset="UTF-8">
                    <style>
                        * {
                            margin: 0;
                            padding: 0;
                            box-sizing: border-box;
                        }
                        
                        body {
                            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
                            line-height: 1.4;
                            color: #333;
                            background: #fff;
                        }
                        
                        .container {
                            max-width: 210mm;
                            margin: 0 auto;
                            padding: 20mm;
                            min-height: 297mm;
                            position: relative;
                        }
                        
                        /* Header Section */
                        .header {
                            text-align: center;
                            margin-bottom: 30px;
                            padding-bottom: 20px;
                            border-bottom: 3px solid #2563eb;
                            position: relative;
                        }
                        
                        .company-name {
                            font-size: 28px;
                            font-weight: bold;
                            color: #1e40af;
                            margin-bottom: 5px;
                            letter-spacing: 1px;
                        }
                        
                        .company-tagline {
                            font-size: 12px;
                            color: #6b7280;
                            margin-bottom: 15px;
                        }
                        
                        .document-title {
                            font-size: 24px;
                            font-weight: bold;
                            color: #374151;
                            background: linear-gradient(135deg, #f3f4f6 0%, #e5e7eb 100%);
                            padding: 12px 30px;
                            border-radius: 8px;
                            display: inline-block;
                            border: 2px solid #d1d5db;
                        }
                        
                        /* Info Grid */
                        .info-grid {
                            display: grid;
                            grid-template-columns: 1fr 1fr;
                            gap: 30px;
                            margin-bottom: 30px;
                        }
                        
                        .info-section {
                            background: #f8fafc;
                            padding: 20px;
                            border-radius: 12px;
                            border: 1px solid #e2e8f0;
                        }
                        
                        .info-title {
                            font-size: 16px;
                            font-weight: bold;
                            color: #1e40af;
                            margin-bottom: 15px;
                            padding-bottom: 8px;
                            border-bottom: 2px solid #3b82f6;
                        }
                        
                        .info-item {
                            display: flex;
                            margin-bottom: 8px;
                            align-items: flex-start;
                        }
                        
                        .info-label {
                            font-weight: 600;
                            color: #4b5563;
                            min-width: 120px;
                            margin-right: 10px;
                        }
                        
                        .info-value {
                            color: #111827;
                            flex: 1;
                        }
                        
                        .status-badge {
                            display: inline-block;
                            padding: 4px 12px;
                            border-radius: 20px;
                            font-size: 12px;
                            font-weight: bold;
                            text-transform: uppercase;
                        }
                        
                        .status-delivered { background: #dcfce7; color: #166534; }
                        .status-transit { background: #dbeafe; color: #1d4ed8; }
                        .status-pending { background: #fef3c7; color: #92400e; }
                        
                        /* Address Section */
                        .address-section {
                            background: #fff;
                            border: 2px solid #e5e7eb;
                            border-radius: 12px;
                            padding: 20px;
                            margin-bottom: 30px;
                        }
                        
                        .address-title {
                            font-size: 16px;
                            font-weight: bold;
                            color: #1e40af;
                            margin-bottom: 12px;
                            display: flex;
                            align-items: center;
                        }
                        
                        .address-title::before {
                            content: "📍";
                            margin-right: 8px;
                            font-size: 18px;
                        }
                        
                        .address-content {
                            background: #f9fafb;
                            padding: 15px;
                            border-radius: 8px;
                            border-left: 4px solid #3b82f6;
                            font-size: 14px;
                            line-height: 1.6;
                        }
                        
                        /* Items Table */
                        .items-section {
                            margin-bottom: 30px;
                        }
                        
                        .items-title {
                            font-size: 18px;
                            font-weight: bold;
                            color: #1e40af;
                            margin-bottom: 15px;
                            display: flex;
                            align-items: center;
                        }
                        
                        .items-title::before {
                            content: "📦";
                            margin-right: 10px;
                            font-size: 20px;
                        }
                        
                        .items-table {
                            width: 100%;
                            border-collapse: collapse;
                            background: #fff;
                            border-radius: 12px;
                            overflow: hidden;
                            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
                            border: 1px solid #e5e7eb;
                        }
                        
                        .items-table th {
                            background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
                            color: white;
                            padding: 15px 20px;
                            text-align: left;
                            font-weight: bold;
                            font-size: 14px;
                            text-transform: uppercase;
                            letter-spacing: 0.5px;
                        }
                        
                        .items-table td {
                            padding: 15px 20px;
                            border-bottom: 1px solid #f3f4f6;
                            vertical-align: top;
                        }
                        
                        .items-table tr:nth-child(even) {
                            background: #f8fafc;
                        }
                        
                        .items-table tr:hover {
                            background: #f1f5f9;
                        }
                        
                        .item-number {
                            font-weight: bold;
                            color: #3b82f6;
                            text-align: center;
                            width: 60px;
                        }
                        
                        .item-description {
                            font-weight: 500;
                            color: #111827;
                        }
                        
                        .item-quantity {
                            font-weight: 600;
                            color: #059669;
                            text-align: center;
                            width: 120px;
                        }
                        
                        /* Notes Section */
                        .notes-section {
                            background: #fffbeb;
                            border: 1px solid #f59e0b;
                            border-radius: 12px;
                            padding: 20px;
                            margin-bottom: 40px;
                        }
                        
                        .notes-title {
                            font-size: 16px;
                            font-weight: bold;
                            color: #92400e;
                            margin-bottom: 10px;
                            display: flex;
                            align-items: center;
                        }
                        
                        .notes-title::before {
                            content: "📝";
                            margin-right: 8px;
                        }
                        
                        .notes-content {
                            color: #78350f;
                            line-height: 1.6;
                        }
                        
                        /* Signature Section */
                        .signature-section {
                            display: grid;
                            grid-template-columns: 1fr 1fr;
                            gap: 40px;
                            margin-top: 50px;
                        }
                        
                        .signature-box {
                            text-align: center;
                            background: #f8fafc;
                            border: 2px solid #e2e8f0;
                            border-radius: 12px;
                            padding: 25px;
                        }
                        
                        .signature-title {
                            font-weight: bold;
                            color: #374151;
                            margin-bottom: 15px;
                            font-size: 14px;
                            text-transform: uppercase;
                            letter-spacing: 0.5px;
                        }
                        
                        .signature-line {
                            height: 80px;
                            border-bottom: 2px solid #6b7280;
                            margin-bottom: 15px;
                            position: relative;
                        }
                        
                        .signature-date {
                            font-size: 12px;
                            color: #6b7280;
                            margin-bottom: 10px;
                        }
                        
                        .signature-name {
                            font-weight: 600;
                            color: #111827;
                        }
                        
                        /* Footer */
                        .footer {
                            position: absolute;
                            bottom: 20mm;
                            left: 20mm;
                            right: 20mm;
                            text-align: center;
                            padding-top: 20px;
                            border-top: 1px solid #e5e7eb;
                            font-size: 11px;
                            color: #6b7280;
                        }
                        
                        /* Print Styles */
                        @media print {
                            body {
                                margin: 0;
                                padding: 0;
                                background: white !important;
                                -webkit-print-color-adjust: exact;
                                color-adjust: exact;
                            }
                            
                            .container {
                                margin: 0;
                                padding: 15mm;
                                box-shadow: none;
                            }
                            
                            .items-table th {
                                background: #3b82f6 !important;
                                color: white !important;
                            }
                            
                            .signature-section {
                                page-break-inside: avoid;
                            }
                            
                            .footer {
                                position: fixed;
                                bottom: 10mm;
                            }
                        }
                        
                        @page {
                            size: A4;
                            margin: 0;
                        }
                    </style>
                </head>
                <body>
                    <div class="container">
                        <!-- Header -->
                        <div class="header">
                            ${companySettings.logo && companySettings.logo !== 'default' ? `
                                <div style="display: flex; align-items: center; justify-content: center; margin-bottom: 15px;">
                                    <img src="${companySettings.logo}" alt="Logo" style="max-width: 80px; max-height: 80px; margin-right: 15px;">
                                    <div>
                                        <div class="company-name">${companySettings.name}</div>
                                        <div class="company-tagline">${companySettings.tagline}</div>
                                    </div>
                                </div>
                            ` : `
                                <div class="company-name">${companySettings.name}</div>
                                <div class="company-tagline">${companySettings.tagline}</div>
                            `}
                            <div class="document-title">SURAT JALAN</div>
                        </div>
                        
                        <!-- Info Grid -->
                        <div class="info-grid">
                            <div class="info-section">
                                <div class="info-title">📋 Informasi Surat Jalan</div>
                                <div class="info-item">
                                    <span class="info-label">No. Surat Jalan:</span>
                                    <span class="info-value"><strong>${delivery.deliveryNumber}</strong></span>
                                </div>
                                <div class="info-item">
                                    <span class="info-label">Tanggal Kirim:</span>
                                    <span class="info-value">${new Date(delivery.date).toLocaleDateString('id-ID', { 
                                        weekday: 'long', 
                                        year: 'numeric', 
                                        month: 'long', 
                                        day: 'numeric' 
                                    })}</span>
                                </div>
                                ${delivery.invoiceRef ? `
                                <div class="info-item">
                                    <span class="info-label">Ref. Tagihan:</span>
                                    <span class="info-value"><strong>${delivery.invoiceRef}</strong></span>
                                </div>
                                ` : ''}
                                <div class="info-item">
                                    <span class="info-label">Status:</span>
                                    <span class="info-value">
                                        <span class="status-badge ${delivery.status === 'Terkirim' ? 'status-delivered' : 
                                                                   delivery.status === 'Dalam Perjalanan' ? 'status-transit' : 
                                                                   'status-pending'}">
                                            ${delivery.status}
                                        </span>
                                    </span>
                                </div>
                            </div>
                            
                            <div class="info-section">
                                <div class="info-title">👤 Informasi Penerima</div>
                                <div class="info-item">
                                    <span class="info-label">Nama:</span>
                                    <span class="info-value"><strong>${delivery.customer}</strong></span>
                                </div>
                                <div class="info-item">
                                    <span class="info-label">Waktu Cetak:</span>
                                    <span class="info-value">${new Date().toLocaleString('id-ID')}</span>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Address Section -->
                        <div class="address-section">
                            <div class="address-title">Alamat Tujuan Pengiriman</div>
                            <div class="address-content">${delivery.address}</div>
                        </div>
                        
                        <!-- Items Table -->
                        <div class="items-section">
                            <div class="items-title">Daftar Barang yang Dikirim</div>
                            <table class="items-table">
                                <thead>
                                    <tr>
                                        <th>No</th>
                                        <th>Deskripsi Barang</th>
                                        <th>Jumlah</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${itemsArray.map((item, index) => `
                                        <tr>
                                            <td class="item-number">${index + 1}</td>
                                            <td class="item-description">${item.description}</td>
                                            <td class="item-quantity">${item.quantity}</td>
                                        </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                        </div>
                        
                        ${delivery.notes ? `
                        <!-- Notes Section -->
                        <div class="notes-section">
                            <div class="notes-title">Catatan Khusus</div>
                            <div class="notes-content">${delivery.notes}</div>
                        </div>
                        ` : ''}
                        
                        <!-- Signature Section -->
                        <div class="signature-section">
                            <div class="signature-box">
                                <div class="signature-title">Pengirim</div>
                                <div class="signature-date">Tanggal: ${new Date().toLocaleDateString('id-ID')}</div>
                                <div class="signature-line"></div>
                                <div class="signature-name">FP Digital Printing</div>
                            </div>
                            
                            <div class="signature-box">
                                <div class="signature-title">Penerima</div>
                                <div class="signature-date">Tanggal: _______________</div>
                                <div class="signature-line"></div>
                                <div class="signature-name">${delivery.customer}</div>
                            </div>
                        </div>
                        
                        <!-- Footer -->
                        <div class="footer">
                            <div>Dokumen ini dicetak secara otomatis pada ${new Date().toLocaleString('id-ID')}</div>
                            <div>${companySettings.name} - ${companySettings.tagline}</div>
                            <div style="font-size: 10px; margin-top: 5px; white-space: pre-line;">${companySettings.address}</div>
                        </div>
                    </div>
                </body>
                </html>
            `;
            
            printWindow.document.write(printContent);
            printWindow.document.close();
            printWindow.focus();
            
            // Auto print after content loads
            printWindow.onload = function() {
                setTimeout(() => {
                    printWindow.print();
                }, 500);
            };
        }

        function editDelivery(id) {
            const delivery = deliveries.find(d => d.id === id);
            if (!delivery) return;
            
            if (confirm(`🔄 EDIT SURAT JALAN\n\nNo: ${delivery.deliveryNumber}\nPelanggan: ${delivery.customer}\nTanggal: ${delivery.date}\nStatus: ${delivery.status}${delivery.invoiceRef ? `\nReferensi: ${delivery.invoiceRef}` : ''}\n\nApakah Anda ingin mengedit surat jalan ini?`)) {
                // Open edit modal with pre-filled data
                openDeliveryModal();
                
                // Fill the form with existing data
                document.getElementById('delivery-number').value = delivery.deliveryNumber;
                document.getElementById('delivery-date').value = delivery.date;
                document.getElementById('delivery-customer').value = delivery.customer;
                document.getElementById('delivery-address').value = delivery.address;
                document.getElementById('delivery-items').value = delivery.items;
                document.getElementById('delivery-notes').value = delivery.notes || '';
                
                // Set invoice reference if exists
                if (delivery.invoiceRef) {
                    const invoice = invoices.find(inv => inv.invoiceNumber === delivery.invoiceRef);
                    if (invoice) {
                        document.getElementById('delivery-invoice').value = invoice.id;
                        document.getElementById('selected-invoice-number').textContent = delivery.invoiceRef;
                        document.getElementById('invoice-reference').classList.remove('hidden');
                    }
                }
                
                // Mark form as edit mode
                document.getElementById('delivery-form').setAttribute('data-edit-id', id);
            }
        }

        function updateDeliveryStatus(id) {
            const delivery = deliveries.find(d => d.id === id);
            if (!delivery) return;
            
            const statusOptions = ['Menunggu Kirim', 'Dalam Perjalanan', 'Terkirim'];
            const currentIndex = statusOptions.indexOf(delivery.status);
            const nextStatus = statusOptions[(currentIndex + 1) % statusOptions.length];
            
            if (confirm(`🚚 UPDATE STATUS PENGIRIMAN\n\nNo: ${delivery.deliveryNumber}\nPelanggan: ${delivery.customer}\nStatus Saat Ini: ${delivery.status}\n\nApakah Anda ingin mengubah status menjadi "${nextStatus}"?`)) {
                delivery.status = nextStatus;
                
                renderDeliveries();
                updateDeliveryStats();
                
                let statusIcon = nextStatus === 'Terkirim' ? '✅' : nextStatus === 'Dalam Perjalanan' ? '🚛' : '⏳';
                alert(`${statusIcon} Status pengiriman berhasil diperbarui!\n\nNo: ${delivery.deliveryNumber}\nStatus Baru: ${nextStatus}\nPelanggan: ${delivery.customer}`);
            }
        }

        function deleteDelivery(id) {
            const delivery = deliveries.find(d => d.id === id);
            if (!delivery) return;
            
            if (confirm(`🗑️ HAPUS SURAT JALAN\n\nNo: ${delivery.deliveryNumber}\nPelanggan: ${delivery.customer}\nTanggal: ${delivery.date}\nStatus: ${delivery.status}\n\n⚠️ PERINGATAN: Data yang dihapus tidak dapat dikembalikan!\n\nApakah Anda yakin ingin menghapus surat jalan ini?`)) {
                // Remove from deliveries array
                deliveries = deliveries.filter(d => d.id !== id);
                
                // Refresh displays
                renderDeliveries();
                updateDeliveryStats();
                
                alert(`✅ Surat jalan ${delivery.deliveryNumber} berhasil dihapus!`);
            }
        }

        // Daily Transaction Management
        function openDailyTransactionModal() {
            const modal = document.getElementById('daily-transaction-modal');
            
            // Generate transaction ID
            const transactionId = `TXN-${String(transactionCounter).padStart(3, '0')}`;
            document.getElementById('transaction-id').value = transactionId;
            
            // Set current datetime
            const now = new Date();
            const localDateTime = new Date(now.getTime() - now.getTimezoneOffset() * 60000).toISOString().slice(0, 16);
            document.getElementById('transaction-datetime').value = localDateTime;
            
            // Populate dropdowns
            populateTransactionCustomerDropdown();
            populateTransactionServiceDropdown();
            
            // Reset form
            document.getElementById('daily-transaction-form').reset();
            document.getElementById('transaction-id').value = transactionId;
            document.getElementById('transaction-datetime').value = localDateTime;
            
            modal.classList.remove('hidden');
            modal.classList.add('flex');
        }

        function closeDailyTransactionModal() {
            document.getElementById('daily-transaction-modal').classList.add('hidden');
            document.getElementById('daily-transaction-modal').classList.remove('flex');
            document.getElementById('daily-transaction-form').reset();
        }

        function populateTransactionCustomerDropdown() {
            const select = document.getElementById('transaction-customer');
            select.innerHTML = '<option value="">Pilih Pelanggan</option>';
            
            customers.forEach(customer => {
                const option = document.createElement('option');
                option.value = customer.name;
                option.textContent = `${customer.name} - ${customer.phone}`;
                select.appendChild(option);
            });
        }

        function populateTransactionServiceDropdown() {
            const select = document.getElementById('transaction-service');
            select.innerHTML = '<option value="">Pilih Jenis Cetakan</option>';
            
            Object.entries(printPrices).forEach(([type, priceData]) => {
                const option = document.createElement('option');
                option.value = type;
                option.textContent = `${type} (${priceData.unit})`;
                option.dataset.price = priceData.dailyPrice;
                option.dataset.unit = priceData.unit;
                select.appendChild(option);
            });
        }

        function updateTransactionPrice() {
            const select = document.getElementById('transaction-service');
            const priceInput = document.getElementById('transaction-price');
            const selectedOption = select.options[select.selectedIndex];
            
            if (selectedOption.value) {
                priceInput.value = selectedOption.dataset.price;
                calculateTransactionTotal();
            } else {
                priceInput.value = '';
                document.getElementById('transaction-total').value = '';
            }
        }

        function calculateTransactionTotal() {
            const quantity = parseFloat(document.getElementById('transaction-quantity').value) || 0;
            const price = parseFloat(document.getElementById('transaction-price').value) || 0;
            const total = quantity * price;
            
            document.getElementById('transaction-total').value = total;
        }

        function createDailyTransaction() {
            const form = document.getElementById('daily-transaction-form');
            const editId = form.getAttribute('data-edit-id');
            
            const transactionId = document.getElementById('transaction-id').value;
            const datetime = document.getElementById('transaction-datetime').value;
            const customer = document.getElementById('transaction-customer').value;
            const service = document.getElementById('transaction-service').value;
            const quantity = parseFloat(document.getElementById('transaction-quantity').value);
            const price = parseFloat(document.getElementById('transaction-price').value);
            const total = parseFloat(document.getElementById('transaction-total').value);
            const description = document.getElementById('transaction-description').value;
            const paymentStatus = document.querySelector('input[name="payment-status"]:checked').value;
            
            if (!customer || !service || !quantity || !price) {
                alert('Silakan lengkapi semua field yang diperlukan');
                return;
            }
            
            // Parse datetime
            const date = datetime.split('T')[0];
            const time = datetime.split('T')[1];
            
            if (editId) {
                // Edit existing transaction
                const transaction = transactions.find(t => t.id === parseInt(editId));
                if (transaction) {
                    const oldCustomer = transaction.customer;
                    
                    transaction.date = date;
                    transaction.time = time;
                    transaction.customer = customer;
                    transaction.service = service;
                    transaction.quantity = quantity;
                    transaction.total = total;
                    transaction.status = paymentStatus === 'Lunas' ? 'Selesai' : 'Proses';
                    transaction.description = description || `${service} (${quantity} unit)`;
                    
                    // Update customer transaction counts if customer changed
                    if (oldCustomer !== customer) {
                        const oldCustomerObj = customers.find(c => c.name === oldCustomer);
                        const newCustomerObj = customers.find(c => c.name === customer);
                        
                        if (oldCustomerObj && oldCustomerObj.totalTransactions > 0) {
                            oldCustomerObj.totalTransactions--;
                        }
                        if (newCustomerObj) {
                            newCustomerObj.totalTransactions++;
                        }
                    }
                    
                    alert(`✅ Transaksi berhasil diperbarui!\n\nID: ${transactionId}\nPelanggan: ${customer}\nLayanan: ${service}\nTotal: Rp ${total.toLocaleString('id-ID')}\nStatus: ${paymentStatus}`);
                }
                
                form.removeAttribute('data-edit-id');
            } else {
                // Create new transaction
                const newTransaction = {
                    id: transactionCounter,
                    invoiceNumber: transactionId,
                    date: date,
                    time: time,
                    customer: customer,
                    service: service,
                    quantity: quantity,
                    total: total,
                    status: paymentStatus === 'Lunas' ? 'Selesai' : 'Proses',
                    description: description || `${service} (${quantity} unit)`,
                    type: 'daily'
                };
                
                transactions.push(newTransaction);
                transactionCounter++;
                
                // Update customer transaction count
                const customerObj = customers.find(c => c.name === customer);
                if (customerObj) {
                    customerObj.totalTransactions++;
                }
                
                alert(`✅ Transaksi berhasil dibuat!\n\nID: ${transactionId}\nPelanggan: ${customer}\nLayanan: ${service}\nTotal: Rp ${total.toLocaleString('id-ID')}\nStatus: ${paymentStatus}`);
            }
            
            // Update displays
            saveAllData(); // Auto-save
            updateDashboardStats();
            updateDailyTransactionStats();
            renderDailyTransactions();
            closeDailyTransactionModal();
        }

        // Quick Customer Add
        function openQuickCustomerAdd() {
            document.getElementById('quick-customer-modal').classList.remove('hidden');
            document.getElementById('quick-customer-modal').classList.add('flex');
        }

        function closeQuickCustomerModal() {
            document.getElementById('quick-customer-modal').classList.add('hidden');
            document.getElementById('quick-customer-modal').classList.remove('flex');
            document.getElementById('quick-customer-form').reset();
        }

        function addQuickCustomer() {
            const name = document.getElementById('quick-customer-name').value.trim();
            const phone = document.getElementById('quick-customer-phone').value.trim();
            
            if (!name || !phone) {
                alert('Silakan masukkan nama dan nomor telepon');
                return;
            }
            
            // Check if customer already exists
            if (customers.find(c => c.name.toLowerCase() === name.toLowerCase() || c.phone === phone)) {
                alert('Pelanggan dengan nama atau nomor telepon ini sudah ada');
                return;
            }
            
            // Add new customer
            const newCustomer = {
                id: customers.length + 1,
                name: name,
                email: `${name.toLowerCase().replace(/\s+/g, '')}@email.com`,
                phone: phone,
                address: `Alamat ${name}`,
                totalTransactions: 0
            };
            
            customers.push(newCustomer);
            
            // Update dropdown and select the new customer
            populateTransactionCustomerDropdown();
            document.getElementById('transaction-customer').value = name;
            
            closeQuickCustomerModal();
            alert(`✅ Pelanggan "${name}" berhasil ditambahkan!`);
        }

        // Daily Transaction Stats and Display
        function updateDailyTransactionStats() {
            const today = new Date().toISOString().split('T')[0];
            const todayTransactions = transactions.filter(t => t.date === today);
            
            const totalTransactions = todayTransactions.length;
            const totalRevenue = todayTransactions.reduce((sum, t) => sum + t.total, 0);
            const averageTransaction = totalTransactions > 0 ? totalRevenue / totalTransactions : 0;
            
            document.getElementById('daily-total-transactions').textContent = totalTransactions;
            document.getElementById('daily-revenue').textContent = `Rp ${totalRevenue.toLocaleString('id-ID')}`;
            document.getElementById('daily-average').textContent = `Rp ${Math.round(averageTransaction).toLocaleString('id-ID')}`;
        }

        function renderDailyTransactions() {
            const tbody = document.getElementById('daily-transactions-table');
            tbody.innerHTML = '';
            
            // Get selected date or today
            const selectedDate = document.getElementById('daily-date').value || new Date().toISOString().split('T')[0];
            const dayTransactions = transactions.filter(t => t.date === selectedDate);
            
            if (dayTransactions.length === 0) {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td colspan="7" class="py-8 px-4 text-center text-gray-500">
                        <p>Tidak ada transaksi pada tanggal ${selectedDate}</p>
                    </td>
                `;
                tbody.appendChild(row);
                return;
            }
            
            dayTransactions.forEach(transaction => {
                const row = document.createElement('tr');
                row.className = 'table-row transition-all duration-300';
                
                const statusClass = transaction.status === 'Selesai' ? 'bg-green-100 text-green-800' : 
                                   transaction.status === 'Proses' ? 'bg-yellow-100 text-yellow-800' : 
                                   'bg-red-100 text-red-800';
                
                row.innerHTML = `
                    <td class="py-3 px-4 text-gray-600 text-sm">${transaction.time}</td>
                    <td class="py-3 px-4 text-gray-600 font-mono text-sm">${transaction.invoiceNumber}</td>
                    <td class="py-3 px-4 text-gray-900 font-medium">${transaction.customer}</td>
                    <td class="py-3 px-4">
                        <div class="text-gray-900 font-medium">${transaction.service}</div>
                        <div class="text-xs text-gray-500">${transaction.quantity} unit</div>
                    </td>
                    <td class="py-3 px-4 text-gray-900 font-semibold">Rp ${transaction.total.toLocaleString('id-ID')}</td>
                    <td class="py-3 px-4">
                        <span class="px-2 py-1 ${statusClass} rounded-full text-xs font-medium">${transaction.status}</span>
                    </td>
                    <td class="py-3 px-4">
                        <div class="flex space-x-2">
                            <button onclick="viewTransaction(${transaction.id})" class="text-purple-600 hover:text-purple-800 font-medium text-sm px-2 py-1 rounded hover:bg-purple-50 transition-all duration-300" title="Lihat & Print">
                                👁️
                            </button>
                            <button onclick="editTransaction(${transaction.id})" class="text-blue-600 hover:text-blue-800 font-medium text-sm px-2 py-1 rounded hover:bg-blue-50 transition-all duration-300" title="Edit">
                                ✏️
                            </button>
                            <button onclick="deleteTransaction(${transaction.id})" class="text-red-600 hover:text-red-800 font-medium text-sm px-2 py-1 rounded hover:bg-red-50 transition-all duration-300" title="Hapus">
                                🗑️
                            </button>
                        </div>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        function viewTransaction(id) {
            const transaction = transactions.find(t => t.id === id);
            if (!transaction) return;
            
            const detailText = `💰 DETAIL TRANSAKSI\n\n🔢 ${transaction.invoiceNumber}\n📅 ${transaction.date} ${transaction.time}\n👤 ${transaction.customer}\n\n🛍️ LAYANAN:\n${transaction.service} (${transaction.quantity} unit)\n${transaction.description ? `📝 ${transaction.description}` : ''}\n\n💰 TOTAL: Rp ${transaction.total.toLocaleString('id-ID')}\n📊 Status: ${transaction.status}`;
            
            if (confirm(`${detailText}\n\n🖨️ Apakah Anda ingin mencetak detail transaksi ini?`)) {
                printTransaction(transaction);
            } else {
                alert(detailText);
            }
        }

        function printTransaction(transaction) {
            const printWindow = window.open('', '_blank');
            const printContent = `
                <!DOCTYPE html>
                <html>
                <head>
                    <title>Cetak Transaksi - ${transaction.invoiceNumber}</title>
                    <style>
                        body { font-family: Arial, sans-serif; margin: 20px; }
                        .header { text-align: center; border-bottom: 2px solid #333; padding-bottom: 10px; margin-bottom: 20px; }
                        .detail { margin: 10px 0; }
                        .total { font-size: 18px; font-weight: bold; margin-top: 20px; }
                        @media print { body { margin: 0; } }
                    </style>
                </head>
                <body>
                    <div class="header">
                        ${companySettings.logo && companySettings.logo !== 'default' ? `
                            <div style="display: flex; align-items: center; justify-content: center; margin-bottom: 15px;">
                                <img src="${companySettings.logo}" alt="Logo" style="max-width: 50px; max-height: 50px; margin-right: 10px;">
                                <div>
                                    <h2>${companySettings.name}</h2>
                                    <p style="margin: 0; font-size: 12px;">${companySettings.tagline}</p>
                                </div>
                            </div>
                        ` : `
                            <h2>${companySettings.name}</h2>
                            <p style="margin: 5px 0;">${companySettings.tagline}</p>
                        `}
                        <p style="font-weight: bold;">Detail Transaksi Harian</p>
                        <div style="font-size: 10px; margin-top: 10px; white-space: pre-line;">${companySettings.address}</div>
                    </div>
                    <div class="detail"><strong>ID Transaksi:</strong> ${transaction.invoiceNumber}</div>
                    <div class="detail"><strong>Tanggal:</strong> ${transaction.date}</div>
                    <div class="detail"><strong>Waktu:</strong> ${transaction.time}</div>
                    <div class="detail"><strong>Pelanggan:</strong> ${transaction.customer}</div>
                    <div class="detail"><strong>Layanan:</strong> ${transaction.service}</div>
                    <div class="detail"><strong>Jumlah:</strong> ${transaction.quantity} unit</div>
                    ${transaction.description ? `<div class="detail"><strong>Deskripsi:</strong> ${transaction.description}</div>` : ''}
                    <div class="detail"><strong>Status:</strong> ${transaction.status}</div>
                    <div class="total">TOTAL: Rp ${transaction.total.toLocaleString('id-ID')}</div>
                    <div style="margin-top: 30px; text-align: center; font-size: 12px;">
                        Dicetak pada: ${new Date().toLocaleString('id-ID')}
                    </div>
                </body>
                </html>
            `;
            
            printWindow.document.write(printContent);
            printWindow.document.close();
            printWindow.focus();
            printWindow.print();
        }

        function editTransaction(id) {
            const transaction = transactions.find(t => t.id === id);
            if (!transaction) return;
            
            if (confirm(`🔄 EDIT TRANSAKSI\n\nID: ${transaction.invoiceNumber}\nPelanggan: ${transaction.customer}\nLayanan: ${transaction.service}\nTotal: Rp ${transaction.total.toLocaleString('id-ID')}\n\nApakah Anda ingin mengedit transaksi ini?`)) {
                // Open edit modal with pre-filled data
                openDailyTransactionModal();
                
                // Fill the form with existing data
                document.getElementById('transaction-id').value = transaction.invoiceNumber;
                document.getElementById('transaction-datetime').value = `${transaction.date}T${transaction.time}`;
                document.getElementById('transaction-customer').value = transaction.customer;
                document.getElementById('transaction-service').value = transaction.service;
                document.getElementById('transaction-quantity').value = transaction.quantity;
                document.getElementById('transaction-price').value = transaction.total / transaction.quantity;
                document.getElementById('transaction-total').value = transaction.total;
                document.getElementById('transaction-description').value = transaction.description;
                
                // Set payment status
                const paymentStatus = transaction.status === 'Selesai' ? 'Lunas' : 'Belum Lunas';
                document.querySelector(`input[name="payment-status"][value="${paymentStatus}"]`).checked = true;
                
                // Mark form as edit mode
                document.getElementById('daily-transaction-form').setAttribute('data-edit-id', id);
            }
        }

        function deleteTransaction(id) {
            const transaction = transactions.find(t => t.id === id);
            if (!transaction) return;
            
            if (confirm(`🗑️ HAPUS TRANSAKSI\n\nID: ${transaction.invoiceNumber}\nPelanggan: ${transaction.customer}\nLayanan: ${transaction.service}\nTotal: Rp ${transaction.total.toLocaleString('id-ID')}\n\n⚠️ PERINGATAN: Data yang dihapus tidak dapat dikembalikan!\n\nApakah Anda yakin ingin menghapus transaksi ini?`)) {
                // Remove from transactions array
                transactions = transactions.filter(t => t.id !== id);
                
                // Update customer transaction count
                const customer = customers.find(c => c.name === transaction.customer);
                if (customer && customer.totalTransactions > 0) {
                    customer.totalTransactions--;
                }
                
                // Refresh displays
                updateDashboardStats();
                updateDailyTransactionStats();
                renderDailyTransactions();
                
                alert(`✅ Transaksi ${transaction.invoiceNumber} berhasil dihapus!`);
            }
        }

        function filterDailyTransactions() {
            const selectedDate = document.getElementById('daily-date').value;
            if (!selectedDate) {
                alert('Silakan pilih tanggal terlebih dahulu');
                return;
            }
            
            renderDailyTransactions();
            
            // Update stats for selected date
            const dayTransactions = transactions.filter(t => t.date === selectedDate);
            const totalTransactions = dayTransactions.length;
            const totalRevenue = dayTransactions.reduce((sum, t) => sum + t.total, 0);
            const averageTransaction = totalTransactions > 0 ? totalRevenue / totalTransactions : 0;
            
            document.getElementById('daily-total-transactions').textContent = totalTransactions;
            document.getElementById('daily-revenue').textContent = `Rp ${totalRevenue.toLocaleString('id-ID')}`;
            document.getElementById('daily-average').textContent = `Rp ${Math.round(averageTransaction).toLocaleString('id-ID')}`;
        }

        function filterDailyTransactions() {
            const selectedDate = document.getElementById('daily-date').value;
            if (!selectedDate) {
                alert('Silakan pilih tanggal terlebih dahulu');
                return;
            }
            
            renderDailyTransactions();
            
            // Update stats for selected date
            const dayTransactions = transactions.filter(t => t.date === selectedDate);
            const totalTransactions = dayTransactions.length;
            const totalRevenue = dayTransactions.reduce((sum, t) => sum + t.total, 0);
            const averageTransaction = totalTransactions > 0 ? totalRevenue / totalTransactions : 0;
            
            document.getElementById('daily-total-transactions').textContent = totalTransactions;
            document.getElementById('daily-revenue').textContent = `Rp ${totalRevenue.toLocaleString('id-ID')}`;
            document.getElementById('daily-average').textContent = `Rp ${Math.round(averageTransaction).toLocaleString('id-ID')}`;
            
            alert(`📊 Filter berhasil diterapkan!\n\nTanggal: ${selectedDate}\nTotal Transaksi: ${totalTransactions}\nPendapatan: Rp ${totalRevenue.toLocaleString('id-ID')}`);
        }

        function renderInvoices() {
            const tbody = document.getElementById('invoices-table');
            tbody.innerHTML = '';

            if (invoices.length === 0) {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td colspan="7" class="py-12 px-4 text-center text-gray-500">
                        <div class="flex flex-col items-center">
                            <svg class="w-16 h-16 text-gray-300 mb-4" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M4 4a2 2 0 012-2h4.586A2 2 0 0112 2.586L15.414 6A2 2 0 0116 7.414V16a2 2 0 01-2 2H6a2 2 0 01-2-2V4z" clip-rule="evenodd"></path>
                            </svg>
                            <p class="text-lg font-medium text-gray-600 mb-2">Belum ada tagihan</p>
                            <p class="text-sm text-gray-500">Klik "Buat Tagihan" untuk membuat tagihan pertama</p>
                        </div>
                    </td>
                `;
                tbody.appendChild(row);
                return;
            }

            invoices.forEach(invoice => {
                const row = document.createElement('tr');
                row.className = 'table-row transition-all duration-300';
                
                const statusClass = invoice.status === 'Lunas' ? 'bg-green-100 text-green-800' : 
                                   invoice.status === 'Sebagian' ? 'bg-yellow-100 text-yellow-800' : 
                                   'bg-red-100 text-red-800';

                const isOverdue = new Date(invoice.dueDate) < new Date() && invoice.status !== 'Lunas';
                
                row.innerHTML = `
                    <td class="py-4 px-4">
                        <div class="font-mono text-blue-600 font-semibold">${invoice.invoiceNumber}</div>
                        ${isOverdue ? '<div class="text-xs text-red-600 font-medium">⚠️ Terlambat</div>' : ''}
                    </td>
                    <td class="py-4 px-4 text-gray-600">${invoice.date}</td>
                    <td class="py-4 px-4">
                        <div class="text-gray-900 font-medium">${invoice.customer}</div>
                        <div class="text-xs text-gray-500">${invoice.items.length} item</div>
                    </td>
                    <td class="py-4 px-4">
                        <div class="text-gray-900 font-semibold">Rp ${invoice.total.toLocaleString('id-ID')}</div>
                        <div class="text-xs text-gray-500">+PPN 11%</div>
                    </td>
                    <td class="py-4 px-4">
                        <div class="text-gray-600">${invoice.dueDate}</div>
                        ${isOverdue ? '<div class="text-xs text-red-600">Lewat tempo</div>' : ''}
                    </td>
                    <td class="py-4 px-4">
                        <span class="px-3 py-1 ${statusClass} rounded-full text-sm font-medium">${invoice.status}</span>
                    </td>
                    <td class="py-4 px-4">
                        <div class="flex space-x-2">
                            <button onclick="viewInvoice(${invoice.id})" class="text-purple-600 hover:text-purple-800 font-medium text-sm px-2 py-1 rounded hover:bg-purple-50 transition-all duration-300" title="Lihat & Print">
                                👁️
                            </button>
                            <button onclick="editInvoice(${invoice.id})" class="text-blue-600 hover:text-blue-800 font-medium text-sm px-2 py-1 rounded hover:bg-blue-50 transition-all duration-300" title="Edit">
                                ✏️
                            </button>
                            <button onclick="markInvoicePaid(${invoice.id})" class="text-green-600 hover:text-green-800 font-medium text-sm px-2 py-1 rounded hover:bg-green-50 transition-all duration-300" title="Tandai Lunas">
                                💰
                            </button>
                            <button onclick="deleteInvoice(${invoice.id})" class="text-red-600 hover:text-red-800 font-medium text-sm px-2 py-1 rounded hover:bg-red-50 transition-all duration-300" title="Hapus">
                                🗑️
                            </button>
                        </div>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        function updateInvoiceStats() {
            const unpaidInvoices = invoices.filter(inv => inv.status === 'Belum Dibayar').length;
            const totalReceivables = invoices.filter(inv => inv.status === 'Belum Dibayar').reduce((sum, inv) => sum + inv.total, 0);
            const paidInvoices = invoices.filter(inv => inv.status === 'Lunas').length;
            
            document.getElementById('unpaid-invoices').textContent = unpaidInvoices;
            document.getElementById('total-receivables').textContent = `Rp ${totalReceivables.toLocaleString('id-ID')}`;
            document.getElementById('paid-invoices').textContent = paidInvoices;
        }

        function viewInvoice(id) {
            const invoice = invoices.find(inv => inv.id === id);
            if (!invoice) return;
            
            let itemsText = invoice.items.map(item => 
                `• ${item.description} (${item.quantity} ${item.unit}) - Rp ${item.total.toLocaleString('id-ID')}`
            ).join('\n');
            
            const detailText = `📄 DETAIL TAGIHAN\n\n🔢 ${invoice.invoiceNumber}\n📅 ${invoice.date}\n👤 ${invoice.customer}\n⏰ Jatuh Tempo: ${invoice.dueDate}\n\n📋 ITEM:\n${itemsText}\n\n💰 TOTAL:\n• Subtotal: Rp ${invoice.subtotal.toLocaleString('id-ID')}\n• PPN (11%): Rp ${invoice.tax.toLocaleString('id-ID')}\n• TOTAL: Rp ${invoice.total.toLocaleString('id-ID')}\n\n📊 Status: ${invoice.status}${invoice.notes ? `\n\n📝 Catatan: ${invoice.notes}` : ''}`;
            
            if (confirm(`${detailText}\n\n🖨️ Apakah Anda ingin mencetak tagihan ini?`)) {
                printInvoice(invoice);
            } else {
                alert(detailText);
            }
        }

        function printInvoice(invoice) {
            const printWindow = window.open('', '_blank');
            const printContent = `
                <!DOCTYPE html>
                <html>
                <head>
                    <title>Cetak Tagihan - ${invoice.invoiceNumber}</title>
                    <style>
                        body { font-family: Arial, sans-serif; margin: 20px; }
                        .header { text-align: center; border-bottom: 2px solid #333; padding-bottom: 15px; margin-bottom: 20px; }
                        .invoice-info { display: flex; justify-content: space-between; margin-bottom: 20px; }
                        .detail { margin: 5px 0; }
                        table { width: 100%; border-collapse: collapse; margin: 20px 0; }
                        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
                        th { background-color: #f2f2f2; }
                        .total-section { margin-top: 20px; text-align: right; }
                        .total { font-size: 18px; font-weight: bold; }
                        @media print { body { margin: 0; } }
                    </style>
                </head>
                <body>
                    <div class="header">
                        ${companySettings.logo && companySettings.logo !== 'default' ? `
                            <div style="display: flex; align-items: center; justify-content: center; margin-bottom: 15px;">
                                <img src="${companySettings.logo}" alt="Logo" style="max-width: 60px; max-height: 60px; margin-right: 15px;">
                                <div>
                                    <h2>${companySettings.name}</h2>
                                    <p style="margin: 0; font-size: 12px; color: #666;">${companySettings.tagline}</p>
                                </div>
                            </div>
                        ` : `
                            <h2>${companySettings.name}</h2>
                            <p style="margin: 5px 0; font-size: 12px; color: #666;">${companySettings.tagline}</p>
                        `}
                        <p style="font-size: 16px; font-weight: bold; margin: 10px 0;">TAGIHAN / INVOICE</p>
                        <div style="font-size: 10px; color: #666; white-space: pre-line; margin-top: 10px;">${companySettings.address}</div>
                    </div>
                    
                    <div class="invoice-info">
                        <div>
                            <div class="detail"><strong>No. Tagihan:</strong> ${invoice.invoiceNumber}</div>
                            <div class="detail"><strong>Tanggal:</strong> ${invoice.date}</div>
                            <div class="detail"><strong>Jatuh Tempo:</strong> ${invoice.dueDate}</div>
                        </div>
                        <div>
                            <div class="detail"><strong>Kepada:</strong></div>
                            <div class="detail">${invoice.customer}</div>
                            <div class="detail"><strong>Status:</strong> ${invoice.status}</div>
                        </div>
                    </div>
                    
                    <table>
                        <thead>
                            <tr>
                                <th>Deskripsi</th>
                                <th>Qty</th>
                                <th>Satuan</th>
                                <th>Harga</th>
                                <th>Total</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${invoice.items.map(item => `
                                <tr>
                                    <td>${item.description}${item.detail ? `<br><small>${item.detail}</small>` : ''}</td>
                                    <td>${item.quantity}</td>
                                    <td>${item.unit}</td>
                                    <td>Rp ${item.price.toLocaleString('id-ID')}</td>
                                    <td>Rp ${item.total.toLocaleString('id-ID')}</td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                    
                    <div class="total-section">
                        <div class="detail">Subtotal: Rp ${invoice.subtotal.toLocaleString('id-ID')}</div>
                        <div class="detail">PPN (11%): Rp ${invoice.tax.toLocaleString('id-ID')}</div>
                        <div class="total">TOTAL: Rp ${invoice.total.toLocaleString('id-ID')}</div>
                    </div>
                    
                    ${invoice.notes ? `<div style="margin-top: 20px;"><strong>Catatan:</strong><br>${invoice.notes}</div>` : ''}
                    
                    <div style="margin-top: 40px; text-align: center; font-size: 12px;">
                        Dicetak pada: ${new Date().toLocaleString('id-ID')}
                    </div>
                </body>
                </html>
            `;
            
            printWindow.document.write(printContent);
            printWindow.document.close();
            printWindow.focus();
            printWindow.print();
        }

        function editInvoice(id) {
            const invoice = invoices.find(inv => inv.id === id);
            if (!invoice) return;
            
            if (confirm(`🔄 EDIT TAGIHAN\n\nNo: ${invoice.invoiceNumber}\nPelanggan: ${invoice.customer}\nTotal: Rp ${invoice.total.toLocaleString('id-ID')}\nStatus: ${invoice.status}\n\nApakah Anda ingin mengedit tagihan ini?`)) {
                // Open edit modal with pre-filled data
                openInvoiceModal();
                
                // Fill the form with existing data
                document.getElementById('invoice-number').value = invoice.invoiceNumber;
                document.getElementById('invoice-date').value = invoice.date;
                document.getElementById('invoice-due-date').value = invoice.dueDate;
                document.getElementById('invoice-customer').value = invoice.customer;
                document.getElementById('invoice-notes').value = invoice.notes || '';
                
                // Clear and populate items
                document.getElementById('invoice-items-container').innerHTML = '';
                invoice.items.forEach((item, index) => {
                    addInvoiceItem();
                    const itemDiv = document.querySelectorAll('.invoice-item')[index];
                    itemDiv.querySelector('.item-description').value = item.description;
                    itemDiv.querySelector('.item-detail').value = item.detail || '';
                    itemDiv.querySelector('.item-quantity').value = item.quantity;
                    itemDiv.querySelector('.item-price').value = item.price;
                    itemDiv.querySelector('.item-total').value = item.total;
                });
                
                calculateInvoiceTotal();
                
                // Mark form as edit mode
                document.getElementById('invoice-form').setAttribute('data-edit-id', id);
            }
        }

        function markInvoicePaid(id) {
            const invoice = invoices.find(inv => inv.id === id);
            if (!invoice) return;
            
            if (invoice.status === 'Lunas') {
                alert('💰 Tagihan ini sudah lunas!');
                return;
            }
            
            if (confirm(`💰 TANDAI LUNAS\n\nNo: ${invoice.invoiceNumber}\nPelanggan: ${invoice.customer}\nTotal: Rp ${invoice.total.toLocaleString('id-ID')}\n\nApakah Anda yakin tagihan ini sudah dibayar lunas?`)) {
                invoice.status = 'Lunas';
                
                renderInvoices();
                updateInvoiceStats();
                updateDashboardStats();
                
                alert(`✅ Tagihan ${invoice.invoiceNumber} berhasil ditandai sebagai LUNAS!\n\nPelanggan: ${invoice.customer}\nTotal: Rp ${invoice.total.toLocaleString('id-ID')}\nStatus: Lunas`);
            }
        }

        function deleteInvoice(id) {
            const invoice = invoices.find(inv => inv.id === id);
            if (!invoice) return;
            
            if (confirm(`🗑️ HAPUS TAGIHAN\n\nNo: ${invoice.invoiceNumber}\nPelanggan: ${invoice.customer}\nTotal: Rp ${invoice.total.toLocaleString('id-ID')}\nStatus: ${invoice.status}\n\n⚠️ PERINGATAN: Data yang dihapus tidak dapat dikembalikan!\n\nApakah Anda yakin ingin menghapus tagihan ini?`)) {
                // Remove from invoices array
                invoices = invoices.filter(inv => inv.id !== id);
                
                // Update customer transaction count
                const customer = customers.find(c => c.name === invoice.customer);
                if (customer && customer.totalTransactions > 0) {
                    customer.totalTransactions--;
                }
                
                // Refresh displays
                renderInvoices();
                updateInvoiceStats();
                updateDashboardStats();
                
                alert(`✅ Tagihan ${invoice.invoiceNumber} berhasil dihapus!`);
            }
        }

        function generateReport() {
            const period = document.getElementById('report-period').value;
            const type = document.getElementById('report-type').value;
            
            if (!period || !type) {
                alert('Silakan pilih periode dan jenis laporan');
                return;
            }
            
            // Calculate date range based on period
            const today = new Date();
            let startDate, endDate = today;
            
            switch (period) {
                case 'today':
                    startDate = new Date(today);
                    break;
                case 'week':
                    startDate = new Date(today);
                    startDate.setDate(today.getDate() - 7);
                    break;
                case 'month':
                    startDate = new Date(today);
                    startDate.setMonth(today.getMonth() - 1);
                    break;
                case 'year':
                    startDate = new Date(today);
                    startDate.setFullYear(today.getFullYear() - 1);
                    break;
            }
            
            const startDateStr = startDate.toISOString().split('T')[0];
            const endDateStr = endDate.toISOString().split('T')[0];
            
            // Filter data based on date range
            const filteredTransactions = transactions.filter(t => t.date >= startDateStr && t.date <= endDateStr);
            const filteredInvoices = invoices.filter(inv => inv.date >= startDateStr && inv.date <= endDateStr);
            const filteredDeliveries = deliveries.filter(d => d.date >= startDateStr && d.date <= endDateStr);
            
            // Generate report based on type
            let reportContent = '';
            
            switch (type) {
                case 'financial':
                    const totalIncome = filteredTransactions.reduce((sum, t) => sum + t.total, 0);
                    const totalExpense = totalIncome * 0.3; // Estimated expenses
                    const netProfit = totalIncome - totalExpense;
                    const outstandingReceivables = filteredInvoices.filter(inv => inv.status === 'Belum Dibayar').reduce((sum, inv) => sum + inv.total, 0);
                    
                    document.getElementById('total-income').textContent = `Rp ${totalIncome.toLocaleString('id-ID')}`;
                    document.getElementById('total-expense').textContent = `Rp ${totalExpense.toLocaleString('id-ID')}`;
                    document.getElementById('net-profit').textContent = `Rp ${netProfit.toLocaleString('id-ID')}`;
                    document.getElementById('outstanding-receivables').textContent = `Rp ${outstandingReceivables.toLocaleString('id-ID')}`;
                    
                    reportContent = `
                        <div class="bg-white rounded-xl p-6 shadow-lg">
                            <h5 class="text-lg font-bold text-gray-900 mb-4">📊 Laporan Keuangan - ${getPeriodText(period)}</h5>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div class="space-y-3">
                                    <div class="flex justify-between p-3 bg-green-50 rounded-lg">
                                        <span class="text-gray-700">Total Pemasukan:</span>
                                        <span class="font-bold text-green-600">Rp ${totalIncome.toLocaleString('id-ID')}</span>
                                    </div>
                                    <div class="flex justify-between p-3 bg-red-50 rounded-lg">
                                        <span class="text-gray-700">Estimasi Pengeluaran:</span>
                                        <span class="font-bold text-red-600">Rp ${totalExpense.toLocaleString('id-ID')}</span>
                                    </div>
                                    <div class="flex justify-between p-3 bg-blue-50 rounded-lg">
                                        <span class="text-gray-700">Keuntungan Bersih:</span>
                                        <span class="font-bold text-blue-600">Rp ${netProfit.toLocaleString('id-ID')}</span>
                                    </div>
                                </div>
                                <div class="space-y-3">
                                    <div class="flex justify-between p-3 bg-purple-50 rounded-lg">
                                        <span class="text-gray-700">Piutang Belum Lunas:</span>
                                        <span class="font-bold text-purple-600">Rp ${outstandingReceivables.toLocaleString('id-ID')}</span>
                                    </div>
                                    <div class="flex justify-between p-3 bg-gray-50 rounded-lg">
                                        <span class="text-gray-700">Total Transaksi:</span>
                                        <span class="font-bold text-gray-600">${filteredTransactions.length}</span>
                                    </div>
                                    <div class="flex justify-between p-3 bg-yellow-50 rounded-lg">
                                        <span class="text-gray-700">Margin Keuntungan:</span>
                                        <span class="font-bold text-yellow-600">${totalIncome > 0 ? ((netProfit/totalIncome)*100).toFixed(1) : 0}%</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                    break;
                    
                case 'sales':
                    const salesByService = {};
                    filteredTransactions.forEach(t => {
                        if (!salesByService[t.service]) {
                            salesByService[t.service] = { count: 0, total: 0 };
                        }
                        salesByService[t.service].count += t.quantity;
                        salesByService[t.service].total += t.total;
                    });
                    
                    reportContent = `
                        <div class="bg-white rounded-xl p-6 shadow-lg">
                            <h5 class="text-lg font-bold text-gray-900 mb-4">📈 Laporan Penjualan - ${getPeriodText(period)}</h5>
                            <div class="overflow-x-auto">
                                <table class="w-full">
                                    <thead>
                                        <tr class="border-b border-gray-200">
                                            <th class="text-left py-3 px-4 font-semibold text-gray-700">Jenis Cetakan</th>
                                            <th class="text-left py-3 px-4 font-semibold text-gray-700">Jumlah Terjual</th>
                                            <th class="text-left py-3 px-4 font-semibold text-gray-700">Total Penjualan</th>
                                            <th class="text-left py-3 px-4 font-semibold text-gray-700">Rata-rata</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        ${Object.entries(salesByService).map(([service, data]) => `
                                            <tr class="border-b border-gray-100">
                                                <td class="py-3 px-4 text-gray-900 font-medium">${service}</td>
                                                <td class="py-3 px-4 text-gray-600">${data.count}</td>
                                                <td class="py-3 px-4 text-gray-900 font-semibold">Rp ${data.total.toLocaleString('id-ID')}</td>
                                                <td class="py-3 px-4 text-gray-600">Rp ${Math.round(data.total/data.count).toLocaleString('id-ID')}</td>
                                            </tr>
                                        `).join('')}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    `;
                    break;
                    
                case 'customer':
                    const customerStats = customers.map(customer => {
                        const customerTransactions = filteredTransactions.filter(t => t.customer === customer.name);
                        const totalSpent = customerTransactions.reduce((sum, t) => sum + t.total, 0);
                        return { ...customer, periodTransactions: customerTransactions.length, periodSpent: totalSpent };
                    }).sort((a, b) => b.periodSpent - a.periodSpent);
                    
                    reportContent = `
                        <div class="bg-white rounded-xl p-6 shadow-lg">
                            <h5 class="text-lg font-bold text-gray-900 mb-4">👥 Laporan Pelanggan - ${getPeriodText(period)}</h5>
                            <div class="overflow-x-auto">
                                <table class="w-full">
                                    <thead>
                                        <tr class="border-b border-gray-200">
                                            <th class="text-left py-3 px-4 font-semibold text-gray-700">Nama Pelanggan</th>
                                            <th class="text-left py-3 px-4 font-semibold text-gray-700">Transaksi Periode</th>
                                            <th class="text-left py-3 px-4 font-semibold text-gray-700">Total Belanja</th>
                                            <th class="text-left py-3 px-4 font-semibold text-gray-700">Status</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        ${customerStats.slice(0, 10).map(customer => {
                                            const status = customer.totalTransactions > 5 ? 'VIP' : customer.totalTransactions > 2 ? 'Aktif' : 'Baru';
                                            const statusClass = status === 'VIP' ? 'bg-purple-100 text-purple-800' : 
                                                              status === 'Aktif' ? 'bg-green-100 text-green-800' : 'bg-blue-100 text-blue-800';
                                            return `
                                                <tr class="border-b border-gray-100">
                                                    <td class="py-3 px-4 text-gray-900 font-medium">${customer.name}</td>
                                                    <td class="py-3 px-4 text-gray-600">${customer.periodTransactions}</td>
                                                    <td class="py-3 px-4 text-gray-900 font-semibold">Rp ${customer.periodSpent.toLocaleString('id-ID')}</td>
                                                    <td class="py-3 px-4">
                                                        <span class="px-2 py-1 ${statusClass} rounded-full text-xs font-medium">${status}</span>
                                                    </td>
                                                </tr>
                                            `;
                                        }).join('')}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    `;
                    break;
                    
                case 'invoice':
                    const paidInvoices = filteredInvoices.filter(inv => inv.status === 'Lunas');
                    const unpaidInvoices = filteredInvoices.filter(inv => inv.status === 'Belum Dibayar');
                    const totalInvoiceValue = filteredInvoices.reduce((sum, inv) => sum + inv.total, 0);
                    const paidValue = paidInvoices.reduce((sum, inv) => sum + inv.total, 0);
                    
                    reportContent = `
                        <div class="bg-white rounded-xl p-6 shadow-lg">
                            <h5 class="text-lg font-bold text-gray-900 mb-4">🧾 Laporan Tagihan - ${getPeriodText(period)}</h5>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                                <div class="space-y-3">
                                    <div class="flex justify-between p-3 bg-green-50 rounded-lg">
                                        <span class="text-gray-700">Tagihan Lunas:</span>
                                        <span class="font-bold text-green-600">${paidInvoices.length}</span>
                                    </div>
                                    <div class="flex justify-between p-3 bg-red-50 rounded-lg">
                                        <span class="text-gray-700">Tagihan Belum Lunas:</span>
                                        <span class="font-bold text-red-600">${unpaidInvoices.length}</span>
                                    </div>
                                </div>
                                <div class="space-y-3">
                                    <div class="flex justify-between p-3 bg-blue-50 rounded-lg">
                                        <span class="text-gray-700">Total Nilai Tagihan:</span>
                                        <span class="font-bold text-blue-600">Rp ${totalInvoiceValue.toLocaleString('id-ID')}</span>
                                    </div>
                                    <div class="flex justify-between p-3 bg-green-50 rounded-lg">
                                        <span class="text-gray-700">Nilai Terbayar:</span>
                                        <span class="font-bold text-green-600">Rp ${paidValue.toLocaleString('id-ID')}</span>
                                    </div>
                                </div>
                            </div>
                            <div class="overflow-x-auto">
                                <table class="w-full">
                                    <thead>
                                        <tr class="border-b border-gray-200">
                                            <th class="text-left py-3 px-4 font-semibold text-gray-700">No. Tagihan</th>
                                            <th class="text-left py-3 px-4 font-semibold text-gray-700">Pelanggan</th>
                                            <th class="text-left py-3 px-4 font-semibold text-gray-700">Nilai</th>
                                            <th class="text-left py-3 px-4 font-semibold text-gray-700">Status</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        ${filteredInvoices.map(invoice => {
                                            const statusClass = invoice.status === 'Lunas' ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800';
                                            return `
                                                <tr class="border-b border-gray-100">
                                                    <td class="py-3 px-4 text-gray-900 font-mono">${invoice.invoiceNumber}</td>
                                                    <td class="py-3 px-4 text-gray-900 font-medium">${invoice.customer}</td>
                                                    <td class="py-3 px-4 text-gray-900 font-semibold">Rp ${invoice.total.toLocaleString('id-ID')}</td>
                                                    <td class="py-3 px-4">
                                                        <span class="px-2 py-1 ${statusClass} rounded-full text-xs font-medium">${invoice.status}</span>
                                                    </td>
                                                </tr>
                                            `;
                                        }).join('')}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    `;
                    break;
                    
                case 'delivery':
                    const deliveredCount = filteredDeliveries.filter(d => d.status === 'Terkirim').length;
                    const inTransitCount = filteredDeliveries.filter(d => d.status === 'Dalam Perjalanan').length;
                    const pendingCount = filteredDeliveries.filter(d => d.status === 'Menunggu Kirim').length;
                    
                    reportContent = `
                        <div class="bg-white rounded-xl p-6 shadow-lg">
                            <h5 class="text-lg font-bold text-gray-900 mb-4">🚚 Laporan Pengiriman - ${getPeriodText(period)}</h5>
                            <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
                                <div class="flex justify-between p-3 bg-green-50 rounded-lg">
                                    <span class="text-gray-700">Terkirim:</span>
                                    <span class="font-bold text-green-600">${deliveredCount}</span>
                                </div>
                                <div class="flex justify-between p-3 bg-blue-50 rounded-lg">
                                    <span class="text-gray-700">Dalam Perjalanan:</span>
                                    <span class="font-bold text-blue-600">${inTransitCount}</span>
                                </div>
                                <div class="flex justify-between p-3 bg-yellow-50 rounded-lg">
                                    <span class="text-gray-700">Menunggu:</span>
                                    <span class="font-bold text-yellow-600">${pendingCount}</span>
                                </div>
                                <div class="flex justify-between p-3 bg-purple-50 rounded-lg">
                                    <span class="text-gray-700">Total:</span>
                                    <span class="font-bold text-purple-600">${filteredDeliveries.length}</span>
                                </div>
                            </div>
                            <div class="overflow-x-auto">
                                <table class="w-full">
                                    <thead>
                                        <tr class="border-b border-gray-200">
                                            <th class="text-left py-3 px-4 font-semibold text-gray-700">No. Surat Jalan</th>
                                            <th class="text-left py-3 px-4 font-semibold text-gray-700">Pelanggan</th>
                                            <th class="text-left py-3 px-4 font-semibold text-gray-700">Tanggal</th>
                                            <th class="text-left py-3 px-4 font-semibold text-gray-700">Status</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        ${filteredDeliveries.map(delivery => {
                                            const statusClass = delivery.status === 'Terkirim' ? 'bg-green-100 text-green-800' : 
                                                              delivery.status === 'Dalam Perjalanan' ? 'bg-blue-100 text-blue-800' : 
                                                              'bg-yellow-100 text-yellow-800';
                                            return `
                                                <tr class="border-b border-gray-100">
                                                    <td class="py-3 px-4 text-gray-900 font-mono">${delivery.deliveryNumber}</td>
                                                    <td class="py-3 px-4 text-gray-900 font-medium">${delivery.customer}</td>
                                                    <td class="py-3 px-4 text-gray-600">${delivery.date}</td>
                                                    <td class="py-3 px-4">
                                                        <span class="px-2 py-1 ${statusClass} rounded-full text-xs font-medium">${delivery.status}</span>
                                                    </td>
                                                </tr>
                                            `;
                                        }).join('')}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    `;
                    break;
            }
            
            document.getElementById('report-content').innerHTML = reportContent;
            
            alert(`✅ Laporan ${getReportTypeText(type)} berhasil dibuat!\n\nPeriode: ${getPeriodText(period)}\nData yang dianalisis:\n• Transaksi: ${filteredTransactions.length}\n• Tagihan: ${filteredInvoices.length}\n• Pengiriman: ${filteredDeliveries.length}`);
        }
        
        function getPeriodText(period) {
            const texts = {
                'today': 'Hari Ini',
                'week': '7 Hari Terakhir',
                'month': '30 Hari Terakhir',
                'year': '1 Tahun Terakhir'
            };
            return texts[period] || period;
        }
        
        function getReportTypeText(type) {
            const texts = {
                'financial': 'Keuangan',
                'sales': 'Penjualan',
                'customer': 'Pelanggan',
                'invoice': 'Tagihan',
                'delivery': 'Pengiriman'
            };
            return texts[type] || type;
        }
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'97741bef11bbcec2',t:'MTc1NjU1NTAzMS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
